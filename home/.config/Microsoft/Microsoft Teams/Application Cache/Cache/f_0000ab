(this.webpackJsonp=this.webpackJsonp||[]).push([[2],{"7YP8":function(e,t,n){"use strict";n.d(t,"b",(function(){return c}));var r=n("+7/b"),o=n("PCsB"),s=n("HLSW"),i=n("Mo3Q"),a=n("yg8y"),c=function(){function e(){}return e.prototype.poll=function(e){var t=this;return this.message$||(this.longPollEvent$=new a.a,Object(s.a)(e.currentUserId,e.chatServiceEndpointProvider).then((function(n){return Object(r.f)(t,void 0,void 0,(function(){var t,o,s,i,a,c;return Object(r.i)(this,(function(u){switch(u.label){case 0:this.longPollUrl||(this.longPollUrl=n.longPollUrl),u.label=1;case 1:u.trys.push([1,6,7,12]),t=Object(r.d)(this.longPoll(e)),u.label=2;case 2:return[4,t.next()];case 3:if((o=u.sent()).done)return[3,5];if(s=o.value,!this.longPollEvent$)return[3,5];this.longPollEvent$.next(s),u.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return i=u.sent(),a={error:i},[3,12];case 7:return u.trys.push([7,,10,11]),o&&!o.done&&(c=t.return)?[4,c.call(t)]:[3,9];case 8:u.sent(),u.label=9;case 9:return[3,11];case 10:if(a)throw a.error;return[7];case 11:return[7];case 12:return[2]}}))}))}),(function(e){t.longPollEvent$&&t.longPollEvent$.error(e),t.reset()})).catch((function(n){return Object(r.f)(t,void 0,void 0,(function(){return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,e.chatServiceEndpointProvider.deleteEndpoint()];case 1:return t.sent(),this.longPollEvent$&&this.longPollEvent$.error(n),this.reset(),[2]}}))}))})),this.message$=new i((function(e){var n,r=null===(n=t.longPollEvent$)||void 0===n?void 0:n.subscribe(e);return function(){r&&r.unsubscribe(),t.reset()}}))),this.message$},e.prototype.longPoll=function(e){var t=e.chatService,n=e.chatServiceEndpointProvider,s=e.sendActiveTimeoutParam;return Object(r.c)(this,arguments,(function(){var e;return Object(r.i)(this,(function(i){switch(i.label){case 0:return this.longPollUrl?[4,Object(r.e)(Object(o.c)(t,n,this.longPollUrl,s))]:[3,5];case 1:return(e=i.sent())?(this.longPollUrl=e.next,[5,Object(r.p)(Object(r.b)(Object(r.d)(e.eventMessages||[])))]):[3,4];case 2:return[4,r.e.apply(void 0,[i.sent()])];case 3:i.sent(),i.label=4;case 4:return[3,0];case 5:return[2]}}))}))},e.prototype.reset=function(){delete this.longPollUrl,delete this.longPollEvent$,delete this.message$},e}()},Dxz4:function(e,t,n){"use strict";n.d(t,"b",(function(){return U})),n.d(t,"a",(function(){return D}));var r=n("+7/b"),o=n("g5XK"),s=n("z4q9"),i=n("3J71"),a=n("zQSw"),c=n("vtvO"),u=n("g9Js"),d=n("yGRu"),h=n("pybt"),l=n("f4tu"),p=n("ifNO"),m=n("svWY"),v=3e5;function f(e){var t=e.get(a.a.ChatService),n=t.maxRetryTimeMs,r=t.maxRetryCount,o=t.minRetryIntervalMs,s=t.maxEndpointFallbackCount,i=t.exponentialDelayFactor;return{retryMaxTimeMs:g(n,3e5),maxRetryCount:g(r,6),expDelayFactor:g(i,2),expDelayMinIntervalMs:g(o,1e3),maxEndpointFallbackCount:g(s,3),maxNotAuthorizedCount:1,maxMinusOneCount:5}}var y=function(e,t){var n=f(e),r=n.retryMaxTimeMs,o=n.maxRetryCount,s=n.maxEndpointFallbackCount,a=n.maxNotAuthorizedCount,c=n.maxMinusOneCount;return{shouldRetry:function(e){return Object(p.h)(e)||[i.j.THROTTLED,i.j.NOT_AUTHORIZED,-1].indexOf(e)>-1},errorHandler:function(e,n){var r=e.serverResponse,o=r.status,u=function(e){var t=Object(m.toNumber)(e["retry-after"]);return!Object(m.isNaN)(t)&&new l.e(Math.min(1e3*t,v))}(r.headers)||n.delay,d=(n.retriesTable[i.j.SERVICE_UNAVAILABLE]||0)+(n.retriesTable[i.j.BAD_GATEWAY]||0),f=n.retriesTable[i.j.NOT_AUTHORIZED]||0,y=n.retriesTable[-1]||0,g=function(){var e=u.next();return null==t||t.mark("retryingRequest",{pauseReason:"status: "+o+", retry table: "+n.retriesTable[o],pauseDelta:e}),Object(h.a)(e)};if([i.j.SERVICE_UNAVAILABLE,i.j.BAD_GATEWAY].indexOf(o)>-1&&d<=s)return g();if(o===i.j.THROTTLED||Object(p.h)(o,[i.j.SERVICE_UNAVAILABLE,i.j.BAD_GATEWAY]))return g();if(o===i.j.NOT_AUTHORIZED&&f<=a)return g();if(-1===o&&y<c)return g();throw e},retryMaxTimeMs:r,maxRetryCount:o,createDelay:function(){var t=f(e),n=t.expDelayFactor,r=t.expDelayMinIntervalMs,o=t.retryMaxTimeMs;return new l.d(r,n,o)}}};function g(e,t){return Object(m.isNil)(e)?t:e}var b=n("8tsx"),S=n("8FIh"),C=n("Ff8T"),j=n("BP+w");function O(e){var t=this;return Object(S.a)(e,(function(e){return Object(r.f)(t,void 0,void 0,(function(){return Object(r.i)(this,(function(t){switch(t.label){case 0:return e instanceof TypeError&&!Object(j.a)().navigator.onLine?[4,Object(h.a)(C.b)]:[3,2];case 1:return t.sent(),[3,3];case 2:throw e;case 3:return[2]}}))}))}))}var T=n("vJjW"),R=n("FaER"),I=n("IoEE"),P=n("F/li"),A=function(){function e(e,t){var n=this;this.callThrottleTracker=new Map,this.maxNumberOfRequestsPerThrottleDuration=e,this.throttlingBucket=t,this.cleanupTimeInMs=10*P.f,this.sleepTimeInMs="Minute"===this.throttlingBucket?P.f:P.i,setInterval((function(){return n.callThrottleTrackerCleanup()}),this.cleanupTimeInMs)}return e.prototype.checkThrottleTracker=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){var n,o;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n=this.makeThrottleKey(e),(o=this.callThrottleTracker.get(n)||0)<this.maxNumberOfRequestsPerThrottleDuration?(this.callThrottleTracker.set(n,++o),[2,Promise.resolve()]):(null==t||t.mark("clientthrottling",{reason:"waiting for "+this.sleepTimeInMs+" milliseconds, apiKey: "+e}),[4,Object(h.a)(this.sleepTimeInMs)]);case 1:return r.sent(),[2,this.checkThrottleTracker(e)]}}))}))},e.prototype.makeThrottleKey=function(e){return e+this.getDateBasedOnThrottleBucket()},e.prototype.getDateBasedOnThrottleBucket=function(){var e=new Date(Date.now()),t=e.getHours().toString()+e.getMinutes().toString();return"Second"===this.throttlingBucket&&(t+=e.getSeconds().toString()),t},e.prototype.callThrottleTrackerCleanup=function(){var e=this;this.callThrottleTracker.forEach((function(t,n){n.endsWith(e.getDateBasedOnThrottleBucket())||e.callThrottleTracker.delete(n)}))},e}(),E="v2/users/ME/endpoints",_="v1/users/ME/conversations",M="v1/threads",N="ChatService",w=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL"],k=["/v1/users/ME/conversations/ALL/properties","/v1/users/ME/conversations/ALL/messages","/v1/threads/ALL"],x="activeTimeout",U=[i.j.BAD_REQUEST,i.j.FORBIDDEN,i.j.NOT_FOUND],D=function(){function e(e,t,n){var r=this;this.coreSettings=t,this.serviceThrottler=new A(9,"Second");this._maxPageSizeForConversations=200,this._maxPageSizeForConvMessages=200,this._send=Object(u.a)(e),this._sendRetryChatService=function(e){return Object(d.b)(r._send,y(r.coreSettings,e))},this._platformService=n}return Object.defineProperty(e.prototype,"maxPageSizeForConversations",{get:function(){return this._maxPageSizeForConversations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"maxPageSizeForConvMessages",{get:function(){return this._maxPageSizeForConvMessages},enumerable:!1,configurable:!0}),e.prototype.createEndpoint=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var o,u,d;return Object(r.i)(this,(function(r){switch(r.label){case 0:return o=[],(u=this.coreSettings.get(a.a.Host).enableMessagingNotificationsOverTrouter)?o.push({channelType:"TrouterPush",interestedResources:k}):o.push({channelType:"HttpLongPoll",interestedResources:w}),d=Object(s.d)(this._platformService),[4,Object(b.a)(this._sendRetryChatService(),i.j.OK)({method:"PUT",url:E+"/"+t,headers:{"content-type":"application/json",clientInfo:d},body:JSON.stringify({endpointFeatures:e,startingTimeSpan:0,subscriptions:o}),serviceName:c.a.CNS,apiName:"endpoint",apiNameDecoration:u?"trouter":"longpoll",correlationId:n})];case 1:return[2,r.sent().body.json()]}}))}))},e.prototype.deleteEndpoint=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,this._deleteRaw(E+"/"+e,"endpoint",t)];case 1:return n.sent(),[2]}}))}))},e.prototype.pollSubscription=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var o,u,d,h,l;return Object(r.i)(this,(function(r){switch(r.label){case 0:return o=e.split("?"),e=o[0],u=o[1],t&&!Object(T.d)(x,u)&&(d=this.coreSettings.get(a.a.ChatService).activeTimeoutCNSDefaultValue||135,h="activeTimeout="+d,u=u?u+"&"+h:h),l=Object(s.d)(this._platformService),[4,Object(b.a)(O(this._send),i.j.OK)({method:"GET",url:e,headers:u?{"x-ms-query-params":u,clientInfo:l}:{clientInfo:l},timeout:9e4,serviceName:c.a.CNS,apiName:"longpoll",correlationId:n})];case 1:return[2,r.sent().body.json()]}}))}))},e.prototype.postActiveEndpoint=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){var n;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n=Object(s.d)(this._platformService),[4,Object(b.a)(this._sendRetryChatService(),i.j.CREATED)({method:"POST",url:e,body:JSON.stringify({timeout:135}),headers:{clientInfo:n},serviceName:c.a.CNS,apiName:"activeendpoint",correlationId:t})];case 1:return r.sent(),[2,Promise.resolve("")]}}))}))},e.prototype.getMyConversations=function(e,t,n,r,o){void 0===e&&(e="All"),void 0===t&&(t=1),void 0===n&&(n=null),void 0===r&&(r=this.maxPageSizeForConversations);var s=_+"?view=msnp24Equivalent&pageSize="+Math.min(r,this.maxPageSizeForConversations);if(n)s+="&syncState="+encodeURIComponent(n);else{if(t<1)return Promise.reject(Object(p.a)(N,i.d.InvalidInput,"getMyConversations",void 0,"Start time too low"));s+="&startTime="+t,null!=e&&(s+="&targetType="+encodeURIComponent(e))}return this._get(s,this._sendRetryChatService(),"myconversations",void 0,o)},e.prototype.getMembersConsumptionHorizon=function(e,t){return this._get("v1/threads/"+encodeURIComponent(e)+"/consumptionhorizons",this._sendRetryChatService(),"thread",t,"consumptionhorizons")},e.prototype.getMyConversation=function(e,t){return this._get(_+"/"+encodeURIComponent(e)+"?view=msnp24Equivalent",this._sendRetryChatService(),"myconversation",t)},e.prototype.getThreadMembers=function(e,t,n){return void 0===t&&(t=5),this._get("v1/threads/"+encodeURIComponent(e)+"/members?view=msnp24Equivalent&pageSize="+t,this._sendRetryChatService(),"thread",n,"members")},e.prototype.getFilteredThreadMembers=function(e,t,n,o,s){var i=this;void 0===n&&(n=5),void 0===o&&(o=10);var a=n*o;return new Promise((function(o,c){var u=function(e,o){return i._get(e,i._sendRetryChatService(),"thread",s,"membersfiltered").then((function(e){var s=Object(r.o)(o,e.members.filter(t));return s.length>=n||!e.nextLink?s.slice(0,n):u(e.nextLink,s)}))};u("v1/threads/"+encodeURIComponent(e)+"/members?view=msnp24Equivalent&selectMemberRoles=User|Admin|Guest&pageSize="+a,[]).then(o).catch(c)}))},e.prototype.getThread=function(e,t){return this._get("v1/threads/"+encodeURIComponent(e)+"?view=msnp24Equivalent",this._sendRetryChatService(t),"thread",null==t?void 0:t.id)},e.prototype.getThreads=function(e,t){if(Object(m.some)(e,(function(e){return Object(m.isEmpty)(e)})))throw TypeError("Invalid thread ids");return this._get("v1/threads?view=msnp24Equivalent&threadIds="+encodeURIComponent(e.join(",")),this._sendRetryChatService(t),"threads",t.id)},e.prototype.createThread=function(e,t,n,o){return Object(r.f)(this,void 0,Promise,(function(){var s,a,c,u,d;return Object(r.i)(this,(function(r){switch(r.label){case 0:return t&&(n.topic=t),[4,this._postRaw(M,{members:e,properties:n},"thread",o)];case 1:if(s=r.sent(),a=s.status,c=s.headers.location,u=s.body,-1===[201,207].indexOf(a)||void 0===c)throw Object(p.a)(N,i.d.RemoteOperationFailed,"createThread",void 0,void 0,s);return d=Object(R.a)(c),[2,{status:a,threadId:d,responseBody:u}]}}))}))},e.prototype.addMembersToThread=function(e,t,n,o){return Object(r.f)(this,void 0,Promise,(function(){var s;return Object(r.i)(this,(function(r){return Object(m.isEmpty)(t)?[2,Promise.reject(Object(p.a)(N,i.d.InvalidInput,"addMembersToThread",void 0,"no members"))]:(s=t.map((function(e){var t=e.id,r=e.role,o={id:t,role:void 0===r?"Admin":r};return Object(m.isNil)(n)||(o.shareHistoryTime=n),o})),[2,this._postRaw("v1/threads/"+encodeURIComponent(e)+"/members",{members:s},"thread_members",o)])}))}))},e.prototype.removeMemberFromThread=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this._deleteRaw("v1/threads/"+encodeURIComponent(e)+"/members/"+t,"thread_members",n)];case 1:return r.sent(),[2]}}))}))},e.prototype.setConversationConsumptionHorizon=function(e,t,n,o){return void 0===n&&(n=!1),Object(r.f)(this,void 0,Promise,(function(){var i,a;return Object(r.i)(this,(function(r){switch(r.label){case 0:return i=n?"consumptionHorizonBookmark":"consumptionhorizon",a=Object(s.d)(this._platformService),[4,this._send({url:"v1/users/ME/conversations/"+encodeURIComponent(e)+"/properties?name="+i,method:"PUT",body:JSON.stringify(n?{consumptionHorizonBookmark:t}:{consumptionhorizon:t}),headers:{clientInfo:a},serviceName:c.a.ChatService,apiName:"conversation",apiNameDecoration:i,correlationId:o})];case 1:return r.sent(),[2]}}))}))},e.prototype.getConversationMessages=function(e,t,n,o,a){return void 0===n&&(n=1),void 0===o&&(o=null),void 0===a&&(a=this.maxPageSizeForConvMessages),Object(r.f)(this,void 0,Promise,(function(){var c,u;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n<1?[2,Promise.reject(Object(p.a)(N,i.d.InvalidInput,"getConversationMessages",void 0,"Start time too low"))]:[4,this.serviceThrottler.checkThrottleTracker("getMessages"+e.conversationId,t)];case 1:return r.sent(),c=e.replyChainId?Object(s.c)(e.conversationId,e.replyChainId):e.conversationId,u=_+"/"+encodeURIComponent(c)+"/messages?view=msnp24Equivalent",Object(s.s)(e.conversationId)&&(u+="|supportsMessageProperties"),u+="&pageSize="+Math.min(a,this.maxPageSizeForConvMessages),o&&(u+="&syncState="+encodeURIComponent(o)),u+="&startTime="+n,[2,this._getRaw(u,this._sendRetryChatService(t),e.replyChainId?"messages_related":"messages",void 0,t.id).then((function(e){return e.body.json().then((function(t){var n=t;return n._metadata.contextid=e.headers.contextid,n}))}))]}}))}))},e.prototype.getConversationMessage=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this.serviceThrottler.checkThrottleTracker("getMessages"+e,n)];case 1:return r.sent(),[2,this._get(_+"/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"?view=msnp24Equivalent|supportsMessageProperties",this._sendRetryChatService(n),"message",null==n?void 0:n.id)]}}))}))},e.prototype.postMessageToConversation=function(e,t,n){return this._postRaw(_+"/"+encodeURIComponent(e)+"/messages",t,"message",n).then((function(e){return e.body.json().then((function(t){return{id:e.headers.location&&Object(m.last)(e.headers.location.split("/")),originalarrivaltime:t&&t.OriginalArrivalTime}}))}))},e.prototype.postInvoke=function(e){return Object(r.f)(this,void 0,Promise,(function(){var t,n,o,s,i;return Object(r.i)(this,(function(a){switch(a.label){case 0:t={},n={};try{(n=JSON.parse(e.value))instanceof Object&&!(n instanceof Array)&&(t=n)}catch(e){t={}}return n.state&&(n.state.type===I.b.BotAuthResultType.JsonAuthResult?t.state=JSON.parse(n.state.value):t.state=n.state.value),o=Object(r.a)({name:e.name,text:e.text,messageType:e.messageType,value:t,imdisplayname:e.imdisplayName,serverMessageId:e.serverMessageId,clientMessageId:e.clientMessageId},e.threadId&&{conversation:{id:e.threadId}}),s="v1/agents/"+e.botMri+"/invoke",[4,this._postRaw(s,o,"botsinvoke",e.scenarioCorrelationId,!0)];case 1:return[4,a.sent().body.text()];case 2:return[2,(i=a.sent())&&i.length>0?JSON.parse(i):""]}}))}))},e.prototype.updateMessageInConversation=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:if(!t.id)throw new RangeError("ID is required for updating a message");return[4,this._putRaw(_+"/"+encodeURIComponent(e)+"/messages/"+t.id,t,"message",n)];case 1:return r.sent(),[2]}}))}))},e.prototype.addMessageEmotion=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var o,s,i;return Object(r.i)(this,(function(r){switch(r.label){case 0:return o=new Date,s={emotions:{key:n,value:o.getTime()}},i=this.coreSettings.get(a.a.Messaging).msgEnableUnlimitedReactions,[4,this._setMessageProperty(e,t,"emotions",s,void 0,!!i)];case 1:return r.sent(),[2,s.emotions.value]}}))}))},e.prototype.getMessageAnnotations=function(e,t,n,o,s){return Object(r.f)(this,void 0,Promise,(function(){var i,c;return Object(r.i)(this,(function(r){return i=this.coreSettings.get(a.a.ChatService).pageSizeForFetchAnnotations||100,c="v1/threads/"+encodeURIComponent(e)+"/messages/"+encodeURIComponent(t)+"/annotations?filter=Type&value="+n+"&pageSize="+i,[2,this._get(c,void 0,"annotations",s,void 0,o?{cursor:o}:void 0)]}))}))},e.prototype.updateMessageLinks=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){return[2,this._setMessageProperty(e,t,"links",n)]}))}))},e.prototype.removeMessageEmotion=function(e,t,n){return this._deleteMessageProperty(e,t,"emotions",{emotions:{key:n}})},e.prototype.setConversationTitle=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,this._setThreadProperty(e,"topic",{topic:t})];case 1:return n.sent(),[2]}}))}))},e.prototype.deleteMessage=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this._deleteRaw(_+"/"+encodeURIComponent(e)+"/messages/"+t+"?behavior=softDelete","message",n)];case 1:return r.sent(),[2]}}))}))},e.prototype.undeleteMessage=function(e,t){return this._deleteMessageProperty(e,t,"deletetime",{deletetime:null})},e.prototype.markStarredMessageAsDeleted=function(e){return this._setMessageProperty(o.eb.StarredConversationId,e,"starred",{starred:{key:"isDeleted",value:"true"}})},e.prototype.getMyProperties=function(e){return this._get("v1/users/ME/properties",void 0,"myproperties",e)},e.prototype.setMyProperty=function(e,t,n){var r="v1/users/ME/properties?name="+encodeURIComponent(e),o={};return o[e]=t,this._putRaw(r,o,"myproperty_"+e,n).then((function(t){var n=t.status;return n!==i.j.OK?Promise.reject(Object(p.a)(N,i.d.FailedToUpdate,"setMyProperty",void 0,"User preferences property "+e+" wasn't updated. Response status code: "+n)):Promise.resolve()}))},e.prototype._messagePropertyUrl=function(e,t,n,r){var o=r?"&replace=true":"";return _+"/"+encodeURIComponent(e)+"/messages/"+t+"/properties?name="+n+o},e.prototype._setMessageProperty=function(e,t,n,o,s,i){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this._putRaw(this._messagePropertyUrl(e,t,n,i),o,"messageproperty_"+n,s)];case 1:return r.sent(),[2]}}))}))},e.prototype._threadPropertyUrl=function(e,t){return"v1/threads/"+encodeURIComponent(e)+"/properties?name="+t},e.prototype._setThreadProperty=function(e,t,n,o){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this._putRaw(this._threadPropertyUrl(e,t),n,"threadproperty_"+t,o)];case 1:return r.sent(),[2]}}))}))},e.prototype._deleteMessageProperty=function(e,t,n,o,s){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this._deleteRaw(this._messagePropertyUrl(e,t,n),"messageproperty",s,o)];case 1:return r.sent(),[2]}}))}))},e.prototype._getRaw=function(e,t,n,o,i,a){var u=Object(s.d)(this._platformService);return t({url:e,method:"GET",headers:Object(r.a)(Object(r.a)({},a),{clientInfo:u}),serviceName:c.a.ChatService,apiName:n,apiNameDecoration:o,correlationId:i})},e.prototype._get=function(e,t,n,r,o,s){return void 0===t&&(t=this._send),this._getRaw(e,t,n,o,r,s).then((function(e){return e.body.json()})).catch((function(e){if(e.code!==i.d.RemoteOperationFailed||Object(p.e)(e,"status",0)!==i.j.NOT_FOUND)throw e}))},e.prototype._putRaw=function(e,t,n,r){var o=Object(s.d)(this._platformService);return this._send({url:e,method:"PUT",headers:{"content-type":"application/json",clientInfo:o},body:JSON.stringify(t),serviceName:c.a.ChatService,apiName:n,correlationId:r})},e.prototype._postRaw=function(e,t,n,r,o){var i=Object(s.d)(this._platformService);return this._send({url:e,method:"POST",headers:{"content-type":"application/json",clientInfo:i},body:o?JSON.stringify(t,(function(e,t){return null===t?void 0:t})):JSON.stringify(t),serviceName:c.a.ChatService,apiName:n,correlationId:r})},e.prototype._deleteRaw=function(e,t,n,r){var o=Object(s.d)(this._platformService);return this._send({url:e,method:"DELETE",body:JSON.stringify(r),headers:{clientInfo:o},serviceName:c.a.ChatService,apiName:t,correlationId:n})},e}()},g9Js:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n("+7/b"),o=n("3J71"),s=n("ifNO");function i(e){var t=this;return function(n){return Object(r.f)(t,void 0,void 0,(function(){var t;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,e(n)];case 1:if((t=r.sent()).status>=o.j.BAD_REQUEST)throw Object(s.a)(o.e.RejectHttpError,o.d.RemoteOperationFailed,"rejectHttpError",void 0,void 0,t);return[2,t]}}))}))}}},"lBu+":function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var r=n("+7/b"),o=n("zQSw"),s=n("vtvO"),i=n("3J71"),a=n("RqlN"),c=n("zDMd"),u=n("yGRu"),d=n("pybt"),h=n("f4tu"),l=n("ifNO"),p=n("svWY"),m=32e4,v=3e5,f=function(e,t){var n=function(e){return{replyChainRetryMaxNotAuthorizedRetries:g(e.get(o.a.CsaService).replyChainRetryMaxNotAuthorizedRetries,0)}}(e).replyChainRetryMaxNotAuthorizedRetries;return{shouldRetry:function(e){return Object(l.h)(e)||e===i.j.THROTTLED||e===i.j.NOT_AUTHORIZED||-1===e},errorHandler:function(e,r){var o=e.serverResponse.status;if(!r.retriesTable[o])throw new Error("ReplyChainCallRetryPolicy: retry count for "+o+" is empty");if(o===i.j.NOT_AUTHORIZED&&r.retriesTable[o]>n)throw e;var s=r.delay.next();return t.mark("retryingRequest",{pauseReason:"status: "+o+", retry table: "+r.retriesTable[o],pauseDelta:s}),Object(d.a)(s)},retryMaxTimeMs:7e3,maxRetryCount:3,createDelay:function(){return new h.b(7e3,1e3,(function(e,t){return(Math.pow(2,t)-1)*e}))}}},y=function(e,t){var n=function(e){var t=e.get(o.a.CsaService),n=t.startupDataMaxRetryTimeMs,r=t.startupRetryMaximumExponentialRetries,s=t.startupRetryMaximumRetries,i=t.startupRetryMinimumInterval,a=t.startupRetryIntervalAfterExponentialRetries;return{retryMaxTimeMs:g(n,m),maxExponentialRetryCount:g(r,6),maxTotalRetryCount:g(s,5),minimumInterval:g(i,1e4),intervalAfterExponentialRetry:g(a,v)}}(e),r=n.retryMaxTimeMs,s=n.maxExponentialRetryCount,a=n.maxTotalRetryCount,c=n.minimumInterval,u=n.intervalAfterExponentialRetry;return{shouldRetry:function(e){return-1===e||e===i.j.THROTTLED||e===i.j.SERVICE_UNAVAILABLE||e===i.j.SERVER_ERROR},errorHandler:function(e,n){var r,o=n.delay.next(),s=null===(r=e.serverResponse)||void 0===r?void 0:r.status;return t.mark("retryingRequest",{pauseReason:"status: "+s+", retry table: "+(s&&n.retriesTable[s]),pauseDelta:o}),Object(d.a)(o)},retryMaxTimeMs:r,maxRetryCount:a,createDelay:function(){return new h.b(r,c,(function(e,t){return t&&t<=s?e*Math.pow(2,t-1):t&&t>s?u:e}))}}};function g(e,t){return Object(p.isNil)(e)?t:e}var b=n("8tsx"),S=n("6qwz"),C=n("DP0A"),j=n("YZyc"),O=n("jFUE"),T=function(){function e(e,t,n,r,o,s){var i=this;this.authenticationService=e,this.platformService=t,this.coreSettings=n,this.discover=r,this.config=s,this._isAnonymousUserCached=void 0,this.getChat=Object(C.a)((function(e){return i._getChat(e)})),this.getBadges=Object(C.a)((function(){return i._getBadges()})),this.getBadgeCounts=Object(C.a)((function(){return i._getBadgeCounts()})),this.registerBadgeCounts=Object(C.a)((function(e){return i._registerBadgeCounts(e)})),this.getTeams=Object(C.a)((function(){return i._getTeams()})),this.getChatsByTitle=Object(C.a)((function(e){return i._getChatsByTitle(e)})),this.getReplyChain=Object(C.a)((function(e,t,n){return i._getReplyChain(e,t,n)}));var a=this._getAPIConstants(),c=a.resource,d=a.version,h=a.endpoints,l=a.host;this.skype=new O.a(r),this.startupCleanEndpoint=h.startupclean,this.startupDeltaEndpoint=h.startupdelta,this.startupCleanAnonymousEndpoint=h.startupcleananonymous,this.startupDeltaAnonymousEndpoint=h.startupdeltaanonymous,this.csaSend=this.addCSASendWrappers(""+l+d,c,o),this.csaSendV2=this.addCSASendWrappers(""+l+j.b,c,o);var p=this.createCSASendWithToken(o,l,d);this.csaReplyChainCallSend=function(e){return Object(u.a)(i.csaSend,f(n,e))},this.csaReplyChainCallSendV2=function(e){return Object(u.a)(i.csaSendV2,f(n,e))},this.csaStartupCallSend=function(e){return Object(u.a)(i.csaSend,y(n,e))},this.csaAnonymousStartupCallSend=function(e){return function(t){return Object(u.a)(p(e),y(n,t))}}}return e.prototype.getReplyChains=function(e,t,n,r,i,a){if(void 0===n&&(n=20),!e||!t)return Promise.reject("teamId: ("+e+") or channelId: ("+t+") cannot be empty");var c,u,d=e===t,h=this.coreSettings.get(o.a.CsaService).filterSystemMessagesGetReplyChains&&d;return h?(c="teams/"+e+"/channels/"+t+"?filterSystemMessage=true&pageSize="+n,u=this.csaReplyChainCallSendV2(a)):(c="teams/"+e+"/channels/"+t+"?pageSize="+n,u=this.csaReplyChainCallSend(a)),i&&(c+="&skip="+i),u({method:"GET",url:c,headers:r&&{"x-ms-continuation":r}||void 0,timeout:this.coreSettings.get(o.a.CsaService).httpTimeoutMillisGetReplyChains||j.q,serviceName:s.a.CSA,apiName:h?j.c.ReplyChainsV2:j.c.ReplyChains,apiNameDecoration:r?"continuation":void 0,correlationId:null==a?void 0:a.id}).then((function(e){return e.body.json()}))},e.prototype.getChats=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var a,c,u,d;return Object(r.i)(this,(function(r){switch(r.label){case 0:a="teams/users/me/chats",c=!1,e&&(a+="?pageSize="+e,c=!0),t&&(a+=(c?"&":"?")+"continuationToken="+encodeURIComponent(t)),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.csaSendV2({method:"GET",url:a,serviceName:s.a.CSA,apiName:j.c.Chats,correlationId:n})];case 2:return[2,r.sent().body.json()];case 3:throw u=r.sent(),d=this.coreSettings.get(o.a.Metadata).ring,Object(l.a)(i.e.CSAService,i.d.RemoteOperationFailed,"getChats",{innerError:u,ring:d},"Could not get chats");case 4:return[2]}}))}))},e.prototype.getRepliesInChain=function(e,t,n,r,o){if(void 0===o&&(o=j.x),!e||!t||!n)return Promise.reject("teamId: ("+e+") or channelId: ("+t+") or postId: ("+n+") cannot be empty");var i="teams/"+e+"/channels/"+t+"/posts/"+n+"/replies?pageSize="+o;return this.csaSend({method:"GET",url:i,headers:r&&{"x-ms-continuation":r}||void 0,serviceName:s.a.CSA,apiName:j.c.RepliesInChain}).then((function(e){return e.body.json()}))},e.prototype.getPostAuthorsList=function(e){return this.csaSend({method:"POST",url:"teams/channels/searchview",headers:{"content-type":"application/json"},serviceName:s.a.CSA,body:JSON.stringify(e),apiName:j.c.PostAuthors}).then((function(e){return e.body.json()}))},e.prototype.getPost=function(e,t,n){if(!e||!t||!n)return Promise.reject("teamId: ("+e+") or channelId: ("+t+") or postId: ("+n+") cannot be empty");var r="teams/"+e+"/channels/"+t+"/posts/"+n;return this.csaSend({method:"GET",url:r,timeout:this.coreSettings.get(o.a.CsaService).httpTimeoutMillisGetReplyChains||j.q,serviceName:s.a.CSA,apiName:j.c.GetPost}).then((function(e){return e.body.json()}))},e.prototype.getMessages=function(e,t,n,r){return void 0===n&&(n=j.x),this.csaSend({method:"GET",url:"chats/"+encodeURIComponent(e)+"/messages?messagePageSize="+n,headers:t&&{"x-ms-messageToken":t}||void 0,serviceName:s.a.CSA,apiName:j.c.ChatMessages,correlationId:r}).then((function(e){return e.body.json()}))},e.prototype.getMessage=function(e,t,n){return this.csaSend({method:"GET",url:"chats/"+encodeURIComponent(e)+"/messages/"+t,serviceName:s.a.CSA,apiName:j.c.ChatMessage,correlationId:n}).then((function(e){return e.body.json()}))},e.prototype.getChatsWithUsers=function(e,t,n){var r="teams/users/me/chats/members";return t&&(r+="?partialMatch=true"),this.csaSend({method:"POST",url:r,headers:{"content-type":"application/json"},body:JSON.stringify(e),serviceName:s.a.CSA,apiName:j.c.ChatWithUser,apiNameDecoration:t?"partial":void 0,correlationId:n}).then((function(e){return e.body.json()}))},e.prototype.getStartupData=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){var n,a,c,u,d,h,p,m;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,this.isAnonymousUser()];case 1:return n=r.sent(),[4,this.validateEndpoint(e,n)];case 2:if(r.sent(),a=this.buildStartupBasePath(e,n),c=a.path,u=a.apiName,d={method:"GET",url:c+="?isPrefetch=false&enableMembershipSummary=true",headers:e&&{"x-ms-synctoken":e}||void 0,timeout:this.coreSettings.get(o.a.CsaService).httpTimeoutMillisGetCsaStartup||j.r,serviceName:s.a.CSA,apiName:u,correlationId:t.id},h=this.csaStartupCallSend,!n)return[3,8];r.label=3;case 3:return r.trys.push([3,7,,8]),this.authenticationService.getSkypeToken?[4,this.authenticationService.getSkypeToken()]:[3,5];case 4:return p=r.sent(),h=this.csaAnonymousStartupCallSend(p.token),[3,6];case 5:return[2,Promise.reject(Object(l.a)(i.e.CSAService,i.d.RemoteOperationFailed,"getStartupData",void 0,"Could not get Skype token for anonymous user. getSkypeToken is not implemented"))];case 6:return[3,8];case 7:return m=r.sent(),[2,Promise.reject(Object(l.a)(i.e.CSAService,i.d.RemoteOperationFailed,"getStartupData",{innerError:m},"Could not get Skype token for anonymous user"))];case 8:return[2,h(t)(d).then((function(e){return e.body.json()}))]}}))}))},e.prototype.postScheduledMessage=function(e,t,n,o){return Object(r.f)(this,void 0,Promise,(function(){var i,a;return Object(r.i)(this,(function(r){return i="chats/"+encodeURIComponent(e)+"/scheduledmessages",e&&t&&n&&o?(a={convId:e,message:t,sendTime:n,action:o},[2,this.csaSend({method:"POST",url:i,headers:{"content-type":"application/json"},body:JSON.stringify(a),serviceName:s.a.CSA,apiName:j.c.ScheduleMessage}).then((function(e){return e.body.json()}))]):[2,Promise.reject("convId: ("+e+") or message: ("+t+") or sendTime: ("+n+") or action: ("+o+") cannot be empty")]}))}))},e.prototype.translateMessages=function(e,t,n,o,a,c,u){return Object(r.f)(this,void 0,Promise,(function(){var d,h,p;return Object(r.i)(this,(function(r){switch(r.label){case 0:if(!(e&&n&&o.length&&a.length))throw Object(l.a)(i.e.CSAService,i.d.InvalidInput,"translateMessages",void 0,"convId, toLanguage, knownLanguages, or, requests cannot be empty");d="chats/"+e+"/messages/languages/"+n,h={"Content-Type":"application/json","x-ms-request-id":c},u?h["x-ms-on-demand-translation"]=""+u:h["x-ms-knownLanguages"]=(o||"").join(","),t&&(h["x-ms-sourceLanguage"]=t),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.csaSend({url:d,method:"POST",headers:h,serviceName:s.a.CSA,apiName:j.c.TranslateMessages,body:JSON.stringify(a),correlationId:c})];case 2:return[2,r.sent().body.json()];case 3:throw p=r.sent(),Object(l.a)(i.e.CSAService,i.d.RemoteOperationFailed,"translateMessages",{innerError:p},"Could not translate messages");case 4:return[2]}}))}))},e.prototype.getSupportedTranslationLanguages=function(e){return Object(r.f)(this,void 0,Promise,(function(){var t,n,o;return Object(r.i)(this,(function(r){switch(r.label){case 0:if(!e)throw Object(l.a)(i.e.CSAService,i.d.InvalidInput,"getSupportedTranslationLanguages",void 0,"locale must not be empty");t="translator/languages?locale="+e,n={"Content-Type":"application/json"},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this.csaSend({url:t,method:"GET",headers:n,serviceName:s.a.CSA,apiName:j.c.GetSupportedTranslationLanguages})];case 2:return[2,r.sent().body.json()];case 3:throw o=r.sent(),Object(l.a)(i.e.CSAService,i.d.RemoteOperationFailed,"getSupportedTranslationLanguages",{innerError:o},"Could not retrieve supported translation languages");case 4:return[2]}}))}))},e.prototype.getAuthorizedSend=function(e,t,n){return this.shouldAuthBySkypeTokenAlone()?this.skype.authorize(n,"x-skypetoken"):this.shouldAuthBySkypeTokenAndAADToken(e)?this.authenticationService.authorize(this.skype.authorize(n,"x-skypetoken"),t):this.authenticationService.authorize(n,t)},e.prototype.shouldAddCSEndpointHeader=function(e){return this.shouldAuthBySkypeTokenAndAADToken(e)},e.prototype.addCSASendWrappers=function(e,t,n){var o=this;return function(s){return Object(r.f)(o,void 0,void 0,(function(){var o;return Object(r.i)(this,(function(r){switch(r.label){case 0:return s.headers=this._addHeadersOverrides(s.headers),this.shouldAddCSEndpointHeader(s.apiName)?(o=s,[4,this._addChatServiceEndpointToHeaders(s.headers)]):[3,2];case 1:o.headers=r.sent(),r.label=2;case 2:return[2,Object(b.a)(Object(S.a)(this.getAuthorizedSend(s.apiName,t,n),e),i.k.HTTP_2XX)(s)]}}))}))}},e.prototype.createCSASendWithToken=function(e,t,n){var r=this;return function(o){return function(s){return s.headers=r._addHeadersOverrides(s.headers),Object(b.a)(Object(S.a)(r._addBearerTokenHeader(e,o),""+t+n),i.k.HTTP_2XX)(s)}}},e.prototype.validateEndpoint=function(e,t){return e&&(!t&&!this.startupDeltaEndpoint||t&&!this.startupDeltaAnonymousEndpoint)?Promise.reject("endpoint cannot be empty for startupdelta call"):e||(t||this.startupCleanEndpoint)&&(!t||this.startupCleanAnonymousEndpoint)?Promise.resolve():Promise.reject("endpoint cannot be empty for startupclean call")},e.prototype.buildStartupBasePath=function(e,t){var n="",r="";return t?(n+=this.getAnonymousStartupBasePath(e),r=e?"anonymousstartupdelta":"anonymousstartupclean"):(n+=this.getDefaultStartupBasePath(e),r=e?"startupdelta":"startupclean"),{path:n,apiName:r}},e.prototype.getAnonymousStartupBasePath=function(e){return e?this.startupDeltaAnonymousEndpoint:this.startupCleanAnonymousEndpoint},e.prototype.getDefaultStartupBasePath=function(e){return e?this.startupDeltaEndpoint:this.startupCleanEndpoint},e.prototype.isAnonymousUser=function(){return Object(r.f)(this,void 0,Promise,(function(){var e,t;return Object(r.i)(this,(function(n){switch(n.label){case 0:if(void 0!==this._isAnonymousUserCached)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.authenticationService.getUser()];case 2:return e=n.sent(),this._isAnonymousUserCached=e&&e.role===a.b.Anonymous,[3,4];case 3:return t=n.sent(),[2,Promise.reject(Object(l.a)(i.e.CSAService,i.d.RemoteOperationFailed,"getStartupData",{innerError:t},"Could not check for anonymous user"))];case 4:return[2,Promise.resolve(this._isAnonymousUserCached)]}}))}))},e.prototype.shouldAuthBySkypeTokenAlone=function(){return!!this.coreSettings.get(o.a.CsaService).onlySkypeTokenForAllAPIs},e.prototype.shouldAuthBySkypeTokenAndAADToken=function(e){return e===j.c.StartupClean||e===j.c.StartupDelta?!!this.coreSettings.get(o.a.CsaService).enableSkypeTokenForCSAStartupAPI:(e===j.c.ReplyChainsV2||e===j.c.ReplyChains)&&!!this.coreSettings.get(o.a.CsaService).enableSkypeTokenForCSAReplyChainAPI},e.prototype._getReplyChain=function(e,t,n,r){return this.csaSend({method:"GET",url:"teams/"+encodeURIComponent(e)+"/channels/"+encodeURIComponent(t)+"/"+encodeURIComponent(n),serviceName:s.a.CSA,apiName:j.c.ReplyChain,correlationId:r}).then((function(e){return e.body.json()}))},e.prototype._getChat=function(e,t){return this.csaSend({method:"GET",url:"teams/users/me/chats/"+encodeURIComponent(e),serviceName:s.a.CSA,apiName:j.c.Chat,correlationId:t}).then((function(e){return e.body.json()}))},e.prototype._getBadges=function(e){return this.csaSend({method:"GET",url:"teams/users/me/badges?getUnreadNotificationCount=true&getUnreadChatCount=true",serviceName:s.a.CSA,apiName:j.c.Badges,correlationId:e}).then((function(e){return e.body.json()}))},e.prototype._registerBadgeCounts=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(n){return[2,this.csaSend({method:"PUT",url:"teams/users/me/badges/registration",headers:{"content-type":"application/json"},body:JSON.stringify(e),serviceName:s.a.CSA,apiName:j.c.Badges,correlationId:t})]}))}))},e.prototype._getBadgeCounts=function(e){return this.csaSend({method:"GET",url:"teams/users/me/badges/aggregatedbadgecounts",serviceName:s.a.CSA,apiName:j.c.Badges,correlationId:e}).then((function(e){return e.body.json()}))},e.prototype._getTeams=function(e){return this.csaSend({method:"GET",url:"teams/users/me/teams?enableMembershipSummary=true",serviceName:s.a.CSA,apiName:j.c.Teams,correlationId:e}).then((function(e){return e.body.json()}))},e.prototype._getChatsByTitle=function(e,t){return this.csaSend({method:"GET",url:"teams/users/me/chats/chatsByTitle?title="+encodeURIComponent(e),serviceName:s.a.CSA,apiName:j.c.ChatsByTitle,correlationId:t}).then((function(e){return e.body.json()}))},e.prototype._addBearerTokenHeader=function(e,t){return function(n){return e(Object(r.a)(Object(r.a)({},n),{headers:Object(r.a)(Object(r.a)({},n.headers),{Authorization:"Bearer "+t})}))}},e.prototype._addChatServiceEndpointToHeaders=function(e){return Object(r.f)(this,void 0,Promise,(function(){var t;return Object(r.i)(this,(function(n){switch(n.label){case 0:return e=e||{},[4,this.discover.regionGtm(o.b.Gtm.chatService)];case 1:return t=n.sent(),e["x-csendpoint"]=t,[2,e]}}))}))},e.prototype._addHeadersOverrides=function(e){var t;e=e||{};var n=this._getClientType(),r=this.coreSettings.get(o.a.Metadata).ring;e["x-ringoverride"]=(null==r?void 0:r.id)||"";var s=null===(t=this.config)||void 0===t?void 0:t.experienceName;return e["x-ms-client-type"]=n===c.c.Embed&&s?n+"-"+s:n,e},e.prototype._getClientType=function(){var e,t;return this.platformService.config.hostingParent===c.d.Outlook?c.d.Outlook:(null===(e=this.config)||void 0===e?void 0:e.clientTypeServiceHeader)?null===(t=this.config)||void 0===t?void 0:t.clientTypeServiceHeader:this.platformService.config.clientType},e.prototype._getAPIConstants=function(){var e=this.coreSettings.get(o.a.CsaService).apiConstants,t=e||{},n=t.resource,r=void 0===n?j.p:n,s=t.version,i=void 0===s?j.a:s,a=t.endpoints;return{resource:r,version:i,endpoints:void 0===a?j.n:a,host:this.coreSettings.get(o.a.Test).csaHostOverrideUrl||e&&e.host||j.o}},e}()},yGRu:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return i}));var r=n("8FIh"),o=n("cvjv");function s(e,t){return function(n){return c((function(){return e(n)}),t)}}function i(e,t){return function(n){return u(c((function(){return e(n)}),t),t)}}var a=function(e,t){if(!e.serverResponse)throw e;var n=e.serverResponse.status;if(n&&t.retryCount++<t.policy.maxRetryCount&&t.policy.shouldRetry(n))return t.retriesTable[n]=(t.retriesTable[n]||0)+1,t.policy.errorHandler(e,t);throw e},c=function(e,t){return Object(r.a)(e,a)({policy:t,delay:t.createDelay(),retryCount:0,retriesTable:{}})},u=function(e,t){return Object(o.a)(e,t.retryMaxTimeMs)}}}]);