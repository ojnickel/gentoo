webpackJsonp([26],{136:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,a,i,s,n,l,r,c){this.title=e,this.messages=t,this.valueCSSClass=a,this.compareType=i,this.sourceStatKey=s,this.eventsThatEnableMetric=n,this.eventsThatDisableMetric=l,this.thresholds=r,this.valueConversion=c,this.state=teamspace.services.CallHealthStateOld.NotAvailable,this.enabled=!1}return e.prototype.updateMetric=function(e){var t=e.get(this.sourceStatKey);return null!=t&&(null==this.value&&(this.enabled=!0),this.value=this.valueConversion(t),1!==this.compareType&&(this.state=this.getState(t)),!0)},e.prototype.getState=function(e){if("number"!=typeof parseInt(e.toString())||2===this.compareType)return teamspace.services.CallHealthStateOld.NotAvailable;switch(this.compareType){case 4:return e<this.thresholds.Amber?teamspace.services.CallHealthStateOld.Green:e<this.thresholds.Red?teamspace.services.CallHealthStateOld.Amber:teamspace.services.CallHealthStateOld.Red;case 3:return e>this.thresholds.Amber?teamspace.services.CallHealthStateOld.Green:e>this.thresholds.Red?teamspace.services.CallHealthStateOld.Amber:teamspace.services.CallHealthStateOld.Red;default:return teamspace.services.CallHealthStateOld.NotAvailable}},e.prototype.disableMetric=function(){this.enabled=!1},e.prototype.enableMetric=function(){null!=this.value&&(this.enabled=!0)},e.prototype.handleEvent=function(e){_.includes(this.eventsThatEnableMetric,e)&&this.enableMetric(),_.includes(this.eventsThatDisableMetric,e)&&this.disableMetric()},e}();t.CallHealthMetricOld=i},2557:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(2558)},2558:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(2559)},2559:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2560),s=a(2561),n=function(){function e(e,t,a,i,n,l,r,c,o){this.meetingPolicySettingsStore=e,this.loggingService=t,this.$scope=a,this.$interval=i,this.$q=n,this.constants=l,this.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.broadcast,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close Call health panel from header"},this.categories=[],this.healthStates=teamspace.services.CallHealthStateOld,this.customRightRailHeader=!1,this.callTechInfoRefreshInterval=null,this.technicalInfoApiCount=0,this.panelType=teamspace.components.Calling.RightPanel.CallHealth,this.metricDefinitionFactory=new s.CallHealthMetricDefinitionFactoryOld(c,o),this.callHealthTabSettings=r.valueFor(l.callHealthTab.settings);var h=(this.callHealthTabSettings.technicalInfoRefreshRate/1e3).toString();this.disclaimerText=c.instant(o.strings.call_health_tab_disclaimer,{refreshRate:h}),this.isUbarEnabled=3===this.meetingPanelLocation&&r.valueAsBoolean(l.settings.names.enableUnifiedControlBar)||(2===this.meetingPanelLocation||1)&&r.valueAsBoolean(l.settings.names.enableUbarV2ForBroadcast),this.customRightRailHeader=r.valueAsBoolean(l.settings.names.customRightRailHeader),this.initialize()}return e.$inject=["meetingPolicySettingsStore","loggingService","$scope","$interval","$q","constants","settingsService","$translate","resources"],e.prototype.initialize=function(){var e=this,t=this.callHealthTabSettings.technicalInfoRefreshRate;this.isVideoOn=this.call.isVideoOn,this.categories=this.metricDefinitionFactory.getCategories(this.meetingPanelLocation);var a=this.getPolicyStats();this.updateCategories(a),this.getCallTechnicalInfoStatsPromise=teamspace.services.QCancelable.toCancelablePromise(this.$q,this.getCallTechnicalInfoStats()),this.getCallTechnicalInfoStatsPromise.then(function(t){e.updateCategories(t)}),this.callChangedSubscription=this.call.changed(function(){e.callChanged()}),this.callTechInfoRefreshInterval=this.$interval(function(){return e.refreshFromCallTechnicalInfo()},t,0,!0),this.$scope.$on("$destroy",function(){return e.destroy()})},e.prototype.destroy=function(){var e;if(this.$interval.cancel(this.callTechInfoRefreshInterval),this.callTechInfoRefreshInterval=null,this.callChangedSubscription&&(this.callChangedSubscription.dispose(),this.callChangedSubscription=null),this.getTechnicalInfoScenario&&(this.getTechnicalInfoScenario.cancel(),this.getTechnicalInfoScenario=null),this.technicalInfoApiCount%this.callHealthTabSettings.technicalInfoScenarioSampleNumber!=1){var t=this.loggingService.newScenario(this.constants.callHealthTab.getTechnicalInfoScenario);this.technicalInfoApiLastCallSuccess?t.stop():t.fail((e={},e[this.constants.scenarioDataPropNames.broadcastError]=this.technicalInfoApiLastCallError,e))}this.getCallTechnicalInfoStatsPromise&&(teamspace.services.QCancelable.cancel(this.getCallTechnicalInfoStatsPromise),this.getCallTechnicalInfoStatsPromise=null)},e.prototype.updateCategories=function(e){this.categories.forEach(function(t){return t.updateMetrics(e)})},e.prototype.handleEvent=function(e){this.categories.forEach(function(t){return t.handleEvent(e)})},e.prototype.getPolicyStats=function(){var e=new Map;e.set("MediaBitRateKb",this.meetingPolicySettingsStore.getSettingValue(SkypeX.Services.MeetingPolicySettingsStorageKey.mediaBitRateKb));var t,a=this.meetingPolicySettingsStore.getSettingValue(SkypeX.Services.MeetingPolicySettingsStorageKey.allowIPVideo),i=this.meetingPolicySettingsStore.getSettingValue(SkypeX.Services.MeetingPolicySettingsStorageKey.screenSharingMode)===SkypeX.Services.ScreenSharingMode.entireScreen;return t=a&&i?3:a||i?a?1:2:4,e.set("IPVideoVBSSPolicyState",t),e},e.prototype.getCallTechnicalInfoStats=function(){var e=this,t=new Map;return this.technicalInfoApiCount%this.callHealthTabSettings.technicalInfoScenarioSampleNumber==0&&(this.getTechnicalInfoScenario=this.loggingService.newScenario(this.constants.callHealthTab.getTechnicalInfoScenario)),this.technicalInfoApiCount++,new Promise(function(a,i){e.call.getTechnicalInformationJson().then(function(i){var s=JSON.parse(i),n=s&&s.channels,l=n&&n[1];if(l&&(l.hasOwnProperty("Received BW estimate")&&t.set("Received BW estimate",l["Received BW estimate"]),l.hasOwnProperty("Send RTT (Avg)")&&t.set("Send RTT (Avg)",l["Send RTT (Avg)"]),l.hasOwnProperty("Send Actual Height")&&t.set("Send Actual Height",l["Send Actual Height"]),l.hasOwnProperty("Sent Codec Name"))){var r=void 0,c=l["Sent Codec Name"].toString().trim().split(" ");2===c.length?r="hw"==c[1]?1:2:c.length>2&&(r=3),t.set("Sent Codec Name",r)}return e.technicalInfoApiLastCallSuccess=!0,e.technicalInfoApiLastCallError=null,e.getTechnicalInfoScenario&&(e.getTechnicalInfoScenario.stop(),e.getTechnicalInfoScenario=null),e.getCallTechnicalInfoStatsPromise=null,a(t)}).catch(function(t){var a;return e.logger.error("Error while fetching technical information from call."),e.technicalInfoApiLastCallSuccess=!1,e.technicalInfoApiLastCallError=JSON.stringify(t),e.getTechnicalInfoScenario&&(e.getTechnicalInfoScenario.fail((a={},a[e.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(t),a)),e.getTechnicalInfoScenario=null),e.loggingService.event(e.constants.callHealthTab.getTechnicalInfoFailure,{error:JSON.stringify(t)}),e.getCallTechnicalInfoStatsPromise=null,i(t)})})},e.prototype.callChanged=function(){if(this.call.isVideoOn!=this.isVideoOn){this.isVideoOn=this.call.isVideoOn;var e=this.isVideoOn?2:1;this.handleEvent(e),2==e&&this.refreshFromCallTechnicalInfo()}},e.prototype.refreshFromCallTechnicalInfo=function(){var e=this;this.getCallTechnicalInfoStatsPromise&&teamspace.services.QCancelable.cancel(this.getCallTechnicalInfoStatsPromise),this.getCallTechnicalInfoStatsPromise=teamspace.services.QCancelable.toCancelablePromise(this.$q,this.getCallTechnicalInfoStats()),this.getCallTechnicalInfoStatsPromise.then(function(t){t&&e.updateCategories(t)})},e}();t.CallHealthTabController=n,angular.module("teamspace.callHealthTab",["teamspace.loggingService","teamspace.constants"]).component("callHealthTab",{bindings:{call:"<?",meetingPanelLocation:"<?"},controllerAs:"ctrl",controller:n,templateUrl:"components/calling/common/call-health-tab/call-health-tab.html"}).run(["$templateCache",function(e){e.put("components/calling/common/call-health-tab/call-health-tab.html",i)}])},2560:function(e,t){e.exports='<div class="health-panel" id="callHealthTab" ng-class="::{\'right-pane-header\': ctrl.customRightRailHeader, \'unified-bar-mode\': ctrl.isUbarEnabled}">\n  <right-pane-header ng-if="ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{ctrl.panelType}}" text="{{::$root.resources.strings.call_health_tab_title|translate}}" telemetry-bag="ctrl.telemetryBag">\n  </right-pane-header>\n\n  <div class="disclaimer" ng-bind-html="::ctrl.disclaimerText"></div>\n  <div simple-scrollbar>\n    <div> \x3c!-- Single empty child div required by simple-scrollbar --\x3e\n      <div class="health-tab-content">\n        \x3c!-- Categories --\x3e\n        <ul class="health-category" ng-repeat="category in ctrl.categories">\n          \x3c!-- title --\x3e\n          <div ng-click="category.toggleExpand();" id="{{\'category_\' + $index}}" role="button" aria-expanded="{{category.expand}}" aria-controls="{{\'metrics_of_\'+ $index}}" class="health-category-title inset-border inset-border-themed ts-sym" tabindex="0">\n            <button class="ts-sym category-expand-arrow app-icons-fill-focus" tabindex="-1"><ng-include src="\'svg/icons-triangle-\' + (category.expand ? \'down\' : \'right\') + \'-small.html\'" class="iconWrapper"></ng-include></button> \x3c!-- button with aria-expanded tag--\x3e\n            <h3 class="category-title">{{category.title}}</h3>\n            <div class="category-state-icon" ng-if="!category.expand && category.state !== ctrl.healthStates.NotAvailable"><ng-include src="\'svg/icons-\' + (category.state === ctrl.healthStates.Green ? \'good\' : (category.state === ctrl.healthStates.Amber ? \'circle-warning\' : \'critical\')) + \'.html\'" class="iconWrapper"></ng-include></div>\n          </div>\n          \x3c!-- metrics --\x3e\n          <div id="{{\'metrics_of_\'+ $index}}" aria-labelledby="{{\'category_\' + $index}}">\n            <li class="health-metric" ng-show="category.expand" ng-repeat="(name, metric) in category.metrics">\n              <div>\n                <div class="health-metric-title" ng-class="{\'metric-title-disabled\': !metric.enabled}">\n                  <span class="metric-title">{{metric.title}}</span>\n                  <div class="metric-title-icon-info" ng-attr-title="{{metric.messages[\'helpText\']}}"><ng-include src="\'svg/icons-info.html\'"></ng-include></div>\n                  <div class="metric-state-icon" ng-show="metric.enabled && metric.state !== ctrl.healthStates.NotAvailable"><ng-include src="\'svg/icons-\' + (metric.state === ctrl.healthStates.Green ? \'good\' : (metric.state === ctrl.healthStates.Amber ? \'circle-warning\' : \'critical\')) + \'.html\'" class="iconWrapper"></ng-include></div>\n                </div>\n                <div class="metric-value" ng-class="metric.valueCSSClass" ng-show="metric.enabled">{{metric.value}}</div>\n                <div class="metric-disabled-text" ng-if="metric.messages[\'disabledText\'] && !metric.enabled">{{metric.messages["disabledText"]}}</div>\n                <div class="metric-state-text" ng-if="metric.enabled && metric.state == ctrl.healthStates.Green && metric.messages[\'stateGreenText\']">{{metric.messages["stateGreenText"]}}</div>\n                <div class="metric-state-text" ng-if="metric.enabled && metric.state == ctrl.healthStates.Amber && metric.messages[\'stateAmberText\']">{{metric.messages["stateAmberText"]}}</div>\n                <div class="metric-state-text" ng-if="metric.enabled && metric.state == ctrl.healthStates.Red && metric.messages[\'stateRedText\']">{{metric.messages["stateRedText"]}}</div>\n              </div>\n            </li>\n          </div>\n          \x3c!-- metrics --\x3e\n\n        </ul> \x3c!-- health-category --\x3e\n      </div> \x3c!-- health-tab-content --\x3e\n    </div> \x3c!-- child - simple-scrollbar --\x3e\n  </div> \x3c!-- simple-scrollbar --\x3e\n</div>'},2561:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a(2562),s=a(136),n=a(2563),l=a(2564),r=function(){function e(e,t){this.$translate=e,this.resources=t}return e.prototype.getCategories=function(e){var t=[];switch(e){case 1:case 2:case 3:var a=[];a.push(this.getNewSendBandwidthEstimateMetric()),a.push(this.getNewRoundTripTimeMetric()),t.push(new i.CallHealthCategoryOld(this.$translate.instant(this.resources.strings.call_health_tab_category_title_network),a));var s=[];s.push(this.getNewCameraCodecMetric()),s.push(this.getNewCameraSendResolutionMetric()),t.push(new i.CallHealthCategoryOld(this.$translate.instant(this.resources.strings.call_health_tab_category_title_devices),s));var n=[];return n.push(this.getNewMediaSharingPolicyMetric()),n.push(this.getNewMediaBitRateLimitPolicyMetric()),t.push(new i.CallHealthCategoryOld(this.$translate.instant(this.resources.strings.call_health_tab_category_title_policy),n)),t;default:return t}},e.prototype.getNewSendBandwidthEstimateMetric=function(){var e=this,t=this.$translate.instant(this.resources.strings.call_health_tab_metric_title_send_bandwidth),a={disabledText:this.$translate.instant(this.resources.strings.call_health_tab_camera_disabled_text),helpText:this.$translate.instant(this.resources.strings.call_health_tab_metric_tooltip_send_bandwidth)};return new s.CallHealthMetricOld(t,a,null,1,"Received BW estimate",[2],[1],null,function(t){var a=parseInt(t.toString());if(!a)return t;var i=parseFloat((a/1e6).toFixed(2));return e.$translate.instant(e.resources.strings.call_health_tab_value_suffix_mbps,{value:i})})},e.prototype.getNewRoundTripTimeMetric=function(){var e=this,t=this.$translate.instant(this.resources.strings.call_health_tab_metric_title_round_trip_time),a={disabledText:this.$translate.instant(this.resources.strings.call_health_tab_camera_disabled_text),helpText:this.$translate.instant(this.resources.strings.call_health_tab_metric_tooltip_round_trip_time)};return new s.CallHealthMetricOld(t,a,null,1,"Send RTT (Avg)",[2],[1],null,function(t){return e.$translate.instant(e.resources.strings.call_health_tab_value_suffix_ms,{value:t})})},e.prototype.getNewCameraCodecMetric=function(){var e=this,t=this.$translate.instant(this.resources.strings.call_health_tab_metric_title_camera_codec),a={disabledText:this.$translate.instant(this.resources.strings.call_health_tab_camera_disabled_text),helpText:this.$translate.instant(this.resources.strings.call_health_tab_metric_tooltip_camera_codec),stateAmberText:this.$translate.instant(this.resources.strings.call_health_tab_metric_amber_state_text_camera_codec),stateRedText:this.$translate.instant(this.resources.strings.call_health_tab_metric_red_state_text_camera_codec)};return new n.CallHealthMetricCodecOld(t,a,"metric-value-small-text",1,"Sent Codec Name",[2],[1],null,function(t){switch(t){case 1:return e.$translate.instant(e.resources.strings.call_health_tab_camera_codec_hardware);case 2:return e.$translate.instant(e.resources.strings.call_health_tab_camera_codec_software);case 3:return e.$translate.instant(e.resources.strings.call_health_tab_camera_codec_hardware_software_fluctuation);case 4:return}})},e.prototype.getNewCameraSendResolutionMetric=function(){var e=this,t=this.$translate.instant(this.resources.strings.call_health_tab_metric_title_camera_send_resolution),a={disabledText:this.$translate.instant(this.resources.strings.call_health_tab_camera_disabled_text),helpText:this.$translate.instant(this.resources.strings.call_health_tab_metric_tooltip_camera_send_resolution)};return new s.CallHealthMetricOld(t,a,null,1,"Send Actual Height",[2],[1],null,function(t){return e.$translate.instant(e.resources.strings.call_health_tab_value_suffix_resolution,{value:t})})},e.prototype.getNewMediaSharingPolicyMetric=function(){var e=this,t=this.$translate.instant(this.resources.strings.call_health_tab_metric_title_media_sharing_policy),a={helpText:this.$translate.instant(this.resources.strings.call_health_tab_metric_tooltip_media_sharing_policy)};return new l.CallHealthMetricMediaSharingPolicyOld(t,a,"metric-value-small-text",1,"IPVideoVBSSPolicyState",null,null,null,function(t){switch(t){case 1:return e.$translate.instant(e.resources.strings.call_health_tab_media_sharing_ip_video_only);case 2:return e.$translate.instant(e.resources.strings.call_health_tab_media_sharing_screen_sharing_only);case 3:return e.$translate.instant(e.resources.strings.call_health_tab_media_sharing_both_enabled);case 4:return e.$translate.instant(e.resources.strings.call_health_tab_media_sharing_both_disabled)}})},e.prototype.getNewMediaBitRateLimitPolicyMetric=function(){var e=this,t=this.$translate.instant(this.resources.strings.call_health_tab_metric_title_media_bitrate_limit_policy),a={helpText:this.$translate.instant(this.resources.strings.call_health_tab_metric_tooltip_media_bitrate_limit_policy)};return new s.CallHealthMetricOld(t,a,null,1,"MediaBitRateKb",null,null,null,function(t){var a=parseInt(t.toString());if(!a)return t;var i=parseFloat((a/1e3).toFixed(2));return e.$translate.instant(e.resources.strings.call_health_tab_value_suffix_mbps,{value:i})})},e}();t.CallHealthMetricDefinitionFactoryOld=r},2562:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,a){void 0===a&&(a=!0),this.title=e,this.metrics=t,this.expand=a,this.state=teamspace.services.CallHealthStateOld.NotAvailable}return e.prototype.updateMetrics=function(e){var t=!1;this.metrics.forEach(function(a){t=a.updateMetric(e)||t}),t&&this.updateHealthState()},e.prototype.updateHealthState=function(){this.state=Math.max.apply(Math,_.values(this.metrics).map(function(e){return e.state}))},e.prototype.toggleExpand=function(){this.expand=!this.expand},e.prototype.handleEvent=function(e){this.metrics.forEach(function(t){return t.handleEvent(e)})},e}();t.CallHealthCategoryOld=i},2563:function(e,t,a){"use strict";var i=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getState=function(e){if(2!==this.compareType)return teamspace.services.CallHealthStateOld.NotAvailable;switch(e){case 1:return teamspace.services.CallHealthStateOld.Green;case 2:return teamspace.services.CallHealthStateOld.Amber;case 3:return teamspace.services.CallHealthStateOld.Red;default:return teamspace.services.CallHealthStateOld.NotAvailable}},t}(a(136).CallHealthMetricOld);t.CallHealthMetricCodecOld=s},2564:function(e,t,a){"use strict";var i=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function i(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.getState=function(e){if(2!==this.compareType)return teamspace.services.CallHealthStateOld.NotAvailable;switch(e){case 4:return teamspace.services.CallHealthStateOld.Red;case 1:case 2:return teamspace.services.CallHealthStateOld.Amber;case 3:return teamspace.services.CallHealthStateOld.Green;default:return teamspace.services.CallHealthStateOld.NotAvailable}},t}(a(136).CallHealthMetricOld);t.CallHealthMetricMediaSharingPolicyOld=s}},[2557]);