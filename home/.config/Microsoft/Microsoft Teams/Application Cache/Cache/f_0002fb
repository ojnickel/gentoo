webpackJsonp([22],{2767:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2768),n(2770),n(2772),n(2774),n(2776),n(2778)},2768:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2769),s=function(){function e(e,t,n,i,s,a,r,l,o,c,d,h){var m=this;this.constants=e,this.$scope=t,this.loggingService=n,this.$translate=i,this.dialogService=s,this.$timeout=a,this.ngDialog=r,this.resources=l,this.settingsService=o,this.utilityService=c,this.$q=d,this.$element=h,this.previewIsRequested=!0,this.attachEnable=!0,this.showPlaceholderElement=!1,this.isWarning=!1,this.media=null,this.mediaArray=[],this.mediaArr=[],this.isAttached=!0,this.errorPlaceHolder=!1,this.attachfilesClicked=!1,this.attachPictures="",this.camera="",this.attach="",this.maxAttachment=0,this.totalCaptures=0,this.removeButton="",this.fileName="",this.closeCallback=!1,this.counter=0,this.countImages=0,this.mapImage=new Map,this.counter=0,this.countImages=0,this.scrollElements=[],this.showPrevious=!1,this.showNext=!1,this.imageUrl="",this.attachPictures=i.instant(l.strings.select_media_attach_pictures),this.camera=i.instant(l.strings.select_media_return_to_camera),this.attach=i.instant(l.strings.select_media_attach_button),this.removeButton=i.instant(l.strings.select_media_remove_button);var u=JSON.parse(t.ctrl.mediaInputs);this.maxAttachment=(u.maxMediaCount<=0?e.mediaConstants.limits.maxSelection:u.maxMediaCount)-1;var g=u.imageProps;void 0!==g&&void 0!==g.sources&&g.sources.indexOf(2)<0&&(this.attachEnable=!1),t.attach=function(){m.mapImage.size>0&&(m.mapImage.forEach(function(e){var n=c.dataURItoBlob(e),i={dataUri:e,objUrl:URL.createObjectURL(n)};t.ctrl.attachCallback({callback:i})}),m.closeDialog())}}return e.$inject=["constants","$scope","loggingService","$translate","dialogService","$timeout","ngDialog","resources","settingsService","utilityService","$q","$element"],e.prototype.setImageData=function(e,t){return{id:e,data:t}},e.prototype.$onInit=function(){this.$element.find(".ts-select-media-vdi")[0].classList.add("full-height"),this.loggingService.event(this.constants.events.mediaApiEvents.startSelectMediaLoaded)},e.prototype.close=function(e){var t=this,n={okButtonText:this.$translate.instant(this.resources.strings.select_media_close_button_continue_dialog),closeButtonText:this.$translate.instant(this.resources.strings.chat_discard),confirmMessageTitle:this.$translate.instant(this.resources.strings.select_media_close_button_unsaved_dialog),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.select_media_close_dialog_text),addCloseButton:!0,callback:function(){t.closeCallback=!0}},i=this.dialogService.open(this.constants.dialogs.confirmDialog,n);i.closePromise.then(function(){t.closeCallback||(t.$scope.ngDialog=i,t.closeDialog()),t.closeCallback=!1}),this.$scope.$emit(this.constants.events.mediaApiEvents.selectMediaClosePressed,null)},e.prototype.closeDialog=function(){this.ngDialog.closeAll()},e.prototype.previewFileAttachment=function(e){var t=this;if(0!==e.length){this.attachfilesClicked=!0,this.mediaArray=[],this.countImages=this.mapImage.size,this.$element.find("#attachButton")[0].focus();for(var n=0;n<e.length;n++){var i=e[n];i&&(this.fileName=i.name,this.file=i,this.readImageAsBase64(i).then(function(e){_.isEmpty(e)||(t.mediaArr=t.mediaArray,t.addToScrollElement(e))}))}}},e.prototype.readImageAsBase64=function(e){var t=this,n=this.$q.defer(),i=new FileReader;return i.readAsDataURL(e),i.onload=function(e){n.resolve(e.target.result)},n.promise.then(function(e){t.counter++;var n=t.createImageObject(e,t.counter);return!t.isMaxSelected()&&t.maxAttachment+1>=t.countImages+t.mediaArray.length?(t.mediaArray.push(n),n):(t.warningText=t.$translate.instant(t.resources.strings.select_media_warning_text_max_media_equal_to_one),t.maxAttachment>1&&(t.warningText=t.$translate.instant(t.resources.strings.select_media_warning_text_max_media_greater_than_one,{maxAttachment:t.maxAttachment+1})),void(t.isWarning=!0))}).catch(function(e){t.showErrorDialog("Load local image failed",e)})},e.prototype.onKeyUp=function(e){e.which===this.constants.keyCodes.enter&&this.$scope.$broadcast(this.constants.events.mediaApiEvents.startSelectMedia),e.which===this.constants.keyCodes.escape&&this.close(this.constants.events.mediaApiEvents.selectMediaClosedByEscape)},e.prototype.onKeyPress=function(e){e.which===this.constants.keyCodes.enter&&this.focusScrollElementByClick(e)},e.prototype.$onDestroy=function(){this.media=null},e.prototype.captureImage=function(){this.counter++;var e=this.$element.find("#captureButton")[0],t=this.$element.find("video")[0],n=this.$element.find("canvas")[0];n.getContext("2d").drawImage(t,0,0,n.width,n.height);var i=this.createImageObject(n.toDataURL("image/jpeg"),this.counter);this.attachfilesClicked=!1,this.isMaxSelected()||(this.media=i),this.addToScrollElement(i),e.focus()},e.prototype.createImageObject=function(e,t){return this.setImageData(""+t,e.toString())},e.prototype.addToScrollElement=function(e){if(this.$element.find(".ts-select-media-vdi")[0].classList.remove("full-height"),this.isMaxSelected())return this.warningText=this.$translate.instant(this.resources.strings.select_media_warning_text_max_media_equal_to_one),this.maxAttachment>0&&(this.warningText=this.$translate.instant(this.resources.strings.select_media_warning_text_max_media_greater_than_one,{maxAttachment:this.maxAttachment+1})),void(this.isWarning=!0);this.totalCaptures=this.mapImage.size+1,this.addToSelectAttach(e.id,e),this.isAttached=!1},e.prototype.updateScrollElementArray=function(e){this.scrollElements=e},e.prototype.focusScrollElementByClick=function(e){var t=this;this.previewIsRequested&&(this.previewIsRequested=!1),""!==this.attachPictures&&(this.attachPictures=""),e.stopPropagation();var n="IMG"===e.target.tagName&&e.target.parentElement||e.target;n!==this.currentScrollElement&&this.$timeout(function(){var e=t.$element.find("#central-section")[0];e.classList.add("central-section-image-viewer"),e.classList.remove("central-section");for(var i=n.firstElementChild,s=t.$element.find(".ts-thumbnail-scroll-item"),a=0;a<s.length;a++)n!==s[a]&&s[a].classList.add("ts-thumbnail-opacity");t.updateMainMedia(i.src,i),t.updateCurrentScrollElement(n)})},e.prototype.updateMainMedia=function(e,t){this.imageUrl=e},e.prototype.updateCurrentScrollElement=function(e){this.removeFocusElement(),this.currentScrollElement=e,this.enableRemoveButton(e),this.currentScrollElement.classList.add("ts-thumbnail-scroll-item-selected");var t=this.findIndexFromScrollElement(this.currentScrollElement.id);this.currentIndex=t+1,this.showPrevious=!(t<=0),this.showNext=!(t>=this.scrollElements.length-1),this.showMedia(e),this.showPlaceholderElement=!1},e.prototype.findIndexFromScrollElement=function(e){return this.scrollElements.findIndex(function(t){return t.id===e})},e.prototype.showMedia=function(e){if(this.currentScrollElement){var t=this.findIndexFromScrollElement(this.currentScrollElement.id);this.focusScrollElementByIndex(t,!1),this.currentReference=e.querySelector("img").src,this.updateMainMedia(this.currentReference,this.currentScrollElement.firstElementChild)}},e.prototype.previousMedia=function(e){var t=this;e.stopPropagation();var n=this.findIndexFromScrollElement(this.currentScrollElement.id);n>0&&(n--,this.updateCurrentScrollElement(this.$element.find("#"+this.scrollElements[n].id)[0]),this.$timeout(function(){t.currentReference=t.currentScrollElement&&t.currentScrollElement.firstElementChild&&t.currentScrollElement.firstChild.src,t.currentReference&&(t.updateMainMedia(t.currentReference,t.currentScrollElement.firstElementChild),t.focusScrollElementByIndex(n,!0))}))},e.prototype.nextMedia=function(e){var t=this;e.stopPropagation();var n=this.findIndexFromScrollElement(this.currentScrollElement.id);n<this.scrollElements.length-1&&(n++,this.updateCurrentScrollElement(this.$element.find("#"+this.scrollElements[n].id)[0]),this.$timeout(function(){t.currentReference=t.currentScrollElement&&t.currentScrollElement.firstElementChild&&t.currentScrollElement.firstChild.src,t.currentReference&&(t.updateMainMedia(t.currentReference,t.currentScrollElement.firstElementChild),t.focusScrollElementByIndex(n,!0))}))},e.prototype.focusScrollElementByIndex=function(e,t){if(!t){var n=_.values(document.querySelectorAll(".ts-thumbnail-scroll-item"));n.forEach(function(t){e!==n.indexOf(t)&&t.classList.add("ts-thumbnail-opacity"),t.classList.remove("ts-thumbnail-smooth")}),n.forEach(function(e){e.classList.add("ts-thumbnail-smooth")})}},e.prototype.enableRemoveButton=function(e){e.querySelector("button").classList.remove("ng-hide")},e.prototype.removeFocusElement=function(){this.currentScrollElement&&(this.currentScrollElement.classList.remove("ts-thumbnail-scroll-item-selected"),this.currentScrollElement.querySelector("button").classList.add("ng-hide"),this.currentScrollElement=void 0)},e.prototype.isMaxSelected=function(){return this.maxAttachment<this.mapImage.size},e.prototype.showErrorDialog=function(e,t){this.dialogService.open(this.constants.dialogs.alert,{alertTitle:this.$translate.instant(e),alertMessage:this.$translate.instant(t)})},e.prototype.removeFromAttach=function(e){if(event.stopPropagation(),this.mapImage.has(e)&&(this.mapImage.delete(e),this.totalCaptures=this.mapImage.size),this.findIndexFromScrollElement(e)>-1){var t=this.findIndexFromScrollElement(e);1===this.scrollElements.length?(this.scrollElements.pop(),this.previewIsRequested=!0,this.showMediaContainer(),this.isAttached=!0,this.$element.find(".ts-select-media-vdi")[0].classList.add("full-height")):(this.getNextScrollElement(t),this.scrollElements.splice(t,1))}angular.isElement&&document.querySelector("#list-"+e).classList.add("ng-hide")},e.prototype.getNextScrollElement=function(e){var t=this,n=e;e>=this.scrollElements.length-1?(this.showPrevious=!1,e--):e++,e<0?this.previewIsRequested=!0:(this.updateCurrentScrollElement(this.$element.find("#"+this.scrollElements[e].id)[0]),this.currentIndex=n+1<=1||e<=1?1:e,0===n&&(this.showPrevious=!1),n>=this.scrollElements.length-1&&(this.showNext=!1,this.currentIndex=this.mapImage.size),this.$timeout(function(){t.currentReference=t.currentScrollElement&&t.currentScrollElement.firstElementChild&&t.currentScrollElement.firstChild.src,t.currentReference&&(t.updateMainMedia(t.currentReference,t.currentScrollElement.firstElementChild),t.focusScrollElementByIndex(e,!1))}))},e.prototype.lastScrollElement=function(){this.$element.find(".ts-media-remove")[0].classList.add("last-element")},e.prototype.addToSelectAttach=function(e,t){void 0!==t&&(this.mapImage.has(e)||this.mapImage.set(e,t.data),this.totalCaptures=this.mapImage.size)},e.prototype.showMediaContainer=function(){this.errorPlaceHolder=!0,this.previewIsRequested=!0;for(var e=this.$element.find(".ts-thumbnail-scroll-item"),t=0;t<e.length;t++)e[t].classList.remove("ts-thumbnail-opacity");this.removeFocusElement(),this.errorPlaceHolder=!1;var n=this.$element.find("#central-section")[0];n.classList.add("central-section"),n.classList.remove("central-section-image-viewer"),this.attachPictures="Attach Pictures"},e}();t.SelectMediaController=s,angular.module("teamspace.selectMedia",[]).component("selectMedia",{bindings:{mediaInputs:"@",attachCallback:"&"},controllerAs:"ctrl",controller:s,templateUrl:"components/select-media/select-media.html"}).run(["$templateCache",function(e){e.put("components/select-media/select-media.html",i)}])},2769:function(e,t){e.exports='<div class="ts-select-media vdi-occlusion">\n  \x3c!--Banner--\x3e\n  <media-banner left-button="ctrl.camera" middle-text="ctrl.attachPictures" right-button="ctrl.attach" left-callback="ctrl.showMediaContainer()" right-callback="attach($event)" disable-right-button="ctrl.isAttached" show-left-button="!ctrl.previewIsRequested" show-right-button="true" close="ctrl.close(\'close dialog\')" class="ts-media-banner" role="menu"></media-banner>\n  \x3c!-- Warning banner--\x3e\n  <media-warning-banner warning-text="ctrl.warningText" show="ctrl.isWarning" class="ts-media-banner"/>\n  \x3c!--End Warning banner--\x3e\n  \x3c!--Video Container--\x3e\n  <div class="ts-select-media-vdi dark-background">\n    <div class="central-section" id="central-section">\n      <div class="ts-video-container" id="video-container" ng-show="ctrl.previewIsRequested">\n        <video-frame attach-button="ctrl.attachEnable" capture="ctrl.captureImage()" attach-callback="ctrl.previewFileAttachment(files)"/>\n        <canvas id="canvas" style="display: none" autoplay width="1400" height="1080"></canvas>\n      </div>\n      \x3c!-- Main image --\x3e\n      <img ng-src="{{ctrl.imageUrl}}" role="img" class="ts-select-media-canvas-content" id="select-media-main-content" ng-show="!ctrl.previewIsRequested"/>\n    </div>\n  </div>\n  \x3c!-- Placeholder --\x3e\n  <div class="placeholder" ng-show="ctrl.previewIsRequested && !ctrl.isAttached">\n    {{ctrl.totalCaptures}} Pictures\n  </div>\n  <div class="placeholder" ng-show="!ctrl.previewIsRequested">\n    {{(ctrl.currentIndex) }} / {{ctrl.mapImage.size}} Pictures\n  </div>\n  \x3c!-- End Placeholder --\x3e\n  \x3c!--Previous Arrow--\x3e\n  <div role="button" id="ts-select-media-previous-wrapper" ng-show="ctrl.showPrevious && !ctrl.previewIsRequested">\n    <button role="button" class="ts-select-media-icon-button ts-sym" id="ts-select-previous-media" aria-label="{{::$root.resources.strings.shortcut_previous_left_rail_item|translate}}" ng-click="ctrl.previousMedia($event)">\n      <ng-include src="\'svg/icons-chevron-left.html\'"></ng-include>\n    </button>\n  </div>\n  \x3c!--End Media Scroll Navigation--\x3e\n  \x3c!--Next Arrow--\x3e\n  <div role="button" id="ts-select-media-next-wrapper" ng-show="ctrl.showNext && !ctrl.previewIsRequested">\n    <button role="button" class="ts-select-media-icon-button ts-sym" id="ts-select-next-media" aria-label="{{::$root.resources.strings.shortcut_next_left_rail_item|translate}}" ng-click="ctrl.nextMedia($event)">\n      <ng-include src="\'svg/icons-chevron-right.html\'"></ng-include>\n    </button>\n  </div>\n  \x3c!--End Video Container--\x3e\n  <thumbnail-scroller class="ts-thumbnail-scroll" media="ctrl.media" media-array="ctrl.mediaArr" click-callback="ctrl.focusScrollElementByClick(event)" media-array-cb="ctrl.updateScrollElementArray(mediaArray)" desc-order="true" remove-button-cb="ctrl.removeFromAttach(item)"/>\n\n</div>'},2770:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2771),s=function(){function e(e,t){this.desktopUtilityService=t,this.isVMWareEnv=!1,this.showPreview=!1,this.showPreview=e.ngDialogData.showPreview,this.isVMWareEnv=t.getVDIProvider()===teamspace.services.VdiProvider.vmware&&t.avIsRemoted()}return e.$inject=["$scope","desktopUtilityService"],e}();t.SelectMediaOverlay=s,angular.module("teamspace.selectMediaOverlay",[]).component("selectMediaOverlay",{bindings:{},controller:s,templateUrl:"components/select-media-overlay/select-media-overlay.html"}).run(["constants","dialogService","desktopUtilityService","$templateCache",function(e,t,n,a){a.put("components/select-media-overlay/select-media-overlay.html",i);var r="ts-modal-dialog custom-width select-media-overlay";n.getVDIProvider()===teamspace.services.VdiProvider.vmware&&n.avIsRemoted()&&(r+=" vmware-style"),t.register(e.lazyDialogs.selectMediaOverlay,{template:"components/select-media-overlay/select-media-overlay.html",className:r,showClose:!1,controller:s,controllerAs:"ctrl",ariaAuto:!1,ariaRole:"dialog",ariaLabelledById:"modalDialog-title",closeByNavigation:!0})}])},2771:function(e,t){e.exports='<div oc-lazy-load="media-api" class="ts-select-media-overlay vdi-donut-occlusion" ng-class="{\'vmware-style\': ctrl.isVMWareEnv, \'video-rendering\': ctrl.previewIsRendering }">\n  <select-media ng-if="!ctrl.showPreview" media-inputs="{{::ngDialogData.mediaInputs}}" attach-callback="ngDialogData.attachCallback(callback)"></select-media>\n  \x3c!-- Dialog shows the camera screen to select or Capture image from system. --\x3e\n</div>'},2772:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2773),s=function(){function e(e,t,n){this.$scope=e,this.$element=t,this.loggingService=n,this.hasLeftButton=!1,this.hasRightButton=!1,this.hasMiddleText=!1,this.logger=n.newLogger("MediaAPIBannerCreated"),void 0==e.bn.leftButton&&""===e.bn.leftButton||(this.hasLeftButton=!0),void 0==e.bn.rightButton&&""===e.bn.rightButton||(this.hasRightButton=!0),void 0==e.bn.middleText&&""===e.bn.middleText||(this.hasMiddleText=!0),e.$watch("bn.disableRightButton",function(e,n){var i=e?"-1":"0";t.find("#rightButton")[0].setAttribute("tabIndex",i)}),e.$watch("bn.disableLeftButton",function(e,n){var i=e?"-1":"0";t.find("#leftButton")[0].setAttribute("tabIndex",i)})}return e.$inject=["$scope","$element","loggingService"],e.prototype.leftButtonClicked=function(){this.$scope.bn.leftCallback({leftCallback:!0})},e.prototype.rightButtonClicked=function(){this.$scope.bn.rightCallback({rightCallback:!0})},e.prototype.closeAction=function(){this.logger.info("MediaAPIBanner created"),this.$scope.bn.close({close:!0})},e}();t.MediaAPIBannerController=s,angular.module("teamspace.mediaAPIbanner",[]).component("mediaBanner",{bindings:{leftButton:"=?",disableLeftButton:"=?",showLeftButton:"=?",rightButton:"=?",disableRightButton:"=?",showRightButton:"=?",close:"&?",middleText:"=?",leftCallback:"&?",rightCallback:"&?"},templateUrl:"components/media-banner/media-head-banner.html",controller:s,controllerAs:"bn"}).run(["$templateCache",function(e){e.put("components/media-banner/media-head-banner.html",i)}])},2773:function(e,t){e.exports='\x3c!--Banner--\x3e\n<div class="ts-media-banner banner">\n  \x3c!--Back Button--\x3e\n  <button role="button" class="ts-btn ts-btn-fluent ts-btn-fluent-secondary-alternate ts-left-banner ng-scope" id="leftButton" aria-labelledby="{{::$root.resources.strings.media_banner_left_button_aria_label|translate}}" ng-click="bn.leftButtonClicked()" ng-show="bn.showLeftButton && bn.hasLeftButton" ng-disabled="bn.disableLeftButton" tabindex="0">\n    <svg-include src="\'[[staticsPath]]/hashed/svg/media/icon-back-arrow-f094a17.html\'" style="padding-right: 9.5px; padding-left: 5.5px;"></svg-include>\n    {{bn.leftButton}}\n  </button>\n  \x3c!--End Back Button--\x3e\n  \x3c!--Middle Text--\x3e\n  <div class="banner-text" ng-show="bn.hasMiddleText">{{bn.middleText}}</div>\n  \x3c!--End Middle Text--\x3e\n  \x3c!--Banner Controls V1--\x3e\n  <div class="flex-container-centered">\n    \x3c!--Attach Controls--\x3e\n    <div class="flex-container-centered" ng-show="bn.hasRightButton">\n      \x3c!--Attach--\x3e\n      <button class="ts-btn ts-btn-fluent ts-btn-fluent-primary" id="rightButton" aria-label="{{::$root.resources.strings.media_banner_right_button_aria_label|translate}}" ng-click="bn.rightButtonClicked($event)" ng-show="bn.showRightButton" ng-disabled="bn.disableRightButton" tabindex="0">\n        {{bn.rightButton}}\n      </button>\n      \x3c!--End Attach--\x3e\n    </div>\n    \x3c!--Close Media--\x3e\n    <button class="banner-close-button ts-btn ts-btn-fluent ts-btn-fluent-secondary-alternate" aria-label="{{::$root.resources.strings.media_banner_close_button_aria_label|translate}}" ng-click="bn.closeAction(\'close dialog\')" translate-once="{{::$root.resources.strings.icons_close}}" tabindex="0">\n      {{::$root.resources.strings.media_banner_close_button_aria_label|translate}}\n    </button>\n    \x3c!--End Close Media--\x3e\n  </div>\n</div>\n\x3c!--End Banner--\x3e'},2774:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2775),s=function(){function e(e,t){this.$scope=e,this.logger=t.newLogger("mediawarningBanner")}return e.$inject=["$scope","loggingService"],e.prototype.clickCloseWarning=function(){this.logger.info("closing media warning banner"),this.$scope.wb.show=!this.$scope.wb.show},e}();t.MediaWarningBannerController=s,angular.module("teamspace.mediaWarningBanner",[]).component("mediaWarningBanner",{bindings:{warningText:"=",show:"="},templateUrl:"components/media-banner/warning-banner.html",controller:s,controllerAs:"wb"}).run(["$templateCache",function(e){e.put("components/media-banner/warning-banner.html",i)}])},2775:function(e,t){e.exports='\x3c!-- Warning banner--\x3e\n<div class="ts-media-banner banner ts-warning-banner" ng-show="wb.show">\n  <div class="ts-left-banner" style="width: 100%;">\n    \x3c!--Warning text--\x3e\n    {{wb.warningText}}\n  </div>\n  \x3c!--End Warning text--\x3e\n  \x3c!-- close warning --\x3e\n  <div class="flex-container-centered">\n    <button class="ts-btn ts-btn-fluent" aria-label="{{::$root.resources.strings.media_banner_close_button_aria_label|translate}}" ng-click="wb.clickCloseWarning()" style="padding: 0px; min-width: 0;">\n      <svg-include src="\'[[staticsPath]]/hashed/svg/media/icon-close-37105ed.html\'"></svg-include>\n    </button>\n    \x3c!-- close warning --\x3e\n  </div>\n</div>\n\x3c!--End Warning banner--\x3e'},2776:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2777),s=function(){function e(e,t,n,i,s,a,r,l,o,c){var d=this;this.constants=t,this.$scope=n,this.adminSettingsService=i,this.settingsService=s,this.loggingService=a,this.$element=r,this.deviceManagerService=l,this.dialogService=o,this.$translate=c,this.showVideo=!1,this.logger=a.newLogger("videoFrame"),this.isVideoEnabled=i.getAdminSettingSync().isVideoEnabled,this.isDesktop=s.valueAsBoolean(t.settings.names.isDesktopApp),this.hasVideoInput=this.isVideoEnabled,this.canToggleCamera=this.isVideoAvailable(),this.deviceManagerChangedSubscription=l.safeSubscribe(n,function(){d.getVideoDevices()},t.events.calling.devicesChanged),this.isDesktop=s.valueAsBoolean(t.settings.names.isDesktopApp),l.whenInitialized(this.isDesktop).then(function(){return d.getVideoDevices()}),n.$watch("ctrl.cameraId",function(e,t){e!==t&&(n.ctrl.cameraId?d.selectedCamera=n.ctrl.cameraId:d.getVideoDevices())}),n.$on("$destroy",function(){l.unsubscribe(d.deviceManagerChangedSubscription),d.stopStreamedVideo(d.previewStream)})}return e.$inject=["$q","constants","$scope","adminSettingsService","settingsService","loggingService","$element","deviceManagerService","dialogService","$translate"],e.prototype.onKeyPress=function(e){e.which===this.constants.keyCodes.enter&&this.attachFile(e)},e.prototype.isVideoAvailable=function(){return this.isVideoEnabled&&this.deviceManagerService.getCameras().length>1},e.prototype.getVideoDevices=function(){this.$scope.ctrl.cameraId?(this.selectedCamera=this.$scope.ctrl.cameraId.replace("camera:",""),this.logger.info("cameras: "+JSON.stringify(this.selectedCamera))):(navigator.mediaDevices.getUserMedia({audio:!1,video:!0}),this.cameras=this.deviceManagerService.getCameras().map(function(e){return e}),this.selectedCamera=this.cameras[0],this.canToggleCamera=this.isVideoEnabled&&this.cameras.length>1),this.selectedCamera&&(this.showVideo=!1,this.startVideo())},e.prototype.startVideo=function(){var e=this;this.previewStream&&(this.showVideo=!1,this.stopStreamedVideo(this.previewStream)),navigator.mediaDevices.getUserMedia({audio:!1,video:{deviceId:this.selectedCamera}}).then(function(t){e.handleStream(t)}).catch(function(t){e.hasVideoInput=!1,t&&e.reportVideoError(t)})},e.prototype.handleStream=function(e){this.$element.find("#select-media-main-video")[0].srcObject=e,this.previewStream=e,this.showVideo=!0},e.prototype.stopStreamedVideo=function(e){var t=this.$element.find("#select-media-main-video")[0];e&&e.getTracks().forEach(function(e){e.stop()}),this.previewStream=null,t&&(t.srcObject=null)},e.prototype.reportVideoError=function(e){this.throwError(e.name,e.message)},e.prototype.throwError=function(e,t){this.dialogService.open(this.constants.dialogs.alert,{alertTitle:this.$translate.instant(e),alertMessage:this.$translate.instant(t)})},e.prototype.toggleCamera=function(){this.deviceManagerService.toggleCamera(),this.$scope.ctrl.cameraId=this.deviceManagerService.getSelectedDevices().camera},e.prototype.attachFile=function(e){e&&this.$scope.ctrl.attachCallback({files:e})},e}();t.VideoFrameController=s,angular.module("teamspace.videoFrame",[]).component("videoFrame",{bindings:{cameraId:"=?",attachButton:"=?",attachCallback:"&?",capture:"&?"},controllerAs:"ctrl",controller:s,templateUrl:"components/select-media/video-frame.html"}).run(["$templateCache",function(e){e.put("components/select-media/video-frame.html",i)}])},2777:function(e,t){e.exports='<div ng-show="ctrl.showVideo">\n  \x3c!-- Grid lines--\x3e\n  <div id="grid">\n    <hr class="horizontal1" id="horizontal1">\n    <hr class="horizontal2" id="horizontal2">\n    <hr class="vertical1" id="vertical1">\n    <hr class="vertical2" id="vertical2">\n  </div>\n  \x3c!-- End Grid lines--\x3e\n  <video class="ng-scope" playsinline autoplay style="width: 100%; height: auto;" id="select-media-main-video"></video>\n  <div class="controls controls-banner">\n    \x3c!-- Attach from gallery --\x3e\n    <button title="Attach" id="attachButton" aria-label="{{::$root.resources.strings.select_media_video_frame_file_attach|translate}}" class="ts-sym ts-btn-fluent sidebtnleft app-icons-fill-focus inset-border inset-border-round inset-border-themed pointer-cursor ng-scope" blur-on="click" data-prevent-refocus="false" ng-show="{{ctrl.attachButton}}" accept="image/*" ng-model="ctrl.file" ngf-select="ctrl.attachFile($files)" ngf-multiple="true">\n      <div style="align-items: center;\n      text-align: center;\n      height: 23px;">\n        <label for="file-input">\n          <svg-include src="\'[[staticsPath]]/hashed/svg/media/icon-file-input-12f64a1.html\'"></svg-include>\n        </label>\n      </div>\n    </button>\n    \x3c!-- End Attach from gallery --\x3e\n    \x3c!-- Camera Button --\x3e\n    <button type="button" role="button" id="captureButton" title="Camera" aria-label="{{::$root.resources.strings.select_media_video_frame_camera|translate}}" class="ts-sym centre-btn ts-btn-fluent app-icons-fill-focus inset-border inset-border-round inset-border-themed ng-scope" blur-on="click" tabindex="0" data-prevent-refocus="false" ng-click="ctrl.capture()">\n      <svg-include src="\'[[staticsPath]]/hashed/svg/media/icon-camera-button-2ef500f.html\'"></svg-include>\n    </button>\n    \x3c!-- End Camera Button --\x3e\n    \x3c!-- Camera toggle Button --\x3e\n    <button type="button" role="button" id="cameraToggle" title="Camera toggle" aria-label="{{::$root.resources.strings.select_media_video_frame_camera_toggle|translate}}" ng-show="ctrl.canToggleCamera" class="ts-sym sidebtnright ts-btn-fluent app-icons-fill-focus inset-border inset-border-round inset-border-themed ng-scope" blur-on="click" tabindex="0" data-prevent-refocus="false" ng-click="ctrl.toggleCamera()">\n      <svg-include src="\'[[staticsPath]]/hashed/svg/media/icon-camera-toggle-c161bff.html\'"></svg-include>\n    </button>\n    \x3c!-- End Camera toggle Button --\x3e\n  </div>\n</div>'},2778:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n(2779),s=function(){function e(e,t,n){var i=this;this.$scope=e,this.loggingService=t,this.$element=n,this.logger=t.newLogger("Thumbnail scroller created"),this.scrollElements=[],e.$watch("tsCtrl.media",function(e,t){e!==t&&null!==e&&i.startMediaScroller(e)}),e.$watchCollection("tsCtrl.mediaArray",function(e,t){null===e||_.isEmpty(e)||i.startMediaScroller(e)})}return e.$inject=["$scope","loggingService","$element"],e.prototype.startMediaScroller=function(e){var t=this;Array.isArray(e)&&e.length>0?e.forEach(function(e){-1===t.scrollElements.indexOf(e.id)&&t.addScrollElement(e)}):this.addScrollElement(e)},e.prototype.addScrollElement=function(e){this.scrollElements.reverse(),this.scrollElements.push(e),this.scrollElements.reverse(),this.$scope.tsCtrl.mediaArrayCb({mediaArray:this.scrollElements})},e}();t.ThumbnailScrollerController=s,angular.module("teamspace.thumbnailScroller",[]).component("thumbnailScroller",{bindings:{media:"=?",mediaArray:"=?",clickCallback:"&?",mediaArrayCb:"&?",removeButtonCb:"&?"},templateUrl:"components/thumbnail-scroller/thumbnail-scroller.html",controller:s,controllerAs:"tsCtrl"}).run(["$templateCache",function(e){e.put("components/thumbnail-scroller/thumbnail-scroller.html",i)}])},2779:function(e,t){e.exports='\x3c!--Media Scroll Navigation--\x3e\n<div id="ts-thumbnail-scroll-navigation" class="ts-thumbnail-scroll single-line-truncation scroller-background">\n  \x3c!--Media Scrollbar, menu role used for screen reader to announce # of list items--\x3e\n  <ul id="ts-thumbnail-scroll" acc-role="list" role="list">\n    <li ng-repeat="scrollElem in tsCtrl.scrollElements" class="ts-thumbnail-scroll-item ts-thumbnail-smooth" ng-click="tsCtrl.clickCallback({ event: $event })" id="{{::scrollElem.id}}" role="listitem">\n      <img role="img" id="list-{{::scrollElem.id}}" ng-src="{{::scrollElem.data}}" tabindex="0" onkeypress="tsCtrl.onKeyPress($event)" class="ts-thumbnail-scroll-image ts-btn-fluent-primary"/>\n      <button class="ts-btn ts-btn-fluent ts-media-remove ng-hide" tabindex="0" aria-label="{{::$root.resources.strings.select_media_remove_button|translate}}" ng-click="tsCtrl.removeButtonCb({ item: scrollElem.id })">\n        <svg-include src="\'[[staticsPath]]/hashed/svg/media/icon-remove-button-06314d4.html\'"></svg-include>\n      </button>\n    </li>\n  </ul>\n</div>\n\x3c!--End Media Scrollbar--\x3e'}},[2767]);