webpackJsonp([2],{129:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,a,s,i,n){this.peopleService=e,this.resources=a,this.$translate=s,this.$q=i,this.authenticationService=n,this.logger=t.newLogger("BroadcastStatusMessage")}return e.prototype.constructStatusMessage=function(e,t){var a=this,s=this.$q.defer();return e.size<=0?s.reject(""):this.fetchUserProfileForParticipants(Array.from(e.values())).then(function(i){a.constructStatusMessageInternal(e,i,t).then(function(e){s.resolve(e)})},function(e){a.logger.error("Error encountered when fetching user profile for the participants"),s.reject("")}),s.promise},e.prototype.fetchUserProfileForParticipants=function(e){for(var t=new Map,a=0,s=e;a<s.length;a++){var i=s[a];i&&!t.get(i)&&t.set(i,1)}return this.peopleService.getAllPeopleProfile(Array.from(t.keys()),"BroadcastParticipants",!1).then(function(e){for(var a=new Map,s=0,i=0,n=Array.from(t.keys());i<n.length;i++){var r=n[i];e&&s<e.length&&e[s]&&!a.has(r)&&a.set(r,e[s]),s++}return a})},e.prototype.constructStatusMessageInternal=function(e,t,a){var s=this,i=[],n=0;return this.authenticationService.getUserInformation().then(function(r){e.forEach(function(e,a){var o,c="video"!==a;if(e){var l=t.get(e);if(!l||!l.displayName)return"";o=l.displayName}else o=r&&r.profile&&r.profile.name;i[n]=c?s.$translate.instant(s.resources.strings.broadcast_statusMessage_desktop,{sourceName:o}):o,n++});var o=e.size>1?a?s.resources.strings.broadcast_statusMessage_multipleSources:s.resources.strings.broadcast_livePreviewMessage_multipleSources:a?i&&i[0]:s.$translate.instant(s.resources.strings.broadcast_livePreview_statusMessage,{source:i&&i[0]});return s.$translate.instant(o,{source1:i&&i[0],source2:i&&i[1]})})},e}();t.BroadcastStatusMessageBuilder=s},130:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,a,s,i,n,r,o,c){var l=e.call(this)||this;return l.constants=a,l.resources=s,l.$translate=i,l.$scope=n,l.callingAlertsService=r,l.call=o,l.settingsService=c,l.logger=t.newLogger("BroadcastStreamRenderingAlertsHelper"),l.sharedWindowStateChangedSubscription=o.on("sharedWindowStateChanged",function(){return l.sharedWindowStateChanged()}),l.registerForScreenSharingRendererEvents(),_.defer(function(){l.sharedWindowStateChanged()}),n.$on("$destroy",function(){return l.dispose()}),l}return s(t,e),Object.defineProperty(t.prototype,"isScreenShareRenderingError",{get:function(){return this._isScreenShareRenderingError},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isScreenShareWindowMinimized",{get:function(){return this._isScreenShareWindowMinimized},enumerable:!0,configurable:!0}),t.prototype.getScreenShareRenderingErrorAlert=function(){return this.screenShareRenderingErrorAlert},t.prototype.getScreenShareWindowMinimizedAlert=function(){return this.screenShareWindowMinimizedAlert},t.prototype.dismissScreenSharingAlert=function(){this.screenShareRenderingErrorAlert&&(this.callingAlertsService.dismiss(this.screenShareRenderingErrorAlert),this.screenShareRenderingErrorAlert=null),this.screenShareWindowMinimizedAlert&&(this.callingAlertsService.dismiss(this.screenShareWindowMinimizedAlert),this.screenShareWindowMinimizedAlert=null)},t.prototype.registerForScreenSharingRendererEvents=function(){var e=this;this.$scope.$on(this.constants.events.calling.screenShareRendererStateChanged,function(t,a){a&&(e.logger.info("Screenshare is rendering"),e._isScreenShareRenderingError=!1,e.dismissScreenSharingAlert()),e.trigger(e.constants.events.calling.screenShareRenderingAlert)}),this.$scope.$on(this.constants.events.calling.streamRenderingTimeout,function(t,a){if(a&&1===a.streamType){e.logger.info("There is an issue with active screenshare rendering, timeout event received"),e._isScreenShareRenderingError=!0;var s=e.$translate.instant(e.resources.strings.error_message_video_rendering_failure_title),i=e.$translate.instant(e.resources.strings.error_message_video_rendering_failure);e.screenShareRenderingErrorAlert=e.createAlert(!0,"ScreenSharingRenderingError",s,i),teamspace.services.BroadcastUtilities.logExternalForDDL("Active screenshare rendering error, callId: "+e.call.callId+" participantId: "+e.call.participantId+" localScreenShare: "+e.call.isScreenSharingOn,e.settingsService,e.constants,e.logger),e.trigger(e.constants.events.calling.screenShareRenderingAlert)}})},t.prototype.createAlert=function(e,t,a,s){return this.logger.info("Creating screen sharing alert {0}",s),{name:t,type:teamspace.services.AlertType.Warning,title:a,text:s,dismissable:e,teamsCallId:this.call.teamsCallId,actions:[]}},t.prototype.sharedWindowStateChanged=function(){if(this.call.sharedWindowState===teamspace.services.SharedWindowState.WindowMinimized){this.logger.info("Screen share window minimized event received"),this._isScreenShareWindowMinimized=!0;var e=this.$translate.instant(this.resources.strings.calling_sharedWindowMinimizedTitle),t=this.$translate.instant(this.resources.strings.calling_sharedWindowMinimized);this.screenShareWindowMinimizedAlert=this.createAlert(!0,"ScreenSharingWindowMinimizedPopUpAlert",e,t)}else this.logger.info("Screen share window restored"),this._isScreenShareWindowMinimized=!1,this.dismissScreenSharingAlert();this.trigger(this.constants.events.calling.screenShareRenderingAlert)},t.prototype.dispose=function(){this.sharedWindowStateChangedSubscription&&(this.sharedWindowStateChangedSubscription.dispose(),this.sharedWindowStateChangedSubscription=null),this.dismissScreenSharingAlert()},t}(SkypeX.Services.ObservableBase);t.BroadcastStreamRenderingAlertsHelper=i},131:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(84),i=function(){function e(e){this.$compile=e}return e.prototype.getPreviewUI=function(e,t,a,i,n,r,o,c,l,d){var p=t.$new();p.streamItem=e,p.localBroadcastState=a,p.conversation=i,p.disabledBehavior=l,p.expanded=o,p.onlyStream=c,p.renderArea=n,p.priority=r,p.isFocusable=d;var g=this.$compile('\n        <broadcast-producer-preview-item\n          local-broadcast-state="::localBroadcastState"\n          expanded="::expanded"\n          priority="::priority"\n          stream-item="::streamItem"\n          only-stream="::onlyStream"\n          disabled-behavior="::disabledBehavior"\n          render-area="::renderArea"\n          is-focusable="::isFocusable">')(p);return new s.BroadcastParticipantPreviewUIWrapper(e,g,p)},e}();t.BroadcastProducerPreviewItemFactory=i},132:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,a){this.callingAlertsService=e,this.settingsService=t,this.constants=a}return e.prototype.getIPVideoVbssPolicyAlert=function(){return this.callingAlertsService.getAlertsOfTypes(["Broadcast_ipvideo_vbss_permission"])||[]},e.prototype.getMicrophoneAlerts=function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCriticalAlertsNewDesign)?this.callingAlertsService.getAlerts(teamspace.services.AlertWindowType.CallingFooter).filter(function(e){return e.type===teamspace.services.AlertType.Error&&e.isMicRelated})||[]:[]},e.prototype.getBannerAlerts=function(){var e=this.callingAlertsService.getAlerts(teamspace.services.AlertWindowType.CallScreen,teamspace.services.ScreenRegionForAlert.CallingAlertBanner)||[],t=this.getFooterBannerAlerts();return t&&(e=e.concat(t)),e},e.prototype.getAlerts=function(e,t){return this.getBannerAlerts()},e.prototype.dismiss=function(e){this.callingAlertsService.dismiss(e)},e.prototype.getFooterBannerAlerts=function(){var e=this.getMicrophoneAlerts();if(e&&e.length)return[];var t=this.callingAlertsService.getAlerts(teamspace.services.AlertWindowType.CallingFooter);return t=t.filter(function(e){return e.type!=teamspace.services.AlertType.Info})},e}();t.ProducerScreenAlertsProvider=s},133:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2073),i=function(){function e(){}return e.Available="Available",e.Pending="Pending",e.NotStarted="NotStarted",e.Deleted="Deleted",e}();t.BroadcastMeetingResourceStatusString=i;var n=function(){function e(){}return e.Hive="HiveReport",e.Recording="MeetingRecording",e.QnaReport="QnaReport",e.AttendeeReport="AttendeeReport",e.Transcript="Transcript",e.Kollective="KollectiveReport",e}();t.BroadcastMeetingObjectType=n;var r=function(){function e(e,t,a,s,i,n,r,o,c,l,d){this.$scope=e,this.loggingService=t,this.constants=a,this.utilityService=s,this.calendarService=i,this.broadcastMeetingService=n,this.meetingViewModelFactory=r,this.exceptionUtilityService=o,this.resources=c,this.ariaLiveService=l,this.$translate=d,this.updateVodInProgress=!1,this.shouldShowTmbResources=!1,this.shouldShowByoeResources=!1,this.showAdvancedOptions=!1,this.isAdvancedOptionsExpanded=!1,this.isTranscriptExpanded=!1,this.logger=t.newLogger("BroadcastMeetingObjectsController")}return e.$inject=["$scope","loggingService","constants","utilityService","calendarService","broadcastMeetingService","meetingViewModelFactory","exceptionUtilityService","resources","ariaLiveService","$translate"],e.prototype.$onInit=function(){this.viewModel?this.initialize():this.logger.error("No broadcast view model.")},e.prototype.isDeleted=function(){return!(!this.meetingObjectsViewModel.isExpired&&!this.meetingObjectsViewModel.meetingObjects.isDeleted)},e.prototype.showHiveReports=function(){return!(!this.meetingObjectsViewModel||this.isDeleted())&&!!(this.meetingObjectsViewModel.meetingObjects&&this.meetingObjectsViewModel.meetingObjects.hive&&this.meetingObjectsViewModel.meetingObjects.hive.url)},e.prototype.showKollectiveReports=function(){return!(!this.meetingObjectsViewModel||this.isDeleted())&&!!(this.meetingObjectsViewModel.meetingObjects&&this.meetingObjectsViewModel.meetingObjects.kollective&&this.meetingObjectsViewModel.meetingObjects.kollective.url)},e.prototype.toggleVodSettings=function(){var e=this;this.updateVodInProgress||this.viewModel&&this.viewModel.broadcastSettings&&this.viewModel.broadcastSettings.teamsStreamingSettings&&(this.viewModel.broadcastSettings.teamsStreamingSettings.isVodEnabled=!this.viewModel.broadcastSettings.teamsStreamingSettings.isVodEnabled,this.updateVodInProgress=!0,this.$scope.$applyAsync(),this.calendarService.updateEvent(this.viewModel).then(function(){e.logger.info("Successfully disabled VOD from meeting objects")},function(t){e.footerMessage=e.exceptionUtilityService.getFormattedErrorMessage(t),e.logger.error("Error occured while disabling VOD {0} from meeting objects",t)}).finally(function(){e.updateVodInProgress=!1}))},e.prototype.refresh=function(e){var t=this;return new Promise(function(a,s){t.refreshInProgress=!0;var i=e?null:t.loggingService.newScenario("refreshMeetingObject");t.calendarService.getEventUsingEventProvider(t.viewModel.meetingId,teamspace.services.CalendarEventProviderType.userEventUsingEventId,"broadcast-meeting-object",null,!0).then(function(e){t.logger.info("Refresh of the meeting object is successful"),t.refreshInProgress=!1;var s=t.meetingViewModelFactory.getBroadcastMeetingViewModel(e);t.meetingObjectsViewModel=s.meetingObjectsViewModel,i&&i.stop(),a()}).catch(function(e){t.logger.error("Error occurred while refreshing the viewmodel"),t.refreshInProgress=!1,i&&teamspace.services.BroadcastUtilities.handleBroadcastScenarioOnError(i,t.constants,e),s(e)})})},e.prototype.deleteAll=function(){var e=this;if(!this.deleteInProgress){var t=this.loggingService.newScenario(this.constants.scenarios.broadcast.deleteAllMeetingObject);if(!this.meetingObjectsViewModel.meetingObjects.links||!this.meetingObjectsViewModel.meetingObjects.links.deleteAll)return this.logger.error("delete: Link is not present in the resources"),void t.fail({error:"Link is missing"});var a=this.meetingObjectsViewModel.meetingObjects.links.deleteAll;if(!this.utilityService.isValidUrl(a))return this.logger.error("delete: link is not valid {0}",a),void t.fail({error:"Link is not valid"});this.deleteInProgress=!0,this.logger.info("User triggered delete for reports. Url {1}",a);var s=this.utilityService.generateUUID();t.eventData[this.constants.categories.requestId]=s,this.broadcastMeetingService.deleteAllMeetingObjects(a,s).then(function(a){e.logger.info("Successfully deleted all the reports"),e.meetingObjectsViewModel.meetingObjects.isDeleted=!0,e.refresh(!0).then(function(){e.deleteInProgress=!1}).catch(function(t){e.deleteInProgress=!1}),t.stop(),e.ariaLiveService.update(e.$translate.instant(e.resources.strings.broadcast_objects_deletemessage))}).catch(function(s){e.logger.error("Failed to delete the reports at {0}",a),teamspace.services.BroadcastUtilities.handleBroadcastScenarioOnError(t,e.constants,s),e.deleteInProgress=!1})}},e.prototype.restore=function(){var e=this;if(!this.restoreInProgress){var t=this.loggingService.newScenario(this.constants.scenarios.broadcast.restoreMeetingObjects);if(!this.meetingObjectsViewModel.meetingObjects.links||!this.meetingObjectsViewModel.meetingObjects.links.restoreAll)return this.logger.error("restore: Link is not present in the resources"),void t.fail({error:"Link is not present"});var a=this.meetingObjectsViewModel.meetingObjects.links.restoreAll;if(!this.utilityService.isValidUrl(a))return this.logger.error("delete: link is not valid {0}",a),void t.fail({error:"Link is not valid"});this.restoreInProgress=!0,this.logger.info("User triggered restore for reports. Url {1}",a);var s=this.utilityService.generateUUID();t.eventData[this.constants.categories.requestId]=s,this.broadcastMeetingService.restoreAllMeetingObjects(a,s).then(function(a){e.logger.info("Successfully restored all the reports"),e.ariaLiveService.update(e.$translate.instant(e.resources.strings.broadcast_objects_restore_message)),e.meetingObjectsViewModel.meetingObjects.isDeleted=!1,e.refresh(!0).then(function(){e.restoreInProgress=!1}).catch(function(t){e.restoreInProgress=!1}),t.stop()}).catch(function(s){e.logger.error("Failed to restore the reports at {0}",a),teamspace.services.BroadcastUtilities.handleBroadcastScenarioOnError(t,e.constants,s),e.restoreInProgress=!1})}},e.prototype.initialize=function(){var e=this.viewModel.broadcastSettings,t=e&&e.teamsStreamingSettings,a=e&&e.byoeStreamingSettings;if(this.isByoe=!!(e&&e.modalityLinks&&e.modalityLinks.stream),this.isByoe){var s=e.modalityLinks.stream.videoId;this.streamExternalLink=teamspace.services.BroadcastUtilities.getStreamAttendeeExternalLink(s),this.shouldShowByoeResources=!(!a||!a.isQAndAEnabled)}else t&&(this.shouldShowTmbResources=!!(e.isRecordingEnabled||t.isQAndAEnabled||t.isAttendeeReportEnabled||t.isCaptionsEnabled));this.viewModel.meetingObjectsViewModel?(this.logger.info("Meeting objects found"),this.meetingObjectsViewModel=this.viewModel.meetingObjectsViewModel,this.threadId=this.viewModel.associatedConversationId,this.showAdvancedOptions=!!this.meetingObjectsViewModel.meetingObjects.altRecording):this.logger.info("No meeting objects found")},e}();t.BroadcastMeetingObjectsController=r,angular.module("teamspace.broadcastMeetingObjects",["teamspace.calendarService","teamspace.loggingService","teamspace.exceptionUtilityService","teamspace.broadcastMeetingSingleObject"]).component("broadcastMeetingObjects",{bindings:{viewModel:"<",footerMessage:"="},controllerAs:"ctrl",controller:r,templateUrl:"components/broadcast/producer/broadcast-meeting-objects/broadcast-meeting-objects.html"}).run(["$templateCache",function(e){e.put("components/broadcast/producer/broadcast-meeting-objects/broadcast-meeting-objects.html",s)}])},2015:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(2016),a(2018),a(2020),a(84),a(131),a(2023),a(132),a(285),a(283),a(287),a(284),a(2028),a(2030),a(2032),a(288),a(289),a(2034),a(2038),a(2040),a(2043),a(2045),a(2047),a(2049),a(41),a(129),a(290),a(291),a(292),a(293),a(2053),a(2054),a(2090)},2016:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2017),i=a(41),n=a(129),r=function(){function e(e,t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b){var v,S=this;this.broadcastService=e,this.loggingService=t,this.peopleService=a,this.callingAlertsService=s,this.settingsService=i,this.resources=n,this.constants=r,this.$translate=o,this.appConfig=c,this.$scope=l,this.$q=d,this.coachmarkEngine=p,this.coachmarksService=g,this.authenticationService=u,this.callTogglingService=h,this.dialogService=m,this.sxConfig=b,this.isBroadcastLive=!1,this.canStartBroadcast=!1,this.canStopBroadcast=!1,this.isStartBroadcastInProgress=!1,this.isStopBroadcastInProgress=!1,this.captionFontSizeClass=(v={},v[1]="small",v[2]="medium",v[3]="large",v),this.logger=t.newLogger("BroadcastLivePreviewController"),this.title=o.instant(n.strings.broadcast_preview_title),this.statusMessage="",this.liveStreamAvailable=!1,this.broadcastStatus=teamspace.services.BroadcastStatus.NotStarted,l.$on("$destroy",function(){return S.onDestroy()})}return e.$inject=["broadcastService","loggingService","peopleService","callingAlertsService","settingsService","resources","constants","$translate","appConfig","$scope","$q","coachmarkEngine","coachmarksService","authenticationService","callTogglingService","dialogService","sxConfig"],e.prototype.$onInit=function(){var e=this;this.call=this.localBroadcastState&&this.localBroadcastState.call,this.broadcastMeeting=this.call&&this.call.broadcastMeeting,this.broadcastStatusMessageBuilder=new n.BroadcastStatusMessageBuilder(this.peopleService,this.loggingService,this.resources,this.$translate,this.$q,this.authenticationService),this.broadcastMeeting&&(this.broadcastMeetingSubscription=this.broadcastMeeting.changed(this.onBroadcastMeetingChanged.bind(this))),this.participantsManager&&(this.participantsManager.safeSubscribe(this.$scope,this.onComposerStreamAdded.bind(this),i.ComposerStreamAddedEventName),this.participantsManager.safeSubscribe(this.$scope,this.onStreamStateChanged.bind(this),i.StreamStateChanged)),this.callSubscription=this.call.changed(function(){e.callChanged(e.call)}),this.callingAlertsService.safeSubscribe(this.$scope,this.onNewAlertReceived.bind(this)),this.onNewAlertReceived(),this.initializeLiveStream(),this.onBroadcastMeetingChanged(),this.updateStatusMessage(),this.setNonAvatarPlaceHolderMessage(),this.callTogglingService.safeSubscribe(this.$scope,function(){return e.setNonAvatarPlaceHolderMessage()},teamspace.services.CallTogglingService.isIncomingVideoChanged)},e.prototype.startBroadcast=function(){var e=this;this.startBroadcastButtonClicked=!0,this.broadcastCriticalAlert&&this.callingAlertsService.dismiss(this.broadcastCriticalAlert);var t={okButtonText:this.$translate.instant(this.resources.strings.broadcast_dialog_confirm_button_text),closeButtonText:this.$translate.instant(this.resources.strings.cancel),confirmMessageTitle:this.$translate.instant(this.resources.strings.broadcast_start_confirm_title_text),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.broadcast_start_confirm_message_text,{maxDuration:this.getMaxDurationForBroadcastInHours()}),callback:function(){e.isStartBroadcastInProgress=!0,e.busyIndicatorStatusMessage=e.$translate.instant(e.resources.strings.broadcast_stage_layout_starting_broadcast),e.broadcastService.startBroadcast(e.call).then(function(){e.isStartBroadcastInProgress=!1;var t=e.localBroadcastState.getTelemetryHandler();null!=t?t.beginStopCommandAvailabilityScenario():e.logger.error("TelemetryHandler is null")}).catch(function(){e.isStartBroadcastInProgress=!1})}};this.dialogService.open(this.constants.dialogs.confirmDialog,t)},e.prototype.stopBroadcast=function(){var e=this,t={okButtonText:this.$translate.instant(this.resources.strings.broadcast_dialog_confirm_stop_button_text),closeButtonText:this.$translate.instant(this.resources.strings.cancel),confirmMessageTitle:this.$translate.instant(this.resources.strings.broadcast_stop_confirm_title_text),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.broadcast_stop_confirm_message_text),callback:function(){e.isStopBroadcastInProgress=!0,e.busyIndicatorStatusMessage=e.$translate.instant(e.resources.strings.broadcast_stage_layout_stopping_broadcast),e.broadcastService.stopBroadcast(e.call).then(function(){e.isStopBroadcastInProgress=!1}).catch(function(){e.isStopBroadcastInProgress=!1})}};this.dialogService.open(this.constants.dialogs.confirmDialog,t)},e.prototype.isClosedCaptionOn=function(){return this.call.getClosedCaptionStatus()==teamspace.services.CallClosedCaptionStatus.started},Object.defineProperty(e.prototype,"producerCaptionSize",{get:function(){return this.localBroadcastState&&this.localBroadcastState.producerCaptionSize||2},enumerable:!0,configurable:!0}),e.prototype.callChanged=function(e){var t=this.call.getScreenSharer();t&&t.id!=this.currentScreenSharerId&&(this.currentScreenSharerId=t.id,this.updateStatusMessage())},e.prototype.onNewAlertReceived=function(){this.checkForFailures()},e.prototype.checkForFailures=function(){if(this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCriticalAlertsNewDesign)){var e=this.isBroadcastLive?"Bmc_start_command_failure":"Bmc_stop_command_failure",t=this.callingAlertsService.getAlertsOfTypes([e]);t&&t.length?this.broadcastCriticalAlert=t[0]:this.broadcastCriticalAlert=null}},e.prototype.onBroadcastMeetingChanged=function(){var e="BroadcastMeeting changed. modalityState ["+this.broadcastMeeting.modalityState+"]";if(3!==this.broadcastMeeting.modalityState&&(this.canStartBroadcast=!1),this.broadcastMeeting.broadcastState){var t=this.broadcastMeeting.broadcastState;e=e+" broadcast status ["+t.status+"]",t&&t.status!==this.broadcastStatus&&(this.broadcastStatus=t.status),this.updateBroadcastControls(t)}this.logger.info(""+e)},e.prototype.updateBroadcastControls=function(e){if(!e||!e.commands)return this.canStartBroadcast=!1,void(this.canStopBroadcast=!1);var t=3===this.broadcastMeeting.modalityState,a=!1,s=!1;switch(this.broadcastStatus){case teamspace.services.BroadcastStatus.NotStarted:a=t;break;case teamspace.services.BroadcastStatus.Starting:a=!1;break;case teamspace.services.BroadcastStatus.Started:a=!1,this.isBroadcastLive=!0,s=t;break;case teamspace.services.BroadcastStatus.Stopping:case teamspace.services.BroadcastStatus.Stopped:this.isBroadcastLive=!1,this.showPostMeetingMessage=!0,s=!1}this.canStartBroadcast=a&&e.commands.start,this.showCoachmarksIfNeeded(),this.canStopBroadcast=s&&e.commands.stop,this.updateStatusMessage()},e.prototype.showCoachmarksIfNeeded=function(){var t=this;this.canStartBroadcast&&!this.startBroadcastShown&&_.delay(function(){if(!t.startBroadcastButtonClicked){t.coachmarkEngine.showStartBroadcast("#start-broadcast"),t.startBroadcastShown=!0}},e.Coachmark_delay)},e.prototype.updateStatusMessage=function(){var e=this,t=this.broadcastMeeting.broadcastState,a=new Map;if(this.statusMessage="",t&&t.commandStatus&&this.broadcastStatus===teamspace.services.BroadcastStatus.Started){for(var s=0,i=teamspace.services.BroadcastUtilities.getBroadcastLiveSources(t);s<i.length;s++){var n=i[s];this.logger.info("bmcState source is set to id ["+n.id+"], type ["+n.type+"]");var r=teamspace.services.BroadcastUtilities.getParticipantFromBroadcastSource(this.call,n.id,this.sxConfig,this.appConfig);r||this.logger.info("Participant not found for source id ["+n.id+"], type ["+n.type+"]"),a.set(n.type,r)}this.broadcastStatusMessageBuilder.constructStatusMessage(a,!1).then(function(t){e.statusMessage=t},function(t){e.statusMessage=""})}},e.prototype.initializeLiveStream=function(){var e=this,t=null;_.forEach(this.appConfig.broadcastSettings.composerBotMris,function(a){if(t=e.participantsManager.getStream(a,!1))return!1}),t&&this.checkIfComposerVideoStreamIsAvailable(t,"Adding composer bot during initialization")},e.prototype.onComposerStreamAdded=function(e,t){t?this.checkIfComposerVideoStreamIsAvailable(t,"Composer bot stream with key ["+e+"] added to the live preview section"):this.logger.error("onParticipantStreamAdded with key ["+e+"] raised without a stream item")},e.prototype.onStreamStateChanged=function(e,t){this.checkIfComposerVideoStreamIsAvailable(t,"Composer bot video stream with key ["+e+"] has changed")},e.prototype.checkIfComposerVideoStreamIsAvailable=function(e,t){teamspace.services.BroadcastUtilities.isComposerBotMri(e.id,this.appConfig.broadcastSettings.composerBotMris)&&(e.isStreamOn?(this.liveStreamAvailable=!0,this.liveStream=e,this.liveStream.item.position=5,this.logger.info(t)):(this.showPostMeetingMessage=this.broadcastStatus===teamspace.services.BroadcastStatus.Stopped,this.liveStreamAvailable=!1,this.logger.info("Composer bot stream does not have video available")),this.updateStatusMessage())},e.prototype.onDestroy=function(){this.callSubscription&&(this.callSubscription.dispose(),this.callSubscription=null),this.broadcastMeetingSubscription&&(this.broadcastMeetingSubscription.dispose(),this.broadcastMeetingSubscription=null),this.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.StartBroadcast)},e.prototype.setNonAvatarPlaceHolderMessage=function(){var e=this.callTogglingService.isIncomingVideoOn(this.call);this.nonAvatarPlaceHolderMessage=e?this.$translate.instant(this.resources.strings.broadcast_preview_loadingText):this.$translate.instant(this.resources.strings.broadcast_preview_incoming_videos_off)},e.prototype.getMaxDurationForBroadcastInHours=function(){var e=this.broadcastMeeting.broadcastState,t=e&&e.broadcastMaxAllowedDuration?e.broadcastMaxAllowedDuration:this.settingsService.valueFor("broadcastSettings").maxBroadcastDurationInMins;return _.round(t/this.constants.timeConversion.numMinuteInHour,1)},e.Coachmark_delay=3e3,e}();t.BroadcastLivePreviewController=r,angular.module("teamspace.broadcastLivePreview",["teamspace.broadcastService","teamspace.loggingService","teamspace.peopleService","teamspace.coachmarksService","teamspace.authenticationService","teamspace.dialogService","teamspace.callTogglingService"]).component("broadcastLivePreview",{bindings:{localBroadcastState:"<",participantsManager:"<",conversation:"<"},controllerAs:"ctrl",controller:r,templateUrl:"components/broadcast/producer/broadcast-producer-stage/broadcast-live-preview.html"}).run(["$templateCache",function(e){e.put("components/broadcast/producer/broadcast-producer-stage/broadcast-live-preview.html",s)}])},2017:function(e,t){e.exports='<div class="ts-bcast-producer-stage-row-container ts-bcast-producer-stage-header-container">\n  <span class="title single-line-truncation">{{::ctrl.title}}</span>\n  <span class="status-message single-line-truncation" title="{{ctrl.statusMessage}}">{{ctrl.statusMessage}}</span>\n</div>\n<div class="ts-bcast-producer-stage-preview-outer-container" ng-class="{\'pre-live\': !ctrl.isBroadcastLive && !ctrl.showPostMeetingMessage, \'live\': ctrl.isBroadcastLive, \'stopped\': ctrl.showPostMeetingMessage}">\n  <div class="ts-bcast-producer-stage-preview-inner-container">\n    <div class="ts-bcast-producer-stage-preview-content">\n      <div class="ts-bcast-producer-stage-layout single">\n        <div class="flex-fill broadcast-live-preview-container">\n          <span ng-if="!ctrl.liveStreamAvailable && !ctrl.showPostMeetingMessage" class="flex-center-fill live-preview-message">{{::$root.resources.strings.broadcast_preview_notAvailable|translate}}</span>\n          <span ng-if="ctrl.showPostMeetingMessage" class="flex-center-fill live-preview-message">{{::$root.resources.strings.broadcast_postMeeting_Message|translate}}</span>\n          <div class="flex-center-fill" ng-if="ctrl.liveStreamAvailable && !ctrl.showPostMeetingMessage">\n            <calling-participant-stream call="::ctrl.call" stream-model="::ctrl.liveStream.item" conversation="::ctrl.conversation" no-avatar-placeholder="ctrl.nonAvatarPlaceHolderMessage" error-message-on-no-frames="::$root.resources.strings.composer_rendering_error|translate" class="previewstream flex-center-fill broadcast-live-preview-container">\n            </calling-participant-stream>\n          </div>\n        </div>\n      </div>\n    </div>\n    <broadcast-busy-overlay ng-if="ctrl.isStartBroadcastInProgress || ctrl.isStopBroadcastInProgress" text="{{ctrl.busyIndicatorStatusMessage}}" take-focus-from="{{ctrl.isStartBroadcastInProgress ? \'bcast-live-start-btn\' : \'bcast-live-end-btn\'}}" send-focus-to="{{ctrl.isStartBroadcastInProgress ? \'bcast-live-end-btn\' : \'bcast-leave-btn\'}}">\n    </broadcast-busy-overlay>\n    <div class="captions-overlay">\n      <calling-closed-captions ng-if="ctrl.isClosedCaptionOn()" call="ctrl.call" ng-class="ctrl.captionFontSizeClass[ctrl.producerCaptionSize]">\n      </calling-closed-captions>\n    </div>\n  </div>\n</div>\n<div class="ts-bcast-producer-row-reverse ts-bcast-producer-stage-row-container">\n  <div class="ts-ufd-alert-wrapper">\n    <button ng-if="!ctrl.isBroadcastLive" ng-click="ctrl.startBroadcast()" id="start-broadcast" ng-disabled="!ctrl.canStartBroadcast || ctrl.isStartBroadcastInProgress" class="ts-btn ts-bcast-primary-btn ts-bcast-prelive-btn inset-border" translate-once="{{::$root.resources.strings.broadcast_stage_layout_start_broadcast}}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{::$root.trackConstants.trackScenario.startBroadcast}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.startBroadcastButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\'}" track-summary="Start broadcast" take-focus-as="bcast-live-start-btn">\n    </button>\n    <button ng-if="ctrl.isBroadcastLive" ng-click="ctrl.stopBroadcast()" ng-disabled="!ctrl.canStopBroadcast || ctrl.isStopBroadcastInProgress" class="ts-btn ts-bcast-primary-btn ts-bcast-live-btn inset-border" translate-once="{{::$root.resources.strings.broadcast_stage_layout_stop_broadcast}}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{::$root.trackConstants.trackScenario.stopBroadcast}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.stopBroadcastButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\'}" track-summary="Stop broadcast" take-focus-as="bcast-live-end-btn">\n    </button>\n    <calling-ufd-popup ng-if="ctrl.broadcastCriticalAlert" alert="ctrl.broadcastCriticalAlert" class="ts-ufd-alert" show-arrow="true">\n    </calling-ufd-popup>\n  </div>\n  <div class="caption-indicator inset-border inset-border-round" tabindex="0" ng-show="ctrl.isClosedCaptionOn()">\n    <ng-include src="\'svg/icons-closed-caption.html\'"></ng-include>\n  </div>\n</div>\n'},2018:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2019),i=function(){function e(e,t,a){this.appConfig=e,this.$translate=t,this.resources=a}return e.$inject=["appConfig","$translate","resources"],Object.defineProperty(e.prototype,"broadcastStatus",{get:function(){var e=this.call.broadcastMeeting&&this.call.broadcastMeeting.broadcastState;return this.broadcastState=e&&e.status,this.broadcastState},enumerable:!0,configurable:!0}),e.prototype.recordingTooltip=function(){return this.broadcastState&&this.broadcastState===teamspace.services.BroadcastStatus.Started?this.$translate.instant(this.resources.strings.broadcast_objects_recording):this.$translate.instant(this.resources.strings.meeting_recording_indicator_tooltip)},e.prototype.$onInit=function(){var e=this;this.conversation&&this.conversation.whenInitialized().then(function(){e.meetingTitle=e.conversation.getTitle()||""})},e.prototype.hangUp=function(){this.disconnectStateHandler.hangUp()},e}();t.BroadcastProducerHeaderController=i,angular.module("teamspace.broadcastProducerHeader",["teamspace.callingService","teamspace.callingNavigationService","teamspace.loggingService","teamspace.attendeeCountIndicator","teamspace.broadcastStateIndicator"]).component("broadcastProducerHeader",{bindings:{call:"<",conversation:"<",disconnectStateHandler:"<",panelButtonOptions:"<",layoutSettings:"<",isLobbyEnabled:"<",isQuickStartStreamBroadcast:"<?"},controllerAs:"ctrl",controller:i,template:s})},2019:function(e,t){e.exports='<div class="ts-bcast-header-indicators">\n  <ng-include ng-if="ctrl.broadcastStatus !== \'stopped\' && ctrl.broadcastStatus !== \'stopping\'" src="\'svg/icons-call-recording.html\'" title="{{ctrl.recordingTooltip()}}" class="ts-bcast-header-indicator {{ctrl.broadcastStatus}}">\n  </ng-include>\n  <div>\n    <span class="ts-bcast-header-title" title="{{::ctrl.meetingTitle}}">{{::ctrl.meetingTitle}}</span>\n    <calling-duration class="ts-bcast-header-sub-title" call="ctrl.call"></calling-duration>\n  </div>\n  <attendee-count-indicator ng-if="!ctrl.isQuickStartStreamBroadcast && ctrl.broadcastStatus" call="::ctrl.call">\n  </attendee-count-indicator>\n  <broadcast-state-indicator call="::ctrl.call"></broadcast-state-indicator>\n</div>\n<div class="ts-bcast-header-help-link-container">\n  <a class="broadcast-producer-help-link inset-border inset-border-themed" translate-once="{{::$root.resources.strings.broadcast_learn_more_and_help_link_title}}" href="{{::ctrl.appConfig.broadcastPolicyDefaults.producerLearnMoreURL}}" target="_blank">\n  </a>\n</div>\n<div class="ts-bcast-header-controls">\n  <button ng-click="ctrl.hangUp($event)" id="bcastLeaveBroadcastBtn" class="ts-btn ts-bcast-secondary-btn inset-border" translate-once="{{::$root.resources.strings.calling_leave_meetup}}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{::$root.trackConstants.trackScenario.leaveBroadcast}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.leaveBroadcastButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\'}" track-summary="Leave broadcast" take-focus-as="bcast-leave-btn">\n  </button>\n</div>\n<div class="ts-bcast-producer-header-buttons">\n  <calling-action-buttons hide-outside-panel="false" call="ctrl.call" class="header" conversation="::ctrl.conversation" panel-button-options="ctrl.panelButtonOptions" layout-settings="::ctrl.layoutSettings" is-lobby-enabled="::ctrl.isLobbyEnabled">\n  </calling-action-buttons>\n</div>\n'},2020:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2021),i="broadcast_captions_language_",n=function(){function e(e,t,a,s,n,r){var o=this;this.loggingService=s,this.isTranscriptionEnabled=!1,this.isTranscriptionSuppressed=!0,this.fontSizes=[{label:e.instant(t.strings.broadcast_captions_producer_size_small),value:1},{label:e.instant(t.strings.broadcast_captions_producer_size_medium),value:2},{label:e.instant(t.strings.broadcast_captions_producer_size_large),value:3}],this.translatedStringOn=e.instant(t.strings.settings_on),this.translatedStringOff=e.instant(t.strings.settings_off),this.localBroadcastState=a.getLocalBroadcastState(this.call&&this.call.teamsCallId),this.localBroadcastState&&(this.localBroadcastState.isTranscriptionEnabled.then(function(e){o.isTranscriptionEnabled=e}),this.isTranscriptionSuppressed=this.localBroadcastState.isTranscriptionSuppressed,this.localBroadcastState.transcriptionLanguages&&(this.enabledLanguages=e.instant(t.strings.broadcast_captions_attendee_live_captions_languages,{languages:this.localBroadcastState.transcriptionLanguages.map(function(t,a,s){return e.instant(""+i+t)}).join(", ")})),this.producerCaptionSizeInternal=this.fontSizes.find(function(e){return e.value===(o.localBroadcastState&&o.localBroadcastState.producerCaptionSize||2)}))}return e.$inject=["$translate","resources","broadcastService","loggingService","settingsService","constants"],Object.defineProperty(e.prototype,"isVisible",{get:function(){return this.hasCaptionSettings||this.auditoriumModeState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasCaptionSettings",{get:function(){return this.call&&this.call.isBroadcast&&this.localBroadcastState&&this.localBroadcastState.role==teamspace.services.BroadcastMeeting.constants.role.producer&&this.isTranscriptionEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isCaptionEnabledForProducer",{get:function(){return this.call.getClosedCaptionStatus()==teamspace.services.CallClosedCaptionStatus.started},enumerable:!0,configurable:!0}),e.prototype.producerCaptionFontSizeChanged=function(){this.localBroadcastState.producerCaptionSize=this.producerCaptionSizeInternal.value},e.prototype.toggleCaptionsForProducer=function(){this.isCaptionEnabledForProducer?(this.call.stopClosedCaption(),this.loggingService.info("Disabled captions for producer")):(this.call.startClosedCaption(),this.loggingService.info("Enabled captions for producer"))},e.prototype.toggleTranscriptionSuppression=function(){var e=this;this.isTranscriptionSuppressed=!this.isTranscriptionSuppressed,this.localBroadcastState.setTranscriptionSuppression(this.isTranscriptionSuppressed).then(function(){e.loggingService.info("Successfully set transcription suppression state to "+e.isTranscriptionSuppressed)},function(t){e.isTranscriptionSuppressed=!e.isTranscriptionSuppressed,e.loggingService.error("Failed to set transcription suppression state: "+JSON.stringify(t))})},e}();t.BroadcastSettingsPanelController=n,angular.module("teamspace.broadcastSettingsPanel",[]).component("broadcastSettingsPanel",{bindings:{call:"<",auditoriumModeState:"<?"},controller:n,controllerAs:"ctrl",template:s})},2021:function(e,t){e.exports='<div class="broadcast-settings-container" ng-if="ctrl.isVisible">\n  <h2 class="right-pane-header-text app-font-title2-bold">\n    {{::$root.resources.strings.broadcast_settings_panel_title|translate}}\n  </h2>\n\n  \x3c!-- Control auditorium mode --\x3e\n  <div ng-if="ctrl.auditoriumModeState">\n    <div class="toggle-setting-title app-font-base-semibold">\n      {{::$root.resources.strings.broadcast_auditorium_mode|translate}}\n    </div>\n    <div class="toggle-setting-button">\n      <div class="toggle-button-state app-font-caption-regular">\n        {{ctrl.auditoriumModeState.isEnabled ? ctrl.translatedStringOn : ctrl.translatedStringOff}}\n      </div>\n      <toggle-button is-pressed="ctrl.auditoriumModeState.isEnabled" is-disabled="ctrl.auditoriumModeState.isToggleDisabled" on-click="ctrl.auditoriumModeState.toggle()" text="{{::$root.resources.strings.broadcast_auditorium_mode|translate}}" telemetry-outcome="{{ctrl.auditoriumModeState.isEnabled ? $root.trackConstants.trackOutcome.auditoriumModeOff : $root.trackConstants.trackOutcome.auditoriumModeOn}}" telemetry-name="{{::$root.trackConstants.trackModuleName.auditoriumModeToggleButton}}" telemetry-type="{{::$root.trackConstants.trackType.button}}" telemetry-summary="Toggle auditorium mode {{ctrl.auditoriumModeState.isEnabled ? \'OFF\' : \'ON\'}} in broadcast pre join screen">\n      </toggle-button>\n    </div>\n    <div class="toggle-detail-text app-small-font" ng-bind-html="::$root.resources.strings.broadcast_auditorium_mode_description|translate"></div>\n  </div>\n\n  <div ng-if="ctrl.hasCaptionSettings">\n    \x3c!-- Control captions for producer --\x3e\n    <div>\n      <div id="privateViewingTitle" class="toggle-setting-title app-font-base-semibold">\n        {{::$root.resources.strings.broadcast_captions_producer_live_captions|translate}}\n      </div>\n      <div class="toggle-setting-button">\n        <div class="toggle-button-state app-font-caption-regular">\n          {{ctrl.isCaptionEnabledForProducer ? ctrl.translatedStringOn : ctrl.translatedStringOff}}\n        </div>\n        <toggle-button is-pressed="ctrl.isCaptionEnabledForProducer" on-click="ctrl.toggleCaptionsForProducer()" text="{{::$root.resources.strings.broadcast_captions_producer_live_captions|translate}}">\n        </toggle-button>\n      </div>\n      <div class="toggle-detail-text app-small-font">\n        {{::$root.resources.strings.broadcast_captions_producer_live_captions_detail|translate}}\n      </div>\n    </div>\n\n    \x3c!-- Control producer caption size --\x3e\n    <div ng-if="ctrl.isCaptionEnabledForProducer">\n      <label class="font-size-label" translate-once="{{::$root.resources.strings.broadcast_captions_producer_size}}" for="font-size-settings"></label>\n      <dropdown-select class="form-field-input" id="font-size-settings" ds-options="ctrl.fontSizes" ds-selected-value="ctrl.producerCaptionSizeInternal" ds-text-field="label" ds-menu-prevent-default="true" ds-on-change="ctrl.producerCaptionFontSizeChanged()" ds-labelledby-id="closed-captions-settings-font-size" ds-highlight-selected-option="true">\n      </dropdown-select>\n    </div>\n\n    \x3c!-- Control captions for attendees --\x3e\n    <div>\n      <div id="privateViewingTitle" class="toggle-setting-title app-font-base-semibold">\n        {{::$root.resources.strings.broadcast_captions_attendee_live_captions|translate}}\n      </div>\n      <div class="toggle-setting-button">\n        <div class="toggle-button-state app-font-caption-regular">\n          {{!ctrl.isTranscriptionSuppressed ? ctrl.translatedStringOn : ctrl.translatedStringOff}}\n        </div>\n        <toggle-button is-pressed="!ctrl.isTranscriptionSuppressed" on-click="ctrl.toggleTranscriptionSuppression()" text="{{::$root.resources.strings.broadcast_captions_attendee_live_captions|translate}}">\n        </toggle-button>\n      </div>\n    </div>\n    <div class="toggle-detail-text app-small-font">\n      {{::$root.resources.strings.broadcast_captions_attendee_live_captions_detail|translate}}\n    </div>\n    <div class="toggle-detail-text app-small-font" ng-if="ctrl.enabledLanguages">\n      {{ctrl.enabledLanguages}}\n    </div>\n  </div>\n</div>\n'},2022:function(e,t){e.exports='<div class="bp-previewitem" ng-click="ctrl.onItemSelected()" ng-class="{\'disabled\': (ctrl.disabledBehavior && ctrl.disabledBehavior.isStreamDisabled(ctrl.streamItem)) || ctrl.isScreenShareRenderingAlertActive}" role="button" aria-label="{{::ctrl.participantStreamAriaLabel}}" aria-disabled="{{(ctrl.disabledBehavior && ctrl.disabledBehavior.isStreamDisabled(ctrl.streamItem)) || ctrl.isScreenShareRenderingAlertActive}}" send-focus-to="bcast-local-source-item" take-focus-as="{{::ctrl.takeFocusAs}}">\n  <div class="my-preview" ng-if="::ctrl.streamItem.isMe && !ctrl.streamItem.isScreenShare">\n      <div class="previewstream" ng-class="{\'is-preview-item-live\': ctrl.isLive}">\n        <calling-local-video render-preview="ctrl.call.isVideoOn" ignore-mirroring="true" call="::ctrl.call">\n        </calling-local-video>\n      </div>\n      <div class="previewinfo" ng-if="::!ctrl.onlyStream">\n        <div class="preview-name">{{ctrl.streamItem.name}}</div>\n        <div class="icon-container">\n          <calling-video-button is-connecting="ctrl.isCallConnecting()" actions-handler="::ctrl" calling-model="ctrl.call" conversation="::ctrl.conversation" context="{{::ctrl.constants.scenarios.calling.context.broadcast}}">\n          </calling-video-button>\n          <calling-microphone-button is-connecting="ctrl.isCallConnecting()" actions-handler="::ctrl" calling-model="::ctrl.call" conversation="::ctrl.conversation" context="{{::ctrl.constants.scenarios.calling.context.broadcast}}">\n          </calling-microphone-button>\n          <button class="switch-camera-icon-container app-icons-fill-hover inset-border" ng-if="ctrl.canSwitchCamera()" title="{{::$root.resources.strings.icons_call_switch_camera|translate}}" ng-click="ctrl.onSwitchCameraClick($event)">\n            <ng-include src="\'svg/icons-call-switch-camera.html\'"></ng-include>\n          </button>\n        </div>\n      </div>\n </div>\n <div class="my-preview" ng-if="::ctrl.streamItem.isMe && ctrl.streamItem.isScreenShare">\n    <div class="previewstream" ng-class="{\'is-preview-item-live\': ctrl.isLive}">\n      <calling-local-video call="::ctrl.call" is-screenshare="true">\n      </calling-local-video>\n    </div>\n    <div class="previewinfo" ng-if="::!ctrl.onlyStream">\n      <div class="preview-name" translate-once="{{::$root.resources.strings.broadcast_my_activeshare_subtitle_format}}"></div>\n    </div>\n </div>\n <div class="participant-preview" ng-if="::!ctrl.streamItem.isMe" data-tid="bcast-participant-preview">\n    <div class="previewstream" ng-class="{\'is-preview-item-live\': ctrl.isLive}">\n      <calling-participant-stream call="::ctrl.call" stream-model="::ctrl.streamItem.item" conversation="::ctrl.conversation" class="item">\n      </calling-participant-stream>\n    </div>\n    <div class="previewinfo" ng-if="::!ctrl.onlyStream" data-tid="bcast-participant-previewinfo">\n        <div class="preview-name" title="{{ctrl.streamItem.name}}">{{ctrl.streamItem.name}}</div>\n        <div class="icon-container" ng-if="!ctrl.streamItem.isScreenShare">\n          <button class="mute-button ts-sym togglable inset-border inset-border-round" title="{{ctrl.isMuted ? ($root.resources.strings.broadcast_producer_contributor_muted|translate) : ($root.resources.strings.calling_button_mute|translate)}}" ng-click="ctrl.muteParticipant($event)" ng-class="{\'disabled\': ctrl.isMuteParticipantDisabled}" tabindex="{{ ctrl.isMuteParticipantDisabled ? -1 : 0 }}" aria-label="{{ctrl.isMuted ? ($root.resources.strings.broadcast_producer_contributor_muted|translate) : ($root.resources.strings.calling_button_mute|translate)}}">\n            <ng-include src="\'svg/icons-call-microphone\' + (ctrl.isMuted ? \'-off\' : \'\') + \'.html\'"></ng-include>\n            <div class="speaking-indicator" ng-show="ctrl.isSpeaking"></div>\n          </button>\n        </div>\n    </div>\n </div>\n</div>\n'},2023:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2024),i=teamspace.components.Calling,n=a(41),r=a(283),o=a(132),c=a(2025),l=a(2026),d=function(){function e(e,t,a,s,i,n,r,d,p,g,u,h,m,b,v,S,y,f,k,_,P,C,w,M,B,A,I,T,E,$,O,L,x,D,R,U,F,N,j,V){var H=this;this.layoutService=e,this.$scope=t,this.$state=a,this.$q=s,this.$translate=r,this.peopleService=d,this.objectLeaksDetector=p,this.$timeout=g,this.analyticsService=u,this.callingTelemetryService=m,this.callingStateFactory=b,this.callMonitorService=v,this.callingDebugService=S,this.callingParticipantService=y,this.appConfig=f,this.settingsService=k,this.loggingService=_,this.eventingService=P,this.broadcastService=C,this.callTogglingService=w,this.callStateHandlerFactory=M,this.ariaLiveService=B,this.callingAlertsService=A,this.callingSupportService=I,this.constants=T,this.resources=$,this.calendarService=L,this.authenticationService=x,this.utilityService=D,this.meetingNotesService=N,this.callPropsStoreService=j,this.pstnNumberService=V,this.meetingModalityLinks={},this.logger=_.newLogger("BroadcastProducerScreenController"),t.$on("$destroy",function(){return H.onDestroy()}),teamspace.components.Calling.ParticipantState.init(r,t.$root.resources.strings),P.$on(t,T.events.calling.callQualityFeedbackComplete,function(e){var t={teamsCallId:H.call.teamsCallId,callId:H.call.callId,conversationId:H.call.conversationId,joinType:teamspace.services.MeetingJoinType.Legacy};return h.navigateOnQuittingCall(t,!1)}),P.$on(t,T.events.pushEvents.messageStore.createOrUpdateMessage,function(e,t){return t.messages.forEach(function(e){return H.onCreateOrUpdateChatMessage(e)})}),this.immersiveModeHandler=new teamspace.components.Calling.ImmersiveModeHandler(g,t,E,e,_,O,T,k),this.immersiveModeHandler.suppressImmersiveMode(teamspace.components.Calling.ImmersiveEventContext.BroadcastProducerScreen,!0),this.producerScreenAlertsProvider=new o.ProducerScreenAlertsProvider(A,k,T),this.footerAlertContext=teamspace.components.Calling.ImmersiveEventContext.ProducerFooterBanner,this.resizeHandler=new c.ProducerScreenLayoutManager(n,i,r,$,A),k.valueAsBoolean(T.settings.names.enableBroadcastManualFailover)&&(this.failoverHandler=new l.BroadcastManualFailoverHandler(t,this.call,T,_,R,r,C,F,U,A,$),this.failoverHandler.initialize())}return e.$inject=["layoutService","$scope","$state","$q","$element","$window","$translate","peopleService","objectLeaksDetector","$timeout","analyticsService","callingNavigationService","callingTelemetryService","callingStateFactory","callMonitorService","callingDebugService","callingParticipantService","appConfig","settingsService","loggingService","eventingService","broadcastService","callTogglingService","callStateHandlerFactory","ariaLiveService","callingAlertsService","callingSupportService","constants","$document","resources","accessibilityService","calendarService","authenticationService","utilityService","dialogService","shortcutService","brbV2FeedbackService","meetingNotesService","callPropsStoreService","pstnNumberService"],e.prototype.$onInit=function(){var e=this;if(this.localBroadcastState=this.broadcastService.getLocalBroadcastState(this.call.teamsCallId),this.callingState=this.callingStateFactory.get(this.call),this.callTelemetryHandler=new teamspace.components.Calling.CallTelemetryHandler(this.$q,this.$scope,this.$state,this.call,this.callingTelemetryService,this.logger,this.constants,this.analyticsService,this.settingsService,this.utilityService,this.loggingService),this.callDisconnectStateHandler=this.callStateHandlerFactory.getCallDisconnectHandler(this.call,this.conversation,this.callTelemetryHandler,this),this.meetingPanelManager=new teamspace.components.MeetingPanelManager(this.$q,this.$scope,this.call,this.conversation,this.questionnaire,this.settingsService,this.callingSupportService,this.constants,this.meetingNotesService,this.meetingModalityLinks,this.authenticationService,this.ariaLiveService,this.$translate,this.resources),this.call){this.broadcastParticipantsManager=new r.BroadcastParticipantsManager(this.$scope,this.peopleService,this.$q,this.$timeout,this.callingDebugService,this.callingParticipantService,this.loggingService,this.appConfig,this.$translate,this.call,this.constants,this.utilityService,this.callPropsStoreService,this.settingsService,this.eventingService,this.pstnNumberService),this.broadcastParticipantsManager.init();var t=function(){e.resizeHandler.onParticipantsChanged(e.call)};this.broadcastParticipantsManager.safeSubscribe(this.$scope,t,n.ParticipantStreamAddedEventName),this.broadcastParticipantsManager.safeSubscribe(this.$scope,t,n.ParticipantStreamRemovedEventName),this.callSubscription=this.call.changed(function(){e.callChanged(e.call)}),this.extendedCallStateChangedSubscription=this.call.on("extendedCallStateChanged",function(){return e.callChanged(e.call)}),this.voiceCollectionStatusSubscription=this.call.on("voiceCollectionStatusChanged",function(){return e.setVoiceCollectionState()}),this.$scope.$on(this.constants.events.calling.participantsChanged,function(){e.setVoiceCollectionState()}),this.callChanged(this.call),_.defer(this.initializeCallMonitor.bind(this),0),this.callingParticipantService.safeSubscribe(this.$scope,function(t,a){a.callId===e.call.callId&&e.$scope.$broadcast(e.constants.events.calling.participantsChanged,{})},this.constants.events.participants.participantStateChanged)}this.initializeMeetingPanel()},e.prototype.executePreCloseCallingAction=function(){},e.prototype.onQuestionnaireDisplay=function(){},e.prototype.toggleHold=function(){this.callTogglingService.toggleHold(this.call,this.constants.scenarios.calling.context.producerScreen)},e.prototype.onCreateOrUpdateChatMessage=function(e){this.conversation.isInitialized&&this.meetingPanelManager&&this.meetingPanelManager.onCreateOrUpdateChatMessage(e)},e.prototype.setVoiceCollectionState=function(){var e=this.call.getVoiceCollectionStatus(),t=teamspace.services.CallingVoiceCollectionStatus,a=this.call.getPreviousVoiceCollectionStatus();switch(e){case t.none:a===t.started&&this.callingAlertsService.showVoiceCollectionAlerts(e);break;case t.started:this.callingAlertsService.showVoiceCollectionAlerts(e)}},e.prototype.callChanged=function(e){this.logger.debug("CALL changed, participants = "+e.participants.map(function(e){return e.id})+", state = "+e.state+", isMuted = "+e.isMuted+", isVideoOn = "+e.isVideoOn),teamspace.services.CallUtilities.isCallConnected(this.call)&&this.isCallOnHold&&this.ariaLiveService.update(this.$translate.instant(this.resources.strings.aria_announce_call_resumed),!0),this.isCallOnHold=teamspace.services.CallUtilities.isCallOnHold(this.call),7===e.state&&this.callDisconnectStateHandler.onDisconnectState(this.lastCallState),this.lastCallState=e.state,this.panelButtonOptions=this.meetingPanelManager.meetingPanelButtonOptions,this.callingStateCallStatusMessageTitle=this.callingState.getCallStatusMessageTitle(),this.callingStateProps=this.callingState.getCallingStateProps(),this.isCallOnLocalHold=4===this.call.state,this.shouldShowRetryScreen=this.call.canBeRetried()},Object.defineProperty(e.prototype,"isLobbyEnabled",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableLobby)&&this.call.role!==this.constants.calling.roles.guest&&!this.authenticationService.isAnonymous()},enumerable:!0,configurable:!0}),e.prototype.initializeCallMonitor=function(){var e=this;this.logger.info("'initializeCallMonitor': registering for call-monitor"),this.externalMonitorMoreOptionsClickSubscription=this.callMonitorService.subscribe(function(t,a){return e.onExternalCallMonitorMoreOptionClicked(a)},teamspace.services.CallMonitorServiceImplementation.Type_ExternalMonitorMoreOptionClicked)},e.prototype.onExternalCallMonitorMoreOptionClicked=function(e){},e.prototype.onDestroy=function(){this.unsubscribeCallMonitorEvents(),this.callSubscription&&(this.callSubscription.dispose(),this.callSubscription=null),this.broadcastParticipantsManager&&(this.broadcastParticipantsManager.dispose(),this.broadcastParticipantsManager=null),this.questionnaire&&this.questionnaire.abandon(),this.resizeHandler&&(this.resizeHandler.dispose(),this.resizeHandler=null),this.immersiveModeHandler.dispose(),this.immersiveModeHandler=null,this.meetingPanelManager&&this.meetingPanelManager.dispose(),this.extendedCallStateChangedSubscription&&this.extendedCallStateChangedSubscription.dispose(),this.failoverHandler&&this.failoverHandler.dispose(),this.voiceCollectionStatusSubscription&&this.voiceCollectionStatusSubscription.dispose(),this.meetingPanelManager=null,this.meetingInfoExchangeProvider=null,this.panelComponentsOptions=null,this.panelButtonOptions=null,this.objectLeaksDetector.track("broadcast-producer-screen",this,{enableAlerting:!0})},e.prototype.unsubscribeCallMonitorEvents=function(){this.callMonitorService.unsubscribe(this.externalMonitorMoreOptionsClickSubscription)},e.prototype.initializeMeetingPanel=function(){var e=this;this.$scope.$on(this.constants.events.calling.toggleRightPanel,function(t,a){e.setMeetingPanel(a),_.defer(function(){e.resizeHandler&&(e.resizeHandler.updateSourcePickerLayoutIfNeeded(),e.resizeHandler.updateStageLayoutIfNeeded())})}),this.meetingInfoExchangeProvider=new i.MeetingInfoExchangeProvider(this.$q,this.call,this.constants,this.conversation,this.calendarService,this.loggingService,this.callingTelemetryService,this.settingsService),this.localBroadcastState.getAttendeeMeeting().then(function(t){t?(e.isQuickStartStreamBroadcast=teamspace.services.BroadcastUtilities.isQuickStartStreamBroadcast(t,e.settingsService),e.meetingModalityLinks.qnaModerator=t.qna&&t.qna.isEnabled?t.qna.moderatorUrl:void 0,e.meetingModalityLinks.yammer=t.yammer&&t.yammer.isEnabled?{broadcastId:t.yammer&&t.yammer.broadcastId,groupId:t.yammer&&t.yammer.groupId}:void 0,e.supportUrl=t.supportUrl,e.panelButtonOptions=e.meetingPanelManager.meetingPanelButtonOptions,e.meetingModalityLinks.qnaModerator&&(e.panelComponentsOptions=e.meetingPanelManager.meetingPanelComponentsOptions,e.eventingService.$on(e.$scope,e.constants.events.broadcast.qnaUpdateNotification,function(t){return e.meetingPanelManager&&e.meetingPanelManager.handleQnaUpdateNotification()}))):e.logger.error("broadcast-producer-screen: broadcastMeeting object is not valid")}).catch(function(t){e.logger.error("broadcast-producer-screen: failed to get the broadcastMeeting information")}),this.panelButtonOptions=this.meetingPanelManager.meetingPanelButtonOptions,this.isOneToOne=this.conversation.isOneToOne()},e.prototype.setMeetingPanel=function(e){this.meetingPanelManager.toggleMeetingPanel(e),this.panelButtonOptions=this.meetingPanelManager.meetingPanelButtonOptions,this.panelComponentsOptions=this.meetingPanelManager.meetingPanelComponentsOptions},e}();t.BroadcastProducerScreenController=d,angular.module("teamspace.broadcastProducerScreen",["teamspace.broadcastService","teamspace.loggingService","teamspace.constants","teamspace.accessibilityService","teamspace.callingRetryScreen","teamspace.layoutService","teamspace.callingTelemetryService","teamspace.callingSupportService","teamspace.settingsService","teamspace.calendarService","teamspace.authenticationService","teamspace.broadcastMeetingService","teamspace.broadcastProducerHeader","teamspace.broadcastProducerSourcePicker","teamspace.broadcastProducerStage","teamspace.broadcastLivePreview","teamspace.producerStageSection","teamspace.broadcastProducerSourcePickerButtons","teamspace.broadcastProducerPreviewItem","teamspace.broadcastProducerParticipantPanel","teamspace.utilityService","teamspace.meetingNotesService","teamspace.callPropsStoreService","teamspace.pstnNumberService"]).component("broadcastProducerScreen",{bindings:{conversation:"<",isSharingPanelRequested:"<",call:"<"},controllerAs:"ctrl",controller:d,template:s})},2024:function(e,t){e.exports='<div class="ts-bcast-producer-host" ng-class="[ctrl.callingState.getCallingStateProps().className,\n                {\'immersive\': ctrl.immersiveModeHandler.isImmersive},\n                {\'has-panel\': ctrl.meetingPanelManager.hasPanel},\n                {\'short-header\': ctrl.resizeHandler.isHeaderIndicatorsOverflow},\n                {\'hide-help-link\': ctrl.resizeHandler.isHeaderHelpLinkOverflow},\n                {\'has-meeting-info\': ctrl.panelButtonOptions.meetingInfoPanelButtonOptions.shouldCreate}]" simple-mousemove="ctrl.immersiveModeHandler.onHover($event)">\n  <calling-lobby-toast-notification call="::ctrl.call" selected-panel="ctrl.meetingPanelManager.activePanel" ng-if="::ctrl.isLobbyEnabled">\n  </calling-lobby-toast-notification>\n  <div class="ts-bcast-producer-main-side-container" ng-if="!ctrl.questionnaire && !ctrl.shouldShowRetryScreen">\n    <div class="ts-bcast-producer-main-container">\n      <div class="calling-screen-alert-banner" ng-class="{\'immersive\': ctrl.immersiveModeHandler.isImmersive}">\n        <calling-alert-banner call="ctrl.call" alerts-provider="ctrl.producerScreenAlertsProvider"></calling-alert-banner>\n      </div>\n      <broadcast-producer-header ng-class="{\'has-panel\': ctrl.meetingPanelManager.hasPanel}" class="producer-header" call="ctrl.call" conversation="::ctrl.conversation" disconnect-state-handler="::ctrl.callDisconnectStateHandler" panel-button-options="ctrl.panelButtonOptions" layout-settings="::ctrl.layoutService.callingScreenLayoutSettings" is-lobby-enabled="::ctrl.isLobbyEnabled" is-quick-start-stream-broadcast="::ctrl.isQuickStartStreamBroadcast">\n      </broadcast-producer-header>\n      <div class="ts-bcast-controls" ng-show="!ctrl.isCallOnHold">\n        <div class="ts-bcast-producer-items-container" ng-class="{\'small-stage\': ctrl.resizeHandler.isStageControlsOverflow}">\n          <broadcast-producer-stage class="ts-bcast-producer-item" local-broadcast-state="::ctrl.localBroadcastState" participants-manager="::ctrl.broadcastParticipantsManager" conversation="::ctrl.conversation">\n          </broadcast-producer-stage>\n          <broadcast-live-preview class="ts-bcast-producer-item" local-broadcast-state="::ctrl.localBroadcastState" participants-manager="::ctrl.broadcastParticipantsManager" conversation="::ctrl.conversation">\n          </broadcast-live-preview>\n        </div>\n        <broadcast-producer-source-picker ng-class="[{\'two-column-mode\': ctrl.resizeHandler.isSourcePickerThreeColumnsOverflow},\n                    {\'one-column-mode\': ctrl.resizeHandler.isSourcePickerTwoColumnsOverflow}]" local-broadcast-state="::ctrl.localBroadcastState" participants-manager="::ctrl.broadcastParticipantsManager" is-sharing-panel-requested="::ctrl.isSharingPanelRequested" conversation="::ctrl.conversation">\n        </broadcast-producer-source-picker>\n      </div>\n      <div ng-if="ctrl.isCallOnHold" class="ts-bcast-hold-state" ng-show="ctrl.duration">\n        <div class="ts-bcast-text">\n          <ng-include src="\'svg/icons-call-participant-onhold.html\'"></ng-include>\n          <span role="status" aria-live="assertive" aria-label="{{this.callingStateProps.descriptionText}}">{{ctrl.callingStateCallStatusMessageTitle}}</span>\n          <calling-duration class="hold-timer" call="ctrl.call" manage-hold-offset="::ctrl.isCallOnHold" cd-duration="ctrl.duration"></calling-duration>\n        </div>\n        <div ng-if="ctrl.isCallOnLocalHold" class="resume-button-wrapper">\n          <button class="ts-btn ts-btn-primary dark-mode" title="{{$root.resources.strings.calling_rejoin_call|translate}}" aria-label="{{::$root.resources.strings.calling_rejoin_call|translate}}" ng-click="ctrl.toggleHold($event)">\n            {{::$root.resources.strings.calling_rejoin_call|translate}}\n          </button>\n        </div>\n      </div>\n    </div>\n    <multi-call-list active-call="::ctrl.call" context="{{::ctrl.constants.scenarios.calling.context.producerScreen}}" class="ts-bcast-multi-call-list" immersive-handler="::ctrl.immersiveModeHandler">\n    </multi-call-list>\n    <div class="ts-bcast-producer-side-container">\n      <div class="broadcast-producer-meeting-tabs">\n        <div class="ts-calling-screen flex-fill" ng-class="[ctrl.meetingPanelManager.showClassName, {\'one-to-one\': ctrl.isOneToOne},\n          {\'immersive\': ctrl.immersiveModeHandler.isImmersive},\n          {\'has-panel\': ctrl.meetingPanelManager.hasPanel},\n          {\'has-meeting-info\': ctrl.panelButtonOptions.meetingInfoPanelButtonOptions.shouldCreate}]">\n          <calling-action-buttons acc-role="tab-handler-calling-screen-action-buttons" hide-outside-panel="true" call="ctrl.call" class="rail" conversation="::ctrl.conversation" panel-button-options="ctrl.panelButtonOptions" layout-settings="::ctrl.layoutService.callingScreenLayoutSettings" is-lobby-enabled="::ctrl.isLobbyEnabled">\n          </calling-action-buttons>\n          <meeting-panel-components ng-if="ctrl.meetingPanelManager.isPanelCreated" ng-class="{\'hide-meetings-panel\': !ctrl.meetingPanelManager.hasPanel}" class="ts-meeting-panel-components" call="ctrl.call" conversation="::ctrl.conversation" actions-handler="::ctrl" participants-manager="::ctrl.broadcastParticipantsManager.participantsManager" meeting-info-exchange-provider="::ctrl.meetingInfoExchangeProvider" support-url="ctrl.supportUrl" qna-url="::ctrl.meetingModalityLinks.qnaModerator" yammer-extension="::ctrl.meetingModalityLinks.yammer" display-options="ctrl.panelComponentsOptions">\n          </meeting-panel-components>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="ts-bcast-producer-state-container" ng-class="{\'hasErrorState\': ctrl.shouldShowRetryScreen}" ng-if="!ctrl.questionnaire" data-tid="bcast-producer-state-container">\n    <div ng-if="!ctrl.shouldShowRetryScreen" class="state-description-title">\n      <div ng-if="ctrl.callingStateProps.icon" ng-include="\'svg/\' + ctrl.callingStateProps.icon + \'.html\'" class="hide-text state-logo"></div>\n      <div ng-bind-html="ctrl.callingStateCallStatusMessageTitle" data-tid="call-status" class="state-message-title"></div>\n    </div>\n    <div ng-if="!ctrl.shouldShowRetryScreen" class="state-description-text" ng-bind="ctrl.callingStateProps.descriptionText" data-tid="state-description-text"></div>\n    <div class="call-retry-container" acc-role="tab-handler-calling-screen-error-message" ng-if="ctrl.shouldShowRetryScreen">\n      <calling-retry-screen ng-if="ctrl.shouldShowRetryScreen" call="ctrl.call" calling-state="ctrl.callingState" call-disconnect-state-handler="ctrl.callDisconnectStateHandler">\n      </calling-retry-screen>\n    </div>\n  </div>\n  <div class="ts-bcast-feedback-container" ng-if="ctrl.questionnaire">\n    <calling-quality-feedback questionnaire="ctrl.questionnaire" calling-screen-mode="true">\n    </calling-quality-feedback>\n  </div>\n  <calling-debug ng-if="!ctrl.layoutService.hideDebug || ctrl.isScenarioTestMode" conversation="::ctrl.conversation"></calling-debug>\n</div>\n'},2025:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=250,i=function(){function e(e,t,a,i,n){var r=this;this.$window=e,this.$element=t,this.$translate=a,this.resources=i,this.callingAlertsService=n,this.isSourcePickerThreeColumnsOverflow=!1,this.isSourcePickerTwoColumnsOverflow=!1,this.isStageControlsOverflow=!1,this.isHeaderHelpLinkOverflow=!1,this.isHeaderIndicatorsOverflow=!1,this.isPreviewOverflowUfdShown=!1,this.videoSourcesTypesCount=1;var o=function(){r.updateStageLayoutIfNeeded(),r.updateSourcePickerLayoutIfNeeded()};this.resizeScreenHandler=_.throttle(o,s),e.addEventListener("resize",this.resizeScreenHandler),_.defer(o)}return e.prototype.onParticipantsChanged=function(e){this.call=e,this.videoSourcesTypesCount=1,this.call&&this.call.participants&&this.call.participants.length>1&&(this.videoSourcesTypesCount+=1),this.call&&this.call.isScreenSharingOn&&(this.videoSourcesTypesCount+=1),this.updateSourcePickerLayoutIfNeeded()},e.prototype.updateStageLayoutIfNeeded=function(){if(this.containerElement&&0!==this.containerElement.length&&this.previewContainer&&0!==this.previewContainer.length||(this.previewContainer=this.$element.find(".ts-bcast-producer-stage-preview-outer-container.pre-live"),this.containerElement=this.$element.find(".ts-bcast-producer-main-container")),this.containerElement&&this.containerElement.length>0){var e=this.containerElement.width();this.isHeaderHelpLinkOverflow=e<755,this.isHeaderIndicatorsOverflow=e<500,this.isStageControlsOverflow=e<515}if(this.previewContainer&&this.previewContainer.length>0){var t=this.previewContainer.width()/this.previewContainer.height();this.showOrHidePreviewOverflowUfd(t)}},e.prototype.updateSourcePickerLayoutIfNeeded=function(){if(this.containerElement||(this.containerElement=this.$element.find(".ts-bcast-producer-main-container")),this.containerElement&&this.containerElement.length>0){var e=this.containerElement.width();this.isSourcePickerThreeColumnsOverflow=3===this.videoSourcesTypesCount&&e<740,this.isSourcePickerTwoColumnsOverflow=e<560}},e.prototype.showOrHidePreviewOverflowUfd=function(e){if(e){var t=e>2;!this.isPreviewOverflowUfdShown&&t?(this.previewOverflowUfd={name:"Broadcast_preview_overflow_warning",type:teamspace.services.AlertType.Warning,title:this.$translate.instant(this.resources.strings.broadcast_preview_overflow_ufd_title),text:this.$translate.instant(this.resources.strings.broadcast_preview_overflow_ufd_text),dismissable:!0,actions:[]},this.callingAlertsService.handleOnDemandAlert(this.previewOverflowUfd),this.isPreviewOverflowUfdShown=!0):this.isPreviewOverflowUfdShown&&!t&&(this.callingAlertsService.dismiss(this.previewOverflowUfd),this.isPreviewOverflowUfdShown=!1)}},e.prototype.dispose=function(){this.$window.removeEventListener("resize",this.resizeScreenHandler)},e}();t.ProducerScreenLayoutManager=i},2026:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2027),i=function(){function e(e,t,a,s,i,n,r,o,c,l,d){this.$scope=e,this.call=t,this.constants=a,this.loggingService=s,this.dialogService=i,this.$translate=n,this.broadcastService=r,this.brbV2FeedbackService=o,this.shortcutService=c,this.callingAlertsService=l,this.resources=d,this.attemptCount=0,this.logger=s.newLogger("BroadcastManualFailoverHandler")}return e.prototype.initialize=function(){this.isInitialized||(this.onKeyPressed=this.executeCommand.bind(this),this.shortcutService.assignCommandHandler(teamspace.services.CommandIdentifier.FailoverBroadcast,this.onKeyPressed,this.$scope),this.isInitialized=!0)},e.prototype.executeCommand=function(){var e,t=this;if(this.currentStep)return this.logger.info("Waiting for {0} to complete",this.currentStep.name),void this.dialogService.open(this.constants.dialogs.confirmDialog,{isConfirmation:!0,showAffirmationAfterAction:!1,affirmationCallback:function(){},dialogBusyMessage:"",closeButtonText:"",okButtonText:this.$translate.instant(this.resources.strings.teams_okButtonText),confirmMessageTitle:this.$translate.instant(this.resources.strings.broadcast_reset_inprogress_title),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.broadcast_reset_inprogress_text),callback:function(){},preCloseCallback:function(){},confirmDialogType:""});var a={},i={callId:this.call.callId,participantId:this.call.participantId,threadId:this.call.threadId},n=this.loggingService.newScenario(this.constants.scenarios.broadcast.triggerFailover),r=this.call.broadcastMeeting&&this.call.broadcastMeeting.broadcastState;if(!r||!r.commands)return this.showInfoDialog(this.$translate.instant(this.resources.strings.broadcast_reset_syncing_title),this.$translate.instant(this.resources.strings.broadcast_reset_syncing_text)),this.logger.info("Broadcast commands are not yet synced."),a.reason="NotSynced",void n.cancel((e={},e[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),e));if(r&&r.status&&r.status===teamspace.services.BroadcastStatus.Stopped)return this.showInfoDialog(this.$translate.instant(this.resources.strings.broadcast_reset_stopstate_title),this.$translate.instant(this.resources.strings.broadcast_reset_stopstate_text)),this.logger.info("Reset command is not available for stopped broadcast"),a.reason="Stopped",i[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),void n.cancel(i);if(!r.commands.instanceFailover&&!r.commands.switchPrimary)return this.showInfoDialog(this.$translate.instant(this.resources.strings.broadcast_reset_notavailable_title),this.$translate.instant(this.resources.strings.broadcast_reset_notavailable_text)),this.logger.info("No reset command is available"),a.reason="CommandsNotAvailable",i[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),void n.cancel(i);var o=0==this.attemptCount;r.commands.instanceFailover?this.currentStep=new s.BroadcastInstanceFailoverStep(this.call,this.brbV2FeedbackService,this.dialogService,this.broadcastService,this.constants,this.loggingService,this.$translate,this.resources,o,n):this.currentStep=new s.BroadcastSwitchPrimaryFailoverStep(this.call,this.brbV2FeedbackService,this.dialogService,this.broadcastService,this.constants,this.loggingService,this.$translate,this.resources,o,n),a.FailoverStep=this.currentStep.name,a.AttemptCount=this.attemptCount,this.attemptCount++,this.logger.info("Executing reset step {0}. Attempt count {1}",this.currentStep.name,this.attemptCount),this.currentStepPromise=this.currentStep.execute(this.call).then(function(e){if(e){var s={name:"Broadcast_reset_done",type:teamspace.services.AlertType.Info,title:t.$translate.instant(t.resources.strings.broadcast_reset_completed_ufd_title),text:t.$translate.instant(t.resources.strings.broadcast_reset_completed_ufd_text),dismissable:!0,teamsCallId:t.call.teamsCallId,actions:[]};t.callingAlertsService.handleOnDemandAlert(s),i[t.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),n.stop(i)}else t.attemptCount--,a.reason="Cancelled",i[t.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),n.cancel(i);t.logger.info("Step executed. {0}",t.currentStep.name),t.currentStep=void 0,t.currentStepPromise=void 0}).catch(function(e){t.attemptCount--,t.logger.error("Failover step attempt failed for "+t.currentStep.name+". Error "+JSON.stringify(e)),t.currentStep=void 0,t.currentStepPromise=void 0;var r={name:"Broadcast_reset_done",type:teamspace.services.AlertType.Warning,title:t.$translate.instant(t.resources.strings.broadcast_reset_completed_ufd_title),text:t.$translate.instant(t.resources.strings.broadcast_reset_completed_ufd_text),dismissable:!0,teamsCallId:t.call.teamsCallId,actions:[]};t.callingAlertsService.handleOnDemandAlert(r),i[t.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(e),e&&e.errorCode==s.BroadcastFailoverErrorCodes.CommandNotAvailable?(a.reason=s.BroadcastFailoverErrorCodes.CommandNotAvailable,i[t.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),n.cancel(i)):(i[t.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(a),n.fail(i))})},e.prototype.showInfoDialog=function(e,t){this.dialogService.open(this.constants.dialogs.confirmDialog,{isConfirmation:!0,showAffirmationAfterAction:!1,affirmationCallback:function(){},dialogBusyMessage:"",closeButtonText:"",okButtonText:this.$translate.instant(this.resources.strings.teams_okButtonText),confirmMessageTitle:e,confirmMessageHtmlBody:t,callback:function(){},preCloseCallback:function(){},confirmDialogType:""})},e.prototype.dispose=function(){this.shortcutService.unassignCommandHandler(teamspace.services.CommandIdentifier.FailoverBroadcast,this.onKeyPressed),this.currentStep&&this.currentStep.dispose()},e}();t.BroadcastManualFailoverHandler=i},2027:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.CommandNotAvailable="CommandNotAvailable",e}();t.BroadcastFailoverErrorCodes=i;var n=function(){function e(e,t,a,s,i,n,r,o,c,l,d){this.call=e,this.brbV2FeedbackService=t,this.dialogService=a,this.broadcastService=s,this.constants=i,this.$translate=r,this.resources=o,this.collectLogs=c,this.scenario=l,this.name=d,this.logger=n.newLogger(d)}return e.prototype.execute=function(e){var t=this;return this.collectBrbLogs().then(function(a){return a?new Promise(function(a,s){var i=!1,n=t.confirmMessageBody,r={okButtonText:t.confirmDialogResetButton,closeButtonText:t.$translate.instant(t.resources.strings.cancel),confirmMessageTitle:t.confirmMessageTitle,confirmMessageHtmlBody:n,callback:function(){i=!0,t.logger.info("User confirmed the Failover operation. Failing over the event"),t.failover(e).then(function(){a(!0)}).catch(function(e){s(e)})}};t.scenario.pause({reason:"OpeningResetDialog"});var o=t.dialogService.open(t.constants.dialogs.confirmDialog,r);return t.lastDialogResult=o,o.closePromise.then(function(){t.scenario.resume(),i||a(!1)})}):(t.logger.info("Brb logs submission was cancelled"),!1)})},e.prototype.collectBrbLogs=function(){var e=this;if(!this.collectLogs)return Promise.resolve(!0);var t={};t.cancel=this.$translate.instant(this.resources.strings.broadcast_reset_feedback_skip_button),t.submit=this.$translate.instant(this.resources.strings.broadcast_reset_feedback_next_button);var a=document.activeElement;return new Promise(function(s,i){e.logger.info("Opening brb dialog"),e.scenario.pause({reason:"OpeningBrb"}),e.brbV2FeedbackService.openDialog(null,null,null,!0,t).then(function(t){e.logger.info("brb dialog closed with data value"+(t&&t.value)),e.scenario.resume();try{angular.element(a).focus()}catch(e){}s(!0)})})},e.prototype.dispose=function(){this.lastDialogResult&&this.dialogService.close(this.lastDialogResult.id)},e.prototype.failover=function(e){return null},Object.defineProperty(e.prototype,"confirmMessageTitle",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"confirmMessageBody",{get:function(){return null},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"confirmDialogResetButton",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_reset_button)},enumerable:!0,configurable:!0}),e}();t.BaseBroadcastFailoverStep=n;var r=function(e){function t(t,a,s,i,n,r,o,c,l,d){return e.call(this,t,a,s,i,n,r,o,c,l,d,"instanceFailover")||this}return s(t,e),t.prototype.failover=function(e){var t=this,a=this.call.broadcastMeeting&&this.call.broadcastMeeting.broadcastState;return a&&a.commands&&a.commands.instanceFailover?this.broadcastService.failoverInstance(e,!0).then(function(){t.logger.info("instanceFailover completed")}):(this.logger.error("Instance failover command is not available"),Promise.reject({errorCode:i.CommandNotAvailable}))},Object.defineProperty(t.prototype,"confirmMessageTitle",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_reset_primary_title)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"confirmMessageBody",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_reset_primary_text)},enumerable:!0,configurable:!0}),t}(n);t.BroadcastInstanceFailoverStep=r;var o=function(e){function t(t,a,s,i,n,r,o,c,l,d){return e.call(this,t,a,s,i,n,r,o,c,l,d,"switchPrimary")||this}return s(t,e),t.prototype.failover=function(e){var t=this,a=this.call.broadcastMeeting&&this.call.broadcastMeeting.broadcastState;return a&&a.commands&&a.commands.switchPrimary?this.broadcastService.switchPrimary(e).then(function(){t.logger.info("Switch primary failover completed")}):(this.logger.error("switchPrimary command is not available"),Promise.reject({errorCode:i.CommandNotAvailable}))},Object.defineProperty(t.prototype,"confirmMessageTitle",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_switchto_backup_title)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"confirmMessageBody",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_switchto_backup_text)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"confirmDialogResetButton",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_switchto_button)},enumerable:!0,configurable:!0}),t}(n);t.BroadcastSwitchPrimaryFailoverStep=o},2028:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2029),i=a(41),n=function(){function e(e,t,a,s,n){var r=this;this.logger=n.newLogger("BroadcastParticipantPanel"),this.container=t.find(".cp-container"),this.logger.info("Initializing the broadcast participant panel"),e.$on(i.ParticipantStreamAddedEventName,function(e,t){r.onItemAdded(t.itemWrapper)}),e.$on("$destroy",function(){s.track("broadcast-producer-participant-panel",r)}),e.$emit(i.ParticipantPanelCreated),this.logger.info("Participant panel initialized. Isscreensharingpanel {0}",!!this.isScreenSharePanel)}return e.$inject=["$scope","$element","constants","objectLeaksDetector","loggingService"],e.prototype.onItemAdded=function(e){if(!!this.isScreenSharePanel==!!e.streamItem.isScreenShare){var t=e.streamItem;t&&this.insertItemAtPosition(e,t.item.layout.order)}else this.logger.info("Current panel type and item type do not match. Panel type {0}. Item type {1}",this.isScreenSharePanel,e.streamItem.isScreenShare)},e.prototype.insertItemAtPosition=function(e,t){var a=this.container[0];0===t?a.insertBefore(e.element[0],a.children&&a.children.length?a.children[0]:null):a.appendChild(e.element[0])},e}();t.BroadcastProducerParticipantPanelController=n,angular.module("teamspace.broadcastProducerParticipantPanel",["teamspace.loggingService","teamspace.constants"]).component("broadcastProducerParticipantPanel",{bindings:{isScreenSharePanel:"<",listLabelledById:"@"},controller:n,controllerAs:"ctrl",templateUrl:"components/broadcast/broadcast-producer-participant-panel.html"}).run(["$templateCache",function(e){e.put("components/broadcast/broadcast-producer-participant-panel.html",s)}])},2029:function(e,t){e.exports='<div class="ts-broadcast-cp">\n  <div class="cp-background"></div>\n  <div class="cp-container" role="list" aria-labelledby="{{::ctrl.listLabelledById}}">\n  </div>\n</div>\n'},2030:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2031),i=function(){function e(e,t,a,s,i,n,r){var o=this;this.constants=t,this.callMuteService=s,this.settingsService=i,this.$translate=n,this.resources=r,this.isNetworkReconnectOngoing=!1,this.adminSettings=a.getAdminSettings(),this.muteParticipantEnabled=i.valueAsBoolean(t.settings.names.enableRemoteMuteParticipant),e.$on("$destroy",function(){o.networkReconnectStatusChangedSubscription&&o.networkReconnectStatusChangedSubscription.dispose()})}return e.$inject=["$scope","constants","callingService","callMuteService","settingsService","$translate","resources"],e.prototype.$onInit=function(){var e=this;this.settingsService.valueAsBoolean(this.constants.settings.names.enableNetworkReconnectUI)&&(this.networkReconnectStatusChangedSubscription=this.call.on("networkReconnectStatusChanged",function(){return e.onNetworkReconnectChanged()}),this.onNetworkReconnectChanged())},e.prototype.getTitle=function(){return this.call.isScreenSharingOn?this.$translate.instant(this.resources.strings.broadcast_producer_stop_share):this.$translate.instant(this.resources.strings.broadcast_producer_share)},e.prototype.handleSharing=function(){this.call.isScreenSharingOn?(this.call.stopScreenSharingOnCall(this.constants.scenarios.calling.context.producerScreen),this.actionHandler.showSharingPanel=!1):this.actionHandler.showSharingPanel=!0},e.prototype.muteAll=function(){this.callMuteService.muteAllParticipants(this.call)},e.prototype.shouldDisableScreenSharing=function(){return this.call&&(2===this.call.state||!this.adminSettings.isScreenSharingEnabled||4===this.call.state||5===this.call.state||this.isNetworkReconnectOngoing||10===this.call.state)},e.prototype.onNetworkReconnectChanged=function(){this.isNetworkReconnectOngoing=this.call.isNetworkReconnectOngoing()},e}();t.BroadcastProducerSourcePickerButtonsController=i,angular.module("teamspace.broadcastProducerSourcePickerButtons",[]).component("broadcastProducerSourcePickerButtons",{bindings:{call:"<",actionHandler:"<?"},controller:i,templateUrl:"components/broadcast/broadcast-producer-source-picker-buttons.html"}).run(["$templateCache",function(e){e.put("components/broadcast/broadcast-producer-source-picker-buttons.html",s)}])},2031:function(e,t){e.exports='<div class="bs-producer-control-area">\n  <button class="ts-btn ts-bcast-secondary-btn share-button inset-border single-line-truncation" ng-disabled="$ctrl.shouldDisableScreenSharing()" ng-click="$ctrl.handleSharing()" ng-if="$ctrl.adminSettings.isScreenSharingEnabled" title="{{$ctrl.getTitle()}}" take-focus-as="bcast-screenshare-btn" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.sourcePickerShare}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.shareButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{callId: \'{{$ctrl.call.callId}}\', participantId: \'{{$ctrl.call.participantId}}\'}" track-summary="Share button in source picker tray clicked" id="broadcast-producer-source-picker-share">{{$ctrl.getTitle()}}\n  </button>\n  <button class="ts-btn ts-bcast-secondary-btn mute-button inset-border single-line-truncation" translate-once="{{::$root.resources.strings.broadcast_producer_muteall}}" ng-click="$ctrl.muteAll()" title="{{::$root.resources.strings.broadcast_producer_muteall|translate}}" acc-role="tab-handler-producer-control-panel" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.sourcePickerMuteAll}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.muteAllButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{callId: \'{{$ctrl.call.callId}}\', participantId: \'{{$ctrl.call.participantId}}\'}" track-summary="Mute all button in source picker tray clicked">\n  </button>\n</div>\n'},2032:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2033),i=a(288),n=a(41),r=a(84),o=a(131),c=a(289),l=a(132),d=a(130),p=function(){function e(e,t,a,s,r,c,d,p,g,u,h,m,b,v,S,y,f,k,_,P,C,w){var M=this;this.$scope=e,this.$element=a,this.$translate=r,this.coachmarkEngine=c,this.coachmarksService=d,this.resources=p,this.constants=g,this.dialogService=u,this.loggingService=h,this.callingDebugService=m,this.callingAlertsService=b,this.deviceManagerService=v,this.authenticationService=S,this.broadcastService=y,this.settingsService=f,this.layoutService=_,this.adminSettingsService=P,this.appConfig=C,this.shareSystemAudioService=w,this.sendToPreviewCoachmarkShown=!1,this.isConcurrentVideosLimitUfdShown=!1,this.hasActiveSharingByOtherParticipant=!1,this.logger=h.newLogger("broadcast-producer-tray"),this.sourcePickerScreenElement=a.find(".bp-source-picker"),this.participantPreviewUIWrappers=[],this.childrenComponentCreatedDefer=t.defer(),this.previewItemFactory=new o.BroadcastProducerPreviewItemFactory(s),this.producerScreenAlertsProvider=new l.ProducerScreenAlertsProvider(b,f,g),this.layoutManager=new i.BroadcastParticipantLayoutManager(this.onItemPositionChanged.bind(this),h.newLogger("layoutManager")),e.$on("$destroy",function(){M.onDestroy(),k.track("broadcast-producer-source-picker",M)}),e.$on(n.ParticipantPanelCreated,function(){M.logger.info("Resolving child component initialization promise"),M.childrenComponentCreatedDefer.resolve()})}return e.$inject=["$scope","$q","$element","$compile","$translate","coachmarkEngine","coachmarksService","resources","constants","dialogService","loggingService","callingDebugService","callingAlertsService","deviceManagerService","authenticationService","broadcastService","settingsService","objectLeaksDetector","layoutService","adminSettingsService","appConfig","shareSystemAudioService"],e.prototype.$onInit=function(){var e,t=this;this.call=this.localBroadcastState&&this.localBroadcastState.call,this.streamDisabledBehavior=new c.BroadcastSourcePickerPreviewItemDisabledBehavior(this.localBroadcastState,this.participantsManager),this.broadcastStreamRenderingAlertsHelper=new d.BroadcastStreamRenderingAlertsHelper(this.loggingService,this.constants,this.resources,this.$translate,this.$scope,this.callingAlertsService,this.call,this.settingsService),this.callingAlertsService.safeSubscribe(this.$scope,this.onNewAlertReceived.bind(this)),this.participantsManager.safeSubscribe(this.$scope,this.onParticipantStreamAdded.bind(this),n.ParticipantStreamAddedEventName),this.participantsManager.safeSubscribe(this.$scope,this.onParticipantStreamRemoved.bind(this),n.ParticipantStreamRemovedEventName),this.participantsManager.safeSubscribe(this.$scope,this.onStreamStateChanged.bind(this),n.StreamStateChanged),this.logger.info("Subscribing to the stream added and removed events"),this.filterSharingMask=teamspace.components.SharingTypes.screen|teamspace.components.SharingTypes.window,!this.showSharingPanel&&this.isSharingPanelRequested&&(this.showSharingPanel=!0),e=this.participantsManager.getMyStreams(),this.myScreenShareStream=e[0],this.myVideoStream=e[1];for(var a=this.participantsManager.getOtherStreams(),s=0;s<a.length;s++)this.onParticipantStreamAdded(a[s].id,a[s]);this.deviceManagerService.safeSubscribe(this.$scope,this.onDeviceChanged.bind(this),this.constants.events.calling.devicesChanged),this.adminSettingsService.getAdminSettings().then(function(e){t.isIPVideoEnabledByPolicy=e.isVideoEnabled,t.isVbssEnabledByPolicy=e.isScreenSharingEnabled,t.selectContentToShareCoachmarkNeeded=!t.isIPVideoEnabledByPolicy&&t.isVbssEnabledByPolicy&&!t.call.isScreenSharingOn&&!t.participantsManager.getOtherStreams().length,t.onDeviceChanged(),t.call&&t.call.broadcastMeeting&&(t.broadcastChangedSubscription=t.call.broadcastMeeting.changed(function(){t.showCoachmarksIfNeeded(t.myVideoStream)}))}),this.onNewAlertReceived(),this.myVideoStream&&this.authenticationService.getUserInformation().then(function(e){t.myVideoStream.name=e.profile.name}),this.broadcastStreamRenderingAlertsHelper.safeSubscribe(this.$scope,this.onRendererAlertsReceived.bind(this),this.constants.events.calling.screenShareRenderingAlert)},e.prototype.hasActiveSharingByMeOrOtherParticipant=function(){return this.call.isScreenSharingOn||this.hasActiveSharingByOtherParticipant},e.prototype.shouldShowPaticipantPanel=function(){return this.participantPreviewUIWrappers&&this.participantPreviewUIWrappers.length>0},e.prototype.startSharingContent=function(e){this.logger.error("Start sharing content invoked")},e.prototype.startSharing=function(e){var t=this,a=this.hasActiveSharingByMeOrOtherParticipant(),s=this.shareSystemAudioService.shouldShareSystemAudio;if(!a)return this.showSharingPanel=!1,void this.call.startScreenSharingOnCall(e,this.constants.scenarios.calling.context.producerScreen,void 0,s);var i=this.call.broadcastMeeting&&this.call.broadcastMeeting.broadcastState;if((i&&i.status)===teamspace.services.BroadcastStatus.Started&&!this.call.isScreenSharingOn&&teamspace.services.BroadcastUtilities.isScreenShareBroadcasting(this.call)){var n={okButtonText:this.$translate.instant(this.resources.strings.broadcast_share_confirm_button_text),closeButtonText:this.$translate.instant(this.resources.strings.cancel),confirmMessageTitle:this.$translate.instant(this.resources.strings.broadcast_share_confirm_title_text),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.broadcast_share_confirm_message_text),callback:function(){t.showSharingPanel=!1,t.call.startScreenSharingOnCall(e,t.constants.scenarios.calling.context.producerScreen,void 0,s)}};this.dialogService.open(this.constants.dialogs.confirmDialog,n)}else this.showSharingPanel=!1,this.call.startScreenSharingOnCall(e,this.constants.scenarios.calling.context.producerScreen,void 0,s)},e.prototype.sharingPanelSizeChanged=function(){this.logger.error("Sharing panel size changed")},e.prototype.hideSharingPanel=function(){this.showSharingPanel=!1},e.prototype.onParticipantStreamAdded=function(e,t){var a=this;t?this.participantPreviewUIWrappers.findIndex(function(e){return e.streamItem===t})>=0?this.logger.info("Item is already present. Skipping {0}",e):this.childrenComponentCreatedDefer.promise.then(function(){a.logger.info("Stream added for {0}. Key {1}",t.id,e);var s=a.previewItemFactory.getPreviewUI(t,a.$scope,a.localBroadcastState,a.conversation,0,r.BroadcastProducerPreviewRenderArea.tray,!1,!1,a.streamDisabledBehavior,!0);a.$element.append(s.element),a.participantPreviewUIWrappers.push(s),a.layoutManager.onItemAdded(t),a.updateScreensharingStatus()}):this.logger.error("Null item passed for key {0}",e)},e.prototype.onParticipantStreamRemoved=function(e,t){var a=this;t?this.childrenComponentCreatedDefer.promise.then(function(){a.logger.info("Stream removed for {0}. Key {1}",t.id,e);var s=a.participantPreviewUIWrappers.findIndex(function(e){return e.streamItem===t});if(-1!==s){var i=a.participantPreviewUIWrappers[s];a.participantPreviewUIWrappers.splice(s,1),a.logger.info("Removing element for participant {0}",t.id),i.dispose()}else a.logger.info("Could not remove element for participant {0}",t.id);a.updateScreensharingStatus()}):this.logger.error("Null item passed for key {0}",e)},e.prototype.onStreamStateChanged=function(e,t){var a=this;t?teamspace.services.BroadcastUtilities.isComposerBotMri(t.id,this.appConfig.broadcastSettings.composerBotMris)||(this.childrenComponentCreatedDefer.promise.then(function(){t.item&&(a.logger.info("onStreamStateChanged: Stream state changed for {0}. Key {1}",t.id,e),-1!==a.participantPreviewUIWrappers.findIndex(function(e){return e.streamItem===t})?a.layoutManager.onItemStreamStateChanged(t):a.logger.error("'onStreamStateChanged': item {0} not found",t.id)),a.showCoachmarksIfNeeded(t)}),this.showConcurrentVideosLimitIfNeeded()):this.logger.error('"onStreamStateChanged": Null item passed for key {0}',e)},e.prototype.onItemPositionChanged=function(e){this.callingDebugService.log("onItemPositionChanged: "+e.id+" "+e.item.position+" "+e.item.layout.order);var t=this.participantPreviewUIWrappers.findIndex(function(t){return t.streamItem===e});-1!==t?this.$scope.$broadcast(n.ParticipantStreamAddedEventName,{itemWrapper:this.participantPreviewUIWrappers[t]}):this.logger.error("'onItemPositionChanged': item {0} not found",e.id)},e.prototype.updateScreensharingStatus=function(){this.logger.info("updateScreensharingStatus"),this.hasActiveSharingByOtherParticipant=_.some(this.participantPreviewUIWrappers,function(e){return e.streamItem&&e.streamItem.isScreenShare})},e.prototype.showCoachmarksIfNeeded=function(e){if(!this.sendToPreviewCoachmarkShown){var t=this.broadcastService.getLocalBroadcastState(this.call.teamsCallId);if(t)if(t.stagedLayout.isReady)this.logger.info("BroadcastProducerSourcePickerController: Coachmark not shown. Source already staged.");else{var a=this.call&&this.call.broadcastMeeting;if(a&&3===a.modalityState&&a.broadcastState.status!==teamspace.services.BroadcastStatus.Stopped){if(e.isStreamOn&&this.isIPVideoEnabledByPolicy){var s="#contributor-panel",i=this.isVbssEnabledByPolicy?this.$translate.instant(this.resources.strings.coachmark_pick_from_source_picker):this.$translate.instant(this.resources.strings.coachmark_pick_video_from_source_picker);this.coachmarkEngine.showSendToPreview(s,i),this.sendToPreviewCoachmarkShown=!0,this.broadcastChangedSubscription&&(this.broadcastChangedSubscription.dispose(),this.broadcastChangedSubscription=null)}if(this.selectContentToShareCoachmarkNeeded){var s="broadcast-producer-source-picker-buttons #broadcast-producer-source-picker-share",i=this.$translate.instant(this.resources.strings.coachmark_pick_content_from_source_picker);this.coachmarkEngine.showTurnOnMediaInBroadcast(s,i),this.selectContentToShareCoachmarkNeeded=!1}}}else this.logger.info("broadcastLocalState not yet available")}},e.prototype.showConcurrentVideosLimitIfNeeded=function(){var e=this;if(!this.isConcurrentVideosLimitUfdShown){var t=this.call&&this.call.broadcastMeeting;if(t&&3===t.modalityState&&t.broadcastState.status!==teamspace.services.BroadcastStatus.Stopped){var a=0,s=this.participantsManager.getOtherStreams();_.forEach(s,function(t){if(t.isStreamOn&&a++,a>=e.constants.maxBroadcastConcurrentVideosCount)return!1}),a<this.constants.maxBroadcastConcurrentVideosCount||(this.isConcurrentVideosLimitUfdShown=!0,this.callingAlertsService.handleOnDemandAlert({name:"Broadcast_concurrent_videos_limit",type:teamspace.services.AlertType.Warning,title:this.$translate.instant(this.resources.strings.broadcast_concurrent_videos_limit_ufd_title),text:this.$translate.instant(this.resources.strings.broadcast_concurrent_videos_limit_ufd_description),dismissable:!1,teamsCallId:this.call.teamsCallId}))}}},e.prototype.onDestroy=function(){this.participantPreviewUIWrappers&&(_.forEach(this.participantPreviewUIWrappers,function(e){e.dispose()}),this.participantPreviewUIWrappers=null),this.layoutManager&&(this.layoutManager.dispose(),this.layoutManager=null),this.streamDisabledBehavior&&(this.streamDisabledBehavior.dispose(),this.streamDisabledBehavior=null),this.broadcastChangedSubscription&&(this.broadcastChangedSubscription.dispose(),this.broadcastChangedSubscription=null),this.broadcastStreamRenderingAlertsHelper&&(this.broadcastStreamRenderingAlertsHelper.dispose(),this.broadcastStreamRenderingAlertsHelper=null),this.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.SendToPreview),this.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.TurnOnMediaInBroadcast)},e.prototype.onDeviceChanged=function(){var e=this;this.deviceManagerService.getCameraAvailable().then(function(t){e.isCameraAvailable=t,e.isIPVideoEnabledByPolicy&&!e.isCameraAvailable&&e.showNoCameraUFD()})},e.prototype.showNoCameraUFD=function(){var e=null;e={name:"Broadcast_noCamera",title:this.$translate.instant(this.resources.strings.broadcast_producer_no_camera_title),text:this.$translate.instant(this.resources.strings.broadcast_producer_no_camera_text),type:teamspace.services.AlertType.Warning,dismissable:!0,teamsCallId:this.call.teamsCallId,actions:[]},this.callingAlertsService.handleOnDemandAlert(e)},e.prototype.onNewAlertReceived=function(){this.checkForMicrophoneCriticalAlerts();var e=this.producerScreenAlertsProvider.getIPVideoVbssPolicyAlert();e&&e.length&&(this.ipVideoVbssPolicyAlert=e[0])},e.prototype.checkForMicrophoneCriticalAlerts=function(){if(this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCriticalAlertsNewDesign)){var e=this.producerScreenAlertsProvider.getMicrophoneAlerts();e&&e.length?this.microphoneCriticalAlert=e[0]:this.microphoneCriticalAlert=null}},e.prototype.onRendererAlertsReceived=function(){var e=this.broadcastStreamRenderingAlertsHelper.isScreenShareRenderingError||this.broadcastStreamRenderingAlertsHelper.isScreenShareWindowMinimized;this.localBroadcastState.sendAlertNotification(e),this.logger.info("Screenshare renderer error: "+e);var t=this.broadcastStreamRenderingAlertsHelper.getScreenShareWindowMinimizedAlert(),a=this.broadcastStreamRenderingAlertsHelper.getScreenShareRenderingErrorAlert();this.screenSharingAlert=t||a,this.broadcastStreamRenderingAlertsHelper.isScreenShareWindowMinimized||a||this.dismissScreenSharingAlert()},e.prototype.dismissScreenSharingAlert=function(){this.screenSharingAlert&&(this.broadcastStreamRenderingAlertsHelper.dismissScreenSharingAlert(),this.screenSharingAlert=null)},e.prototype.dismissIPVideoVbssAlert=function(){this.ipVideoVbssPolicyAlert&&(this.callingAlertsService.dismiss(this.ipVideoVbssPolicyAlert),this.ipVideoVbssPolicyAlert=null)},e}();t.BroadcastProducerSourcePickerController=p,angular.module("teamspace.broadcastProducerSourcePicker",["teamspace.coachmarksService","teamspace.adminSettingsService","teamspace.shareSystemAudioService"]).component("broadcastProducerSourcePicker",{bindings:{localBroadcastState:"<",participantsManager:"<?",conversation:"<?",onlyStream:"<?",isSharingPanelRequested:"<?"},controller:p,templateUrl:"components/broadcast/producer/broadcast-producer-source-picker/broadcast-producer-source-picker.html"}).run(["$templateCache",function(e){e.put("components/broadcast/producer/broadcast-producer-source-picker/broadcast-producer-source-picker.html",s)}])},2033:function(e,t){e.exports='<div class="bp-source-picker">\n  <div class="my-contributor-with-control-panel" ng-hide="$ctrl.showSharingPanel">\n    <div class="my-contributor-panel-scroll-wrapper">\n      <div class="my-contributor-panel" id="contributor-panel" simple-scrollbar>\n\n        \x3c!-- Critical UFD when ipvideo and vbss policies are disabled --\x3e\n        <calling-ufd-popup ng-if="$ctrl.ipVideoVbssPolicyAlert" alert="$ctrl.ipVideoVbssPolicyAlert" class="ts-ipvideo-ufd-alert" show-arrow="true" close="$ctrl.dismissIPVideoVbssAlert()">\n        </calling-ufd-popup>\n        <div class="critical-ufd-arrow-down" ng-if="$ctrl.ipVideoVbssPolicyAlert">\n        </div>\n\n        <div class="scroll-area">\n          <div id="contributor-sources" class="group-level1" ng-show="$ctrl.shouldShowPaticipantPanel()">\n            <h6 id="contributor-sources-heading" class="group-title" translate-once="{{::$root.resources.strings.broadcast_producer_contributor_sharing_title}}" aria-label="{{::$root.resources.strings.broadcast_producer_contributor_sharing_title|translate}}"></h6>\n            <broadcast-producer-participant-panel list-labelled-by-id="contributor-sources-heading" call="$ctrl.call">\n            </broadcast-producer-participant-panel>\n          </div>\n          <div class="non-contributor-sources-wrapper">\n            <div id="my-sources" class="group-level1 my-camera-source">\n              <h6 class="group-title" translate-once="{{::$root.resources.strings.broadcast_producer_myvideo_sharing_title}}" aria-label="{{::$root.resources.strings.broadcast_producer_myvideo_sharing_title|translate}}"></h6>\n              <broadcast-producer-preview-item local-broadcast-state="$ctrl.localBroadcastState" stream-item="$ctrl.myVideoStream" disabled-behavior="::$ctrl.streamDisabledBehavior" conversation="::$ctrl.conversation" is-focusable="true" take-focus-as="bcast-local-source-item">\n              </broadcast-producer-preview-item>\n              <calling-ufd-popup ng-if="$ctrl.microphoneCriticalAlert" alert="$ctrl.microphoneCriticalAlert" class="ts-ufd-alert" show-arrow="true">\n              </calling-ufd-popup>\n              <div class="down-arrow" ng-if="$ctrl.microphoneCriticalAlert"></div>\n            </div>\n            <div id="active-share" class="group-level1 active-share" ng-show="$ctrl.hasActiveSharingByMeOrOtherParticipant()">\n              <h6 id="active-share-heading" class="group-title" translate-once="{{::$root.resources.strings.broadcast_producer_active_sharing_title}}" aria-label="{{::$root.resources.strings.broadcast_producer_active_sharing_title|translate}}"></h6>\n              <broadcast-producer-participant-panel list-labelled-by-id="active-share-heading" call="$ctrl.call" is-screen-share-panel="true" ng-show="$ctrl.hasActiveSharingByOtherParticipant">\n              </broadcast-producer-participant-panel>\n              <broadcast-producer-preview-item local-broadcast-state="$ctrl.localBroadcastState" stream-item="$ctrl.myScreenShareStream" disabled-behavior="::$ctrl.streamDisabledBehavior" ng-if="$ctrl.call.isScreenSharingOn" is-focusable="true" conversation="::$ctrl.conversation">\n              </broadcast-producer-preview-item>\n              <calling-ufd-popup ng-if="$ctrl.screenSharingAlert" alert="$ctrl.screenSharingAlert" class="ts-ufd-alert" show-arrow="true" close="$ctrl.dismissScreenSharingAlert()">\n              </calling-ufd-popup>\n              <div class="down-arrow" ng-if="$ctrl.screenSharingAlert"></div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <broadcast-producer-source-picker-buttons class="control-area" action-handler="::$ctrl" call="$ctrl.call">\n    </broadcast-producer-source-picker-buttons>\n  </div>\n  <div class="share-screen-window-with-control-panel" ng-if="$ctrl.showSharingPanel" send-focus-to="bcast-screenshare-btn">\n    <calling-screensharing-panel ng-class="{\'active\': $ctrl.showSharingPanel}" actions-handler="::$ctrl" call="::$ctrl.call" filter-sharing-type-mask="::$ctrl.filterSharingMask">\n    </calling-screensharing-panel>\n    <div class="bs-producer-control-area">\n      <button type="button" translate-once="{{::$root.resources.strings.broadcast_producer_back}}" ng-click="$ctrl.hideSharingPanel()" class="ts-btn ts-bcast-secondary-btn inset-border back-button" acc-role="tab-handler-producer-control-panel" send-focus-to="bcast-screenshare-btn" take-focus-from="bcast-screenshare-btn">\n      </button>\n    </div>\n  </div>\n</div>\n'},2034:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2035),i=a(2036),n=a(2037),r=a(41),o=a(290),c=a(292),l=a(293),d=a(129),p=a(130),g=function(){function e(e,t,a,s,i,n,r,o,c,l,d,p,g,u,h,m){var b=this;this.broadcastService=e,this.loggingService=t,this.peopleService=a,this.callingAlertsService=s,this.settingsService=i,this.coachmarkEngine=n,this.coachmarksService=r,this.resources=o,this.constants=c,this.$scope=l,this.$translate=d,this.$q=p,this.objectLeaksDetector=g,this.authenticationService=u,this.adminSettingsService=h,this.appConfig=m,this.canSendLayout=!1,this.isSendLayoutInProgress=!1,this.logger=t.newLogger("BroadcastProducerStageController"),l.$on("$destroy",function(){return b.onDestroy()}),this.title=d.instant(o.strings.broadcast_stage_preview),this.statusMessage="",this.sendingBusyMessage=d.instant(o.strings.broadcast_stage_layout_settingLayout_broadcast),this.gettingReadyBusyMessage=d.instant(o.strings.broadcast_stage_layout_gettingReady_broadcast)}return e.$inject=["broadcastService","loggingService","peopleService","callingAlertsService","settingsService","coachmarkEngine","coachmarksService","resources","constants","$scope","$translate","$q","objectLeaksDetector","authenticationService","adminSettingsService","appConfig"],e.prototype.$onInit=function(){var e=this;if(this.layoutTemplates=this.getSupportedLayoutTemplates(),this.broadcastStatusMessageBuilder=new d.BroadcastStatusMessageBuilder(this.peopleService,this.loggingService,this.resources,this.$translate,this.$q,this.authenticationService),this.singleLayoutLabel=this.$translate.instant(this.resources.strings.broadcast_stage_layout_add_video_content),this.localBroadcastState){if(this.subscribeToActiveSectionSourceChange(),this.localBroadcastState.stagedLayout)for(var t=0,a=this.localBroadcastState.stagedLayout.sections;t<a.length;t++){var s=a[t],i=s.source;if(i){var n=this.participantsManager.getStream(i.participant.mri,"vbss"===i.type,i.participant.isMe);n&&n.isStreamOn||this.localBroadcastState.clearSection(s.id)}}else this.localBroadcastState.stagedLayout=new o.BroadcastLayout(this.layoutTemplates[0]);this.call=this.localBroadcastState.call,this.broadcastMeeting=this.call&&this.call.broadcastMeeting,this.broadcastMeeting&&(this.broadcastMeetingSubscription=this.broadcastMeeting.changed(this.updateControls.bind(this))),this.broadcastStreamRenderingAlertsHelper=new p.BroadcastStreamRenderingAlertsHelper(this.loggingService,this.constants,this.resources,this.$translate,this.$scope,this.callingAlertsService,this.call,this.settingsService),this.participantsManager.safeSubscribe(this.$scope,this.onParticipantStreamRemoved.bind(this),r.ParticipantStreamRemovedEventName),this.participantsManager.safeSubscribe(this.$scope,this.onStreamStateChanged.bind(this),r.StreamStateChanged),this.callingAlertsService.safeSubscribe(this.$scope,this.onNewAlertReceived.bind(this)),this.onNewAlertReceived(),this.localBroadcastState.safeSubscribe(this.$scope,this.onErrorNotificationReceived.bind(this),teamspace.services.localBroadcastStateEvents.notifyAlertStates),this.broadcastStreamRenderingAlertsHelper.safeSubscribe(this.$scope,this.onRendererAlertsReceived.bind(this),this.constants.events.calling.screenShareRenderingAlert),this.updateControlsAndStatusMessage(),this.adminSettingsService.getAdminSettings().then(function(t){e.isIPVideoEnabledByPolicy=t.isVideoEnabled,e.isVbssEnabledByPolicy=t.isScreenSharingEnabled,e.showLayoutButtons=e.isIPVideoEnabledByPolicy&&e.isVbssEnabledByPolicy,e.disableStage=!e.isIPVideoEnabledByPolicy&&!e.isVbssEnabledByPolicy,e.showIPVideoVbssPolicyUfdIfRequired()})}else this.logger.error("Broadcast producer stage initialized without localBroadcastState")},e.prototype.showIPVideoVbssPolicyUfdIfRequired=function(){if(!this.isIPVideoEnabledByPolicy&&this.isVbssEnabledByPolicy){var e={name:"Broadcast_ipvideo_permission",title:this.$translate.instant(this.resources.strings.broadcast_policy_disabled_video_title),text:this.$translate.instant(this.resources.strings.broadcast_policy_disabled_video_vbss_text),type:teamspace.services.AlertType.Warning,dismissable:!0,teamsCallId:this.call.teamsCallId,actions:[]};this.callingAlertsService.handleOnDemandAlert(e),this.singleLayoutLabel=this.$translate.instant(this.resources.strings.broadcast_stage_layout_add_content)}else if(this.isIPVideoEnabledByPolicy&&!this.isVbssEnabledByPolicy){var t={name:"Broadcast_vbss_permission",title:this.$translate.instant(this.resources.strings.broadcast_policy_disabled_vbss_title),text:this.$translate.instant(this.resources.strings.broadcast_policy_disabled_video_vbss_text),type:teamspace.services.AlertType.Warning,dismissable:!0,teamsCallId:this.call.teamsCallId,actions:[]};this.callingAlertsService.handleOnDemandAlert(t),this.singleLayoutLabel=this.$translate.instant(this.resources.strings.broadcast_stage_layout_add_video)}else if(!this.isIPVideoEnabledByPolicy&&!this.isVbssEnabledByPolicy){var a={name:"Broadcast_ipvideo_vbss_permission",title:this.$translate.instant(this.resources.strings.broadcast_policy_disabled_video_vbss_critical_ufd_title),text:this.$translate.instant(this.resources.strings.broadcast_policy_disabled_video_vbss_critical_ufd_message),type:teamspace.services.AlertType.Error,dismissable:!0,teamsCallId:this.call.teamsCallId,position:teamspace.services.Position.Top,windowType:teamspace.services.AlertWindowType.Custom,actions:[]};this.showIPVideoVbssPolicyAlert=!0,this.callingAlertsService.handleOnDemandAlert(a),this.singleLayoutLabel=this.$translate.instant(this.resources.strings.broadcast_stage_layout_error)}},e.prototype.onErrorNotificationReceived=function(e,t){this.isScreenShareErrorAlreadyShown=t},e.prototype.selectSection=function(e){this.localBroadcastState.changeActiveSection(e)},e.prototype.changeStagedLayout=function(e){var t=this.localBroadcastState.stagedLayout;if(!t||e.id!==t.templateId){var a=new o.BroadcastLayout(e);t.sections&&t.sections.forEach(function(t){a.sections.forEach(function(a){t.source&&!a.source&&e.sectionMap.get(a.id).includes(t.source.type)&&(a.source=t.source)})}),this.localBroadcastState.stagedLayout=a}},e.prototype.sendStagedLayout=function(){var e=this;this.sendPreviewButtonClicked=!0,this.sendLayoutCriticalAlert&&this.callingAlertsService.dismiss(this.sendLayoutCriticalAlert),this.isSendLayoutInProgress=!0;var t=this.localBroadcastState.stagedLayout&&this.localBroadcastState.stagedLayout.getComposerLayout();this.broadcastService.pushStagedLayout(this.call,t).then(function(){e.isSendLayoutInProgress=!1;var t=e.localBroadcastState.getTelemetryHandler();null!=t?t.beginStartCommandAvailabilityScenario():e.logger.error("TelemetryHandler is null")}).catch(function(){e.isSendLayoutInProgress=!1})},e.prototype.onNewAlertReceived=function(){this.checkForSetLayoutFailures()},e.prototype.checkForSetLayoutFailures=function(){if(this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCriticalAlertsNewDesign)){var e=this.callingAlertsService.getAlertsOfTypes(["Bmc_setLayout_command_failure"]);e&&e.length?this.sendLayoutCriticalAlert=e[0]:this.sendLayoutCriticalAlert=null}},e.prototype.getTrackData=function(){for(var e={callId:this.call.callId,participantId:this.call.participantId,role:this.broadcastMeeting.role,templateId:this.localBroadcastState.stagedLayout.templateId},t=0;t<this.localBroadcastState.stagedLayout.sections.length;t++){var a=this.localBroadcastState.stagedLayout.sections[t]&&this.localBroadcastState.stagedLayout.sections[t].source;a&&a.participant&&(e["sourceType_"+t]=a.type,e["sourceParticipantId_"+t]=a.participant.mri,e["isLocalSource_"+t]=a.participant.isMe)}return e},e.prototype.subscribeToActiveSectionSourceChange=function(){var e=this;this.statusMessage="",this.localBroadcastState.safeSubscribe(this.$scope,function(){e.updateControlsAndStatusMessage()},teamspace.services.localBroadcastStateEvents.activeSectionSourceChanged),this.localBroadcastState.safeSubscribe(this.$scope,function(){e.updateControlsAndStatusMessage()},teamspace.services.localBroadcastStateEvents.stagedLayoutChanged)},e.prototype.updateControlsAndStatusMessage=function(){this.updateControls(),this.updateStatusMessage()},e.prototype.updateStatusMessage=function(){var e=this,t=new Map;this.statusMessage="";for(var a=0,s=this.localBroadcastState.stagedLayout.sections;a<s.length;a++){var i=s[a],n=i&&i.source;n&&n.participant&&t.set(n.type,n.participant.mri)}this.broadcastStatusMessageBuilder.constructStatusMessage(t,!0).then(function(t){e.statusMessage=t},function(t){e.statusMessage=""})},e.prototype.updateControls=function(){if(this.isRenderingError=this.isScreenSharingInStageArea()&&this.isScreenShareRenderingAlertActive,this.broadcastMeeting.broadcastState){var e=this.broadcastMeeting.broadcastState;if(this.canSendLayout=e&&e.commands&&e.commands.setLayout&&this.localBroadcastState.stagedLayout.isReady&&3===this.broadcastMeeting.modalityState,this.broadcastStatus=e&&e.status,this.showCoachmarksIfNeeded(),this.broadcastStatus===teamspace.services.BroadcastStatus.Stopped){for(var t=0,a=this.localBroadcastState.stagedLayout.sections;t<a.length;t++){var s=a[t];s&&s.source&&this.localBroadcastState.clearSection(s.id)}this.updateStatusMessage()}}},e.prototype.showCoachmarksIfNeeded=function(){var t=this;!this.sendLiveCoachmarkShown&&this.canSendLayout&&_.delay(function(){if(!t.sendPreviewButtonClicked){t.coachmarkEngine.showSendToBroadcast("#send-to-broadcast"),t.sendLiveCoachmarkShown=!0}},e.Coachmark_delay)},Object.defineProperty(e.prototype,"isStagedButNotReadyToSetLayout",{get:function(){var t=this,a=this.broadcastMeeting.broadcastState;if(!a)return!1;var s=this.localBroadcastState.stagedLayout.isReady&&!(a&&a.commands.setLayout)&&a.status===teamspace.services.BroadcastStatus.NotStarted;return this.isWaitingScenarioCompleted?s:(!this.gettingReadyScenario&&this.localBroadcastState.stagedLayout.isReady&&(this.gettingReadyScenario=this.loggingService.newScenario(this.constants.scenarios.broadcast.waitingForSetLayout,null,function(e){e===t.constants.scenarioStepStatus.timeout&&(t.isWaitingScenarioCompleted=!0,t.gettingReadyScenario=null)},e.Wait_SetLayout_Timeout),this.gettingReadyScenario.cancelIfOffline=!0,this.gettingReadyScenario.eventData=this.getEventData()),this.gettingReadyScenario&&(s?s&&!teamspace.services.BroadcastUtilities.isAnyParticipantStreamAvailable(this.call,this.appConfig)&&(this.gettingReadyScenario.cancel(this.getEventData()),this.gettingReadyScenario=null):(this.gettingReadyScenario.stop(),this.gettingReadyScenario=null,this.isWaitingScenarioCompleted=!0)),s)},enumerable:!0,configurable:!0}),e.prototype.dismissScreenSharingAlert=function(){this.screenShareRenderingErrorAlert&&(this.broadcastStreamRenderingAlertsHelper.dismissScreenSharingAlert(),this.screenShareRenderingErrorAlert=null)},e.prototype.getEventData=function(){var e=this.localBroadcastState.getTelemetryHandler();return e?e.getEventData():null},e.prototype.onDestroy=function(){this.broadcastMeetingSubscription&&(this.broadcastMeetingSubscription.dispose(),this.broadcastMeetingSubscription=null),this.gettingReadyScenario&&(this.gettingReadyScenario.cancel(),this.gettingReadyScenario=null),this.broadcastStreamRenderingAlertsHelper&&(this.broadcastStreamRenderingAlertsHelper.dispose(),this.broadcastStreamRenderingAlertsHelper=null),this.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.SendToBroadcast),this.objectLeaksDetector.track("broadcast-producer-stage",this)},e.prototype.onParticipantStreamRemoved=function(e,t){if(t){var a=t.item&&t.item.participant&&t.item.participant.id;this.logger.info("Stream with key ["+e+"] removed for participant ["+a+"]"),this.clearSectionSourcesForStream(t)}else this.logger.error("onParticipantStreamRemoved with key ["+e+"] raised without a stream item")},e.prototype.onStreamStateChanged=function(e,t){t?t.isStreamOn||this.clearSectionSourcesForStream(t):this.logger.error("onStreamStateChanged with key ["+e+"] raised without a stream item")},e.prototype.clearSectionSourcesForStream=function(e){for(var t=0,a=this.localBroadcastState.stagedLayout.sections;t<a.length;t++){var s=a[t];s.source&&s.source.equals(e.toLayoutSource())&&(this.localBroadcastState.clearSection(s.id),this.clearRendererAlerts(),this.updateControlsAndStatusMessage())}},e.prototype.getSupportedLayoutTemplates=function(){return[new c.SingleLayoutBroadcastLayoutTemplate(this.resources,this.$translate),new l.TwoLargeLeftBroadcastLayoutTemplate(this.resources,this.$translate)]},e.prototype.onRendererAlertsReceived=function(){this.screenShareRenderingErrorAlert=this.broadcastStreamRenderingAlertsHelper.getScreenShareRenderingErrorAlert(),this.isScreenShareRenderingAlertActive=this.broadcastStreamRenderingAlertsHelper.isScreenShareRenderingError||this.broadcastStreamRenderingAlertsHelper.isScreenShareWindowMinimized,this.logger.info("Screenshare renderer error: "+this.isScreenShareRenderingAlertActive),this.updateControls()},e.prototype.isScreenSharingInStageArea=function(){for(var e=0,t=this.localBroadcastState.stagedLayout.sections;e<t.length;e++){var a=t[e],s=a&&a.source;if(s&&s.type&&"vbss"===s.type)return!0}return!1},e.prototype.clearRendererAlerts=function(){this.isScreenShareRenderingAlertActive&&(this.isScreenShareRenderingAlertActive=!1,this.dismissScreenSharingAlert())},e.Coachmark_delay=3e3,e.Wait_SetLayout_Timeout=6e4,e}();t.BroadcastProducerStageController=g,angular.module("teamspace.broadcastProducerStage",["teamspace.broadcastService","teamspace.loggingService","teamspace.callTogglingService","teamspace.peopleService","teamspace.coachmarksService","teamspace.authenticationService","teamspace.adminSettingsService","teamspace.appStateAdapter"]).component("broadcastProducerStage",{bindings:{localBroadcastState:"<",participantsManager:"<"},controllerAs:"ctrl",controller:g,template:s}).run(["$templateCache",function(e){e.put("components/broadcast/producer/layout/templates/single-layout.html",i),e.put("components/broadcast/producer/layout/templates/two-large-left-layout.html",n)}])},2035:function(e,t){e.exports='<div class="ts-bcast-producer-stage-row-container ts-bcast-producer-stage-header-container">\n    <span class="title">{{::ctrl.title}}</span>\n    <span class="status-message single-line-truncation" title="{{ctrl.statusMessage}}">{{ctrl.statusMessage}}</span>\n</div>\n<div class="ts-bcast-producer-stage-preview-outer-container" ng-class="{\'pre-live\': ctrl.canSendLayout}">\n  <div class="ts-bcast-producer-stage-preview-inner-container">\n       <div class="ts-bcast-producer-stage-preview-content ts-bcast-producer-stage-queue" ng-include="ctrl.localBroadcastState.stagedLayout.template.templateUrl" acc-role="listgrid-horizontal" custom-listgrid-item-attribute="data-stage-section" set-focus="true" set-focus-in="100">\n       </div>\n  </div>\n  <broadcast-busy-overlay text="{{ctrl.isSendLayoutInProgress ? ctrl.sendingBusyMessage : ctrl.gettingReadyBusyMessage}}" ng-if="ctrl.isSendLayoutInProgress || ctrl.isStagedButNotReadyToSetLayout" send-focus-to="bcast-send-btn" take-focus-from="bcast-send-btn">\n  </broadcast-busy-overlay>\n</div>\n<div class="ts-bcast-producer-stage-row-container ts-bcast-producer-stage-control-buttons">\n  <div class="ts-bcast-producer-stage-controls-container" acc-role="listgrid-horizontal" ng-class="{\'disabled\': (ctrl.broadcastStatus === \'stopped\') || (ctrl.broadcastStatus === \'stopping\')}" ng-if="ctrl.showLayoutButtons">\n    <button class="ts-bcast-layout-btn app-icons-fill-hover app-icons-fill-focus inset-border icon-bcast-layout" acc-role="listgrid-item" title="{{template.displayName}}" ng-class="{\'selected\': template.id === ctrl.localBroadcastState.stagedLayout.templateId && ctrl.broadcastStatus !== \'stopped\'}" ng-click="ctrl.changeStagedLayout(template)" ng-repeat="template in ctrl.layoutTemplates track by template.id" ng-disabled="(ctrl.broadcastStatus === \'stopped\') || (ctrl.broadcastStatus === \'stopping\')" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.selectTemplateControls}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.templateControls}}" track-type="{{::$root.trackConstants.trackType.listItem}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\', templateId: \'{{template.id}}\'}" track-summary="Set stage layout template" data-tid="bcast-layout-btns">\n      <ng-include src="template.iconUrl"></ng-include>\n    </button>\n  </div>\n  <div class="ts-ufd-alert-wrapper">\n    <button class="ts-btn ts-bcast-primary-btn ts-bcast-prelive-btn inset-border" take-focus-as="bcast-send-btn" id="send-to-broadcast" ng-click="ctrl.sendStagedLayout()" ng-if="ctrl.isIPVideoEnabledByPolicy || ctrl.isVbssEnabledByPolicy" ng-disabled="!ctrl.canSendLayout || ctrl.isSendLayoutInProgress || ctrl.isRenderingError" translate-once="{{::$root.resources.strings.broadcast_stage_layout_setLayout_broadcast}}" track-outcome="{{::$root.trackConstants.trackOutcome.submit}}" track-scenario="{{::$root.trackConstants.trackScenario.setLayout}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.setLayoutButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{{ctrl.getTrackData()}}" track-summary="Set layout">\n    </button>\n    <calling-ufd-popup ng-if="ctrl.sendLayoutCriticalAlert" alert="ctrl.sendLayoutCriticalAlert" class="ts-ufd-alert" show-arrow="true">\n    </calling-ufd-popup>\n    <calling-ufd-popup ng-if="ctrl.screenShareRenderingErrorAlert && !ctrl.isScreenShareErrorAlreadyShown" alert="ctrl.screenShareRenderingErrorAlert" class="ts-ufd-alert" show-arrow="true" close="ctrl.dismissScreenSharingAlert()">\n    </calling-ufd-popup>\n  </div>\n</div>\n'},2036:function(e,t){e.exports='<div class="ts-bcast-producer-stage-layout single" id="bcastPreviewStageSingleLayout" ng-click="ctrl.selectSection(\'single\')" ng-class="{\'selected-section\': ctrl.localBroadcastState.stagedLayout.activeSection.id === \'single\' && !ctrl.disableStage}" acc-role="listgrid-item" aria-label="{{::$root.resources.strings.broadcast_stage_layout_add_video_content|translate}}" data-stage-section track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.selectSingleLayout}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.singleLayout}}" track-type="{{::$root.trackConstants.trackType.viewer}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\', templateId: \'single\'}" track-summary="Set active section in stage layout">\n  <producer-stage-section section-id="\'single\'" class="flex-fill" ng-class="{\'producer-stage-section-disabled\' : ctrl.disableStage}" local-broadcast-state="::ctrl.localBroadcastState" participants-manager="::ctrl.participantsManager" broadcast-status="ctrl.broadcastStatus" instruction="::ctrl.singleLayoutLabel" broadcast-stream-rendering-alerts-helper="ctrl.broadcastStreamRenderingAlertsHelper">\n  </producer-stage-section>\n</div>'},2037:function(e,t){e.exports='<div class="ts-bcast-producer-stage-layout large" id="bcastPreviewStageLeftLayout" ng-click="ctrl.selectSection(\'large-left\')" ng-class="{\'selected-section\': ctrl.localBroadcastState.stagedLayout.activeSection.id === \'large-left\'}" acc-role="listgrid-item" aria-label="{{::$root.resources.strings.broadcast_stage_layout_add_content|translate}}" data-stage-section track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.selectTwoLargeLeftLayout}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.twoLargeLeftLayout}}" track-type="{{::$root.trackConstants.trackType.viewer}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\', templateId: \'large-left\'}" track-summary="Set active section in stage layout">\n  <producer-stage-section section-id="\'large-left\'" class="flex-fill" local-broadcast-state="::ctrl.localBroadcastState" participants-manager="::ctrl.participantsManager" broadcast-status="ctrl.broadcastStatus" instruction="::$root.resources.strings.broadcast_stage_layout_add_content|translate" broadcast-stream-rendering-alerts-helper="ctrl.broadcastStreamRenderingAlertsHelper">\n  </producer-stage-section>\n</div>\n<div class="ts-bcast-producer-stage-layout small" ng-click="ctrl.selectSection(\'small-right\')" ng-class="{\'selected-section\': ctrl.localBroadcastState.stagedLayout.activeSection.id === \'small-right\'}" acc-role="listgrid-item" aria-label="{{::$root.resources.strings.broadcast_stage_layout_add_video|translate}}" data-stage-section track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.selectTwoLargeLeftLayout}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.twoLargeLeftLayout}}" track-type="{{::$root.trackConstants.trackType.viewer}}" track-data="{callId: \'{{ctrl.call.callId}}\', participantId: \'{{ctrl.call.participantId}}\', templateId: \'small-right\'}" track-summary="Set active section in stage layout">\n  <producer-stage-section section-id="\'small-right\'" class="flex-fill" local-broadcast-state="::ctrl.localBroadcastState" participants-manager="::ctrl.participantsManager" broadcast-status="ctrl.broadcastStatus" instruction="::$root.resources.strings.broadcast_stage_layout_add_video|translate" broadcast-stream-rendering-alerts-helper="ctrl.broadcastStreamRenderingAlertsHelper">\n  </producer-stage-section>\n</div>'},2038:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2039),i=a(131),n=a(84),r=function(){function e(e,t,a,s,n,r,o,c){this.$scope=e,this.$element=a,this.objectLeaksDetector=s,this.$translate=r,this.resources=o,this.constants=c,this.logger=n.newLogger("ProducerStageSectionController"),this.previewItemFactory=new i.BroadcastProducerPreviewItemFactory(t)}return e.$inject=["$scope","$compile","$element","objectLeaksDetector","loggingService","$translate","resources","constants"],e.prototype.$onInit=function(){var e=this;this.initialInstruction=this.instruction,this.previewContainer=this.$element.find(".section-preview-container");var t=this.localBroadcastState.stagedLayout.getSection(this.sectionId);t?(this.renderItemPreview(t.source),this.localBroadcastState.safeSubscribe(this.$scope,function(){var a=e.localBroadcastState.stagedLayout.activeSection;a&&e.sectionId==a.id?e.renderItemPreview(t.source):e.logger.info("This section {0} is not the active section {1}",e.sectionId,a&&a.id)},teamspace.services.localBroadcastStateEvents.activeSectionSourceChanged),this.localBroadcastState.safeSubscribe(this.$scope,function(){var t=e.localBroadcastState.stagedLayout.getSection(e.sectionId);!e.currentRenderedPreviewItem||t&&t.source||(e.currentRenderedPreviewItem.dispose(),e.currentRenderedPreviewItem=null,e.cachedRenderedSource=null,e.clearRendererAlerts())},teamspace.services.localBroadcastStateEvents.sectionCleared),this.$scope.$on("$destroy",function(){e.currentRenderedPreviewItem&&(e.currentRenderedPreviewItem.dispose(),e.currentRenderedPreviewItem=null),e.objectLeaksDetector.track("broadcast-producer-section",e,{enableAlerting:!0})})):this.logger.error("Section not found for sectionId {0} in layoutId {1}",this.sectionId,this.localBroadcastState.stagedLayout.templateId)},e.prototype.renderItemPreview=function(e){if(this.currentRenderedPreviewItem){if(this.cachedRenderedSource&&this.cachedRenderedSource.participant.isMe===e.participant.isMe&&this.cachedRenderedSource.participant.mri===e.participant.mri&&this.cachedRenderedSource.type===e.type)return void this.logger.info("New "+JSON.stringify(e.participant)+" and old source "+JSON.stringify(this.cachedRenderedSource.participant)+" are same. So exiting");this.currentRenderedPreviewItem.dispose(),this.currentRenderedPreviewItem=null}this.isScreenShareRenderingAlertActive=!1,this.logger.info("Got new item "+JSON.stringify(e&&e.participant)+" to render in section "+this.sectionId);var t=this.getParticipantStream(e);if(!t)return this.logger.warn("Didn't find any participant stream for the newSource"),this.cachedRenderedSource=null,void this.localBroadcastState.clearSection(this.sectionId);this.currentRenderedPreviewItem=this.previewItemFactory.getPreviewUI(t,this.$scope,this.localBroadcastState,null,1,n.BroadcastProducerPreviewRenderArea.stage,!0,!0,null,!1),this.previewContainer.append(this.currentRenderedPreviewItem.element),this.cachedRenderedSource=e,t.isScreenShare&&this.broadcastStreamRenderingAlertsHelper.safeSubscribe(this.$scope,this.onRendererAlertsReceived.bind(this),this.constants.events.calling.screenShareRenderingAlert)},e.prototype.onRendererAlertsReceived=function(){this.isScreenShareRenderingAlertActive=this.broadcastStreamRenderingAlertsHelper.isScreenShareRenderingError,this.logger.info("Screenshare renderer error: "+this.isScreenShareRenderingAlertActive),this.instruction=this.isScreenShareRenderingAlertActive?this.$translate.instant(this.resources.strings.error_message_video_rendering_failure_title):this.initialInstruction},e.prototype.clearRendererAlerts=function(){this.isScreenShareRenderingAlertActive&&(this.isScreenShareRenderingAlertActive=!1,this.instruction=this.initialInstruction)},e.prototype.getParticipantStream=function(e){if(!e||!e.participant)return null;var t=this.participantsManager.getStream(e.participant.mri,"vbss"===e.type,e.participant.isMe);return t||(this.logger.error("No particpant stream found with mri {0} in the stream",e.participant.mri),null)},e}();t.ProducerStageSectionController=r,angular.module("teamspace.producerStageSection",["teamspace.loggingService","teamspace.callTogglingService"]).component("producerStageSection",{bindings:{sectionId:"<",localBroadcastState:"<",participantsManager:"<",broadcastStatus:"<",instruction:"<",broadcastStreamRenderingAlertsHelper:"<"},controllerAs:"ctrl",controller:r,templateUrl:"components/broadcast/producer/broadcast-producer-stage/producer-stage-section.html"}).run(["$templateCache",function(e){e.put("components/broadcast/producer/broadcast-producer-stage/producer-stage-section.html",s)}])},2039:function(e,t){e.exports='<div class="producer-stage-section flex-fill {{ctrl.broadcastStatus}}">\n  <span ng-if="(!ctrl.cachedRenderedSource && ctrl.broadcastStatus !== \'stopped\') || ctrl.isScreenShareRenderingAlertActive" class="flex-center-fill producer-stage-section-instruction">{{ctrl.instruction}}</span>\n  <div class="flex-center-fill section-preview-container" ng-show="ctrl.cachedRenderedSource && !ctrl.isScreenShareRenderingAlertActive">\n  </div>\n</div>\n'},2040:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2041),i=a(2042),n=function(){function e(e,t,a,s,i){var n;this.$scope=e,this.analyticsService=a,this.tooltipService=s,this.constants=i,this.tooltipId=t.generateUUID(),this.isChecked=this.dialog.meetingDetails&&!(null===(n=this.dialog.meetingDetails.disableLobby)||void 0===n||n)}return e.$inject=["$scope","utilityService","analyticsService","tooltipService","constants"],e.prototype.onExternalPresentersInfoLinkKeyDown=function(e){e.keyCode===this.constants.keyCodes.enter&&(this.showExternalPresentersTooltip(e,!0),e.stopPropagation(),e.preventDefault())},e.prototype.showExternalPresentersTooltip=function(e,t){var a={template:i,trigger:"manual",container:"body",placement:"bottom",autoClose:!0,scope:this.$scope},s={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:a,tooltipId:this.tooltipId};t?this.tooltipService.showTooltip(s):this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.tooltipId)},e.prototype.onToggleAllowExternalPresenters=function(e){this.isChecked=e,this.dialog.meetingDetails.disableLobby=!this.isChecked,this.logTelemetryForLobbyToggle(e)},e.prototype.stopEscape=function(e){e.keyCode===this.constants.keyCodes.escape&&(this.showExternalPresentersTooltip(e,!1),e.stopPropagation())},e.prototype.logTelemetryForLobbyToggle=function(e){var t=e?teamspace.components.PanelActionOutcome.enable:teamspace.components.PanelActionOutcome.disable,a={action:{gesture:teamspace.components.PanelActionGesture.click,outcome:t,scenario:teamspace.components.PanelActionScenario.broadcastAllowExternalPresenters},module:{type:teamspace.components.PanelModuleType.toggle,name:teamspace.components.PanelModuleName[teamspace.components.PanelModuleName.broadcastSchedulingForm],summary:"Enable lobby for live event"},dataBag:{enableLobby:e}};this.analyticsService.onPanelAction(this.$scope,a)},e}();t.AllowExternalPresentersController=n,angular.module("teamspace.allowExternalPresenters",[]).directive("allowExternalPresenters",[function(){return{restrict:"E",scope:{},bindToController:{dialog:"="},template:s,controller:n,controllerAs:"baepc"}}])},2041:function(e,t){e.exports='<div class="allow-external-presenters-toggle">\n  <toggle-switch is-checked="baepc.isChecked" on-toggle="baepc.onToggleAllowExternalPresenters(isChecked)" ds-aria-label="{{::$root.resources.strings.broadcast_allow_external_presenters_switch_text|translate}}"></toggle-switch>\n  <span class="toggle-switch-label" translate-once="{{::$root.resources.strings.broadcast_allow_external_presenters_switch_text}}"></span>\n  <button class="ts-sym external-presenters-info-link app-icons-fill-focus inset-border inset-border-themed inset-border-round" acc-tabbable="true" aria-label="{{::$root.resources.strings.broadcast_allow_external_presenters_info_tooltip|translate}}" ng-keydown="baepc.onExternalPresentersInfoLinkKeyDown($event)" ng-mouseenter="baepc.showExternalPresentersTooltip($event, true)" ng-mouseleave="baepc.showExternalPresentersTooltip($event, false)">\n    <ng-include src="\'svg/icons-info.html\'"></ng-include>\n  </button>\n</div>'},2042:function(e,t){e.exports='<div class="tooltip-container external-presenters-info-popover" acc-role="dialog" ng-keydown="baepc.stopEscape($event)">\n  <div class="content-container">\n    <div class="tooltip-arrow-up"></div>\n    <span class="tooltip-content inset-border shadow-level-2" acc-role="focus-default">\n      <div translate-once="{{::$root.resources.strings.broadcast_allow_external_presenters_info_tooltip}}"></div>\n    </span>\n  </div>\n</div>'},2043:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2044);t.userTypeGroup="Group";var i=function(){function e(e,t,a,s,i,n,r,o,c,l,d){var p=this;this.$scope=e,this.$translate=t,this.resources=a,this.constants=s,this.broadcastMeetingPolicyStore=n,this.settingsService=r,this.appConfig=o,this.eventingService=c,this.broadcastMeetingService=l,this.ariaLiveService=d,this.shouldDisablePublicAccessLevel=!1,this.isPermissionDisabledByPolicy=!1,this.logger=i.newLogger("BroadcastAttendeePermissions"),this.checkBroadcastPolicyForAttendeePermissions(),this.onAttendeeAdd=function(e){return p.onAttendeeAddCallback(e)}}return e.$inject=["$scope","$translate","resources","constants","loggingService","broadcastMeetingPolicyStore","settingsService","appConfig","eventingService","broadcastMeetingService","ariaLiveService"],e.prototype.$onInit=function(){var e=this;this.isGuestEnabledForBroadcast=this.settingsService.valueAsBoolean(this.constants.settings.names.enableGuestForBroadcast)&&!this.broadcastSettings.isStreamEnabled,this.enableOrDisableExternalUserAccess(),this.attendeeAdded={};for(var t=0,a=this.broadcastSettings.closedMeetingAttendees;t<a.length;t++){var s=a[t];s&&s.address&&(this.attendeeAdded[s.address]=!0)}this.$scope.$watchGroup(["bap.attendeePermissionsInfo[2].isEnabled","bap.broadcastSettings.isStreamEnabled"],function(t){var a=t[0],s=t[1];e.shouldDisablePublicAccessLevel=!a||s,e.isGuestEnabledForBroadcast=e.settingsService.valueAsBoolean(e.constants.settings.names.enableGuestForBroadcast)&&!s,e.enableOrDisableExternalUserAccess()}),this.eventingService.$on(this.$scope,this.constants.events.messages.setFocus,function(){e.broadcastSettings.isYammerEnabled||setTimeout(function(){for(var t=document.getElementsByClassName("broadcast-attendee-permissions-input-wrapper"),a=0;a<t.length;a++)t[a].setAttribute("tabIndex","-1");var s=document.getElementById("broadcast-attendee-permission-option-"+e.selectedAttendeePermissionsId);s&&(s.setAttribute("tabIndex","0"),s.focus())})})},e.prototype.selectAttendeePermissions=function(e){if(this.selectedAttendeePermissionsId=e,this.broadcastSettings.broadcastMeetingAccessLevel=teamspace.middletier.BroadcastMeetingAccessLevel[this.attendeePermissionsInfo[e].level],this.ariaLiveService.update(this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_selected,{permissionOption:this.attendeePermissionsInfo[e].header}),!0),0===this.selectedAttendeePermissionsId){var t=angular.element(".broadcast-attendee-permissions .ts-search-input");if(_.isUndefined(t))return;_.defer(function(){return t.focus()})}},e.prototype.onAttendeeAddCallback=function(e){if(null!=e){var a=e.email||e.userPrincipalName;if(!this.attendeeAdded[a]){var s={};s.name=e.displayName,s.address=a,s.broadcastMeetingRole=teamspace.middletier.BroadcastRole[teamspace.middletier.BroadcastRole.Attendee],s.isGroup=e.type&&e.type===t.userTypeGroup,e.accountEnabled&&(s.role=e.userType===this.constants.userTypes.guest?this.constants.RoleConstants.Guest:this.constants.RoleConstants.Admin),s.isGroup?(s.objectId=e.objectId,s.groupType=e.securityEnabled?teamspace.middletier.AttendeeGroupType.SecurityGroup:teamspace.middletier.AttendeeGroupType.StreamGroup):s.mri=e.mri;var i=new teamspace.services.MeetingAttendeeDetailViewModel(s,this.constants);i.isNewAttendee=!0,this.broadcastSettings.closedMeetingAttendees.push(i),this.attendeeAdded[s.address]=!0}}else this.logger.error("selected contact is invalid")},e.prototype.onAttendeeRemove=function(e){if(null!=e){var t=this.broadcastSettings.closedMeetingAttendees.indexOf(e);-1!==t&&this.broadcastSettings.closedMeetingAttendees.splice(t,1),this.attendeeAdded[e.address]=!1}else this.logger.error("removed contact is invalid")},e.prototype.peoplePickerFilter=function(e){return _.filter(e,function(e){var t=e.originalObject;return!!t&&("Group"!==t.type||t.isUnified||t.securityEnabled)&&!SkypeX.Services.ChatServiceUtils.isAnonymousUserMri(t.mri)})},e.prototype.checkBroadcastPolicyForAttendeePermissions=function(){var e=this;this.getBroadcastMeetingVisibilityModePolicy().then(function(t){e.initializeAttendeePermissions(e.attendeeVisibilityMode),e.isPermissionDisabledByPolicy=!(!e.isQuickStartEnabledInRegion||e.attendeeVisibilityMode===teamspace.components.BroadcastAttendeeVisibilityMode.Everyone)})},e.prototype.initializeAttendeePermissions=function(e){this.attendeePermissionsInfo=[{level:teamspace.middletier.BroadcastMeetingAccessLevel.InvitationOnly,header:this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_specific_people_text),details:this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_specific_people_details_text),peoplePickerRequired:!0,svgPath:"svg/icons-people.html",svgPathSelected:"svg/icons-people.html",isEnabled:!this.readOnlyMode},{level:teamspace.middletier.BroadcastMeetingAccessLevel.AllCompany,header:this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_company_text),details:this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_company_details_text),peoplePickerRequired:!1,svgPath:"svg/icons-building.html",svgPathSelected:"svg/icons-building.html",isEnabled:!this.readOnlyMode&&e!==teamspace.components.BroadcastAttendeeVisibilityMode.InvitedUsersInCompany&&e!==teamspace.components.BroadcastAttendeeVisibilityMode.InvitedUsersInCompanyAndExternal},{level:teamspace.middletier.BroadcastMeetingAccessLevel.Anonymous,header:this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_public_text),details:this.$translate.instant(this.resources.strings.broadcast_attendee_permissions_public_details_text),peoplePickerRequired:!1,svgPath:"svg/icons-globe.html",svgPathSelected:"svg/icons-globe.html",isEnabled:!this.readOnlyMode&&e===teamspace.components.BroadcastAttendeeVisibilityMode.Everyone}];var t=teamspace.middletier.BroadcastMeetingAccessLevel[this.broadcastSettings.broadcastMeetingAccessLevel];void 0===t&&(this.logger.error("invalid broadcast meeting access level "+this.broadcastSettings.broadcastMeetingAccessLevel),t=teamspace.middletier.BroadcastMeetingAccessLevel.AllCompany),t=this.validateAndGetAllowedAccessLevelForPolicy(e,t),this.broadcastSettings.broadcastMeetingAccessLevel=teamspace.middletier.BroadcastMeetingAccessLevel[t],this.selectedAttendeePermissionsId=this.attendeePermissionsInfo.findIndex(function(e){return e.level===t})},e.prototype.validateAndGetAllowedAccessLevelForPolicy=function(e,t){if(void 0===t)return t;for(var a=[teamspace.middletier.BroadcastMeetingAccessLevel.InvitationOnly,teamspace.middletier.BroadcastMeetingAccessLevel.AllCompany,teamspace.middletier.BroadcastMeetingAccessLevel.Anonymous],s=a.indexOf(t);s>=0;s--)if(this.broadcastMeetingService.isValidMeetingAccessLevel(e,a[s]))return a[s];return teamspace.middletier.BroadcastMeetingAccessLevel.InvitationOnly},e.prototype.getBroadcastMeetingVisibilityModePolicy=function(){var e=this;return void 0!==this.attendeeVisibilityMode?Promise.resolve(this.attendeeVisibilityMode):this.broadcastMeetingPolicyStore.waitForSettingAndGetValue(SkypeX.Services.BroadcastMeetingPolicyStorageKey.broadcastAttendeeVisibilityMode).then(function(t){return e.attendeeVisibilityMode=t,e.attendeeVisibilityMode}).catch(function(t){return e.logger.error("broadcastMeetingPolicyStore.waitForSettingAndGetValue errored out for keys: "+SkypeX.Services.BroadcastMeetingPolicyStorageKey.broadcastAttendeeVisibilityMode+" error: "+t),e.attendeeVisibilityMode=e.appConfig.broadcastPolicyDefaults.broadcastAttendeeVisibilityMode,e.attendeeVisibilityMode})},e.prototype.enableOrDisableExternalUserAccess=function(){var e=this;this.getBroadcastMeetingVisibilityModePolicy().then(function(t){e.isFederationEnabledForBroadcast=e.settingsService.valueAsBoolean(e.constants.settings.names.enableFederationForBroadcast)&&!e.broadcastSettings.isStreamEnabled;var a=e.settingsService.valueAsBoolean(e.constants.settings.names.enableExternalUserPolicyCheckForBroadcastAttendee);e.isFederationEnabledForBroadcast&&a&&(e.isFederationEnabledForBroadcast=t!==teamspace.components.BroadcastAttendeeVisibilityMode.EveryoneInCompany&&t!==teamspace.components.BroadcastAttendeeVisibilityMode.InvitedUsersInCompany)})},e}();t.BroadcastAttendeePermissionsController=i,angular.module("teamspace.broadcastAttendeePermissions",["skypeX.broadcastMeetingPolicyStore"]).directive("broadcastAttendeePermissions",[function(){return{restrict:"E",scope:{},bindToController:{broadcastSettings:"=",readOnlyMode:"=",isQuickStartEnabledInRegion:"="},template:s,controller:i,controllerAs:"bap"}}])},2044:function(e,t){e.exports='<div class="broadcast-attendee-permissions">\n\n  <div class="broadcast-attendee-permissions-access-selector" acc-role="list" aria-labelledby="broadcast-attendee-permissions-section-header">\n    \x3c!-- This should be done with ng-repeat, however, it breaks accessibility --\x3e\n    <div class="broadcast-attendee-permissions-input-wrapper" id="broadcast-attendee-permission-option-0" ng-class="{\'selected\': bap.selectedAttendeePermissionsId === 0, \'disabled\': !bap.attendeePermissionsInfo[0].isEnabled}" ng-disabled="{{::!bap.attendeePermissionsInfo[0].isEnabled}}" ng-click="bap.selectAttendeePermissions(0)" acc-role="list-item" aria-checked="{{bap.selectedAttendeePermissionsId === 0}}" role="radio">\n      <div class="broadcast-attendee-permissions-input-icon" ng-class="{\'selected\': bap.selectedAttendeePermissionsId === 0}">\n        <ng-include src="bap.attendeePermissionsInfo[0].svgPath" ng-if="bap.selectedAttendeePermissionsId !== 0" aria-hidden="true" ng-class="{\'disabled\': !bap.attendeePermissionsInfo[0].isEnabled, \'enabled\': bap.attendeePermissionsInfo[0].isEnabled}"></ng-include>\n        <ng-include src="bap.attendeePermissionsInfo[0].svgPathSelected" ng-if="bap.selectedAttendeePermissionsId === 0" aria-hidden="true" ng-class="{\'disabled\': !bap.attendeePermissionsInfo[0].isEnabled, \'enabled\': bap.attendeePermissionsInfo[0].isEnabled}"></ng-include>\n      </div>\n      <div class="broadcast-attendee-permissions-input-details">\n        <div class="broadcast-attendee-permissions-header">{{bap.attendeePermissionsInfo[0].header}}</div>\n        <div class="broadcast-attendee-permissions-content">{{bap.attendeePermissionsInfo[0].details}}</div>\n      </div>\n    </div>\n    <div class="broadcast-attendee-permissions-input-wrapper" id="broadcast-attendee-permission-option-1" ng-class="{\'selected\': bap.selectedAttendeePermissionsId === 1, \'disabled\': !bap.attendeePermissionsInfo[1].isEnabled}" ng-disabled="{{::!bap.attendeePermissionsInfo[1].isEnabled}}" ng-click="bap.selectAttendeePermissions(1)" acc-role="list-item" aria-checked="{{bap.selectedAttendeePermissionsId === 1}}" role="radio">\n      <div class="broadcast-attendee-permissions-input-icon org-wide" ng-class="{\'selected\': bap.selectedAttendeePermissionsId === 1}">\n        <ng-include src="bap.attendeePermissionsInfo[1].svgPath" ng-if="bap.selectedAttendeePermissionsId !== 1" aria-hidden="true" ng-class="{\'disabled\': !bap.attendeePermissionsInfo[1].isEnabled, \'enabled\': bap.attendeePermissionsInfo[1].isEnabled}"></ng-include>\n        <ng-include src="bap.attendeePermissionsInfo[1].svgPathSelected" ng-if="bap.selectedAttendeePermissionsId === 1" aria-hidden="true" ng-class="{\'disabled\': !bap.attendeePermissionsInfo[1].isEnabled, \'enabled\': bap.attendeePermissionsInfo[1].isEnabled}"></ng-include>\n      </div>\n      <div class="broadcast-attendee-permissions-input-details">\n        <div class="broadcast-attendee-permissions-header">{{bap.attendeePermissionsInfo[1].header}}</div>\n        <div class="broadcast-attendee-permissions-content">{{bap.attendeePermissionsInfo[1].details}}</div>\n      </div>\n    </div>\n    <div class="broadcast-attendee-permissions-input-wrapper" id="broadcast-attendee-permission-option-2" ng-if="::bap.isQuickStartEnabledInRegion" ng-class="{\'selected\': bap.selectedAttendeePermissionsId === 2, \'disabled\': bap.shouldDisablePublicAccessLevel}" ng-disabled="bap.shouldDisablePublicAccessLevel" ng-click="bap.selectAttendeePermissions(2)" acc-role="list-item" aria-checked="{{bap.selectedAttendeePermissionsId === 2}}" role="radio">\n      <div class="broadcast-attendee-permissions-input-icon" ng-class="{\'selected\': bap.selectedAttendeePermissionsId === 2}">\n        <ng-include src="bap.attendeePermissionsInfo[2].svgPath" ng-if="bap.selectedAttendeePermissionsId !== 2" aria-hidden="true" ng-class="{\'disabled\': bap.shouldDisablePublicAccessLevel, \'enabled\': !bap.shouldDisablePublicAccessLevel}"></ng-include>\n        <ng-include src="bap.attendeePermissionsInfo[2].svgPathSelected" ng-if="bap.selectedAttendeePermissionsId === 2" aria-hidden="true" ng-class="{\'disabled\': bap.shouldDisablePublicAccessLevel, \'enabled\': !bap.shouldDisablePublicAccessLevel}"></ng-include>\n      </div>\n      <div class="broadcast-attendee-permissions-input-details">\n        <div class="broadcast-attendee-permissions-header">{{bap.attendeePermissionsInfo[2].header}}</div>\n        <div class="broadcast-attendee-permissions-content">{{bap.attendeePermissionsInfo[2].details}}</div>\n      </div>\n    </div>\n    <span ng-if="bap.isPermissionDisabledByPolicy" translate-once="{{::$root.resources.strings.broadcast_policy_disabled_text}}"></span>\n  </div>\n\n  <div class="broadcast-attendee-permissions-attendee-selector" ng-show="bap.attendeePermissionsInfo[bap.selectedAttendeePermissionsId].peoplePickerRequired">\n    <div class="broadcast-input-section">\n      <div class="control-title" translate-once="{{::$root.resources.strings.broadcast_attendee_people_picker_title}}"></div>\n      <div class="control-input">\n        <people-picker skip-auto-focus="true" prevent-scroll-top-align="true" hide-logged-in-user="true" is-invite-guest-enabled="bap.isFederationEnabledForBroadcast" should-hide-guest-results="!bap.isGuestEnabledForBroadcast" guest-display-name-as-email="true" contact-selected="bap.onAttendeeAdd" custom-class="broadcast-attendee-permissions-pp" custom-container=".broadcast-attendee-permissions-attendee-selector" placeholder="{{::$root.resources.strings.broadcast_attendee_people_picker_placeholder|translate}}" aria-labelledby-id="meeting-invite-people" include-distribution-lists="true" is-broadcast-attendee-picker="true" custom-filter="bap.peoplePickerFilter(contacts)" is-disabled="!bap.attendeePermissionsInfo[0].isEnabled" picker-usage-area="BroadcastAttendeePermissionPicker">\n        </people-picker>\n      </div>\n    </div>\n    \x3c!-- Set is-organizer to true, as we show permission component to organizer only --\x3e\n    <meeting-attendees-cards attendees="bap.broadcastSettings.closedMeetingAttendees" show-mail="true" on-attendee-remove="bap.onAttendeeRemove(removedContact)" hide-headers="true" is-organizer="true" is-edit-mode="true" show-free-status="false" show-broadcast-role="false" is-broadcast="true" is-broadcast-attendee-list="true" is-disabled="!bap.attendeePermissionsInfo[0].isEnabled">\n    </meeting-attendees-cards>\n  </div>\n\n</div>\n'},2045:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=a(2046);!function(e){e[e.Default=0]="Default",e[e.Custom=1]="Custom"}(s=t.BroadcastSupportLink||(t.BroadcastSupportLink={}));var n=function(){function e(e,t,a){this.broadcastMeetingPolicyStore=e,this.appConfig=a,this.broadcastSupportLink=s,this.logger=t.newLogger("BroadcastAttendeeSupportController"),this.dialog.isEditMode||this.settings.supportLinkUrl||this.setSupportUrlFromBroadcastPolicy()}return e.$inject=["broadcastMeetingPolicyStore","loggingService","appConfig"],e.prototype.setSupportUrlFromBroadcastPolicy=function(){var e,t=this;return this.broadcastMeetingPolicyStore.waitForSettingAndGetValue(SkypeX.Services.BroadcastMeetingPolicyStorageKey.supportURL).then(function(t){e=t}).catch(function(e){t.logger.error("broadcastMeetingPolicyStore.waitForSettingAndGetValue errored out for key: "+SkypeX.Services.BroadcastMeetingPolicyStorageKey.supportURL+" error: "+JSON.stringify(e))}).finally(function(){t.settings.supportLinkUrl=e||t.appConfig.broadcastPolicyDefaults.supportURL})},e}();t.BroadcastAttendeeSupportController=n,angular.module("teamspace.broadcastAttendeeSupport",[]).directive("broadcastAttendeeSupport",[function(){return{restrict:"E",scope:{},bindToController:{dialog:"=",settings:"=",readOnlyMode:"="},template:i,controller:n,controllerAs:"basc"}}])},2046:function(e,t){e.exports='<div class="broadcast-attendee-support">\n  <div class="broadcast-support-settings-header">\n    <span id="broadcast-support-links-header" translate-once="{{::$root.resources.strings.broadcast_troubleshooting_setting_header}}"></span>\n  </div>\n\n  <div class="broadcast-attendee-support-link-selector" aria-labelledby="broadcast-support-links-section-header">\n    <div class="broadcast-attendee-support-link-container" aria-labelledby="broadcast-support-links-header">\n      <span class="broadcast-input-label support-link-url-title" id="broadcast-support-links-url-title">{{::$root.resources.strings.broadcast_attendee_custom_support_link_url_label | translate}}</span>\n      <div class="control-input broadcast-input-container">\n        <input sanitized class="broadcast-input support-link-url" type="text" ng-model="basc.settings.supportLinkUrl" ng-disabled="basc.readOnlyMode" aria-labelledby="broadcast-support-links-url-title"/>\n      </div>\n    </div>\n  </div>\n</div>\n'},2047:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2048),i=function(){return function(){this.readOnlyMode=!!this.dialog.meetingDetails&&this.dialog.isEditMode&&!this.dialog.meetingDetails.canEditMeeting()}}();t.BroadcastSettingsController=i,angular.module("teamspace.broadcastSettings",[]).directive("broadcastSettings",[function(){return{restrict:"E",scope:{},bindToController:{dialog:"=",settings:"="},template:s,controller:i,controllerAs:"bsc"}}])},2048:function(e,t){e.exports='<div class="broadcast-settings">\n\n  <div class="broadcast-settings-section" ng-if="!bsc.settings.isYammerEnabled">\n    <div class="broadcast-settings-section-header">\n      <label id="broadcast-attendee-permissions-section-header" translate-once="{{::$root.resources.strings.broadcast_settings_section_header_attendee_permissions}}">\n      </label>\n    </div>\n    <div class="broadcast-settings-section-content" ng-show="true">\n      <broadcast-attendee-permissions broadcast-settings="bsc.settings" read-only-mode="bsc.readOnlyMode" is-quick-start-enabled-in-region="bsc.dialog.isQuickStartEnabledInRegion">\n      </broadcast-attendee-permissions>\n    </div>\n  </div>\n\n  <div class="broadcast-settings-section">\n    <div class="broadcast-settings-section-header">\n      <label id="broadcast-streaming-section-header" translate-once="{{::$root.resources.strings.broadcast_settings_section_header_streaming}}">\n      </label>\n    </div>\n    <div class="broadcast-settings-section-content" ng-show="true">\n      <broadcast-streaming read-only-mode="bsc.readOnlyMode" dialog="bsc.dialog" settings="bsc.settings">\n      </broadcast-streaming>\n    </div>\n  </div>\n\n  <div class="broadcast-settings-section" ng-show="!bsc.settings.isBYOEEvent">\n    <div class="broadcast-settings-section-header">\n      <label id="broadcast-support-links-section-header" translate-once="{{::$root.resources.strings.broadcast_settings_section_header_support}}">\n      </label>\n    </div>\n    <div class="broadcast-settings-section-content" ng-show="true">\n      <broadcast-attendee-support settings="bsc.settings" dialog="bsc.dialog" read-only-mode="bsc.readOnlyMode">\n      </broadcast-attendee-support>\n    </div>\n  </div>\n\n  \x3c!-- Workaround to avoid clipping of the bottom of the page on smaller resolution (simple scrollbar) --\x3e\n  <div style="min-height: 200px"></div>\n</div>\n'},2049:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s,i=a(2050),n=a(2051),r=a(2052);!function(e){e[e.Teams=0]="Teams",e[e.ExternalEncoder=1]="ExternalEncoder"}(s=t.BroadcastStreamingOption||(t.BroadcastStreamingOption={}));var o=function(){function e(e,t,a,i,n,r,o,c,l,d,p,g,u,h,m){var b=this;if(this.tooltipCssApplicators=e,this.$scope=t,this.$translate=a,this.resources=i,this.constants=n,this.settingsService=r,this.tooltipService=c,this.$q=l,this.broadcastMeetingPolicyStore=d,this.streamPermissionsService=g,this.appConfig=u,this.streamPolicyService=m,this.broadcastStreamingOption=s,this.isVodSelectionDisabledForUser=!1,this.enableDoNotRecordCapability=!1,this.shouldDisableExternalEncoder=!1,this.shouldDisableQuickStart=!1,this.isQSPushToStreamSelected=!1,this.shouldDisableQSPushToStream=!1,this.isPublicAccessLevelSelected=!1,this.logger=p.newLogger("BroadcastStreamingController"),this.tooltipId=o.generateUUID(),this.translationMenuId=o.generateUUID(),this.broadcastVodSettingTextDescription=a.instant(i.strings.broadcast_vod_setting_text_description),this.checkBroadcastPolicy(),this.checkStreamPolicy(),this.isSpeechServicesEnabled=r.valueAsBoolean(n.settings.names.enableBroadcastSpeechServices)&&this.isSpeechServicesEnabledInRegion(),this.isBYOEEnabled=r.valueAsBoolean(n.settings.names.enableBroadcastBYOE)&&this.dialog.isBYOEEnabledInRegion,this.isExternalUserAccessEnabled=r.valueAsBoolean(n.settings.names.enableFederationForBroadcast),this.showQSPushToStreamOption=r.valueAsBoolean(n.settings.names.enableBroadcastQSPushToStream),this.isQnASelectionEnabled=this.dialog.isQuickStartEnabledInRegion&&r.valueAsBoolean(n.settings.names.enableBroadcastSchedulingQnA),this.enableDoNotRecordCapability=r.valueAsBoolean(n.settings.names.enableDoNotRecordCapability),this.dialog.isEditMode?(this.selectedStreamingOption=this.settings.isBYOEEvent?s.ExternalEncoder:s.Teams,this.showQSPushToStreamOption&&(this.isQSPushToStreamSelected=this.settings.isStreamEnabled&&!this.settings.isBYOEEvent)):this.isBYOEEnabled&&(this.settings.isYammerEnabled||!this.dialog.isQuickStartEnabledInRegion||this.dialog.isIPVideoVbssPolicyDisabled)?(this.selectedStreamingOption=s.ExternalEncoder,this.settings.isStreamEnabled=!0,this.settings.isBYOEEvent=!0):(this.selectedStreamingOption=s.Teams,this.settings.isStreamEnabled=!1,this.settings.isBYOEEvent=!1),this.isSpeechServicesEnabled){this.transcriptionSourceLanguages=this.getLanguagesWithTranslatedNames(r.valueFor("transcriptionLanguages"),teamspace.services.BroadcastLanguageCodeProperty.ISO),!this.settings.teamsStreamingSettings.primarySpokenLanguage&&this.transcriptionSourceLanguages&&this.transcriptionSourceLanguages.length>0&&(this.settings.teamsStreamingSettings.primarySpokenLanguage=this.transcriptionSourceLanguages[0][teamspace.services.BroadcastLanguageCodeProperty.ISO]),this.translationLanguages=this.getLanguagesWithTranslatedNames(r.valueFor("translationLanguages"),teamspace.services.BroadcastLanguageCodeProperty.BCP),this.translationLanguages=this.translationLanguages.sort(function(e,t){return e.name.localeCompare(t.name)}),this.numSelectedTranslationLanguages=0;for(var v=this,S=0,y=this.translationLanguages;S<y.length;S++)!function(e){v.settings.transcriptionLanguages.filter(function(t){return t===e[b.settings.codeFormat]})[0]?(e.selected=!0,v.numSelectedTranslationLanguages++):e.selected=!1}(y[S]);this.updateSelectedTranslationLanguagesText()}else this.settings.teamsStreamingSettings.isCaptionsEnabled=!1;this.streamingOptionLabels={quickStartTitle:a.instant(i.strings.broadcast_streaming_teams_header),quickStartAriaTitle:a.instant(i.strings.broadcast_streaming_teams_header)+" "+a.instant(i.strings.broadcast_streaming_teams_description),quickStartTranscriptionTitle:a.instant(i.strings.broadcast_transcription_checkbox_label),quickStartQnaTitle:a.instant(i.strings.broadcast_moderated_q_and_a_text),byoeTitle:a.instant(i.strings.broadcast_streaming_byoe_header),byoeAriaTitle:a.instant(i.strings.broadcast_streaming_byoe_header)+" "+a.instant(i.strings.broadcast_streaming_byoe_description),byoeQnaTitle:a.instant(i.strings.broadcast_moderated_q_and_a_text)},this.updatePreviewLabels(),this.transcriptionSourceLanguagesForByoe=this.getLanguagesWithTranslatedNames(r.valueFor("transcriptionSourceLanguagesForByoe"),teamspace.services.BroadcastLanguageCodeProperty.ISO),!this.settings.byoeStreamingSettings.primarySpokenLanguage&&this.transcriptionSourceLanguagesForByoe&&this.transcriptionSourceLanguagesForByoe.length>0&&(this.settings.byoeStreamingSettings.primarySpokenLanguage=this.transcriptionSourceLanguagesForByoe[0][teamspace.services.BroadcastLanguageCodeProperty.ISO]),t.$watchGroup(["bstrc.canCreateStreamEvent","bstrc.settings.broadcastMeetingAccessLevel","bstrc.selectedStreamingOption","bstrc.settings.closedMeetingAttendees.length","bstrc.dialog.meetingDetails.attendees.length","bstrc.settings.teamsStreamingSettings.isCaptionsEnabled","bstrc.settings.isRecordingEnabled","bstrc.settings.teamsStreamingSettings.isVodEnabled","bstrc.dialog.meetingDetails.disableLobby"],function(e){var t=e[0],a=e[1],s=e[2];b.isPublicAccessLevelSelected=teamspace.middletier.BroadcastMeetingAccessLevel[a]===teamspace.middletier.BroadcastMeetingAccessLevel.Anonymous,b.shouldDisableExternalEncoder=!t||b.isPublicAccessLevelSelected||b.dialog.isEditMode&&s!==b.broadcastStreamingOption.ExternalEncoder;var i=b.isGuestOrExternalUserAdded(b.settings.closedMeetingAttendees)||b.isGuestOrExternalUserAdded(b.dialog.meetingDetails&&b.dialog.meetingDetails.attendees),n=b.dialog.meetingDetails.useLiveEventAuthorizationV2&&!b.dialog.meetingDetails.disableLobby;b.shouldDisableExternalEncoder=b.shouldDisableExternalEncoder||i||n,b.shouldDisableQuickStart=b.dialog.isIPVideoVbssPolicyDisabled||b.dialog.isEditMode&&b.selectedStreamingOption!==b.broadcastStreamingOption.Teams,b.shouldDisableQSPushToStream=!t||b.isPublicAccessLevelSelected||i||b.dialog.isEditMode||b.settings.teamsStreamingSettings.isCaptionsEnabled||!b.settings.isRecordingEnabled||!b.settings.teamsStreamingSettings.isVodEnabled,b.selectedStreamingOption===b.broadcastStreamingOption.ExternalEncoder&&n&&b.updateSelection(b.broadcastStreamingOption.Teams)}),h.$on(t,n.events.messages.setFocus,function(){b.settings.isYammerEnabled&&setTimeout(function(){for(var e=document.getElementsByClassName("broadcast-streaming-input-wrapper"),t=0;t<e.length;t++)e[t].setAttribute("tabIndex","-1");var a=b.selectedStreamingOption===s.ExternalEncoder?"broadcast-streaming-option-byoe":"broadcast-streaming-option-teams",i=document.getElementById(a);i&&(i.setAttribute("tabIndex","0"),i.focus())})}),t.$watch("bstrc.dialog.currentBroadcastPageOpen",function(e,t){null!=e&&e!==t&&e===teamspace.components.BroadcastPage.BroadcastSettings&&b.settings.isYammerEnabled&&b.isBYOEEnabled&&b.selectedStreamingOption===s.ExternalEncoder&&b.showStreamConsentDialog(s.ExternalEncoder)})}return e.$inject=["tooltipCssApplicators","$scope","$translate","resources","constants","settingsService","utilityService","tooltipService","$q","broadcastMeetingPolicyStore","loggingService","streamPermissionsService","appConfig","eventingService","streamPolicyService"],e.prototype.updatePreviewLabels=function(){if(this.previewSettings={},this.previewSettings.isLiveEventsInPreview=!this.settingsService.valueAsBoolean(this.constants.settings.names.enableBroadcastGALabel),!this.previewSettings.isLiveEventsInPreview){this.previewSettings.isQnaInPreview=this.settingsService.valueAsBoolean(this.constants.settings.names.qnaPreview);var e=this.appConfig.broadcastSettings.quickStartPreviewRegions;this.previewSettings.isQuickStartInPreview=_.indexOf(e,this.dialog.userRegion)>=0,this.previewSettings.isQuickStartInPreview?this.streamingOptionLabels.quickStartTitle=this.$translate.instant(this.resources.strings.broadcast_streaming_teams_header_preview):(this.settingsService.valueAsBoolean(this.constants.settings.names.enableBroadcastCaptionsGA)||(this.streamingOptionLabels.quickStartTranscriptionTitle=this.$translate.instant(this.resources.strings.broadcast_transcription_checkbox_label_preview)),this.previewSettings.isQnaInPreview&&(this.streamingOptionLabels.quickStartQnaTitle=this.$translate.instant(this.resources.strings.broadcast_moderated_q_and_a_text_preview)));var t=this.appConfig.broadcastSettings.byoePreviewRegions;this.previewSettings.isBYOEInPreview=_.indexOf(t,this.dialog.userRegion)>=0,this.previewSettings.isBYOEInPreview?this.streamingOptionLabels.byoeTitle=this.$translate.instant(this.resources.strings.broadcast_streaming_byoe_header_preview):this.previewSettings.isQnaInPreview&&(this.streamingOptionLabels.byoeQnaTitle=this.$translate.instant(this.resources.strings.broadcast_moderated_q_and_a_text_preview))}},e.prototype.toggleQSStreamSelection=function(){var e=this;this.isQSPushToStreamSelected?(this.isQSPushToStreamSelected=!1,this.settings.isStreamEnabled=!1):this.streamPolicyService.ensureAcceptUserPolicyIsMet(teamspace.services.StreamPolicyClients.broadcast).then(function(t){t?(e.isQSPushToStreamSelected=!0,e.settings.isStreamEnabled=!0,e.settings.teamsStreamingSettings.isAttendeeReportEnabled=!1):(e.dialog.footerMessage=e.$translate.instant(e.resources.strings.broadcast_quick_start_stream_policy_consent_error_message),e.isQSPushToStreamSelected=!1,e.settings.isStreamEnabled=!1)})},e.prototype.selectBroadcastStreamingOption=function(e){if(!this.dialog.isEditMode){if(this.selectedStreamingOption===e)return;e===s.ExternalEncoder?this.showStreamConsentDialog(e):this.updateSelection(e)}},e.prototype.isStreamingOptionsDisabledByPolicy=function(){return(!this.dialog.isEditMode||!this.settings.isStreamEnabled)&&(this.dialog.isEditMode&&!this.settings.isStreamEnabled?this.isRecordingSelectionDisabledForUser||!this.isTranscriptionAllowedByPolicy:(this.isBYOEEnabled||this.showQSPushToStreamOption)&&!this.canCreateStreamEvent||this.isRecordingSelectionDisabledForUser||!this.isTranscriptionAllowedByPolicy)},e.prototype.checkBroadcastPolicy=function(){var e,t,a=this;return this.$q.all([this.broadcastMeetingPolicyStore.waitForSettingAndGetValue(SkypeX.Services.BroadcastMeetingPolicyStorageKey.broadcastRecordingMode),this.broadcastMeetingPolicyStore.waitForSettingAndGetValue(SkypeX.Services.BroadcastMeetingPolicyStorageKey.allowBroadcastTranscription)]).then(function(a){e=a[0],t=a[1]}).catch(function(s){a.logger.error("broadcastMeetingPolicyStore.waitForSettingAndGetValue errored out for keys: "+SkypeX.Services.BroadcastMeetingPolicyStorageKey.broadcastRecordingMode+",\n          "+SkypeX.Services.BroadcastMeetingPolicyStorageKey.allowBroadcastTranscription+" error: "+JSON.stringify(s)),e=a.appConfig.broadcastPolicyDefaults.broadcastRecordingMode,t=a.appConfig.broadcastPolicyDefaults.allowBroadcastTranscription}).finally(function(){a.isRecordingSelectionDisabledForUser=e!==teamspace.components.BroadcastRecordingMode.UserOverride,e===teamspace.components.BroadcastRecordingMode.AlwaysEnabled?(a.settings.isRecordingEnabled=!0,a.enableDoNotRecordCapability&&(a.settings.teamsStreamingSettings.isVodEnabled=!0,a.isVodSelectionDisabledForUser=!0)):e===teamspace.components.BroadcastRecordingMode.AlwaysDisabled&&(a.settings.isRecordingEnabled=!1,a.enableDoNotRecordCapability&&(a.isVodSelectionDisabledForUser=!0,a.settings.teamsStreamingSettings.isVodEnabled=!1,a.settings.teamsStreamingSettings.isDoNotRecordEnabled=!0)),a.isTranscriptionAllowedByPolicy=t,a.isTranscriptionAllowedByPolicy||(a.settings.teamsStreamingSettings.isCaptionsEnabled=!1,a.settings.byoeStreamingSettings.isCaptionsEnabled=!1)})},e.prototype.stopEscape=function(e){e.keyCode===this.constants.keyCodes.escape&&(this.showVodInfoTooltip(e,!1),e.stopPropagation())},e.prototype.isSpeechServicesEnabledInRegion=function(){var e=this.appConfig.broadcastSettings.supportedSpeechQuickStartRegions;return e&&e.length&&e.indexOf(this.dialog.userRegion)>=0},e.prototype.getLanguagesWithTranslatedNames=function(e,t){var a=this;return e.map(function(e){var s=a.resources.strings["broadcast_captions_language_"+e[t]];return e.name=a.$translate.instant(s)||e.name,e})},e.prototype.checkPolicyDisabledError=function(){!this.dialog.isBYOEEnabledInRegion||this.canCreateStreamEvent||this.dialog.isQuickStartEnabledInRegion&&!this.dialog.isIPVideoVbssPolicyDisabled||(this.dialog.currentBroadcastPageOpen=teamspace.components.BroadcastPage.Disabled,this.dialog.loadingError=this.dialog.$translate.instant(this.dialog.resources.strings.broadcast_meeting_creation_disabled_stream_permission),this.dialog.context.setFooterButtons())},e.prototype.checkStreamPolicy=function(){var e=this;{if(this.settingsService.valueAsBoolean(this.constants.settings.names.enableBroadcastPolicyCheck))return this.streamPermissionsService.getPermission(teamspace.services.StreamPermissionKeys.canCreateLiveEvent).then(function(t){e.canCreateStreamEvent=t}).catch(function(){e.logger.error("Failed to retrieve stream permission: "+teamspace.services.StreamPermissionKeys.canCreateLiveEvent),e.canCreateStreamEvent=!1}).finally(function(){e.checkPolicyDisabledError(),e.logger.info("canCreateStreamEvent permission for the tenant: "+e.canCreateStreamEvent),e.dialog.isEditMode?e.settings.isStreamEnabled&&(e.canCreateStreamEvent=!0):e.canCreateStreamEvent||(e.settings.isBYOEEvent=!1,e.settings.isStreamEnabled=!1,e.isQSPushToStreamSelected=!1,e.selectedStreamingOption=s.Teams)});this.canCreateStreamEvent=!0}},e.prototype.showStreamConsentDialog=function(e){var t=this;this.selectedStreamingOption=e,this.streamPolicyService.ensureAcceptUserPolicyIsMet(teamspace.services.StreamPolicyClients.broadcast).then(function(a){a?t.updateSelection(e):(t.dialog.footerMessage=t.$translate.instant(t.resources.strings.broadcast_stream_policy_consent_error_message),t.selectedStreamingOption=s.Teams,t.settings.isStreamEnabled=!1,t.settings.isBYOEEvent=!1,t.isQSPushToStreamSelected=!1),t.onFocus(t.selectedStreamingOption)})},e.prototype.updateSelection=function(e){this.settings.isBYOEEvent=e===s.ExternalEncoder,this.settings.isStreamEnabled=this.settings.isBYOEEvent,this.dialog.context.currentState.discardSchedulingServiceMeetingEvent(),this.dialog.context.currentState.createSchedulingMeetingEvent(),this.selectedStreamingOption=e},e.prototype.onFocus=function(e){e===s.Teams?(this.setTabEnabled("broadcast-streaming-option-teams",!0),this.setTabEnabled("broadcast-streaming-option-byoe",!1)):(this.setTabEnabled("broadcast-streaming-option-teams",!1),this.setTabEnabled("broadcast-streaming-option-byoe",!0))},e.prototype.setTabEnabled=function(e,t){var a=document.getElementById(e);if(a)for(var s=a.getElementsByClassName("broadcast-streaming-option"),i=0;i<s.length;i++)s[i].setAttribute("tabIndex",t?"0":"-1")},e.prototype.OnVodInfoLinkKeyDown=function(e){e.keyCode===this.constants.keyCodes.enter&&(this.showVodInfoTooltip(e,!0),e.stopPropagation(),e.preventDefault())},e.prototype.showVodInfoTooltip=function(e,t){var a={template:n,trigger:"manual",container:"body",placement:"right",autoClose:!0,scope:this.$scope},s={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Popover,options:a,tooltipId:this.tooltipId};t?this.tooltipService.showTooltip(s):this.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,this.tooltipId)},e.prototype.showTranslationMenu=function(e,t){var a=this,s={template:r,trigger:"manual",container:"#broadcast-translation-dropdown-icon",placement:"bottom-right",autoClose:!0,scope:this.$scope},i={sourceElement:angular.element(e.currentTarget),tooltipType:teamspace.services.TooltipType.Dropdown,options:s,tooltipId:this.translationMenuId,cssApplicator:function(){a.tooltipCssApplicators.contextMenu(e)},done:function(e){e&&setTimeout(function(){var e=document.getElementById("broadcast-translation-language-0");e&&e.focus()},150)}};this.tooltipService.toggleTooltip(i)},e.prototype.closeTranslationMenu=function(){this.tooltipService.clearTooltip(teamspace.services.TooltipType.Dropdown,this.translationMenuId)},e.prototype.toggleTranslationLanguage=function(e){e.selected?(e.selected=!1,this.numSelectedTranslationLanguages--,this.updateSelectedTranslationLanguagesText()):this.numSelectedTranslationLanguages<6&&(e.selected=!0,this.numSelectedTranslationLanguages++,this.updateSelectedTranslationLanguagesText())},e.prototype.onTranslationLanguageKeyDown=function(e){if(e.keyCode===this.constants.keyCodes.escape){this.closeTranslationMenu();var t=document.getElementById("broadcast-translation-languages-container");t&&t.focus(),e.stopPropagation(),e.preventDefault()}},e.prototype.disableTranslationLanguageButton=function(e){return e[teamspace.services.BroadcastLanguageCodeProperty.ISO]===this.settings.teamsStreamingSettings.primarySpokenLanguage||!e.selected&&6===this.numSelectedTranslationLanguages},e.prototype.transcriptionLanguageChanged=function(){var e=this,t=this.translationLanguages.filter(function(t){return t[teamspace.services.BroadcastLanguageCodeProperty.ISO]===e.settings.teamsStreamingSettings.primarySpokenLanguage})[0];t&&t.selected&&this.toggleTranslationLanguage(t)},e.prototype.updateSelectedTranslationLanguagesText=function(){if(this.settings.transcriptionLanguages=[],0!==this.numSelectedTranslationLanguages){for(var e=[],t=0,a=this.translationLanguages;t<a.length;t++){var s=a[t];if(s.selected){var i=this.$translate.instant(this.resources.strings["broadcast_captions_language_"+s[this.settings.codeFormat]]);e.push(i||s.nativeName),this.settings.transcriptionLanguages.push(s[this.settings.codeFormat])}}this.selectedTranslationLanguagesText=e.join(", ")}else this.selectedTranslationLanguagesText=this.$translate.instant(this.resources.strings.broadcast_translation_dropdown_selection_title)},e.prototype.isGuestOrExternalUserAdded=function(e){if(!e||!e.length)return!1;for(var t=0,a=e;t<a.length;t++){var s=a[t];if(s.role===this.dialog.constants.RoleConstants.Guest)return!0;if(this.isExternalUserAccessEnabled&&!s.objectId&&!s.skypeMri&&s.type!==teamspace.middletier.AttendeeType[teamspace.middletier.AttendeeType.Organizer])return!0}return!1},e}();t.BroadcastStreamingController=o,angular.module("teamspace.broadcastStreaming",[]).directive("broadcastStreaming",[function(){return{restrict:"E",scope:{},bindToController:{readOnlyMode:"=",dialog:"=",settings:"="},template:i,controller:o,controllerAs:"bstrc"}}])},2050:function(e,t){e.exports='<div class="broadcast-streaming" aria-labelledby="broadcast-streaming-section-header">\n\n  <div class="broadcast-streaming-radio" ng-if="::bstrc.dialog.isQuickStartEnabledInRegion" ng-class="{\'disabled\': bstrc.readOnlyMode || bstrc.shouldDisableQuickStart}" aria-labelledby="broadcast-streaming-teams-header" data-tid="streamingoption-quickstart">\n    <input id="broadcast-streaming-option-teams" type="radio" name="broadcast-streaming-production" ng-if="::bstrc.isBYOEEnabled" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableQuickStart" ng-checked="bstrc.isBYOEEnabled && (bstrc.selectedStreamingOption === bstrc.broadcastStreamingOption.Teams)" ng-click="bstrc.selectBroadcastStreamingOption(bstrc.broadcastStreamingOption.Teams)" ng-focus="bstrc.onFocus(bstrc.broadcastStreamingOption.Teams)">\n    <label class="broadcast-streaming-header" id="broadcast-streaming-teams-header" for="broadcast-streaming-option-teams" ng-class="{\'disabled\': bstrc.readOnlyMode || bstrc.shouldDisableQuickStart}" aria-label="{{::bstrc.streamingOptionLabels.quickStartAriaTitle}}">\n      {{::bstrc.streamingOptionLabels.quickStartTitle}}\n    </label>\n    <div ng-class="{\'broadcast-streaming-content\': bstrc.isBYOEEnabled}">\n      <div class="broadcast-streaming-description" id="broadcast-streaming-teams-description" translate-once="{{::$root.resources.strings.broadcast_streaming_teams_description}}"></div>\n      <div class="broadcast-disclaimer-text" ng-if="bstrc.settings.isYammerEnabled && bstrc.dialog.showQuickStartDisclaimer">\n         <span translate-once="{{::$root.resources.strings.broadcast_streaming_teams_yammer_preview_disclaimer}}"></span>\n         <a href="https://aka.ms/quickstartyammer" target="_blank">{{::$root.resources.strings.broadcast_learn_more|translate}}</a>\n      </div>\n      <div class="broadcast-streaming-settings" ng-show="bstrc.selectedStreamingOption === bstrc.broadcastStreamingOption.Teams">\n        <div class="broadcast-streaming-option" tabindex="0" acc-role="clickable" role="checkbox" ng-if="bstrc.showQSPushToStreamOption" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableQSPushToStream" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.readOnlyMode || bstrc.shouldDisableQSPushToStream}">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="teams_broadcast_publishToStream">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="teams_broadcast_publishToStream" ng-checked="bstrc.isQSPushToStreamSelected" ng-click="bstrc.toggleQSStreamSelection()" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableQSPushToStream"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.readOnlyMode || bstrc.shouldDisableQSPushToStream}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.readOnlyMode || bstrc.shouldDisableQSPushToStream}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span aria-label="{{::$root.resources.strings.broadcast_push_to_stream_checkbox_label|translate}}" translate-once="{{::$root.resources.strings.broadcast_push_to_stream_checkbox_label}}">\n                </span>\n              </div>\n            </label>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option acc-broadcast-checkbox-focusable" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.isRecordingSelectionDisabledForUser}" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.isRecordingEnabled}}" ng-disabled="bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="teams_broadcast_recording">\n              <input type="checkbox" id="teams_broadcast_recording" class="broadcast-streaming-checkbox-hidden" ng-checked="bstrc.settings.isRecordingEnabled" ng-disabled="bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected" ng-model="bstrc.settings.isRecordingEnabled"/>\n              <ng-include ng-if="!bstrc.settings.isRecordingEnabled" class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.isRecordingSelectionDisabledForUser || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include ng-if="bstrc.settings.isRecordingEnabled" class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.isRecordingSelectionDisabledForUser || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span translate-once="{{::$root.resources.strings.broadcast_create_recording_setting_text}}"></span>\n              </div>\n            </label>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option acc-broadcast-checkbox-focusable" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.isVodSelectionDisabledForUser}" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.teamsStreamingSettings.isVodEnabled}}" ng-disabled="bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="teams_broadcast_vod">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="teams_broadcast_vod" ng-checked="bstrc.settings.teamsStreamingSettings.isVodEnabled" ng-disabled="bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected" ng-model="bstrc.settings.teamsStreamingSettings.isVodEnabled"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.isVodSelectionDisabledForUser || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.isVodSelectionDisabledForUser || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span translate-once="{{::$root.resources.strings.broadcast_vod_setting_text}}" aria-label="{{::$root.resources.strings.broadcast_vod_setting_text|translate}}"></span>\n              </div>\n              <button class="ts-sym video-on-demand-info-link app-icons-fill-focus inset-border inset-border-themed inset-border-round" ng-keydown="bstrc.OnVodInfoLinkKeyDown($event)" acc-tabbable="true" aria-label="{{::$root.resources.strings.broadcast_vod_setting_text_description|translate}}" ng-mouseenter="bstrc.showVodInfoTooltip($event, true)" ng-mouseleave="bstrc.showVodInfoTooltip($event, false)">\n                <ng-include src="\'svg/icons-info.html\'"></ng-include>\n              </button>\n            </label>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option acc-broadcast-checkbox-focusable" ng-if="bstrc.isSpeechServicesEnabled" ng-disabled="bstrc.readOnlyMode || !bstrc.isTranscriptionAllowedByPolicy || bstrc.isQSPushToStreamSelected" ng-class="{\'broadcast-streaming-option-disabled\': !bstrc.isTranscriptionAllowedByPolicy || bstrc.isQSPushToStreamSelected}" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.teamsStreamingSettings.isCaptionsEnabled}}">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="crm_transcription">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="crm_transcription" ng-checked="bstrc.settings.teamsStreamingSettings.isCaptionsEnabled" ng-disabled="bstrc.readOnlyMode || !bstrc.isTranscriptionAllowedByPolicy || bstrc.isQSPushToStreamSelected" ng-model="bstrc.settings.teamsStreamingSettings.isCaptionsEnabled"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': !bstrc.isTranscriptionAllowedByPolicy || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': !bstrc.isTranscriptionAllowedByPolicy || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text" data-tid="captions-option-text">\n                <span>{{::bstrc.streamingOptionLabels.quickStartTranscriptionTitle}}</span>\n              </div>\n            </label>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option" ng-if="bstrc.isSpeechServicesEnabled && bstrc.settings.teamsStreamingSettings.isCaptionsEnabled" id="broadcast-teams-transcription-language-container" ng-disabled="bstrc.readOnlyMode || !bstrc.isTranscriptionAllowedByPolicy || bstrc.isQSPushToStreamSelected" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.readOnlyMode || !bstrc.isTranscriptionAllowedByPolicy || bstrc.isQSPushToStreamSelected}" tabindex="0" role="menuitem" acc-role="clickable">\n          <div class="broadcast-streaming-option-checkbox">\n            <div class="broadcast-streaming-transcription-language-selector" data-tid="transcription-selector-item">\n              <span class="transcription-dropdown-title" translate-once="{{::$root.resources.strings.broadcast_transcription_dropdown_title}}"></span>\n              <dropdown-select class="transcription-dropdown-button" ds-disabled="bstrc.readOnlyMode || !bstrc.settings.teamsStreamingSettings.isCaptionsEnabled" ds-focus-return-selector="#broadcast-teams-transcription-language-container" ds-text-field="name" ds-value-field="code" ds-options="::bstrc.transcriptionSourceLanguages" ds-selected-value="bstrc.settings.teamsStreamingSettings.primarySpokenLanguage" ds-calculate-width="true" ds-on-change="bstrc.transcriptionLanguageChanged()">\n              </dropdown-select>\n            </div>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option" ng-if="bstrc.isSpeechServicesEnabled && bstrc.settings.teamsStreamingSettings.isCaptionsEnabled" id="broadcast-translation-languages-container" ng-disabled="bstrc.readOnlyMode || !bstrc.isTranscriptionAllowedByPolicy" ng-class="{\'broadcast-streaming-option-disabled\': !bstrc.isTranscriptionAllowedByPolicy}" tabindex="0" role="menuitem" acc-role="clickable">\n          <div class="broadcast-streaming-option-checkbox">\n            <div class="broadcast-streaming-translation-language-selector">\n              <span class="transcription-dropdown-title" translate-once="{{::$root.resources.strings.broadcast_translation_dropdown_title}}"></span>\n              <button class="ts-btn dropdown-button single-line-truncation" ng-click="bstrc.showTranslationMenu($event, this)" bs-dropdown="" container="body" placement="bottom" ng-disabled="bstrc.readOnlyMode" aria-haspopup="listbox" title="{{bstrc.selectedTranslationLanguagesText}}" data-tid="translation-menu-toggle-button">\n                {{bstrc.selectedTranslationLanguagesText}}\n              </button>\n              \x3c!-- Adding the dropdown icon separately to avoid single line truncation --\x3e\n              <button class="ts-btn dropdown-button translation-dropdown-icon" ng-click="bstrc.showTranslationMenu($event, this)" bs-dropdown="" container="body" placement="bottom" ng-disabled="bstrc.readOnlyMode" aria-haspopup="listbox">\n                <ng-include src="\'svg/icons-dropdown.html\'"></ng-include>\n              </button>\n            </div>\n            <div id="broadcast-translation-dropdown-icon"></div>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option acc-broadcast-checkbox-focusable" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.teamsStreamingSettings.isAttendeeReportEnabled}}" ng-disabled="bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected}">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="teams_broadcast_attendee_report">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="teams_broadcast_attendee_report" ng-checked="bstrc.settings.teamsStreamingSettings.isAttendeeReportEnabled" ng-model="bstrc.settings.teamsStreamingSettings.isAttendeeReportEnabled" ng-disabled="bstrc.readOnlyMode || bstrc.isQSPushToStreamSelected"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.readOnlyMode || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.readOnlyMode || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams) || bstrc.isQSPushToStreamSelected}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span translate-once="{{::$root.resources.strings.broadcast_attendee_report_setting_text}}"></span>\n              </div>\n            </label>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option acc-broadcast-checkbox-focusable" ng-if="bstrc.isQnASelectionEnabled && (bstrc.settings.isYammerEnabled === false)" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.teamsStreamingSettings.isQAndAEnabled}}" ng-disabled="bstrc.readOnlyMode" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.readOnlyMode}">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="teams_broadcast_qna">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="teams_broadcast_qna" ng-checked="bstrc.settings.teamsStreamingSettings.isQAndAEnabled" ng-model="bstrc.settings.teamsStreamingSettings.isQAndAEnabled" ng-disabled="bstrc.readOnlyMode"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.readOnlyMode || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams)}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.readOnlyMode || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.Teams)}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span aria-label="{{::$root.resources.strings.aria_broadcast_meeting_qna_option|translate}}">{{::bstrc.streamingOptionLabels.quickStartQnaTitle}}</span>\n              </div>\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="broadcast-policy-disabled-text" ng-if="bstrc.dialog.isQuickStartEnabledInRegion && bstrc.dialog.isIPVideoVbssPolicyDisabled" translate-once="{{::$root.resources.strings.broadcast_policy_scheduling_disabled_video_vbss_quick_start_text}}">\n  </div>\n  <div class="broadcast-policy-disabled-text" ng-if="!bstrc.isTranscriptionAllowedByPolicy" ng-show="bstrc.selectedStreamingOption === bstrc.broadcastStreamingOption.Teams" translate-once="{{::$root.resources.strings.broadcast_policy_disabled_text}}">\n  </div>\n\n  <div class="broadcast-streaming-radio" ng-if="::bstrc.isBYOEEnabled" ng-class="{\'disabled\': bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder}" aria-labelledby="broadcast-streaming-byoe-header" data-tid="streamingoption-byoe">\n    <input id="broadcast-streaming-option-byoe" type="radio" name="broadcast-streaming-production" ng-if="bstrc.dialog.isQuickStartEnabledInRegion" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" ng-checked="bstrc.dialog.isQuickStartEnabledInRegion && bstrc.selectedStreamingOption === bstrc.broadcastStreamingOption.ExternalEncoder" ng-click="bstrc.selectBroadcastStreamingOption(bstrc.broadcastStreamingOption.ExternalEncoder)" ng-focus="bstrc.onFocus(bstrc.broadcastStreamingOption.ExternalEncoder)">\n    <label class="broadcast-streaming-header" id="broadcast-streaming-byoe-header" for="broadcast-streaming-option-byoe" ng-class="{\'disabled\': bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder}" aria-label="{{::bstrc.streamingOptionLabels.byoeAriaTitle}}">\n      {{::bstrc.streamingOptionLabels.byoeTitle}}\n    </label>\n    <div ng-class="{\'broadcast-streaming-content\': bstrc.dialog.isQuickStartEnabledInRegion}">\n      <div class="broadcast-streaming-description" id="broadcast-streaming-byoe-description">\n        <span translate-once="{{::$root.resources.strings.broadcast_streaming_byoe_description}}"></span>\n        <a href="{{::bstrc.constants.urls.broadcast.externalEncoderLearnMoreUrl}}" target="_blank" translate-once="{{::$root.resources.strings.broadcast_learn_more}}" ng-disabled="bstrc.shouldDisableExternalEncoder" tabindex="{{bstrc.shouldDisableExternalEncoder ? \'-1\' : \'0\'}}"></a>\n      </div>\n      <div class="broadcast-streaming-settings" ng-show="bstrc.selectedStreamingOption === bstrc.broadcastStreamingOption.ExternalEncoder">\n        <div class="broadcast-streaming-option-disabled">\n          <div class="broadcast-streaming-option-checkbox">\n            <div class="broadcast-checkbox-margin broadcast-byoe-vod-option">\n              <ng-include class="icons-checkbox-disabled icon" src="\'svg/icons-checked.html\'"></ng-include>\n              <div class="broadcast-byoe-vod-option-text broadcast-streaming-option-text">\n                <span translate-once="{{::$root.resources.strings.broadcast_vod_setting_text}}"></span>\n              </div>\n              <button class="ts-sym video-on-demand-info-link app-icons-fill-focus inset-border inset-border-themed inset-border-round" ng-class="{\'disabled\': bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder}" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" acc-tabbable="true" aria-label="{{::$root.resources.strings.broadcast_vod_setting_text_description|translate}}" ng-keydown="bstrc.OnVodInfoLinkKeyDown($event)" ng-mouseenter="bstrc.showVodInfoTooltip($event, true)" ng-mouseleave="bstrc.showVodInfoTooltip($event, false)">\n                <ng-include src="\'svg/icons-info.html\'"></ng-include>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.shouldDisableExternalEncoder}" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.byoeStreamingSettings.isCaptionsEnabled}}">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="crm_transcription_byoe">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="crm_transcription_byoe" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" ng-checked="bstrc.settings.byoeStreamingSettings.isCaptionsEnabled" ng-model="bstrc.settings.byoeStreamingSettings.isCaptionsEnabled"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.shouldDisableExternalEncoder || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.ExternalEncoder)}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.shouldDisableExternalEncoder || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.ExternalEncoder)}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span translate-once="{{::$root.resources.strings.broadcast_transcription_checkbox_label_byoe}}"></span>\n              </div>\n            </label>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option" ng-if="bstrc.settings.byoeStreamingSettings.isCaptionsEnabled" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" ng-class="{\'broadcast-streaming-option-disabled\': bstrc.shouldDisableExternalEncoder}" id="broadcast-byoe-transcription-language-container" tabindex="0" acc-role="clickable" role="checkbox" aria-checked="{{bstrc.settings.byoeStreamingSettings.isCaptionsEnabled}}">\n          <div class="broadcast-streaming-option-checkbox">\n            <div class="broadcast-streaming-transcription-language-selector">\n              <span class="transcription-dropdown-title" translate-once="{{::$root.resources.strings.broadcast_transcription_dropdown_title}}"></span>\n              <dropdown-select class="transcription-dropdown-button" ds-disabled="bstrc.readOnlyMode || !bstrc.settings.byoeStreamingSettings.isCaptionsEnabled || bstrc.shouldDisableExternalEncoder" ds-focus-return-selector="#broadcast-byoe-transcription-language-container" ds-text-field="name" ds-value-field="code" ds-options="::bstrc.transcriptionSourceLanguagesForByoe" ds-selected-value="bstrc.settings.byoeStreamingSettings.primarySpokenLanguage" ds-calculate-width="true">\n              </dropdown-select>\n            </div>\n          </div>\n        </div>\n        <div class="broadcast-streaming-option" tabindex="0" acc-role="clickable" role="checkbox" ng-if="bstrc.isQnASelectionEnabled && (bstrc.settings.isYammerEnabled === false)" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" aria-checked="{{bstrc.settings.byoeStreamingSettings.isQAndAEnabled}}">\n          <div class="broadcast-streaming-option-checkbox">\n            <label class="broadcast-checkbox-margin" for="streams_broadcast_qna">\n              <input type="checkbox" class="broadcast-streaming-checkbox-hidden" id="streams_broadcast_qna" ng-checked="bstrc.settings.byoeStreamingSettings.isQAndAEnabled" ng-disabled="bstrc.readOnlyMode || bstrc.shouldDisableExternalEncoder" ng-model="bstrc.settings.byoeStreamingSettings.isQAndAEnabled"/>\n              <ng-include class="icons-checkbox-unselected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.shouldDisableExternalEncoder || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.ExternalEncoder)}" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n              <ng-include class="icons-checkbox-selected icon" ng-class="{\'icons-checkbox-disabled\': bstrc.shouldDisableExternalEncoder || (bstrc.selectedStreamingOption !== bstrc.broadcastStreamingOption.ExternalEncoder)}" src="\'svg/icons-checkbox-selected.html\'"></ng-include>\n              <div class="broadcast-streaming-option-text">\n                <span>{{::bstrc.streamingOptionLabels.byoeQnaTitle}}</span>\n              </div>\n            </label>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <span ng-if="bstrc.isStreamingOptionsDisabledByPolicy()" ng-show="bstrc.selectedStreamingOption === bstrc.broadcastStreamingOption.ExternalEncoder" ng-class="{\'broadcast-policy-disabled-text\' : bstrc.isStreamingOptionsDisabledByPolicy()}" translate-once="{{::$root.resources.strings.broadcast_policy_disabled_text}}">\n  </span>\n\n</div>\n'},2051:function(e,t){e.exports='<div class="tooltip-container vod-popover" acc-role="dialog" ng-keydown="bstrc.stopEscape($event)">\n  <div class="content-container">\n    <div class="tooltip-arrow-left"></div>\n    <span class="tooltip-content inset-border shadow-level-2" acc-role="focus-default">\n      <div translate-once="{{::$root.resources.strings.broadcast_vod_setting_text_description}}"></div>\n    </span>\n  </div>\n</div>'},2052:function(e,t){e.exports='<div class="popover app-default-menu minwidth-sm broadcast-translation-language-menu" ng-keydown="bstrc.onTranslationLanguageKeyDown($event)" acc-role="dialog menu" aria-labelledby="broadcast-translation-language-menu-title">\n  <div class="broadcast-translation-language-menu-header">\n    <span translate-once="{{::$root.resources.strings.broadcast_translation_dropdown_selection_title}}" id="broadcast-translation-language-menu-title"></span>\n    <button class="btn-default inset-border inset-border-round inset-border-themed app-icons-fill-hover" role="button" ng-click="bstrc.closeTranslationMenu()" title="{{::$root.resources.strings.icons_close|translate}}" aria-label="{{::$root.resources.strings.icons_close|translate}}" data-tid="translationmenu-close-button">\n      <ng-include src="\'svg/icons-close.html\'"></ng-include>\n    </button>\n  </div>\n  <div acc-role="list" simple-scrollbar>\n    <div> \x3c!-- This extra div is needed by simple-scrollbar --\x3e\n      <div class="broadcast-streaming-option" ng-repeat="language in bstrc.translationLanguages">\n        <div id="broadcast-translation-language-{{$index}}" class="broadcast-streaming-option-checkbox" acc-role="list-item clickable" aria-checked="{{language.selected}}" tabindex="0">\n          <button class="btn btn-default" ng-click="bstrc.toggleTranslationLanguage(language)" role="checkbox" ng-disabled="bstrc.disableTranslationLanguageButton(language)">\n            <ng-include ng-if="!language.selected" class="icons-checkbox-unselected icon" src="\'svg/icons-checkbox-unselected.html\'"></ng-include>\n            <ng-include ng-if="language.selected" class="icons-checkbox-selected icon" src="\'svg/icons-checkbox-selected.html\'">\n            </ng-include>\n            <div class="broadcast-streaming-option-text"><span>{{::language.name}}</span></div>\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},2053:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={left:"small-left",right:"large-right"},i=function(){function e(e,t){this.resources=e,this.$translate=t}return Object.defineProperty(e.prototype,"displayName",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_stage_layout_template_content_right)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"two-large-right"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iconUrl",{get:function(){return"components/broadcast/producer/layout/templates/two-large-right-layout-icon.html"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sectionMap",{get:function(){var e=new Map;return e.set(s.left,["image","video"]),e.set(s.right,["image","ppt","vbss"]),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"templateUrl",{get:function(){return"components/broadcast/producer/layout/templates/two-large-right-layout.html"},enumerable:!0,configurable:!0}),e.prototype.getComposerLayout=function(e){if(!e||e.length<2)return null;var t=e.find(function(e){return e.id===s.left}),a=e.find(function(e){return e.id===s.right});return t&&a?{sources:[{type:t.source.type,id:t.source.getMediaId()},{type:a.source.type,id:a.source.getMediaId()}]}:null},e}();t.TwoLargeRightBroadcastLayoutTemplate=i},2054:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),a(2055),a(2059),a(2061),a(2063),a(2065),a(2067),a(2069),a(2071),a(133),a(2074),a(2076),a(2081),a(2083),a(2086),a(294),a(2088)},2055:function(e,t,a){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++){t=arguments[a];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=a(2056),n=a(2057),r=a(226),o=a(71),c=a(2058),l=teamspace.services.BroadcastUtilities,d={defaultPlayer:"AMP",defaultPlayerId:"teamsDefaultPlayer",videoPlayerTabbableElementSelector:".vjs-player",playbackStartedScenario:"broadcast_amp_playback_started",techOrderTypes:{azureHtml5JS:"azureHtml5JS",html5:"html5",flashSS:"flashSS"},sdnNames:{sdnHiveName:"hive",sdnKollectiveName:"kollective"},textTrackKind:"subtitles",customHeuristicSettings:{useBrowserWindowSizeForBitRateForAmp:"useBrowserWindowSizeForBitRateForAmp"},ampErrorCodesEligibleForStreamingUrlSwitch:"ampErrorCodesEligibleForStreamingUrlSwitch",streamingUrlSwitchMaxCount:2},p=["200000","200190","200194","200195","20019c","2001f4","2001f6","2001f7","2001f8","200258","300000","400001","400002","400003","400004","400005","500000","500001","500002","500004","500005","500006"],g=function(){function e(e,t,a,s,i,n,r,o,c,d,p,g,u,h,m,b,v,S,y,f,k,_,P,C,w){var M=this;this.$interval=e,this.$scope=t,this.$timeout=a,this.$translate=s,this.$http=i,this.appStateService=n,this.appConfig=r,this.ariaLiveService=o,this.brbV2AmpLogProvider=c,this.broadcastPlaybackService=d,this.constants=p,this.loggingService=g,this.platformDetectService=u,this.resources=h,this.settingsService=m,this.utilityService=b,this.objectLeaksDetector=v,this.analyticsService=S,this.desktopHandlingService=y,this.downloadAppService=f,this.dialogService=k,this.desktopUtilityService=_,this.$rootScope=P,this.eventingService=C,this.exceptionUtilityService=w,this.showPlayer=!1,this.consumePartials=!1,this.isUserRetryCurtainShowing=!1,this.userRetryCount=0,this.isPlaybackUnsupported=!1,this.sdnPluginLoaded=!1,this._textTracks=void 0,this.videoSourceType="application/dash+xml",this.isVerboseMode=!1,this.retryCount=0,this.maxRetryCount=10,this.sourceResetTimeoutInMs=1e3,this.errorDetailsResetInMs=1e4,this.maxMemoryTraceLogCount=1e4,this.streamingUrlSwitchCount=0,this.isLastPlayerUrlSetBySwitching=!1,this.onStreamUpdateTimeoutOrFailure=function(e,t){M.logger.error("onStreamUpdateTimeoutOrFailure: WAMS streaming url was not received after the broadcast was "+t),M.playerInstance&&l.isStreamValid(M.selectedStreamDetails)?M.logger.info("onStreamUpdateTimeoutOrFailure: ignoring event as the player already has a valid stream information"):(M.curtainMessageText=M.$translate.instant(M.resources.strings.broadcast_tmb_broadcast_state_update_timeout_message),M.showCurtain=!0,M.showPlayer=!1)},this.flushInMemoryAmpLogs=function(){if(M.playerInstance){var e=M.playerInstance.getMemoryLog(!0);if(e)return e}},this.logger=g.newLogger("azureMediaPlayer"),this.isVerboseMode=m.valueAsBoolean(p.settings.names.enableAmpVerboseLogging),this.consumePartials=m.valueAsBoolean(p.settings.names.enableBroadcastCaptionsProcessPartials),this.registerForEvents()}return e.$inject=["$interval","$scope","$timeout","$translate","$http","appStateService","appConfig","ariaLiveService","brbV2AmpLogProvider","broadcastPlaybackService","constants","loggingService","platformDetectService","resources","settingsService","utilityService","objectLeaksDetector","analyticsService","desktopHandlingService","downloadAppService","dialogService","desktopUtilityService","$rootScope","eventingService","exceptionUtilityService"],e.prototype.$onInit=function(){var e=this.broadcastPlaybackService.getActiveBroadcastPlayback();this.attendeeMeeting=e&&e.attendeeMeeting,this.updateCaptionsVisibility(),this.attendeeMeeting&&this.handleAttendeeMeetingInfoUpdate()},e.prototype.registerForEvents=function(){var e=this;this.attendeeMeetingInfoReceivedSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.attendeeMeetingInfoReceived,function(t,a){if(a&&l.isPrimaryOrAlternateStreamAvailable({stream:a.stream,altStream:a.altStream})){if(e.logger.info("attendeeMeetingInfoReceived: received attendee meeting"),e.isLastPlayerUrlSetBySwitching)return e.logger.info("attendeeMeetingInfoReceived: not using the received streaming url because attendee has already switched to another streaming url."),void e.notifyPlaybackStart();e.attendeeMeeting=a,e.updateCaptionsVisibility(),!e.isPlaybackUnsupported&&e.handleAttendeeMeetingInfoUpdate()}else e.logger.error("attendeeMeetingInfoReceived: received invalid broadcast meeting")}),this.overflowCaptionsSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.overflowCaptionsUpdate,function(t,a){e.logger.info("Recieved overflow captions state update to: "+a),e.playerInstance.captionToggle.handleClick()}),this.suppressTranscriptionSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.suppressTranscriptionUpdate,function(t,a){e.logger.info("Received transcription suppression state update to: "+a),e.attendeeMeeting.transcription.isSuppressed=a,e.updateCaptionsVisibility()}),this.streamUpdateSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.broadcastStreamUpdate,function(t,a,s){if(a&&l.isPrimaryOrAlternateStreamAvailable(a))try{if(e.logger.info("broadcastStreamUpdate: received broadcast stream information"),e.attendeeMeeting.stream=a.stream,e.attendeeMeeting.altStream=a.altStream,e.switchStreamingUrlCallback=s,e.selectedStreamDetails=l.isStreamValid(e.attendeeMeeting.stream)?e.attendeeMeeting.stream:e.attendeeMeeting.altStream,e.hasAttendeeSwitchedToSameUrl())return e.isLastPlayerUrlSetBySwitching=!1,e.streamingUrlSwitchCount--,void e.notifyPlaybackStart();!e.isPlaybackUnsupported&&e.handlePlayerTransitions()}catch(t){e.logger.error("broadcastStreamUpdate Error: "+JSON.stringify(t))}else e.logger.error("broadcastStreamUpdate: received invalid broadcast streaming details")}),this.broadcastPlaybackService.safeSubscribe(this.$scope,function(){e.playerInstance&&!e.playerInstance.paused()&&e.playerInstance.pause()},teamspace.services.BroadcastPlaybackServiceEvents.BroadcastPlaybackPause),this.$scope.$on("$destroy",function(){e.destroy(),e.objectLeaksDetector.track("azure-media-player",e)}),this.streamUpdateTimeoutSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.broadcastStreamUpdateTimeout,this.onStreamUpdateTimeoutOrFailure),this.streamUpdateFailureSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.receivedInvalidBroadcastStreamUpdate,this.onStreamUpdateTimeoutOrFailure)},e.prototype.$onChanges=function(e){null!=e.isDocked&&e.isDocked.currentValue!==e.isDocked.previousValue&&(this.logger.info(e.isDocked.currentValue?"Navigated to docked player view":"Navigated to full page view"),this.updateCaptionsVisibility())},e.prototype.isSdnInfoValid=function(){return this.selectedStreamDetails&&!!this.selectedStreamDetails.sdnName&&!!this.selectedStreamDetails.sdnPluginUrl},e.prototype.updateCaptionsVisibility=function(){this.captionsPlugin&&(this.shouldHideCaptions()?this.captionsPlugin.hideCaptions():this.captionsPlugin.showCaptions())},e.prototype.shouldHideCaptions=function(){return this.isDocked&&!this.playerInstance.isFullscreen()||this.attendeeMeeting.transcription.isSuppressed},e.prototype.destroy=function(){this.brbV2AmpLogProvider.getLogsCallback=null,this.ampDiagLogger&&(this.ampDiagLogger.dispose(),this.ampDiagLogger=null),this.captionsRetriever&&(this.captionsRetriever.dispose(),this.captionsRetriever=null),this.captionsPlugin&&(this.captionsPlugin.dispose(),this.captionsPlugin=null),this.playerInstance&&(this.playerInstance.removeEventListener(amp.eventName.canplaythrough),this.playerInstance.removeEventListener(amp.eventName.error),this.playerInstance.removeEventListener(amp.eventName.fullscreen),this.playerInstance.removeEventListener(amp.eventName.pause),this.playerInstance.removeEventListener(amp.eventName.resume),this.playerInstance.removeEventListener(amp.eventName.play),this.playerInstance.removeEventListener(amp.eventName.start),this.playerInstance.removeEventListener(amp.eventName.ended),this.playerInstance.removeEventListener(amp.eventName.fullscreenchange),this.playerInstance.getMemoryLog(!0),this.playerInstance.dispose(),this.playerInstance=null),this.showPlayer=!1,this.playbackStartedScenario&&(this.playbackStartedScenario.cancel({message:"player destroy"}),this.playbackStartedScenario=null),this.suppressTranscriptionSubscriptionCleanup&&this.suppressTranscriptionSubscriptionCleanup(),this.streamUpdateSubscriptionCleanup&&this.streamUpdateSubscriptionCleanup(),this.attendeeMeetingInfoReceivedSubscriptionCleanup&&this.attendeeMeetingInfoReceivedSubscriptionCleanup(),this.streamUpdateTimeoutSubscriptionCleanup&&this.streamUpdateTimeoutSubscriptionCleanup(),this.streamUpdateFailureSubscriptionCleanup&&this.streamUpdateFailureSubscriptionCleanup(),this.overflowCaptionsSubscriptionCleanup&&this.overflowCaptionsSubscriptionCleanup(),this.lastAmpErrorTimeout&&(this.$timeout.cancel(this.lastAmpErrorTimeout),this.lastAmpErrorTimeout=void 0),this.sourceRetryTimeout&&(this.$timeout.cancel(this.sourceRetryTimeout),this.sourceRetryTimeout=void 0)},e.prototype.handleAttendeeMeetingInfoUpdate=function(){var e=this;this.selectedStreamDetails=l.isStreamValid(this.attendeeMeeting.stream)?this.attendeeMeeting.stream:this.attendeeMeeting.altStream,this.loadSdnPlugin().then(function(){e.sdnPluginLoaded=!0,e.handlePlayerTransitions()}).catch(function(t){e.logger.error("sdn plugin configured but script could not be downloaded: "+t),e.sdnPluginLoaded=!1,e.handlePlayerTransitions()})},e.prototype.loadSdnPlugin=function(){var e=this;return new Promise(function(t,a){if(!e.sdnPluginLoaded&&e.isSdnInfoValid()){var s=e.loggingService.newScenario(e.constants.scenarios.broadcast.attendee.loadSdnPluginScript);e.logger.info("loading sdn plugin for "+e.selectedStreamDetails.sdnName+", url: "+e.selectedStreamDetails.sdnPluginUrl),e.utilityService.addScript(e.selectedStreamDetails.sdnPluginUrl).then(function(){var a;s.stop((a={},a[e.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({url:e.selectedStreamDetails.sdnPluginUrl}),a)),e.logger.info("sdn plugin script loaded successfully"),t()}).catch(function(t){var i;e.exceptionUtilityService.failScenarioIfOnline(s,(i={},i[e.constants.scenarioDataPropNames.broadcastError]=t,i[e.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({url:e.selectedStreamDetails.sdnPluginUrl}),i)),a(t)})}else t()})},e.prototype.handlePlayerTransitions=function(){var e=teamspace.services.MeetingState[this.attendeeMeeting.meetingStatus],t=this.broadcastPlaybackService.getActiveBroadcastPlayback();if(!l.isStreamValid(this.selectedStreamDetails))return e===teamspace.services.MeetingState.Stopped?this.curtainMessageText=this.$translate.instant(this.resources.strings.broadcast_vod_stream_retrieval_message_text):e===teamspace.services.MeetingState.Live?this.curtainMessageText=this.$translate.instant(this.resources.strings.broadcast_live_stream_retrieval_message_text):(this.curtainMessageText=t.type===teamspace.services.BroadcastPlaybackType.Overflow?this.$translate.instant(this.resources.strings.broadcast_preMeeting_overflow_curtain_message_text):this.$translate.instant(this.resources.strings.broadcast_preMeeting_curtain_message_text),this.eventingService.$emit(this.constants.events.broadcast.playerTransitionComplete,this.constants.events.broadcast.curtainPreMeeting)),this.ariaLiveService.update(this.curtainMessageText,!0),this.showCurtain=!0,void(this.showPlayer=!1);this.showCurtain=!1,this.showPlayer=!0;var a=document.getElementById(d.defaultPlayerId);(this.loadSucceeded||a)&&this.videoSourceUrl!==this.selectedStreamDetails.wamsStreamingUrl?(this.setPlayerSource(this.selectedStreamDetails.wamsStreamingUrl,this.selectedStreamDetails.decryptionToken),this.isLastPlayerUrlSetBySwitching=!1):this.loadSucceeded&&this.playerInstance&&this.playerInstance.currentTime()>0&&this.eventingService.$emit(this.constants.events.broadcast.playerTransitionComplete,this.constants.events.broadcast.playbackStarted)},e.prototype.loadPlayer=function(){var e=this,t=[],a=this.broadcastPlaybackService.getActiveBroadcastPlayback();this.isVerboseMode?t.push({target:"memory",maxMemoryTraceCount:this.maxMemoryTraceLogCount}):t.push({target:"console"});var s={TraceTargets:t,maxLogLevel:this.isVerboseMode?3:2},i={techOrder:[d.techOrderTypes.azureHtml5JS,d.techOrderTypes.flashSS,d.techOrderTypes.html5],nativeControlsForTouch:!1,autoplay:!0,preload:"auto",controls:a.type!==teamspace.services.BroadcastPlaybackType.Overflow,logo:{enabled:!1},height:"100%",width:"100%",traceConfig:s,staleDataTimeLimitInSec:this.appConfig.broadcastSettings.attendee.staleDataTimeLimitInSec,heuristicProfile:amp.Player.HeuristicProfile.HighQuality,customPlayerSettings:{customHeuristicSettings:{bandwidthTestWithTimeThresholdDuringLive:!1,windowSizeHeuristics:this.settingsService.valueAsBoolean(d.customHeuristicSettings.useBrowserWindowSizeForBitRateForAmp),useBrowserWindowForWindowSizeRule:this.settingsService.valueAsBoolean(d.customHeuristicSettings.useBrowserWindowSizeForBitRateForAmp),useVariableFragmentSizeMode:!0}},plugins:{}};this.initializePluginOptions(i);try{if(this.playerInstance=amp(d.defaultPlayerId,i),!this.playerInstance)return this.notifyPlayerState("playerLoadFailed","player instance is null"),!1}catch(e){return this.notifyPlayerState("playerLoadFailed",JSON.stringify(e)),!1}this.brbV2AmpLogProvider.getLogsCallback=this.flushInMemoryAmpLogs;var r=this.hasCaptions();return this.logger.info("loadPlayer: Load the captions plugin ["+r+"]"),r&&this.loadCaptionsPlugin(a),this.ampDiagLogger=new n.AmpDiagnosticLogger(this.$interval,this.appConfig,this.appStateService,this.constants,this.loggingService,this.playerInstance,this.attendeeMeeting,r,this.captionsPlugin,this.analyticsService,this.$rootScope,this.exceptionUtilityService,this.settingsService),this.playerInstance.addEventListener(amp.eventName.canplaythrough,function(){e.broadcastPlaybackService.logAmsTelemetryData(teamspace.services.AttendeeTelemetryEvent.playThrough,e.attendeeMeeting.meetingStatus)}),this.playerInstance.addEventListener(amp.eventName.error,function(){e.handlePlaybackError()}),this.playerInstance.addEventListener(amp.eventName.fullscreen,function(){e.broadcastPlaybackService.logAmsTelemetryData(teamspace.services.AttendeeTelemetryEvent.fullScreen,e.attendeeMeeting.meetingStatus)}),this.playerInstance.addEventListener(amp.eventName.pause,function(){e.broadcastPlaybackService.logAmsTelemetryData(teamspace.services.AttendeeTelemetryEvent.pause,e.attendeeMeeting.meetingStatus)}),this.playerInstance.addEventListener(amp.eventName.resume,function(){e.broadcastPlaybackService.logAmsTelemetryData(teamspace.services.AttendeeTelemetryEvent.resume,e.attendeeMeeting.meetingStatus)}),this.playerInstance.addEventListener(amp.eventName.play,function(){(e.retryCount>0||e.lastKnownPlayTime)&&(e.logger.info("Playing after retry count "+e.retryCount+", userRetryCount: "+e.userRetryCount+", Setting current time to "+e.lastKnownPlayTime),e.playerInstance.currentTime(e.lastKnownPlayTime),e.retryCount=0,e.lastKnownPlayTime=void 0)}),this.playerInstance.addEventListener(amp.eventName.start,function(){e.logger.info("Playback started, retry count: "+e.retryCount),e.eventingService.$emit(e.constants.events.broadcast.playerTransitionComplete,e.constants.events.broadcast.playbackStarted),e.playbackStartedScenario&&e.playbackStartedScenario.stop({message:"Playback started, retry count: "+e.retryCount+", userRetryCount: "+e.userRetryCount+","}),e.playbackStartedScenario=null,e.switchStreamingUrlScenario&&(e.isLastPlayerUrlSetBySwitching=!0,e.switchStreamingUrlScenario.stop({message:"Playback started, switch count: "+e.streamingUrlSwitchCount}),e.switchStreamingUrlScenario=null)}),this.playerInstance.addEventListener(amp.eventName.ended,function(){a.type===teamspace.services.BroadcastPlaybackType.Overflow&&e.showOverflowRoomEndedCurtain(),e.$rootScope.$emit(e.constants.events.broadcast.playbackNotLive)}),this.playerInstance.addEventListener(amp.eventName.fullscreenchange,function(){e.updateCaptionsVisibility()}),l.isStreamValid(this.selectedStreamDetails)?(this.loadSucceeded=this.setPlayerSource(this.selectedStreamDetails.wamsStreamingUrl,this.selectedStreamDetails.decryptionToken),this.logger.info("loadPlayer succeeded: "+this.loadSucceeded)):this.loadSucceeded=!1,this.loadSucceeded},e.prototype.loadCaptionsPlugin=function(e){var t=this,a=this.loggingService.newScenario(this.constants.scenarios.broadcast.attendee.loadCaptionsPlugin);try{var s=this.broadcastPlaybackService.getActiveBroadcastPlayback(),i=s&&s.attendeeMeeting,n=function(e,a,i){a*=1e3,s.wereCaptionsEnabled=!0,t.broadcastPlaybackService.subscribeToCaptions(e,a,i)},l=function(e){t.broadcastPlaybackService.unsubscribeToCaptions(e)},d=new o.CaptionsLogger(i,this.$interval,this.appConfig,this.constants,this.loggingService,this.utilityService);if(this.settingsService.valueAsBoolean(this.constants.settings.names.enableRetrieveBroadcastCaptionsFromCDN)){var p=e.type===teamspace.services.BroadcastPlaybackType.Overflow?function(){return t.playerInstance.currentMediaTime()}:function(){return t.playerInstance.currentTime()};this.captionsRetriever=new r.BroadcastCaptionsRetriever(this.$http,this.appConfig,i,p,this.loggingService,this.constants,this.utilityService,this.$timeout,d,this.platformDetectService,this.broadcastPlaybackService,this.eventingService,this.$rootScope,this.consumePartials),n=function(e,a,i){s.wereCaptionsEnabled=!0,t.captionsRetriever.start(e,a,i)},l=function(e){t.captionsRetriever.stop()}}this.captionsPlugin=new c.BroadcastCaptionsPlugin(this.playerInstance,n,l,this.loggingService,d,this.appConfig,e.type===teamspace.services.BroadcastPlaybackType.Overflow),this.captionsPlugin.load(),a.stop(),this.updateCaptionsVisibility()}catch(e){this.logger.error("loadPlayer: The captions plugin couldn't be loaded. Error ["+e+"]"),this.handleScenarioFailure(a,JSON.stringify(e))}},e.prototype.handlePlaybackError=function(){var e=this,t=this.playerInstance.error();if(!t||!t.code)return this.logger.error("onError: error details are not available"),this.handleScenarioFailure(this.playbackStartedScenario,t&&t.message),void this.ampDiagLogger.handlePlayerError(!1);if(this.desktopUtilityService.isDesktop()||(t.code&amp.errorCode.srcErrUnsupportedPresentation)!==amp.errorCode.srcErrUnsupportedPresentation){var a=!1;(t.code&amp.errorCode.srcPlayerMismatchFlashNotInstalled)===amp.errorCode.srcPlayerMismatchFlashNotInstalled&&(a=!0),this.broadcastPlaybackService.getActiveBroadcastPlayback().hadError=!0;var s=this.playerInstance.currentTechName()&&this.playerInstance.currentTechName().toLowerCase()===d.techOrderTypes.html5,i=this.platformDetectService.getOS();if((a||s)&&i!==this.constants.os.ios)this.ampDiagLogger.handlePlayerError(!0),this.playbackStartedScenario&&this.playbackStartedScenario.mark("flash not installed"),this.destroy(),this.curtainMessageText=this.$translate.instant(this.resources.strings.broadcast_flash_not_installed_message_text),this.showCurtain=!0,this.isPlaybackUnsupported=!0,this.ariaLiveService.update(this.curtainMessageText,!0);else{var n=t.code,r=(268435455&n).toString(16).toLowerCase();this.logger.error("onError: errorCode: "+n+", errorCodeExcludingTech: "+r+", message: "+t.message),this.retryCount<this.maxRetryCount&&-1!==_.indexOf(p,r)?this.sourceRetryTimeout=this.$timeout(function(){var t={};t[e.constants.counters.eventNames.retryCount]=e.retryCount,e.loggingService.event(e.constants.events.broadcast.attendeePlaybackRetried,t),e.logger.info("Retry loading stream because of error code: "+n.toString(16)),e.retryCount++,e.ampDiagLogger.handlePlayerRetry(e.retryCount,e.userRetryCount),e.setPlayerSource(e.videoSourceUrl,e.decryptionToken),e.sourceRetryTimeout=void 0},this.sourceResetTimeoutInMs):(this.handleScenarioFailure(this.switchStreamingUrlScenario,t&&t.message),this.isLastPlayerUrlSetBySwitching=!1,_.isEqual(this.lastAmpError,t)||this.switchStreamingUrl(r,t)||(this.handleScenarioFailure(this.playbackStartedScenario,"errorCode: "+n+", errorCodeExcludingTech: "+r+", message: "+t.message),this.ampDiagLogger.handlePlayerError(!1),this.showUserRetryCurtain("200259"===r||t.message&&t.message.includes("200259"))))}}else this.handleUnsupportedPlayback()},e.prototype.hasAttendeeSwitchedToSameUrl=function(){return this.isLastPlayerUrlSetBySwitching&&this.streamingUrlSwitchCount>0&&this.videoSourceUrl===this.selectedStreamDetails.wamsStreamingUrl},e.prototype.switchStreamingUrl=function(e,t){var a=this,s=this.settingsService.valueFor(d.ampErrorCodesEligibleForStreamingUrlSwitch);if(this.streamingUrlSwitchCount>=d.streamingUrlSwitchMaxCount||!_.includes(s,e))return!1;this.switchStreamingUrlScenario=this.loggingService.newScenario(this.constants.scenarios.broadcast.attendee.switchStreamingUrl),this.switchStreamingUrlScenario.cancelIfOffline=!0,this.switchStreamingUrlScenario.eventData=this.getScenarioData();var i=this.videoSourceUrl===(this.attendeeMeeting.stream&&this.attendeeMeeting.stream.wamsStreamingUrl);if(!i&&!l.isStreamValid(this.attendeeMeeting.stream))return this.handleScenarioFailure(this.switchStreamingUrlScenario,this.attendeeMeeting.stream&&this.attendeeMeeting.stream.wamsStreamingUrl?"primary decryptionToken is null":"primary wamsStreamingUrl is null"),!1;if(i&&!l.isStreamValid(this.attendeeMeeting.altStream))return this.handleScenarioFailure(this.switchStreamingUrlScenario,this.attendeeMeeting.altStream&&this.attendeeMeeting.altStream.wamsStreamingUrl?"alternate decryptionToken is null":"alternate wamsStreamingUrl is null"),!1;this.selectedStreamDetails=i?this.attendeeMeeting.altStream:this.attendeeMeeting.stream;var n=this.setPlayerSource(this.selectedStreamDetails.wamsStreamingUrl,this.selectedStreamDetails.decryptionToken);return this.switchStreamingUrlScenario.eventData[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({switchCount:++this.streamingUrlSwitchCount,currentUrl:this.selectedStreamDetails.wamsStreamingUrl,isSwitchedToPrimary:!i}),n?(this.lastAmpError=t,this.lastAmpErrorTimeout=this.$timeout(function(){a.lastAmpError=void 0,a.lastAmpErrorTimeout=void 0},this.errorDetailsResetInMs),this.switchStreamingUrlCallback&&this.switchStreamingUrlCallback(this.videoSourceUrl),!0):(this.handleScenarioFailure(this.switchStreamingUrlScenario,"setPlayerSource failed"),!1)},e.prototype.getScenarioData=function(e){var t=e?s({},e):{},a={};return a[this.constants.categories.requestId]=this.attendeeMeeting.signalR&&this.attendeeMeeting.signalR.querystrings&&this.attendeeMeeting.signalR.querystrings.joinid,a[this.constants.counters.eventNames.correlationId]=this.attendeeMeeting.correlationId,a[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(t),a},e.prototype.handleUnsupportedPlayback=function(){var e=this;this.isPlaybackUnsupported=!0,this.ampDiagLogger.handlePlayerError(!0),this.playbackStartedScenario&&this.playbackStartedScenario.mark("unSupportedPlayback"),this.destroy();var t=this.desktopHandlingService.getIsAppInstalled(),a={okButtonText:this.$translate.instant(t?this.resources.strings.calling_unsupported_open_text:this.resources.strings.calling_unsupported_ok_text),closeButtonText:this.$translate.instant(this.resources.strings.desktopapp_close_button_text),confirmMessageTitle:this.$translate.instant(this.resources.strings.broadcast_attendee_join_unsupported_title),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.broadcast_attendee_join_unsupported_body),callback:function(){return t?e.desktopHandlingService.openApp():e.downloadAppService.download()},postCloseCallback:this.leaveBroadcastCallback};this.dialogService.open(this.constants.dialogs.confirmDialogWithActionlink,a)},e.prototype.handleScenarioFailure=function(e,t){var a;e&&this.exceptionUtilityService.failScenarioIfOnline(e,(a={},a[this.constants.scenarioDataPropNames.broadcastError]=t,a))},e.prototype.initializePluginOptions=function(e){if(this.sdnPluginLoaded&&this.isSdnInfoValid())switch(this.selectedStreamDetails.sdnName){case d.sdnNames.sdnHiveName:return void(e.plugins={hive:{debugLevel:this.isVerboseMode?"debug":"notice",telemetryId:this.attendeeMeeting.correlationId}});case d.sdnNames.sdnKollectiveName:return void(e.plugins={kollectiveSDN:{playbackInfo:JSON.parse(this.selectedStreamDetails.sdnPlaybackInfo),reportSessionId:this.attendeeMeeting.correlationId}})}},e.prototype.showUserRetryCurtain=function(e){void 0===e&&(e=!1),this.lastKnownPlayTime=this.playerInstance.currentTime()||this.lastKnownPlayTime,this.userRetryCurtainText=this.$translate.instant(e?this.resources.strings.broadcast_curtain_fail_network_retry:this.resources.strings.broadcast_curtain_fail_retry),this.userRetryCurtainTitle=this.$translate.instant(e?this.resources.strings.broadcast_curtain_network_error_title:this.resources.strings.broadcast_curtain_fail_title),this.showCurtain=!1,this.isUserRetryCurtainShowing=!0,this.destroy()},e.prototype.showOverflowRoomEndedCurtain=function(){this.curtainMessageText=this.$translate.instant(this.resources.strings.broadcast_overflow_postMeeting_message),this.showCurtain=!0,this.destroy()},e.prototype.userRetry=function(){this.retryCount=0,this.isUserRetryCurtainShowing=!1,this.showPlayer=!0,this.logger.info("User attempted to reload the player. userRetryCount: "+ ++this.userRetryCount)},e.prototype.setPlayerSource=function(e,t){if(!this.playerInstance)return this.logger.error("setPlayerSource: playerInstance is null"),this.notifyPlayerState("setPlayerSourceFailed","playerInstance is null"),!1;this.logger.info("setPlayerSource: AMP source set to: ["+e+"]");var a={src:e,type:this.videoSourceType,protectionInfo:[{}],sdnList:[{}]};if(a.protectionInfo=t?[{type:"AES",authenticationToken:t}]:null,this.sdnPluginLoaded&&this.isSdnInfoValid()){var s=this.selectedStreamDetails.sdnName;switch(this.logger.info("setPlayerSource: Adding SDN ["+s+"]"),s){case d.sdnNames.sdnHiveName:a.sdnList=[{sdnName:"hive",sdnUrl:this.selectedStreamDetails.sdnPlaybackInfo}];break;case d.sdnNames.sdnKollectiveName:a.sdnList=[{sdnName:"kollectiveSDN",playbackInfo:JSON.parse(this.selectedStreamDetails.sdnPlaybackInfo)}]}}var i=this.playerInstance.currentTime();i>0&&(this.lastKnownPlayTime=i);try{return this.logger.info("setPlayerSource: src changed"),this.videoSourceUrl=e,this.decryptionToken=t,this.playerInstance.src([a],this.textTracks),this.notifyPlayerState("setPlayerSourceSucceeded",null),this.playbackStartedScenario=this.playbackStartedScenario||this.loggingService.newScenario(d.playbackStartedScenario),this.playbackStartedScenario.cancelIfOffline=!0,this.playbackStartedScenario.eventData=this.getScenarioData(),!0}catch(e){var n=JSON.stringify(e);return this.logger.error("setPlayerSource: failed with error ["+n+"]"),this.notifyPlayerState("setPlayerSourceFailed",n),!1}},Object.defineProperty(e.prototype,"textTracks",{get:function(){return this._textTracks||(this._textTracks=this.createCaptionsTextTracks()),this._textTracks},enumerable:!0,configurable:!0}),e.prototype.createCaptionsTextTracks=function(){var e=[];if(!this.hasCaptions())return e;try{var t=this.settingsService.valueFor("translationLanguages"),a=this.attendeeMeeting.transcription.transcriptionLanguage;try{e.push(this.getTextTrack(a,t))}catch(e){this.logger.error("Failed to add caption spoken language. Error: "+e)}for(var s=0,i=this.attendeeMeeting.transcription.translationLanguages.filter(function(e){return!!e});s<i.length;s++){var n=i[s];try{e.push(this.getTextTrack(n,t))}catch(e){this.logger.error("Failed to add caption translation language. Error: "+e)}}this.logger.info("setPlayerSource: Text tracks for captions to be set in the player ["+e.map(function(e){return e.srclang}).join(",")+"]")}catch(e){this.logger.error("Failed to initialize text tracks: "+e)}return e},e.prototype.getTextTrack=function(e,t){var a=_.find(t,function(t){return t.BCP47Code===e||t.code===e});return{id:d.defaultPlayerId+"_"+e,kind:d.textTrackKind,label:a&&a.nativeName||e,src:"",srclang:e.substr(0,2)}},e.prototype.hasCaptions=function(){return this.attendeeMeeting&&this.attendeeMeeting.transcription&&this.attendeeMeeting.transcription.isEnabled},e.prototype.notifyPlayerState=function(e,t){this.$rootScope.$emit(this.constants.events.broadcast.playerStateNotification,{playerState:e,error:t,isPlaybackError:!1})},e.prototype.notifyPlaybackStart=function(){this.loadSucceeded&&this.playerInstance&&this.playerInstance.currentTime()>0&&this.eventingService.$emit(this.constants.events.broadcast.playerTransitionComplete,this.constants.events.broadcast.playbackStarted)},e}();t.AzureMediaPlayerController=g,angular.module("teamspace.azureMediaPlayer",["teamspace.appState","teamspace.ariaLiveService","teamspace.brbV2AmpLogProvider","teamspace.broadcastPlaybackService","teamspace.config","teamspace.constants","teamspace.loggingService","teamspace.platformDetectService","teamspace.settingsService","teamspace.utilityService","teamspace.eventingService","teamspace.exceptionUtilityService"]).component("azureMediaPlayer",{bindings:{attendeeMeeting:"<",leaveBroadcastCallback:"&",isDocked:"<"},controllerAs:"ctrl",controller:g,templateUrl:"components/broadcast/attendee/azure-media-player/azure-media-player.html"}).run(["$templateCache",function(e){e.put("components/broadcast/attendee/azure-media-player/azure-media-player.html",i)}])},2056:function(e,t){e.exports='<div class="azure-media-player-container">\n  <div ng-if="ctrl.showCurtain" data-tid="attendee-curtain" class="azure-media-player-curtain">\n    <div class="curtain-text" ng-bind-html="ctrl.curtainMessageText" data-tid="azure-media-player-curtain">\n    </div>\n  </div>\n  <div ng-if="ctrl.isUserRetryCurtainShowing" class="azure-media-player-curtain error-curtain">\n    <div class="curtain-text">\n      <div ng-bind-html="ctrl.userRetryCurtainTitle"></div>\n      <div ng-bind-html="ctrl.userRetryCurtainText"></div>\n    </div>\n    <button class="ts-btn ts-btn-primary azure-media-player-retry-btn" ng-click="ctrl.userRetry()" translate-once="{{::$root.resources.strings.broadcast_playback_retry}}">\n    </button>\n  </div>\n  <div class="azure-media-player-media-playback-area" ng-class="{\'captions-partials\': ctrl.consumePartials}" ng-if="ctrl.showPlayer" style="flex-direction: column;">\n    <video id="teamsDefaultPlayer" ng-init="ctrl.loadPlayer()" class="azuremediaplayer amp-stream-skin amp-big-play-centered" tabindex="0">\n    </video>\n    <div class="captions-buffer" aria-hidden="true">\n    </div>\n  </div>\n</div>'},2057:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScenarioMarkers={AudioDownloadFailure:"AudioDownloadFailure",Buffering:"Buffering",Error:"Error",Retry:"Retry",LoadedMetadata:"LoadedMetadata",Pause:"Pause",PlayComplete:"PlayComplete",PlayStarted:"PlayStarted",RapidSeeking:"RapidSeeking",Ready:"Ready",Tick:"Tick",VideoDownloadFailure:"VideoDownloadFailure",potentialMediaFreeze:"potentialMediaFreeze"},t.PlayerStates={LoadedMetadata:"LoadedMetadata",Ready:"Ready",Play:"Play",Playing:"Playing",Paused:"Paused",Buffering:"Buffering",Seeking:"Seeking",Ended:"Ended",Error:"Error"};var s=6e4,i=function(){function e(e,a,i,n,r,o,c,l,d,p,g,u,h){var m=this;this.$interval=e,this.appConfig=a,this.appStateService=i,this.constants=n,this.playerInstance=o,this.hasCaptionsEnabled=l,this.captionsPlugin=d,this.analyticsService=p,this.$rootScope=g,this.exceptionUtilityService=u,this.consecutiveSeekCount=0,this.videoDownloadLatencies=[],this.audioDownloadLatencies=[],this.audioDownloadBytes=[],this.videoDownloadBytes=[],this.videoDownloadSuccessCount=0,this.audioDownloadSuccessCount=0,this.videoDownloadFailureCount=0,this.audioDownloadFailureCount=0,this.audioDownloadFailureCountFromLastTick=0,this.videoDownloadFailureCountFromLastTick=0,this.audioDownloadSuccessCountFromLastTick=0,this.videoDownloadSuccessCountFromLastTick=0,this.tickInterval=this.appConfig.broadcastSettings.attendee.perfSampleIntervalInMs||s,this.slidingWindowLengthForLatency=5,this.slidingWindowLengthForDownloadBytes=this.tickInterval/(2*this.constants.timeInMiliseconds.second),this.logger=r.newLogger("AmpDiagnosticLogger"),this.onVideoDownloadCompleted=this.onVideoDownloadCompleted.bind(this),this.onVideoDownloadError=this.onVideoDownloadError.bind(this),this.onAudioDownloadCompleted=this.onAudioDownloadCompleted.bind(this),this.onAudioDownloadError=this.onAudioDownloadError.bind(this),this.useScenarioLiveEventsAriaTable=h.valueAsBoolean(n.settings.names.enableCustomAriaTableForLiveEventsTelemetry),this.useScenarioLiveEventsAriaTable?this.scenario=r.newScenario(n.scenarios.broadcast.attendee.diagnostic,null,null,n.timeInMiliseconds.day,!0,void 0,void 0,teamspace.services.ScenarioKind.ScenarioLiveEvents):this.scenario=r.newScenario(n.scenarios.broadcast.attendee.diagnostic,null,null,n.timeInMiliseconds.day,!0),this.scenario.eventData[n.counters.eventNames.correlationId]=c.correlationId,this.scenario.eventData[n.counters.eventNames.callId]=c.callId,c&&c.signalR&&c.signalR.querystrings&&(this.scenario.eventData[n.categories.requestId]=c.signalR.querystrings.joinid),this.playbackTimerStart(),o.addEventListener(amp.eventName.canplaythrough,function(){m.playerState=t.PlayerStates.Ready,m.playerVideoBuffer=o.videoBufferData(),m.playerAudioBuffer=o.audioBufferData(),m.playerVideoBuffer&&(m.playerVideoBuffer.addEventListener(amp.bufferDataEventName.downloadcompleted,m.onVideoDownloadCompleted),m.playerVideoBuffer.addEventListener(amp.bufferDataEventName.downloadfailed,m.onVideoDownloadError)),m.playerAudioBuffer&&(m.playerAudioBuffer.addEventListener(amp.bufferDataEventName.downloadcompleted,m.onAudioDownloadCompleted),m.playerAudioBuffer.addEventListener(amp.bufferDataEventName.downloadfailed,m.onAudioDownloadError)),m.onPlaybackStateChanged(amp.eventName.canplaythrough)}),o.addEventListener(amp.eventName.loadedmetadata,function(){m.playerState=t.PlayerStates.LoadedMetadata,m.onPlaybackStateChanged(amp.eventName.loadedmetadata)}),o.addEventListener(amp.eventName.ended,function(){m.playerState=t.PlayerStates.Ended,m.onPlaybackStateChanged(amp.eventName.ended)}),o.addEventListener(amp.eventName.waiting,function(){m.playerState!==t.PlayerStates.Buffering&&(m.isVideoBuffering=!0,m.bufferingStartTime=(new Date).getTime()),m.playerState=t.PlayerStates.Buffering,m.onPlaybackStateChanged(amp.eventName.waiting)}),o.addEventListener(amp.eventName.pause,function(){m.playerState=t.PlayerStates.Paused,m.onPlaybackStateChanged(amp.eventName.pause)}),o.addEventListener(amp.eventName.play,function(){m.playerState=t.PlayerStates.Play,m.onPlaybackStateChanged(amp.eventName.play)}),o.addEventListener(amp.eventName.playing,function(){if(m.playerState=t.PlayerStates.Playing,!m.hasPlayerPlayed){var e=m.getPlayerEventData();m.scenario.mark(t.ScenarioMarkers.PlayStarted,e)}m.hasPlayerPlayed=!0,m.onPlaybackStateChanged(amp.eventName.playing),m.playbackScenarioMessage=null}),o.addEventListener(amp.eventName.seeking,function(){m.playerState=t.PlayerStates.Seeking,0===m.consecutiveSeekCount&&(m.seekStartTime=(new Date).getTime()),m.onPlaybackStateChanged(amp.eventName.seeking)}),o.addEventListener(amp.eventName.seeked,function(){m.onPlaybackStateChanged(amp.eventName.seeked)}),o.addEventListener(amp.eventName.playbackbitratechanged,function(){m.onDownloadBitrateChanged()}),o.addEventListener("potentialMediaFreeze",function(){m.logger.warn("Player detected a potential media freeze");var e=m.getPlayerEventData();m.scenario.mark(t.ScenarioMarkers.potentialMediaFreeze,e)})}return e.prototype.handlePlayerRetry=function(e,a){if(this.scenario){var s=this.getPlayerErrorEventData()||{};s.retryCount=e,s.userReloadCount=a,this.scenario.mark(t.ScenarioMarkers.Retry,s)}},e.prototype.handlePlayerError=function(e){this.playerState=t.PlayerStates.Error;var a=this.getPlayerErrorEventData();this.$rootScope.$emit(this.constants.events.broadcast.playerStateNotification,{playerState:"playerError",error:JSON.stringify(a),isPlaybackError:!0});var s=!this.appStateService.isOnline||!this.appStateService.isConnected;if(s?this.playbackScenarioMessage="App offline":this.appStateService.machineState===teamspace.services.MachineState.MachineLocked&&(this.playbackScenarioMessage="Machine Locked"),this.scenario){var i=this.getPlayerEventData();i[this.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(a),i[this.constants.scenarioDataPropNames.errorCode]=a.errorCode,i[this.constants.counters.eventNames.reason]=a.errorCode,i.message=this.playbackScenarioMessage,s||e?this.scenario.cancel(i):this.exceptionUtilityService.failScenarioIfOnline(this.scenario,i),this.scenario=null,this.dispose()}else this.logger.error("handlePlayerError: player hit the error: "+JSON.stringify(a)+". message="+this.playbackScenarioMessage)},e.prototype.dispose=function(){if(this.playbackTimerStop(),this.scenario){var e=this.getPlayerEventData();e.message=this.playbackScenarioMessage,this.scenario.stop(e)}this.disposePlayer()},e.prototype.disposePlayer=function(){this.playerVideoBuffer=null,this.playerAudioBuffer=null,this.playerInstance&&(this.playerInstance.removeEventListener(amp.eventName.canplaythrough),this.playerInstance.removeEventListener(amp.eventName.loadedmetadata),this.playerInstance.removeEventListener(amp.eventName.ended),this.playerInstance.removeEventListener(amp.eventName.waiting),this.playerInstance.removeEventListener(amp.eventName.pause),this.playerInstance.removeEventListener(amp.eventName.play),this.playerInstance.removeEventListener(amp.eventName.playing),this.playerInstance.removeEventListener(amp.eventName.seeking),this.playerInstance.removeEventListener(amp.eventName.seeked),this.playerInstance.removeEventListener(amp.eventName.playbackbitratechanged),this.playerInstance.removeEventListener("potentialMediaFreeze"),this.playerInstance=null)},e.prototype.onPlaybackStateChanged=function(e){if(this.hasPlayerPlayed&&this.isVideoBuffering&&e!==amp.eventName.waiting&&e!==amp.eventName.pause){this.isVideoBuffering=!1;s=this.getPlayerEventData((new Date).getTime()-this.bufferingStartTime);this.scenario.mark(t.ScenarioMarkers.Buffering,s)}if(e===amp.eventName.seeking||e===amp.eventName.seeked){if(this.consecutiveSeekCount>=6){this.consecutiveSeekCount=0;s=this.getPlayerEventData((new Date).getTime()-this.seekStartTime);return void this.scenario.mark(t.ScenarioMarkers.RapidSeeking,s)}this.consecutiveSeekCount++}else this.consecutiveSeekCount=0;var a=this.getScenarioMarkerForEvent(e);if(a){var s=this.getPlayerEventData();this.scenario.mark(a,s)}e===amp.eventName.pause||e===amp.eventName.ended?(this.playbackTimerStop(),this.scenario.pause({reason:"playback is: "+this.playerState})):(e===amp.eventName.play&&this.scenario.resume(),this.playbackTimerStart())},e.prototype.onDownloadBitrateChanged=function(){this.previousDownloadBitRate=this.currentDownloadBitRate,this.currentDownloadBitRate=this.playerInstance.currentDownloadBitrate(),this.playbackPerfMarkTick()},e.prototype.getScenarioMarkerForEvent=function(e){switch(e){case amp.eventName.ended:return t.ScenarioMarkers.PlayComplete;case amp.eventName.loadedmetadata:return t.ScenarioMarkers.LoadedMetadata;case amp.eventName.canplaythrough:return t.ScenarioMarkers.Ready;case amp.eventName.pause:return t.ScenarioMarkers.Pause}return null},e.prototype.playbackTimerStart=function(){var e=this;this.playbackTimer||(this.playbackTimer=this.$interval(function(){e.playbackPerfMarkTick(),!e.isPlaybackSwitchedToDVR&&e.playerInstance&&e.checkBroadcastLiveStatus()},this.tickInterval,0,!1))},e.prototype.checkBroadcastLiveStatus=function(){this.playerInstance.isLive()||(this.isPlaybackSwitchedToDVR=!0,this.$rootScope.$emit(this.constants.events.broadcast.playbackNotLive))},e.prototype.playbackTimerStop=function(){this.playbackTimer&&(this.$interval.cancel(this.playbackTimer),delete this.playbackTimer)},e.prototype.playbackPerfMarkTick=function(){var e=(new Date).getTime(),a=e-this.lastTickLogTime;this.lastTickLogTime=e;var s=this.getPlayerEventData(a);this.scenario.mark(t.ScenarioMarkers.Tick,s),this.previousDownloadBitRate=this.currentDownloadBitRate,this.videoDownloadFailureCountFromLastTick=0,this.videoDownloadSuccessCountFromLastTick=0,this.audioDownloadFailureCountFromLastTick=0,this.audioDownloadSuccessCountFromLastTick=0,this.videoDownloadBytes=[],this.audioDownloadBytes=[],this.videoDownloadLatencies=[],this.audioDownloadLatencies=[]},e.prototype.getPlayerEventData=function(e){var t;if(!this.playerInstance)return{};var a=this.analyticsService.getWindowSize(),s={playerData:{playerState:this.playerState,currentPlayPosition:this.playerInstance.currentTime(),livePosition:this.playerInstance.duration(),playbackBitrate:this.playerInstance.currentPlaybackBitrate(),downloadBitrate:this.currentDownloadBitRate||this.playerInstance.currentDownloadBitrate(),previousDownloadBitrate:this.previousDownloadBitRate,perceivedBandwidth:this.playerVideoBuffer?this.playerVideoBuffer.perceivedBandwidth:0,streamType:this.playerInstance.isLive()?"LIVE":"DVR",tech:this.playerInstance.currentTechName(),eventDurationMs:e,playerVersion:this.playerInstance.getAmpVersion(),isP2PSdnUsed:this.isP2PSdnUsed(),audioBufferLength:this.playerAudioBuffer?this.playerAudioBuffer.bufferLevel:0,videoBufferLength:this.playerVideoBuffer?this.playerVideoBuffer.bufferLevel:0,mediaHeight:this.playerInstance.videoHeight(),mediaWidth:this.playerInstance.videoWidth(),playerHeight:this.playerInstance.height(),playerWidth:this.playerInstance.width(),windowWidth:a?a.width:0,windowHeight:a?a.height:0,isFullscreen:this.playerInstance.isFullscreen(),avgAudioDownloadLatency:_.mean(this.audioDownloadLatencies),avgVideoDownloadLatency:_.mean(this.videoDownloadLatencies),avgAudioDownloadBytes:_.mean(this.audioDownloadBytes),avgVideoDownloadBytes:_.mean(this.videoDownloadBytes),maxVideoDownloadBytes:_.max(this.videoDownloadBytes),minVideoDownloadBytes:_.min(this.videoDownloadBytes),audioDownloadFailureCount:this.audioDownloadFailureCount,audioDownloadSuccessCount:this.audioDownloadSuccessCount,videoDownloadFailureCount:this.videoDownloadFailureCount,videoDownloadSuccessCount:this.videoDownloadSuccessCount,audioDownloadFailureCountFromLastTick:this.audioDownloadFailureCountFromLastTick,audioDownloadSuccessCountFromLastTick:this.audioDownloadSuccessCountFromLastTick,videoDownloadFailureCountFromLastTick:this.videoDownloadFailureCountFromLastTick,videoDownloadSuccessCountFromLastTick:this.videoDownloadSuccessCountFromLastTick,hasCaptionsEnabled:this.hasCaptionsEnabled,captionsLanguage:this.getCaptionsLanguage(),availableCaptionLanguages:this.getAvailableCaptionLanguages()}};return t={},t[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(s),t},e.prototype.getCaptionsLanguage=function(){return this.captionsPlugin&&this.captionsPlugin.getSelectedCaptionsLanguage()||""},e.prototype.getAvailableCaptionLanguages=function(){var e=this.captionsPlugin&&this.captionsPlugin.getAvailableLanguages();return e&&e.length||0},e.prototype.isP2PSdnUsed=function(){return!!(this.playerInstance.options_&&this.playerInstance.options_.sdn&&this.playerInstance.options_.sdn.name)},e.prototype.getPlayerErrorEventData=function(){if(!this.playerInstance)return null;var e=this.playerInstance.error();return{errorCode:e&&e.code&&e.code.toString(16),message:e&&e.message,tech:this.playerInstance.currentTechName(),mseSupported:!!window.MediaSource,playerVersion:this.playerInstance.getAmpVersion()}},e.prototype.onVideoDownloadCompleted=function(){this.videoDownloadSuccessCount++,this.videoDownloadSuccessCountFromLastTick++,this.videoDownloadLatencies.length>=this.slidingWindowLengthForLatency&&this.videoDownloadLatencies.shift(),this.videoDownloadBytes.length>=this.slidingWindowLengthForDownloadBytes&&this.videoDownloadBytes.shift(),this.videoDownloadLatencies.push(this.playerVideoBuffer.downloadCompleted.totalDownloadMs),this.videoDownloadBytes.push(this.playerVideoBuffer.downloadCompleted.totalBytes)},e.prototype.onAudioDownloadCompleted=function(){this.audioDownloadSuccessCount++,this.audioDownloadSuccessCountFromLastTick++,this.audioDownloadLatencies.length>=this.slidingWindowLengthForLatency&&this.audioDownloadLatencies.shift(),this.audioDownloadBytes.length>=this.slidingWindowLengthForDownloadBytes&&this.audioDownloadBytes.shift(),this.audioDownloadLatencies.push(this.playerAudioBuffer.downloadCompleted.totalDownloadMs),this.audioDownloadBytes.push(this.playerAudioBuffer.downloadCompleted.totalBytes)},e.prototype.onVideoDownloadError=function(){this.videoDownloadFailureCount++,this.videoDownloadFailureCountFromLastTick++,this.logger.warn("onDownloadError Code: "+this.playerVideoBuffer.downloadFailed.code+" Bitrate: "+this.playerVideoBuffer.downloadFailed.mediaDownload.bitrate+" Message: "+this.playerVideoBuffer.downloadFailed.message+" Url: "+this.playerVideoBuffer.downloadFailed.mediaDownload.url);var e={videoDownloadErrorCode:this.playerVideoBuffer.downloadFailed.code,videoDownloadUrl:this.playerVideoBuffer.downloadFailed.mediaDownload.url},a=this.getPlayerEventData();a[this.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(e),this.scenario.mark(t.ScenarioMarkers.VideoDownloadFailure,a)},e.prototype.onAudioDownloadError=function(){this.audioDownloadFailureCount++,this.audioDownloadFailureCountFromLastTick++,this.logger.warn("onDownloadError Code: "+this.playerAudioBuffer.downloadFailed.code+" Bitrate: "+this.playerAudioBuffer.downloadFailed.mediaDownload.bitrate+" Message: "+this.playerAudioBuffer.downloadFailed.message+" Url: "+this.playerAudioBuffer.downloadFailed.mediaDownload.url);var e={audioDownloadErrorCode:this.playerAudioBuffer.downloadFailed.code,audioDownloadUrl:this.playerAudioBuffer.downloadFailed.mediaDownload.url},a=this.getPlayerEventData();a[this.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(e),this.scenario.mark(t.ScenarioMarkers.AudioDownloadFailure,a)},e}();t.AmpDiagnosticLogger=i},2058:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(71),i=function(){function e(e,t,a,i,n,r,o){var c=this;this.player=e,this.captionsOnHandler=t,this.captionsOffHandler=a,this.captionsLogger=n,this.appConfig=r,this.queuedFinalCaption=void 0,this.buffer=void 0,this.lineHeight=0,this.onLoadedMetadata=function(){for(var e=0,t=c.getPlayerTextTracksAsArray();e<t.length;e++)t[e].mode="disabled";c.logger.info("Player loaded, registering for caption events");var a=c.player.textTracks();a&&a.addEventListener&&a.addEventListener("change",c.onTextTrackChanged),c.player.addEventListener(amp.eventName.seeked,c.onSeeked),c.metadataLoadedResolve()},this.onSeeked=function(){if(c.currentTextTrack){var e=(c.isLiveEdgeOnlyStream?c.player.currentMediaTime():c.player.currentTime())||1,t=c.player.currentAbsoluteTime()||1;c.captionOffsetTime=c.isLiveEdgeOnlyStream?Math.max(t-e,0):t-e;var a=c.getCulture(c.currentTextTrack);c.tryClearCues(c.currentTextTrack),c.captionsOnHandler(a,e,c.captionsUpdateHandler),c.logger.info("Player seeked: Get captions for culture ["+a+"] at player time ["+e+"]"),c.resetCachedCaptionProcessingData(),c.captionsLogger.logPlayerSeeked(e)}},this.onTextTrackChanged=function(){var e=c.player.getCurrentTextTrack(),t=(c.isLiveEdgeOnlyStream?c.player.currentMediaTime():c.player.currentTime())||1,a=c.player.currentAbsoluteTime()||1;if(e)if(c.currentTextTrack&&c.currentTextTrack.label===e.label&&c.currentTextTrack.mode===e.mode)c.captionsLogger.logTextTrackChanged(s.CaptionVisibilityChange.None,c.getCulture(e));else{i=c.getCulture(e);"showing"===e.mode?(c.tryClearCues(e),c.captionsOnHandler(i,t,c.captionsUpdateHandler),c.captionOffsetTime=c.isLiveEdgeOnlyStream?Math.max(a-t,0):a-t,c.resetCachedCaptionProcessingData(),c.logger.info("Turned captions ON for culture ["+i+"] at player time ["+t+"]"),c.captionsLogger.logTextTrackChanged(s.CaptionVisibilityChange.On,i)):(c.captionsOffHandler(i),c.resetCachedCaptionProcessingData(),c.logger.info("Turned captions OFF for culture ["+i+"] at player time ["+t+"]"),c.captionsLogger.logTextTrackChanged(s.CaptionVisibilityChange.Off,i))}else if(c.currentTextTrack){var i=c.getCulture(c.currentTextTrack);c.captionsOffHandler(i),c.resetCachedCaptionProcessingData(),c.logger.info("Turned captions OFF for culture ["+i+"] at player time ["+t+"]"),c.captionsLogger.logTextTrackChanged(s.CaptionVisibilityChange.Off,i)}c.currentTextTrack&&c.currentTextTrack.removeEventListener("cuechange",c.cueChangeHandler),c.currentTextTrack=e,c.currentTextTrack&&c.currentTextTrack.addEventListener("cuechange",c.cueChangeHandler)},this.cueChangeHandler=function(){c.currentTextTrack&&c.currentTextTrack.activeCues&&c.captionsLogger.captureCaptionsDisplayedEvent(c.player.currentTime()||-1,c.currentTextTrack.activeCues.cues_)},this.captionsUpdateHandler=function(e){var t=[],a=void 0,s=void 0;c.queuedFinalCaption&&(e&&e[0]&&c.queuedFinalCaption.TimestampMs<e[0].TimestampMs&&e.unshift(c.queuedFinalCaption),c.queuedFinalCaption=void 0);for(var i=0,n=e;i<n.length;i++){var r=n[i];if(!(""===r.Text||r.TimestampMs/1e3<c.highestProcessedCaptionEndTime))if(r.IsFinal&&e[e.length-1]===r)c.queuedFinalCaption=r;else{var o={start:r.TimestampMs/1e3,text:c.getText(r.Text,r.IsFinal),end:r.EndTimestampMs?r.EndTimestampMs/1e3:void 0,isFinal:r.IsFinal};t.length&&t[t.length-1]&&t[t.length-1].isFinal&&(t[t.length-1].end=o.start),t.push(o),(!a||o.start<a)&&(a=o.start),(!s||o.end>s)&&(s=o.end)}}0!==t.length&&(c.captionsLogger.logReceivedCaptions(a,s,t.length),c.addCues(t),c.highestProcessedCaptionEndTime=s)},this.logger=i.newLogger("broadcastCaptionsPlugin"),this.metadataLoaded=new Promise(function(e,t){c.metadataLoadedResolve=e}),this.buffer=$(".captions-buffer"),this.lineHeight=this.buffer.text("&nbsp;").height(),this.isLiveEdgeOnlyStream=o}return e.prototype.load=function(){this.logger.info("Loading the captions plugin"),this.player.addEventListener(amp.eventName.loadedmetadata,this.onLoadedMetadata)},e.prototype.hideCaptions=function(){var e=this;this.metadataLoaded.then(function(){e.previouslyVisibleTextTrack=e.currentTextTrack,e.previouslyVisibleTextTrack&&(e.previouslyVisibleTextTrack.mode="disabled"),e.player.captionToggle&&e.player.captionToggle.hide&&e.player.captionToggle.hide(),e.player.MoreOptionscaptionSubtitleButton&&e.player.MoreOptionscaptionSubtitleButton.hide&&e.player.MoreOptionscaptionSubtitleButton.hide(),e.player.MoreOptionscaptionSettingsButton&&e.player.MoreOptionscaptionSettingsButton.hide&&e.player.MoreOptionscaptionSettingsButton.hide(),e.captionsLogger.logCaptionsHidden(!!e.previouslyVisibleTextTrack)})},e.prototype.showCaptions=function(){var e=this;this.metadataLoaded.then(function(){e.previouslyVisibleTextTrack&&(e.previouslyVisibleTextTrack.mode="showing"),e.player.captionToggle&&e.player.captionToggle.show&&e.player.captionToggle.show(),e.player.MoreOptionscaptionSubtitleButton&&e.player.MoreOptionscaptionSubtitleButton.show&&e.player.MoreOptionscaptionSubtitleButton.show(),e.player.MoreOptionscaptionSettingsButton&&e.player.MoreOptionscaptionSettingsButton.show&&e.player.MoreOptionscaptionSettingsButton.show(),e.captionsLogger.logCaptionsShown(!!e.previouslyVisibleTextTrack)})},e.prototype.getSelectedCaptionsLanguage=function(){return this.getCulture(this.currentTextTrack)},e.prototype.getAvailableLanguages=function(){var e=this;return this.getPlayerTextTracksAsArray().map(function(t){return e.getCulture(t)})},e.prototype.dispose=function(){if(this.player){var e=this.player.textTracks();e&&e.removeEventListener&&e.removeEventListener("change"),this.player.removeEventListener(amp.eventName.seeked,this.onSeeked),this.player.removeEventListener(amp.eventName.loadedmetadata,this.onLoadedMetadata),this.currentTextTrack&&this.currentTextTrack.removeEventListener("cuechange",this.cueChangeHandler)}this.captionsLogger.dispose(),this.buffer=void 0},e.prototype.resetCachedCaptionProcessingData=function(){this.previousFinalCaptionText="",this.highestProcessedCaptionEndTime=0,this.queuedFinalCaption=void 0},e.prototype.addCue=function(e){var t=e.start,a=e.end,s=e.text,i=this.player.getCurrentTextTrack();if(i){var n=new(window.vttjs&&window.vttjs.VTTCue||window.VTTCue)(t+this.captionOffsetTime,a+this.captionOffsetTime,s);n.size=100,i.addCue(n)}},e.prototype.addCues=function(e){for(var t=e.length,a=0;a<t;a++){var s=e[a],i=s.start;if(!s.end){var n=a+1<t?e[a+1].start:i+5;n=i+Math.min(n-i,10),s.end=n}this.addCue(s)}},e.prototype.getText=function(e,t){var a;return a=this.previousFinalCaptionText?this.previousFinalCaptionText+" \n "+e:e,t&&(this.previousFinalCaptionText=e),this.truncateText(a)},e.prototype.truncateText=function(e){var t=this;this.buffer.empty();var a=0,s=[],i=e.split(" ");i.forEach(function(e,i){t.buffer.append(t.renderWord(e)),t.buffer.height()>t.lineHeight*a+.1&&(a++,s.push(i))});var n=this.appConfig.broadcastSettings.attendee.captionsLinesToRender||2,r=s.slice(-n);return this.generateTruncatedCaptionText(i,r)},e.prototype.renderWord=function(e){if("\n"==e)return document.createElement("br");var t=document.createElement("span");return t.className="ts-closed-captions-word",t.textContent=e+" ",t},e.prototype.generateTruncatedCaptionText=function(e,t){var a;return t.forEach(function(s,i){var n=e.slice(s,t[i+1]||e.length);a?"\n"==a[a.length-1]?a+=n.join(" "):a=a+"\n"+n.join(" "):a=n.join(" ")}),a},e.prototype.getCulture=function(e){if(!e)return"";if(e.id){var t=e.id.split("_")[1];if(t)return t}return""},e.prototype.tryClearCues=function(e){try{if(e.cues.setCues_){e.cues_&&(e.cues_.length=0),e.cues.setCues_([]);for(var t=0,a=Object.getOwnPropertyNames(e.cues);t<a.length;t++){var s=a[t];"length"!==s&&"length_"!==s&&"cues_"!==s&&delete e.cues[s]}}}catch(e){}},e.prototype.getPlayerTextTracksAsArray=function(){var e=this.player.textTracks();return e&&e.tracks_||[]},e}();t.BroadcastCaptionsPlugin=i},2059:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2060),i=function(){function e(e,t,a){this.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.clickButton,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close settings from attendee header",trackName:teamspace.components.PanelModuleName.closeButton},this.customRightRailHeader=a.valueAsBoolean(e.settings.names.customRightRailHeader),this.panelType=teamspace.components.Calling.RightPanel.DeviceSettings,this.attendeeSupportUrl=t.broadcastPolicyDefaults.attendeeSupportURL}return e.$inject=["constants","appConfig","settingsService"],e}();t.BroadcastAttendeeSettingsController=i,angular.module("teamspace.broadcastAttendeeSettings",["teamspace.rightPaneHeader","teamspace.callingSharedsettingsSection","teamspace.settingsService"]).component("broadcastAttendeeSettings",{bindings:{isAnonymous:"<"},controllerAs:"ctrl",controller:i,template:s})},2060:function(e,t){e.exports='<div class="attendee-settings-wrapper">\n  <right-pane-header ng-if="::ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{ctrl.panelType}}" telemetry-bag="ctrl.telemetryBag" text="{{::$root.resources.strings.devices_header|translate}}">\n  </right-pane-header>\n\n  <span class="audio-settings-suggestion">\n    {{::$root.resources.strings.broadcast_audio_settings_suggestion|translate}}\n  </span>\n\n  <a class="audio-settings-helper-link" target="_blank" href="{{::ctrl.attendeeSupportUrl}}}" translate-once="{{::$root.resources.strings.broadcast_attendee_settings_learn_more}}">\n  </a>\n\n  <div ng-if="::ctrl.isAnonymous" class="anonymous-attendee-section flex-fill call-settings-tab-container scrolling-pane">\n    <calling-sharedsettings-section></calling-sharedsettings-section>\n  </div>\n</div>\n'},2061:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2062),i=function(){function e(e,t,a,s,i,n,r,o,c,l,d,p){this.$scope=e,this.$element=t,this.resources=s,this.calendarService=i,this.broadcastMeetingService=n,this.broadcastSchedulingService=r,this.utilityService=o,this.tooltipService=c,this.$translate=p,this.customRightRailHeader=!1,this.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.broadcast,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close broadcast attendee info from header",trackName:teamspace.components.PanelModuleName.meetingInfoPanel},this.logger=a.newLogger("BroadcastAttendeeMeetingInfo"),this.customRightRailHeader=l.valueAsBoolean(d.settings.names.customRightRailHeader),this.panelType=teamspace.components.Calling.RightPanel.MeetingInfo}return e.$inject=["$scope","$element","loggingService","resources","calendarService","broadcastMeetingService","broadcastSchedulingService","utilityService","tooltipService","settingsService","constants","$translate"],e.prototype.$onInit=function(){if(this.broadcastAttendeeMeeting)if(this.broadcastAttendeeMeeting.utcStart&&this.broadcastAttendeeMeeting.utcEnd)if(this.broadcastAttendeeMeeting.subject){this.meetingSubject=this.broadcastAttendeeMeeting.subject;var e=moment(this.broadcastAttendeeMeeting.utcStart).format("LT"),t=moment(this.broadcastAttendeeMeeting.utcEnd).format("LT"),a=this.utilityService.generateDurationString(moment(this.broadcastAttendeeMeeting.utcEnd).diff(moment(this.broadcastAttendeeMeeting.utcStart)));this.meetingHours=this.$translate.instant(this.resources.strings.meeting_timeduration_format,{startHour:e,endingHour:t,duration:a}),this.meetingRecurrence=this.calendarService.getMeetingFormattedTime(new Date(this.broadcastAttendeeMeeting.utcStart.toString())),this.supportUrl=this.broadcastAttendeeMeeting.supportUrl,this.supportUrl&&(this.supportUrlWithProtocol=this.utilityService.addMissingProtocol(this.supportUrl)),this.getMeetingInfoFromSchedulingService()}else this.logger.error("onInit: Meeting subject is null");else this.logger.error("onInit: Meeting hours are not available");else this.logger.error("onInit: Attendee meeting is null")},e.prototype.getMeetingInfoFromSchedulingService=function(){var e=this,t=this.broadcastAttendeeMeeting.signalR&&this.broadcastAttendeeMeeting.signalR.querystrings;t&&this.broadcastSchedulingService.getSchedulingServiceMeetingUsingIds(t.tenantid,t.organizerid,t.threadid,"0").then(function(t){if(t){e.meetingLocation=t.location;var a=t.modalityLinks&&t.modalityLinks.stream?teamspace.services.BroadcastPlaybackType.Stream:teamspace.services.BroadcastPlaybackType.AMS;e.meetingJoinLink=e.broadcastMeetingService.getAttendeeJoinLink(t.links&&t.links.join,a)}})},e.prototype.copyJoinLink=function(e,t){this.utilityService.copyToClipboard(this.meetingJoinLink),this.tooltipService.showLinkCopiedTooltip(e,t,this.$element,this.$element.find(".meeting-join-button"))},e}();t.BroadcastAttendeeMeetingInfoController=i,angular.module("teamspace.broadcastAttendeeMeetingInfo",["teamspace.loggingService","teamspace.calendarService","teamspace.utilityService","teamspace.tooltipService","teamspace.broadcastMeetingService","teamspace.broadcastSchedulingService"]).component("broadcastAttendeeMeetingInfo",{bindings:{broadcastAttendeeMeeting:"<"},controller:i,template:s})},2062:function(e,t){e.exports='<div class="attendee-meeting-info" ng-class="::{\'right-pane-header\': $ctrl.customRightRailHeader}">\n  <right-pane-header ng-if="$ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{$ctrl.panelType}}" text="{{::$root.resources.strings.broadcast_attendee_header|translate}}" telemetry-bag="$ctrl.telemetryBag"></right-pane-header>\n  <div class="attendee-meeting-content">\n    <div class="attendee-meeting-info-head">\n      <div aria-label="{{::$ctrl.meetingSubject}}" class="attendee-meeting-info-subject app-font-title-regular">\n        {{$ctrl.meetingSubject}}\n      </div>\n      <div class="attendee-meeting-info-schedule" ng-if="::$ctrl.meetingHours">\n        <div aria-label="{{::$ctrl.meetingHours}}">{{::$ctrl.meetingHours}}</div>\n        <div aria-label="{{::$ctrl.meetingRecurrence}}" ng-if="::$ctrl.meetingRecurrence">\n          {{::$ctrl.meetingRecurrence}}\n        </div>\n        <div class="calling-meeting-info-location" aria-label="{{::$ctrl.meetingLocation}}" ng-if="::$ctrl.meetingLocation">\n          {{::$ctrl.meetingLocation}}\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <button class="copy-joinlink-button inset-border inset-border-themed" ng-if="::$ctrl.meetingJoinLink" ng-click="$ctrl.copyJoinLink($event, this)">\n    <ng-include class="icon" aria-hidden="true" src="\'svg/icons-link.html\'"></ng-include>\n    <span class="copy-joinlink-text" translate-once="{{::$root.resources.strings.meeting_details_invite_getLink}}"></span>\n  </button>\n\n  <div class="support-link" ng-if="::$ctrl.supportUrl">\n    <div class="support-link-title">{{::$root.resources.strings.broadcast_settings_section_header_support|translate}}</div>\n    <a href="{{::$ctrl.supportUrlWithProtocol}}" title="{{::$ctrl.supportUrl}}" class="inset-border inset-border-themed" target="_blank">{{::$root.resources.strings.broadcast_attendee_support_default_help_link_title_text|translate}}</a>\n  </div>\n</div>'},2063:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++){t=arguments[a];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n,r=a(2064),o=a(171),c=a(35);!function(e){e[e.verbose=0]="verbose",e[e.info=1]="info",e[e.warning=2]="warning",e[e.error=3]="error",e[e.exception=4]="exception"}(n||(n={})),t.QnaConstants={events:{htmlLoad:"extensions.qna.startup",updateToken:"extensions.qna.updateAadToken",updateNotification:"extensions.qna.notification",logQna:"extensions.qna.log",qnaScenario:"extensions.qna.scenario",notifyAppState:"extensions.qna.notifyAppState"},scenarios:{QnaAuthTokenUpdate:"bcast_qna_extension_update_auth_token",QnaEventMessageReceived:"bcast_qna_extension_event_message_received",QnaFeedLoaded:"qna_feed_loaded",QnaFeedRefreshed:"qna_feed_refreshed",QnaLatency:"qna_latency"},urlQspKeys:{joinId:"jid",lang:"lang",sessionId:"sid",theme:"theme",meetingType:"type",doNotRedirect:"doNotRedirect",rand:"rand"},themes:{default:"light",contrast:"contrast",dark:"dark"},maxRetryCount:3,urlSeparator:"#"};var l=function(e){function a(t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b,v,S,y,f,k,_,P,C,w,M,B,A,I,T){var E=e.call(this,b,v,p,h,m,S,y,g,u,_,B,w,M,P,C)||this;return E.appStateService=t,E.authenticationService=a,E.broadcastPlaybackService=s,E.eventingService=i,E.objectLeaksDetector=n,E.localizationService=r,E.appStateAdapter=o,E.$translate=c,E.resources=l,E.exceptionUtilityService=d,E.$scope=p,E.constants=g,E.loggingService=u,E.appConfig=f,E.desktopUtilityService=k,E.tooltipService=A,E.broadcastMeetingService=T,E.customRightRailHeader=!1,E.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.broadcast,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close QNA panel from header"},E.broadcastQnaEvents=[],E.broadcastQnaEventHandlers={},E.retryCount=0,E.isQnaFeedLoaded=!1,E.shouldHandleCustomZoomLevel=!1,E.isResetZoomLevelUfdShown=!1,E._isQnaTooltipShown=!1,E.activeQnaScenarios=[],E.skipWebviewResizeHandling=!M.valueAsBoolean(g.settings.names.enableWebViewResizingForBroadcast),E.customRightRailHeader=M.valueAsBoolean(g.settings.names.customRightRailHeader),E.panelType=teamspace.components.Calling.RightPanel.BroadcastQna,E.loadTimeout=f.broadcastSettings.frameLoadTimeoutInMs,E.logger=u.newLogger("BroadcastQnaExtension"),E.definitionId=f.broadcastSettings.qnaAppDefinitionId,E.localBroadcastState=E.call&&I.getLocalBroadcastState(E.call.teamsCallId),E}return s(a,e),a.$inject=["appStateService","authenticationService","broadcastPlaybackService","eventingService","objectLeaksDetector","localizationService","appStateAdapter","$translate","resources","exceptionUtilityService","$scope","constants","loggingService","$element","$interval","$q","$sce","$timeout","$window","appConfig","desktopUtilityService","extensionTabService","htmlSanitizer","navigationService","sdkHelperService","settingsService","utilityService","tooltipService","broadcastService","broadcastMeetingService"],a.prototype.$onInit=function(){var e=this;this.qnaUrl?(this.loadQnaFeed(),this.desktopUtilityService.isDesktop()&&this.desktopUtilityService.getElectronAppVersionInfo().then(function(t){t&&t.hostInfo&&t.hostInfo.version&&(e.electronVersion=t.hostInfo.version,e.shouldHandleCustomZoomLevel=-1===e.utilityService.compareVersions(e.electronVersion,e.appConfig.broadcastSettings.electronVersionWithSupportForWebFrameResize)),e.shouldHandleCustomZoomLevel&&(e.deregisterWatchListener=e.$scope.$watch("ctrl.isSelected",function(t,a){t&&e.handleCustomZoomLevel()}))}).catch(function(t){e.logger.error("Failed to get Electron version information. Error: "+JSON.stringify(t)+"$")})):this.logger.error("onInit: invalid Q&A url received")},a.prototype.loadQnaFeed=function(){var e=this;this.broadcastQnaEvents.push(t.QnaConstants.events.updateToken,t.QnaConstants.events.updateNotification,t.QnaConstants.events.logQna,t.QnaConstants.events.qnaScenario,t.QnaConstants.events.htmlLoad),this.broadcastQnaEventHandlers[t.QnaConstants.events.updateToken]=this.handleAuthTokenUpdateRequest,this.broadcastQnaEventHandlers[t.QnaConstants.events.updateNotification]=this.handleUpdateNotificationRequest,this.broadcastQnaEventHandlers[t.QnaConstants.events.logQna]=this.handleLogQnaRequest,this.broadcastQnaEventHandlers[t.QnaConstants.events.qnaScenario]=this.handleQnaScenarioEvents,this.eventingService.$on(this.$scope,this.constants.events.layout.themeChanged,function(a,s){if(e.utilityService.getQueryStringByName(t.QnaConstants.urlQspKeys.rand,e.qnaExtensionUrl))e.qnaExtensionUrl=e.utilityService.appendOrUpdateQueryStringParamToUrl(e.qnaExtensionUrl,t.QnaConstants.urlQspKeys.rand,Math.random().toString());else if(_.includes(e.qnaExtensionUrl,e.appConfig.broadcastQnaBootstrapUrlKeyword)){var i=e.qnaExtensionUrl.split(t.QnaConstants.urlSeparator),n=e.utilityService.appendOrUpdateQueryStringParamToUrl(i[0],t.QnaConstants.urlQspKeys.rand,Math.random().toString());e.qnaExtensionUrl=""+n+t.QnaConstants.urlSeparator+i[1]}e.qnaExtensionUrl=e.utilityService.appendOrUpdateQueryStringParamToUrl(e.qnaExtensionUrl,t.QnaConstants.urlQspKeys.theme,s),e.retryCount===t.QnaConstants.maxRetryCount&&(e.retryCount=0),e.loadFrameWithRetry()}),this.$scope.$on("$destroy",function(){e.broadcastQnaEvents=null,e.broadcastQnaEventHandlers=null,e.pendingAuthTokenUpdateEvent=null,e.tooltipOptions&&(e.tooltipService.clearTooltip(e.tooltipOptions.tooltipType,e.tooltipOptions.tooltipId),e.tooltipOptions=null),e.hideUfdBanner(),e.activeQnaScenarios&&e.activeQnaScenarios.forEach(function(t){t&&t.cancel(e.getScenarioData({message:"component destroyed"})),t=null}),e.shouldHandleCustomZoomLevel&&e.deregisterWatchListener&&(e.deregisterWatchListener(),e.deregisterWatchListener=null),e.frameInfo=null,e.call=null,e.activeQnaScenarios=null,e.objectLeaksDetector.track("broadcast-qna-extension",e)}),this.eventingService.$on(this.$scope,this.constants.events.appState.changed,function(){return e.onAppStateChanged()}),!_.includes(this.qnaUrl,this.appConfig.broadcastQnaBootstrapUrlKeyword)&&this.settingsService.valueAsBoolean(this.constants.settings.names.enableQnaAutoDiscoveryWithoutRedirect)?(this.updateQnaExtensionUrl(null,!0),this.broadcastMeetingService.getQnaClientExtensionUrl(this.qnaExtensionUrl).then(function(t){e.logger.info("loadQnaFeed: received Qna client extension url: "+t),t?(e.qnaExtensionUrl=t,e.createQnaScenarios(),e.loadFrameScenario.mark("broadcastQnaAutoD_success"),e.loadFrameWithRetry()):e.loadQnaFeedInternal("broadcastQnaAutoD_invalid_url")}).catch(function(t){var a;e.logger.error("Error while fetching Qna client extension url for: "+e.qnaExtensionUrl+" with error: "+JSON.stringify(t)),e.loadQnaFeedInternal("broadcastQnaAutoD_failure",(a={},a[e.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(t),a))})):this.loadQnaFeedInternal()},a.prototype.loadQnaFeedInternal=function(e,t){this.updateQnaExtensionUrl(),this.createQnaScenarios(),e&&this.loadFrameScenario.mark(e,t),this.loadFrameWithRetry()},a.prototype.createQnaScenarios=function(){var e=this.getScenarioData();this.loadFrameScenario=this.loggingService.newScenario(this.constants.scenarios.broadcast.qnaFrameLoad),this.loadFrameScenario.cancelIfOffline=!0,this.loadFrameScenario.eventData=e,this.activeQnaScenarios.push(this.loadFrameScenario),this.latencyScenario=this.loggingService.newScenario(t.QnaConstants.scenarios.QnaLatency),this.latencyScenario.cancelIfOffline=!0,this.latencyScenario.eventData=e,this.activeQnaScenarios.push(this.latencyScenario),this.qnaEventMessageReceivedScenario=this.loggingService.newScenario(t.QnaConstants.scenarios.QnaEventMessageReceived),this.qnaEventMessageReceivedScenario.cancelIfOffline=!0,this.qnaEventMessageReceivedScenario.eventData=e,this.activeQnaScenarios.push(this.qnaEventMessageReceivedScenario)},a.prototype.createMessageHandler=function(t){var a=e.prototype.createMessageHandler.call(this,t);return a.addGenericMessageHandler(this.handleQnaEvent.bind(this)),a},a.prototype.onLoadHandler=function(){var e=this;this.logger.info("Content loaded for QnA frame"),this.retryCount=0,this.loadFrameScenario&&(this.loadFrameScenario.stop(this.getScenarioData()),_.remove(this.activeQnaScenarios,function(t){return t.name===e.loadFrameScenario.name}),this.loadFrameScenario=null)},a.prototype.onLoadErrorHandler=function(){this.loadFrameWithRetry("Error while loading the embedded-page-container")},a.prototype.updateQnaExtensionUrl=function(e,a){var s=t.QnaConstants.urlQspKeys,i=this.getLang(),n=e||this.settingsService.getActiveTheme();this.joinId=this.utilityService.generateUUID();var r=this.videoId?"byoe":"tmb",o=this.qnaUrl+(/\?.*=/.test(this.qnaUrl)?"&":"?")+s.lang+"="+i+"&"+s.theme+"="+t.QnaConstants.themes[n]+"&"+s.sessionId+"="+this.loggingService.sessionId+"&"+s.joinId+"="+this.joinId+"&"+s.meetingType+"="+r;a&&(o+="&"+s.doNotRedirect+"="+a),this.logger.info("BroadcastQnaExtension: Init: Q&A url is: "+o),this.qnaExtensionUrl=o},a.prototype.loadFrameWithRetry=function(e){var a,s,i=this;this.retryCount<t.QnaConstants.maxRetryCount?this.beginLoad(this.qnaExtensionUrl,!0).catch(function(e){var t;i.loadFrameScenario&&i.loadFrameScenario.mark("FrameLoadRetry",(t={},t[i.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({retryAttempt:++i.retryCount}),t)),i.loadFrameWithRetry("Frame load failed with error: "+JSON.stringify(e))}).then(function(){if(!i.loadHtmlScenario){var e=i.getScenarioData();i.loadHtmlScenario=i.loggingService.newScenario(i.constants.scenarios.broadcast.qnaHtmlLoad,void 0,void 0,i.loadTimeout),i.loadHtmlScenario.cancelIfOffline=!0,i.loadHtmlScenario.eventData=e,i.activeQnaScenarios.push(i.loadHtmlScenario)}}):(this.logger.error("loadFrameWithRetry: failed with error: "+e),this.showQnaLoadFailureMessage(),this.loadHtmlScenario&&(this.exceptionUtilityService.failScenarioIfOnline(this.loadHtmlScenario,this.getScenarioData(null,e)),_.remove(this.activeQnaScenarios,function(e){return e.name===i.loadHtmlScenario.name}),this.loadHtmlScenario=null),this.loadFrameScenario&&(this.exceptionUtilityService.failScenarioIfOnline(this.loadFrameScenario,this.getScenarioData(null,e)),_.remove(this.activeQnaScenarios,function(e){return e.name===i.loadFrameScenario.name}),this.loadFrameScenario=null),this.latencyScenario&&(this.latencyScenario.cancel(this.getScenarioData((a={},a[this.constants.counters.eventNames.reason]="frameLoadFailed",a))),_.remove(this.activeQnaScenarios,function(e){return e.name===i.latencyScenario.name}),this.latencyScenario=null),this.qnaEventMessageReceivedScenario&&(this.qnaEventMessageReceivedScenario.cancel((s={},s[this.constants.counters.eventNames.reason]="frameLoadFailed",s)),_.remove(this.activeQnaScenarios,function(e){return e.name===i.qnaEventMessageReceivedScenario.name}),this.qnaEventMessageReceivedScenario=null))},a.prototype.handleQnaEvent=function(e){var a=this;if(this.isValidQnaEvent(e)){var s=JSON.parse(e.data);this.frameInfo=e.source,s.event!==t.QnaConstants.events.htmlLoad?this.broadcastQnaEventHandlers&&this.broadcastQnaEventHandlers[s.event]&&(this.loadHtmlScenario&&(this.loadHtmlScenario.stop(),_.remove(this.activeQnaScenarios,function(e){return e.name===a.loadHtmlScenario.name}),this.loadHtmlScenario=null),this.loadFrameScenario&&(this.loadFrameScenario.stop(),_.remove(this.activeQnaScenarios,function(e){return e.name===a.loadFrameScenario.name}),this.loadFrameScenario=null),this.qnaEventMessageReceivedScenario&&(this.qnaEventMessageReceivedScenario.stop(),_.remove(this.activeQnaScenarios,function(e){return e.name===a.qnaEventMessageReceivedScenario.name}),this.qnaEventMessageReceivedScenario=null),this.broadcastQnaEventHandlers[s.event].call(this,e)):this.loadHtmlScenario&&(this.loadHtmlScenario.stop(),_.remove(this.activeQnaScenarios,function(e){return e.name===a.loadHtmlScenario.name}),this.loadHtmlScenario=null)}},a.prototype.handleAuthTokenUpdateRequest=function(e){var a,s=this;if(e.source){if(!this.appStateService.isOnline||!this.appStateService.isConnected)return this.pendingAuthTokenUpdateEvent||(this.loggingService.newScenario(t.QnaConstants.scenarios.QnaAuthTokenUpdate).cancel((a={},a[this.constants.scenarioDataPropNames.broadcastData]="appOfflineOrDisconnected",a)),this.pendingAuthTokenUpdateEvent=e),this.handleAppStateNotificationToQna(),void(this.existingAppState=this.getAppState());var i=this.loggingService.newScenario(t.QnaConstants.scenarios.QnaAuthTokenUpdate);i.cancelIfOffline=!0;var n=this.settingsService.valueAsBoolean(this.constants.settings.names.useAttendeeAuthResourceForBroadcastAttendee)?[this.settingsService.valueFor("broadcastSettings").attendeeServiceAuthResource]:void 0;this.authenticationService.getAuthTokens(n).then(function(a){i.mark("auth_token_received"),s.sdkWindowMessageHandler.postGenericMessage(e.source,{stringMessage:JSON.stringify({event:t.QnaConstants.events.updateToken,data:{aadToken:""+a}})}),s.logger.info("handleAuthTokenUpdateRequest: Fetched AAD token and posted a message to the source frame"),i.mark("auth_token_posted_to_qna"),i.stop()}).catch(function(e){var t;s.logger.error("handleAuthTokenUpdateRequest: Failed to get auth token"),!e||"renewalTimeout"!==e||s.appStateService.isConnected&&s.appStateService.current!==teamspace.services.ApplicationState.LongInactive?i.fail(s.getScenarioData(null,e)):(i.cancel(s.getScenarioData((t={},t[s.constants.counters.eventNames.reason]="tokenRenewalTimeout due to appState: "+s.appStateService.current,t),e)),s.handleAppStateNotificationToQna())})}else this.logger.error("handleAuthTokenUpdateRequest: source frame is null")},a.prototype.handleUpdateNotificationRequest=function(e){this.eventingService.$emit(this.constants.events.broadcast.qnaUpdateNotification)},a.prototype.handleLogQnaRequest=function(e){var t=JSON.parse(e.data);if(t.data&&t.data.logs)for(var a=0,s=t.data.logs;a<s.length;a++){var i=s[a],r="Q&A log: "+i.time+", class: "+i.class+", method: "+i.method+", message: "+i.message;switch(i.type){case n.verbose:this.logger.debug(r);break;case n.info:this.logger.info(r);break;case n.warning:this.logger.warn(r);break;case n.error:case n.exception:this.logger.error(r)}}else this.logger.error("handleLogQnaRequest: received invalid Q&A log message")},a.prototype.isValidQnaEvent=function(e){if(!e||!e.data||"string"!=typeof e.data)return!1;var t=JSON.parse(e.data);return!t||!this.broadcastQnaEvents||-1!==this.broadcastQnaEvents.indexOf(t.event)},a.prototype.handleQnaScenarioEvents=function(e){var a,s,i,n,r=this,c=JSON.parse(e.data).data;if(c&&c.scenarioName){this.logger.info("handleQnaScenarioEvents: received an event message for scenario: "+c.scenarioName);var l=this.loggingService.findScenario(c.scenarioName);if(!l){var d=this.constants.timeInMiliseconds.tenMinutes+this.constants.timeInMiliseconds.minute;(l=this.loggingService.newScenario(c.scenarioName,null,null,d)).clientId=c.clientId,this.activeQnaScenarios.push(l)}if(l.cancelIfOffline=!0,l.eventData.contextId=this.joinId,"stop"!==c.step){h=(a={errorReason:c.errorReason},a[this.constants.counters.eventNames.reason]=c.reason,a);l.mark(c.step,this.getScenarioData({scenarioMessage:c.data},h),c.status)}else switch(c.status){case"success":if(l.stop(this.getScenarioData({scenarioMessage:c.data}),null,c.status),_.remove(this.activeQnaScenarios,function(e){return e.name===l.name}),c.scenarioName!==t.QnaConstants.scenarios.QnaFeedLoaded&&c.scenarioName!==t.QnaConstants.scenarios.QnaFeedRefreshed||(this.retryCount=0,this.isQnaFeedLoaded=!0,this.handleCustomZoomLevel()),c.scenarioName===t.QnaConstants.scenarios.QnaFeedLoaded&&this.latencyScenario&&(this.latencyScenario.stop(this.getScenarioData()),_.remove(this.activeQnaScenarios,function(e){return e.name===r.latencyScenario.name}),this.latencyScenario=null),c.scenarioName===t.QnaConstants.scenarios.QnaFeedLoaded&&!this.isQnaTooltipShown&&!this.isSelected){var p=this.utilityService.generateUUID(),g=$("*[id*=broadcast-qna-button]:visible");if(!g||!g.length||this.broadcastPlaybackService.shouldDockPlayer||g.offset()&&g.offset().top<0)return;!this.call||!this.call.broadcastMeeting||this.call.broadcastMeeting.role&&this.call.broadcastMeeting.role!==teamspace.services.BroadcastMeeting.constants.role.contributor||g.addClass("updated");var u={template:o,trigger:"manual",container:"body",scope:angular.extend(this.$scope.$new(),{panelType:"coachmark",showArrow:!0}),autoClose:!0,content:this.$translate.instant(this.resources.strings.broadcast_qna_session_open),placement:this.enableActionButtonsInUbar?"top":"bottom"};this.tooltipOptions={selector:"*[id*=broadcast-qna-button]:visible",tooltipType:teamspace.services.TooltipType.Popover,options:u,tooltipId:p},this.$timeout(function(){r.tooltipOptions&&r.broadcastQnaEvents&&(r.tooltipService.showTooltip(r.tooltipOptions),r.isQnaTooltipShown=!0,r.enableActionButtonsInUbar&&r.eventingService.$emit(r.constants.events.calling.notificationUpdateReceived))}),this.$timeout(function(){r.tooltipOptions&&(g.hasClass("updated")&&g.removeClass("updated"),r.tooltipService.clearTooltip(r.tooltipOptions.tooltipType,r.tooltipOptions.tooltipId))},7*this.constants.timeInMiliseconds.second)}break;case"failure":case"timeout":var h=(s={status:c.status,errorReason:c.errorReason},s[this.constants.counters.eventNames.reason]=c.reason,s.appState=this.appStateService.current,s),m=c.scenarioName;m===t.QnaConstants.scenarios.QnaFeedLoaded&&this.latencyScenario&&(this.latencyScenario.cancel(this.getScenarioData((i={},i[this.constants.counters.eventNames.reason]="Cancelled due to "+c.status+" of "+c.scenarioName,i))),_.remove(this.activeQnaScenarios,function(e){return e.name===r.latencyScenario.name}),this.latencyScenario=null),m===t.QnaConstants.scenarios.QnaFeedLoaded&&c.errorReason&&c.errorReason.startsWith("UNAUTHORIZED_FAILED_LATER")&&(l.cancel(this.getScenarioData((n={},n[this.constants.counters.eventNames.reason]="Cancelled due to "+c.errorReason,n))),l=null),!this.appStateService.isOnline||!this.appStateService.isConnected&&this.pendingAuthTokenUpdateEvent?l.cancel(this.getScenarioData(null,h)):(l.fail(this.getScenarioData(null,h)),this.showQnaLoadFailureMessage()),_.remove(this.activeQnaScenarios,function(e){return e.name===l.name}),this.isQnaFeedLoaded=!1}}else this.logger.error("handleQnaScenarioEvents: received invalid Q&A scenario message: "+JSON.stringify(c))},a.prototype.onAppStateChanged=function(){this.appStateService.isOnline&&this.appStateService.isConnected&&this.pendingAuthTokenUpdateEvent&&(this.handleAuthTokenUpdateRequest(this.pendingAuthTokenUpdateEvent),this.pendingAuthTokenUpdateEvent=null),this.handleAppStateNotificationToQna(),this.existingAppState=this.getAppState()},a.prototype.getAppState=function(){return this.appStateService.isOnline&&this.appStateService.isConnected?"online":"offline"},a.prototype.handleAppStateNotificationToQna=function(){if(this.frameInfo){var e=this.getAppState();this.existingAppState!==e&&(this.sdkWindowMessageHandler.postGenericMessage(this.frameInfo,{stringMessage:JSON.stringify({event:t.QnaConstants.events.notifyAppState,data:{state:e}})}),this.logger.info("handleAppStateNotificationToQna: notified state change from: "+this.existingAppState+" to: "+e))}},a.prototype.getScenarioData=function(e,t){var a={};if(a[this.constants.categories.broadcastRole]=this.isByoeProducer?"producer":"attendee",this.call)a[this.constants.counters.eventNames.callId]=this.call.callId,a[this.constants.categories.threadId]=this.call.threadId,a[this.constants.counters.eventNames.participantId]=this.call.participantId,a[this.constants.categories.broadcastRole]=this.call.broadcastMeeting&&this.call.broadcastMeeting.role||"unknown";else{var s=this.broadcastPlaybackService.getActiveBroadcastPlayback();a[this.constants.categories.threadId]=s&&s.threadId}this.videoId?(a[this.constants.counters.eventNames.streamId]=this.videoId,a[this.constants.categories.broadcastType]="byoe"):a[this.constants.categories.broadcastType]="tmb";var n={};return e&&(n=i({},e)),n.qnaExtensionUrl=this.qnaExtensionUrl,a.contextId=this.joinId,a[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(n),t&&(a[this.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(t)),a},a.prototype.showQnaLoadFailureMessage=function(){this.appStateService.isOnline&&this.appStateService.isConnected&&(this.ufdBanner=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Error,this.$translate.instant(this.resources.strings.broadcast_qna_load_failure_ufd_message),this.constants.scenarios.broadcast.attendee.ufdBannerNames.qnaPanelLoadFailed,{autoHideTimer:10}))},a.prototype.getLang=function(){var e=this.localizationService.getLocale(),t=_.find(this.appConfig.languages,function(t){return t.code===e});return t&&t.translationCode||e},a.prototype.hideUfdBanner=function(){this.ufdBanner&&(!this.ufdBanner.isHidden&&this.ufdBanner.hide(),this.ufdBanner=null)},a.prototype.handleCustomZoomLevel=function(){var e=this;if(this.shouldHandleCustomZoomLevel&&!this.isResetZoomLevelUfdShown&&this.isQnaFeedLoaded&&this.isSelected&&100!==this.desktopUtilityService.getZoomPercent()){var t={actionCssClass:"reset-zoom-level-action"};t.action=[],this.$window.electronSafeIpc&&t.action.push(new teamspace.services.BannerAction(this.$translate.instant(this.resources.strings.reset_zoom_level_to_default),function(){e.$window.electronSafeIpc.send(e.constants.events.desktopApp.zoomReset),e.hideUfdBanner()})),t.action.push(new teamspace.services.BannerAction(this.$translate.instant(this.resources.strings.dismiss),function(){e.hideUfdBanner()})),this.ufdBanner=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Warning,this.$translate.instant(this.resources.strings.broadcast_qna_reset_zoom_level_ufd_message),this.constants.scenarios.broadcast.attendee.ufdBannerNames.resetZoomLevelToDefault,t),this.isResetZoomLevelUfdShown=!0}},Object.defineProperty(a.prototype,"isQnaTooltipShown",{get:function(){return this.call&&this.localBroadcastState&&(this._isQnaTooltipShown=this.localBroadcastState.isQnaTooltipShown),this._isQnaTooltipShown},set:function(e){this.call&&this.localBroadcastState?this.localBroadcastState.isQnaTooltipShown=e:this._isQnaTooltipShown=e},enumerable:!0,configurable:!0}),a}(c.ExtensionFrameBase);t.BroadcastQnaExtensionController=l,angular.module("teamspace.broadcastQnaExtension",["teamspace.config","teamspace.loggingService","teamspace.authenticationService","teamspace.appStateAdapter","teamspace.broadcastPlaybackService","teamspace.exceptionUtilityService","teamspace.broadcastService","teamspace.localizationService"]).component("broadcastQnaExtension",{bindings:{qnaUrl:"<",call:"<?",videoId:"<?",isByoeProducer:"<?",isSelected:"<?",enableActionButtonsInUbar:"<?"},controllerAs:"ctrl",controller:l,template:r})},2064:function(e,t){e.exports='<div id="qnaExtension" class="broadcast-qna-panel" ng-class="::{\'right-pane-header\': ctrl.customRightRailHeader}">\n  <right-pane-header ng-if="ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{ctrl.panelType}}" text="{{::$root.resources.strings.broadcast_qna_header|translate}}" telemetry-bag="ctrl.telemetryBag"></right-pane-header>\n  <embedded-page-container acc-focus-default focusable="true" iframe-title="{{::$root.resources.strings.broadcast_qna_panel | translate}}" url="{{ctrl.frameSrc}}" definition-id="{{::ctrl.definitionId}}" enable-message-passing="true" on-content-loaded="ctrl.onContentLoaded(isSuccessful, frameInfo)" on-message-received="ctrl.onMessageReceived(source, data, origin)" skip-resize-handling="::ctrl.skipWebviewResizeHandling" page-identifier="broadcast_qna_extension" process-tag="qnaBroadcast" load-timeout="::ctrl.loadTimeout">\n  </embedded-page-container>\n</div>'},2065:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++){t=arguments[a];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=a(2066),r=a(35);t.config={containerid:"bcastYammerExtension",yammerIframeId:"embed-feed",yammerDomain:"https://www.yammer.com",scenarioIds:{feed:"broadcast_yammer_extension_feed",getToken:"broadcast_yammer_embed_get_token",aadTokenLoginStatus:"broadcast_yammer_aad_token_login_status"},themes:{default:"light",contrast:"dark",dark:"dark"},events:{yammerEmbedLoginFailure:"yam.embed.initialLoginFailure",yammerEmbedAadTokenLoginStatus:"yam.embed.aadTokenLoginStatus"},maxRetryCount:3};var o=function(e){function a(t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b,v,S,y,f,k,_,P,C){var w=e.call(this,m,b,n,u,h,v,g,s,a,y,C,_,P,f,k)||this;return w.appConfig=t,w.loggingService=a,w.constants=s,w.eventingService=i,w.$scope=n,w.authenticationService=r,w.objectLeaksDetector=o,w.appStateAdapter=c,w.$translate=l,w.resources=d,w.exceptionUtilityService=p,w.utilityService=C,w.retryCount=0,w.customRightRailHeader=!1,w.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.broadcast,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close Yammer extension panel from header"},w.hasExtension=!1,w.logger=a.newLogger("BroadcastYammerExtension"),w.broadcastYammerEventHandlers=new Map,w.skipWebviewResizeHandling=!P.valueAsBoolean(s.settings.names.enableWebViewResizingForBroadcast),w.loadTimeout=t.broadcastSettings.frameLoadTimeoutInMs,w.customRightRailHeader=P.valueAsBoolean(s.settings.names.customRightRailHeader),w.panelType=teamspace.components.Calling.RightPanel.BroadcastYammer,w}return s(a,e),a.$inject=["appConfig","loggingService","constants","eventingService","$scope","authenticationService","objectLeaksDetector","appStateAdapter","$translate","resources","exceptionUtilityService","$window","$element","$interval","$q","$sce","$timeout","desktopUtilityService","extensionTabService","htmlSanitizer","navigationService","sdkHelperService","settingsService","utilityService"],a.prototype.$onInit=function(){var e=this;this.broadcastYammerEventHandlers.set(t.config.events.yammerEmbedLoginFailure,this.handleYammerEmbedTokenRequest),this.broadcastYammerEventHandlers.set(t.config.events.yammerEmbedAadTokenLoginStatus,this.handleAadTokenLoginStatusEvent),this.$scope.$on("$destroy",function(){e.broadcastYammerEventHandlers=null,e.ufdBanner&&(!e.ufdBanner.isHidden&&e.ufdBanner.hide(),e.ufdBanner=null),[e.frameLoadedScenario,e.getYammerTokenScenario].map(function(t){t&&t.cancel(e.getScenarioData({message:"component destroyed"}))}),e.objectLeaksDetector.track("broadcast-yammer-extension",e)}),this.loadYammerFeed(),this.eventingService.$on(this.$scope,this.constants.events.layout.themeChanged,function(a,s){e.$scope.$applyAsync(function(){return e.hasExtension=!1}),e.retryCount===t.config.maxRetryCount&&(e.retryCount=0),e.loadYammerFeed(s)})},a.prototype.createMessageHandler=function(t){var a=e.prototype.createMessageHandler.call(this,t);return a.addGenericMessageHandler(this.handleYammerEmbedEvents.bind(this)),a},a.prototype.onLoadHandler=function(){this.logger.info("Yammer iframe loaded"),this.retryCount=0,this.frameLoadedScenario&&(this.frameLoadedScenario.stop(),this.frameLoadedScenario=null)},a.prototype.onLoadErrorHandler=function(){this.loadFrameWithRetry("onLoadErrorHandler: Error while loading the embedded-page-container")},a.prototype.loadYammerFeed=function(e){var a=this,s=this.yammerSettings&&this.yammerSettings.broadcastId;if(s){this.frameLoadedScenario=this.loggingService.newScenario(t.config.scenarioIds.feed);var i=e||this.settingsService.getActiveTheme();this.yammerEmbedUrl=this.appConfig.broadcastSettings.yammerEmbedUrl.replace("{theme}",i).replace("{broadcastId}",s).replace("{container}",t.config.containerid),this.$scope.$applyAsync(function(){return a.hasExtension=!0}),this.loadFrameWithRetry()}else this.logger.error("loadYammerFeed: Yammer broadcastId is missing ["+s+"]")},a.prototype.loadFrameWithRetry=function(e){var a=this;this.retryCount<t.config.maxRetryCount?this.beginLoad(this.yammerEmbedUrl,!0).catch(function(e){var t;a.frameLoadedScenario&&a.frameLoadedScenario.mark("FrameLoadRetry",(t={},t[a.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({retryAttempt:++a.retryCount}),t)),a.loadFrameWithRetry("Frame load failed with error: "+JSON.stringify(e))}):(this.logger.error("loadFrameWithRetry: failed with error: "+e),this.showYammerLoadFailureMessage(),this.frameLoadedScenario&&(this.exceptionUtilityService.failScenarioIfOnline(this.frameLoadedScenario,this.getScenarioData(null,e)),this.frameLoadedScenario=null))},a.prototype.handleYammerEmbedEvents=function(e){this.isValidYammerEvent(e)&&this.broadcastYammerEventHandlers.get(e.data.message).call(this,e)},a.prototype.isValidYammerEvent=function(e){if(!e||!e.data||!e.data.message)return!1;var t=e.data.message;return!(!this.broadcastYammerEventHandlers||!this.broadcastYammerEventHandlers.get(t))},a.prototype.handleYammerEmbedTokenRequest=function(e){var a=this;e.source?(this.getYammerTokenScenario=this.loggingService.newScenario(t.config.scenarioIds.getToken),this.authenticationService.getAuthTokens([t.config.yammerDomain]).then(function(t){a.getYammerTokenScenario.mark("auth_token_received"),a.sdkWindowMessageHandler.postGenericMessage(e.source,{message:"loginWithAadToken",token:""+t}),a.logger.info("handleYammerEmbedTokenRequest: Fetched AAD token and posted a message to: "+e.source),a.getYammerTokenScenario.mark("auth_token_posted_to_yammer"),a.getYammerTokenScenario.stop(a.getScenarioData()),a.getYammerTokenScenario=null}).catch(function(e){a.logger.error("handleYammerEmbedTokenRequest: Failed to get auth token for the audience: "+t.config.yammerDomain),a.exceptionUtilityService.failScenarioIfOnline(a.getYammerTokenScenario,a.getScenarioData(null,e)),a.getYammerTokenScenario=null,a.showYammerLoadFailureMessage()})):this.logger.error("handleYammerEmbedTokenRequest: source frame is null")},a.prototype.handleAadTokenLoginStatusEvent=function(e){if(e.data.status){var a=this.loggingService.newScenario(t.config.scenarioIds.aadTokenLoginStatus);switch(e.data.status){case"success":this.retryCount=0,a.stop(this.getScenarioData({status:e.data.status}));break;case"failure":case"timeout":this.exceptionUtilityService.failScenarioIfOnline(a,this.getScenarioData({status:e.data.status})),this.showYammerLoadFailureMessage();break;case"abandoned":case"incomplete":default:a.cancel(this.getScenarioData({status:e.data.status}))}}else this.logger.error("handleAadTokenLoginStatusEvent: received invalid AAD token status: "+e.data.status)},a.prototype.getScenarioData=function(e,t){var a={};a[this.constants.categories.broadcastRole]=this.isByoeProducer?"producer":"attendee",this.call&&(a[this.constants.counters.eventNames.callId]=this.call.callId,a[this.constants.counters.eventNames.participantId]=this.call.participantId,a[this.constants.categories.broadcastRole]=this.call.broadcastMeeting&&this.call.broadcastMeeting.role||"unknown"),this.videoId&&(a[this.constants.counters.eventNames.streamId]=this.videoId);var s={};return e&&(s=i({},e)),s.yammerBroadcastId=this.yammerSettings&&this.yammerSettings.broadcastId,a[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(s),t&&(a[this.constants.scenarioDataPropNames.broadcastError]=JSON.stringify(t)),a},a.prototype.showYammerLoadFailureMessage=function(){this.ufdBanner=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Error,this.$translate.instant(this.resources.strings.broadcast_yammer_load_failure_ufd_message),this.constants.scenarios.broadcast.attendee.ufdBannerNames.yammerPanelLoadFailed,{autoHideTimer:10})},a}(r.ExtensionFrameBase);t.BroadcastYammerExtensionController=o,angular.module("teamspace.broadcastYammerExtension",["teamspace.loggingService","teamspace.utilityService","teamspace.constants","teamspace.eventingService","teamspace.authenticationService","teamspace.appStateAdapter","teamspace.exceptionUtilityService"]).component("broadcastYammerExtension",{bindings:{yammerSettings:"<",isAuthRequired:"<",call:"<?",videoId:"<?",isByoeProducer:"<?"},controllerAs:"ctrl",controller:o,templateUrl:"components/broadcast/common/yammer-extension/broadcast-yammer-extension.html"}).run(["$templateCache",function(e){e.put("components/broadcast/common/yammer-extension/broadcast-yammer-extension.html",n)}])},2066:function(e,t){e.exports='<div id="bcastYammerExtension" class="flex-fill broadcast-yammer-panel" ng-class="::{\'right-pane-header\': ctrl.customRightRailHeader}">\n  <right-pane-header ng-if="ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{ctrl.panelType}}" text="{{::$root.resources.strings.broadcast_yammer_header|translate}}" telemetry-bag="ctrl.telemetryBag"></right-pane-header>\n  <div ng-if="ctrl.hasExtension" class="yammer-panel-wrapper">\n    <embedded-page-container focusable="true" acc-focus-default iframe-title="{{::$root.resources.strings.broadcast_yammer_panel | translate}}" url="{{ctrl.frameSrc}}" enable-message-passing="true" on-content-loaded="ctrl.onContentLoaded(isSuccessful, frameInfo)" on-message-received="ctrl.onMessageReceived(source, data, origin)" skip-resize-handling="::ctrl.skipWebviewResizeHandling" page-identifier="broadcast_yammer_extension" load-timeout="::ctrl.loadTimeout" process-tag="yammerBroadcast">\n    </embedded-page-container>\n  </div>\n</div>'},2067:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2068),i=function(){function e(e,t,a,s){var i=this;this.resources=t,this.$translate=s,this.logger=e.newLogger("BroadcastStateIndicatorController"),a.$on("$destroy",function(){return i.onDestroy()})}return e.$inject=["loggingService","resources","$scope","$translate"],e.prototype.$onInit=function(){this.call&&this.call.broadcastMeeting?(this.broadcastMeetingSubscription=this.call.broadcastMeeting.changed(this.updateBroadcastState.bind(this)),this.updateBroadcastState()):this.logger.error("Broadcast object not available while initializing indicator")},e.prototype.updateBroadcastState=function(){var e=this.call.broadcastMeeting;if(e){var t=e.broadcastState;this.broadcastStatus=t&&t.status;var a=teamspace.services.BroadcastUtilities.getBroadcastStatusResourceString(this.broadcastStatus,this.resources,this.useShortFormat);this.stateString=this.$translate.instant(a)}else this.logger.error("Broadcast meeting object is null")},e.prototype.onDestroy=function(){this.broadcastMeetingSubscription&&(this.broadcastMeetingSubscription.dispose(),this.broadcastMeetingSubscription=null)},e}();t.BroadcastStateIndicatorController=i,angular.module("teamspace.broadcastStateIndicator",["teamspace.callingService","teamspace.callingNavigationService","teamspace.loggingService"]).component("broadcastStateIndicator",{bindings:{call:"<",useShortFormat:"<?"},controllerAs:"ctrl",controller:i,template:s})},2068:function(e,t){e.exports='<span class="ts-bcast-state-indicator {{ctrl.broadcastStatus}}">{{ctrl.stateString}}</span>'},2069:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2070),i=function(){function e(e,t,a,s,i,n,r){this.constants=e,this.resources=a,this.$scope=s,this.$translate=i,this.broadcastSignalRService=n,this.broadcastService=r,this.logger=t.newLogger("AttendeeCountIndicatorController"),this.registerEventListeners()}return e.$inject=["constants","loggingService","resources","$scope","$translate","broadcastSignalRService","broadcastService"],e.prototype.$onInit=function(){var e=this;if(this.call.isBroadcast&&this.call.broadcastMeeting){var t=0,a=this.broadcastSignalRService.getHubEventData(this.call.threadId,teamspace.services.HubSubscriberType.Producer);t=a&&a.getAttendeeCount()||0,this.updateAttendeeString(t),this.$scope.$on(this.constants.events.broadcast.signalRConnectionFailure,function(t){e.showStaleCountMessage=!0})}else this.logger.error("onInit: cannot get attendee count for a non broadcast meeting: "+this.call.threadId)},e.prototype.updateAttendeeString=function(e){this.attendeeString=this.$translate.instant(this.resources.strings.broadcast_attendee_count_mf,{attendeeCount:e},this.constants.translation.interpolationIds.messageformat)},e.prototype.registerEventListeners=function(){var e=this;this.$scope.$on(this.constants.events.broadcast.attendeeCountUpdate,function(t,a){e.logger.info("registerEventListeners: received attendee count update event"),e.updateAttendeeString(a.attendeeCount)})},e}();t.AttendeeCountIndicatorController=i,angular.module("teamspace.attendeeCountIndicator",["teamspace.loggingService","teamspace.broadcastSignalRService","teamspace.broadcastMeetingService","teamspace.broadcastService","teamspace.calendarService"]).component("attendeeCountIndicator",{bindings:{call:"<"},controllerAs:"ctrl",controller:i,template:s})},2070:function(e,t){e.exports='<div>\n  <span data-tid="bcast-attendee-count">{{ctrl.attendeeString}}</span>\n  <ng-include src="\'svg/icons-call-alert.html\'" class="icon-container" ng-if="ctrl.showStaleCountMessage" ng-attr-title="{{::$root.resources.strings.broadcast_stale_attendee_count_message|translate}}">\n  </ng-include>\n</div>'},2071:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2072),i=function(){return function(){}}();t.BroadcastBusyOverlayController=i,angular.module("teamspace.broadcastBusyOverlay",[]).component("broadcastBusyOverlay",{bindings:{text:"@",takeFocusFrom:"@"},controller:i,template:s})},2072:function(e,t){e.exports='<div class="bcast-busy-overlay-container">\n  <div class="bcast-busy-spinner-container">\n    <div class="bcast-busy-spinner">\n      <svg viewBox="0 0 500 15500" xmlns="http://www.w3.org/2000/svg">\n        <path fill="#545687" d="M241.37 4.46c39.62-1.14 79.5 7.5 114.99 25.17 52.79 26.01 95.47 71.81 117.6 126.35 16.66 40.54 21.87 85.62 15.33 128.94a242.74 242.74 0 0 1-36.81 96.55 245.25 245.25 0 0 1-72.12 71.78 242.5 242.5 0 0 1-101.47 36.99c-43.99 5.58-89.49-.96-129.98-19.09-50.8-22.51-93.35-62.99-118.39-112.6A243 243 0 0 1 4.24 245.97a243.04 243.04 0 0 1 40.4-132.25c29.04-44.01 72.71-78.19 122.5-95.59a243.1 243.1 0 0 1 74.23-13.67m-.01 32.85A210.63 210.63 0 0 0 140.7 66.67a212.32 212.32 0 0 0-81.82 88.24 210.7 210.7 0 0 0 16.2 214.05 212.3 212.3 0 0 0 84.24 70.73 210.67 210.67 0 0 0 199.51-11.82 212.21 212.21 0 0 0 78.31-85.81 210.6 210.6 0 0 0-12.6-209.5 212.3 212.3 0 0 0-77.49-70.67 210.65 210.65 0 0 0-105.69-24.58z"/>\n        <path fill="#4b4d79" opacity=".9" d="M141.7 528.74c42.01-20.52 90.02-28.29 136.39-22.55a242.72 242.72 0 0 1 109.07 41.64c49.66 34.36 86.05 87.71 98.84 146.81-2.53-5.47-7.88-9.69-14-10.04-7.45-.74-14.91 4.33-16.98 11.51-1.11 3.29-.71 6.81-.13 10.16-11.28-57.68-48.4-109.47-98.92-139.35a210.54 210.54 0 0 0-219.66 2.43 212.2 212.2 0 0 0-80.01 90.97 210.72 210.72 0 0 0-17.41 115.61 210.37 210.37 0 0 0 36.61 93.62 212.32 212.32 0 0 0 83.15 69.83c45.63 21.59 99.12 25.84 147.6 11.77a211.42 211.42 0 0 0 93.06-55.77c27.95-28.68 47.66-65.43 55.5-104.73-1.09 5.04-.5 10.65 2.78 14.8 4.4 6.09 13.21 8.29 19.97 5.04 3.93-1.74 6.83-5.17 8.6-9.01-13.83 63.86-55.02 121.01-110.8 154.92A243 243 0 0 1 251 992.15a243.18 243.18 0 0 1-133.38-37.79 245.31 245.31 0 0 1-67.86-64.13A242.78 242.78 0 0 1 6.97 784.99c-7.15-47.02-.34-96.13 19.78-139.26 23.37-50.66 64.71-92.74 114.95-116.99z"/>\n        <path fill="#f2f3ff" d="M455.02 696.11c2.07-7.18 9.53-12.25 16.98-11.51 6.12.35 11.47 4.57 14 10.04 5.65 22.63 6.77 46.21 5.64 69.45-1 12.56-2.41 25.16-5.48 37.39-1.77 3.84-4.67 7.27-8.6 9.01-6.76 3.25-15.57 1.05-19.97-5.04-3.28-4.15-3.87-9.76-2.78-14.8a209.96 209.96 0 0 0 .08-84.38c-.58-3.35-.98-6.87.13-10.16z"/>\n        <path fill="#43446c" opacity=".8" d="M232.04 1004.9a244.04 244.04 0 0 1 103.6 15.63c55.25 21.07 102.09 63.08 129.17 115.64 1.23 2.83 3.26 5.45 3.76 8.5-4.98-4.78-12.65-7.03-19.13-4-8.13 3.29-11.98 13.44-8.67 21.46a211.76 211.76 0 0 0-49.76-69.05 211.05 211.05 0 0 0-92.93-49.87 210.77 210.77 0 0 0-110.14 2.77c-40.71 12.05-77.47 36.84-104.08 69.91a210.72 210.72 0 0 0-45.91 113.1 210.5 210.5 0 0 0 20.48 111.68 212.07 212.07 0 0 0 70.37 81.58c42.63 29.54 96.45 42.35 147.82 35.13 44.21-5.9 86.25-26.44 118.2-57.53 18.79-18.05 33.88-39.73 45.07-63.21-1.42 7.09 1.55 15.05 8.1 18.5 7.24 4.28 17.13 1.68 21.81-5.18-15.72 34.69-40.01 65.42-69.77 89.15A243.03 243.03 0 0 1 288 1488.92c-46.52 7.68-95.26 1.7-138.37-17.45-51.8-22.75-95.09-64.17-120.11-114.91-31.77-63.27-33.67-140.54-5.23-205.35a245.02 245.02 0 0 1 94.87-110.01 242.5 242.5 0 0 1 112.88-36.3z"/>\n        <path fill="#e5e6ff" d="M449.44 1140.67c6.48-3.03 14.15-.78 19.13 4 2.47 3.44 3.84 7.52 5.5 11.39 25.28 61.5 24.06 133.66-4.27 193.9-4.68 6.86-14.57 9.46-21.81 5.18-6.55-3.45-9.52-11.41-8.1-18.5 11.81-26.29 18.63-54.83 19.2-83.68a211.3 211.3 0 0 0-18.32-90.83c-3.31-8.02.54-18.17 8.67-21.46z"/>\n        <path fill="#3a3c5e" opacity=".7" d="M167.17 1518.12c42.12-14.87 88.34-17.7 132-8.41 56.44 11.86 108.14 44.71 142.9 90.72l.69 1.29c-6.02-4.59-15.05-4.9-20.92.08-6.35 4.92-7.75 14.4-3.85 21.27-20.85-28.08-48.6-51.03-80.29-65.87a210.58 210.58 0 0 0-210.4 18.12 212.11 212.11 0 0 0-76.6 98.38 210.75 210.75 0 0 0-9.83 114.41 210.84 210.84 0 0 0 46.39 96.63 211.93 211.93 0 0 0 81.83 59.2c46.64 19.04 100.14 20.44 147.72 3.88 40.16-13.74 75.72-40.11 101.03-74.13-2.15 4.37-2.82 9.6-.97 14.2a16.43 16.43 0 0 0 16.17 10.48c4-.1 7.69-2 10.69-4.55-23.34 31.79-54.84 57.49-90.37 74.55-39.38 18.94-83.94 26.78-127.44 22.8a243.13 243.13 0 0 1-133.26-54.95 244.8 244.8 0 0 1-68.23-90.58C8.04 1808.2 1.5 1766.6 5.23 1725.93a242.9 242.9 0 0 1 49.02-125.69c28.62-37.54 68.34-66.53 112.92-82.12z"/>\n        <path fill="#d8daff" d="M421.84 1601.8c5.87-4.98 14.9-4.67 20.92-.08 2.21 2.01 3.78 4.59 5.52 6.99 27.81 39.67 43.4 87.84 43.72 136.31a241.98 241.98 0 0 1-27.36 115.83c-6.11 11.49-12.79 22.79-20.91 32.97-3 2.55-6.69 4.45-10.69 4.55a16.43 16.43 0 0 1-16.17-10.48c-1.85-4.6-1.18-9.83.97-14.2 23.42-31.81 37.93-70.19 40.66-109.64 4.02-49.84-10.79-100.8-40.51-140.98-3.9-6.87-2.5-16.35 3.85-21.27z"/>\n        <path fill="#323351" opacity=".6" d="M168.42 2017.69a245.12 245.12 0 0 1 111.7-11.24c47.45 6.17 93.08 26.69 128.79 58.57-4.54-2.4-10.11-3.05-14.89-.97-6.64 2.66-10.95 10.03-9.96 17.12.23 2.7 1.51 5.11 2.62 7.53-1.4-.64-2.53-1.67-3.7-2.64a210.57 210.57 0 0 0-223.96-29.07 212.3 212.3 0 0 0-95.3 88.72 210.54 210.54 0 0 0-25.88 120.5 210.2 210.2 0 0 0 36.81 102.11 212.35 212.35 0 0 0 76.6 67.41c46.23 24.14 101.56 30.08 151.85 16.29 31.4-8.39 60.59-24.39 84.98-45.81-3.1 3.86-4.86 8.94-3.91 13.89a16.46 16.46 0 0 0 13.85 13.47c3.45.61 6.91-.32 10.1-1.59-1.07 1.6-2.74 2.65-4.15 3.92a243.06 243.06 0 0 1-111.03 52.16c-48.02 8.95-98.71 3.24-143.37-16.62-56.68-24.85-103.02-72.17-126.66-129.38a244.4 244.4 0 0 1-17.16-121.17 242.6 242.6 0 0 1 48.5-120.65c28.89-37.89 69.09-67.07 114.17-82.55z"/>\n        <path fill="#cbcdff" d="M394.02 2064.05c4.78-2.08 10.35-1.43 14.89.97 28.84 24.69 51.23 56.75 65.49 91.89 26.77 65.54 22.95 142.75-10.46 205.22a243.55 243.55 0 0 1-40.73 56.03c-4.86 4.76-9.46 9.95-15.09 13.82-3.19 1.27-6.65 2.2-10.1 1.59a16.46 16.46 0 0 1-13.85-13.47c-.95-4.95.81-10.03 3.91-13.89a213.9 213.9 0 0 0 46.31-58.79 210.59 210.59 0 0 0 22.98-126.3c-5.99-48.3-29.7-94.05-65.36-127.14-1.83-1.7-3.72-3.35-5.33-5.28-1.11-2.42-2.39-4.83-2.62-7.53-.99-7.09 3.32-14.46 9.96-17.12z"/>\n        <path fill="#292a43" opacity=".5" d="M117.99 2541.93a242.82 242.82 0 0 1 120.07-37.36c45.09-1.9 90.76 8.86 129.96 31.31-6.38-2.42-14.15-.69-18.56 4.61-5.95 6.54-4.89 17.27 1.42 23.2a60.94 60.94 0 0 1-5.8-2.83 210.6 210.6 0 0 0-217.76 14.44 212.14 212.14 0 0 0-75.22 94.81 210.7 210.7 0 0 0 27.59 205.18 212.2 212.2 0 0 0 79.6 64.38c46.88 22.01 101.95 25.69 151.35 10.17 14.45-4.44 28.3-10.63 41.52-17.91-6.44 4.84-8.75 14.41-4.57 21.43 3.63 6.85 12.33 9.97 19.61 7.61-31.33 18.13-67.13 28.31-103.2 30.69-48.2 3.22-97.29-8.24-138.94-32.76a245.28 245.28 0 0 1-71.01-62.87A242.76 242.76 0 0 1 6.62 2782.6c-6.02-42.55-.71-86.69 15.6-126.46 19-46.81 53.03-87.3 95.77-114.21z"/>\n        <path fill="#bec1ff" d="M349.46 2540.49c4.41-5.3 12.18-7.03 18.56-4.61 45.83 25.51 82.7 66.59 103.68 114.63 16.26 36.96 22.89 78.01 19.5 118.22a242.21 242.21 0 0 1-38.74 112.85 244.83 244.83 0 0 1-82.7 78.2c-.83.46-1.68.85-2.56 1.19-7.28 2.36-15.98-.76-19.61-7.61-4.18-7.02-1.87-16.59 4.57-21.43 32.89-18.81 60.74-46.42 79.43-79.41 22.29-38.89 31.5-85.03 26.03-129.5a209.07 209.07 0 0 0-26.26-79.41 212.33 212.33 0 0 0-66.71-71.26c-4.48-3.07-9.27-5.64-13.77-8.66-6.31-5.93-7.37-16.66-1.42-23.2z"/>\n        <path fill="#212236" opacity=".4" d="M217.89 3006.22a245.74 245.74 0 0 1 104.13 9.52c-8.08-1.81-16.98 3.23-19.24 11.24-2.47 7.31 1.2 15.55 7.68 19.43-19.35-5.47-39.32-9.04-59.47-9.2a210.82 210.82 0 0 0-114.63 32.1 212.22 212.22 0 0 0-83.68 99.35 210.71 210.71 0 0 0 24.9 203.79 212.23 212.23 0 0 0 76.33 64.63 210.97 210.97 0 0 0 98.11 22.22c20.11-.32 40.09-3.78 59.34-9.57-7.01 3.49-11.08 12.03-8.66 19.61 2.05 7.53 9.88 12.51 17.55 11.79-39.02 12.56-81.38 14.16-121.5 6.04-51.56-10.47-99.29-38.39-133.91-77.97a243.66 243.66 0 0 1-50.11-89.88 245.5 245.5 0 0 1-1.23-137.92c13.67-48.45 42.95-92.25 82.29-123.63a242.9 242.9 0 0 1 122.1-51.55z"/>\n        <path fill="#b1b5ff" d="M302.78 3026.98c2.26-8.01 11.16-13.05 19.24-11.24 58.01 18.12 108.33 59.12 138.24 111.97 24.51 42.79 35.29 93.16 30.84 142.24a242.33 242.33 0 0 1-37.82 110.38c-28.32 44.09-71.19 78.65-120.39 96.76-4.17 1.45-8.29 3.18-12.64 4.04-7.67.72-15.5-4.26-17.55-11.79-2.42-7.58 1.65-16.12 8.66-19.61 32.96-10.56 63.39-29.04 87.55-53.87a210.83 210.83 0 0 0 54.61-196.13 210.77 210.77 0 0 0-43.89-87.27 211.63 211.63 0 0 0-85.18-60.96c-4.61-1.86-9.37-3.28-13.99-5.09-6.48-3.88-10.15-12.12-7.68-19.43z"/>\n        <path fill="#191928" opacity=".3" d="M208 3507.65a249.35 249.35 0 0 1 57.11-2.73 38 38 0 0 1 4.23.68c-3.54.93-7.05 2.47-9.51 5.27-5.01 5.26-5.75 13.93-1.74 19.98 1.93 3.19 5.14 5.28 8.42 6.88-3.82-.09-7.64-.16-11.45-.41a210.64 210.64 0 0 0-116.88 30.87 212.26 212.26 0 0 0-83.1 94.84 210.6 210.6 0 0 0 23.32 210.53 212.22 212.22 0 0 0 70.9 61.14 210.59 210.59 0 0 0 104.66 24.54c3.9-.28 7.8-.22 11.7-.15-5.96 2.93-10.51 9.02-10.16 15.87.01 8.14 6.85 15.22 14.87 16.01-47.02 4.79-95.36-5.17-137.02-27.43-52.75-28-94.47-76.04-114.65-132.26a245.45 245.45 0 0 1-8.27-137.94c11.29-49.62 38.81-95.3 77.17-128.72a243.16 243.16 0 0 1 120.4-56.97z"/>\n        <path fill="#a4a8ff" d="M259.83 3510.87c2.46-2.8 5.97-4.34 9.51-5.27 1.51-.14 3.04-.04 4.56.08a242.53 242.53 0 0 1 111.52 40.92c43.64 29.63 77.24 73.77 93.96 123.82a245.53 245.53 0 0 1 3 146.11 243.54 243.54 0 0 1-49.17 90.66c-33.55 39.2-79.81 67.35-130.14 78.8-10.77 2.34-21.68 4.51-32.7 4.98-8.02-.79-14.86-7.87-14.87-16.01-.35-6.85 4.2-12.94 10.16-15.87 5.07-1.22 10.29-1.47 15.42-2.35a210.31 210.31 0 0 0 98.94-43.75 211.99 211.99 0 0 0 63.63-85.18c16.59-40.52 19.97-86.26 9.72-128.82a210.35 210.35 0 0 0-42.01-84.45c-31.35-38.44-76.62-65.27-125.49-73.94-6.41-1.26-12.93-1.76-19.36-2.87-3.28-1.6-6.49-3.69-8.42-6.88-4.01-6.05-3.27-14.72 1.74-19.98z"/>\n        <path fill="#999df7" d="M222.17 4005.72c38.27-4.1 77.52.93 113.45 14.78 57.11 21.75 105.19 65.91 131.84 120.89 21.1 42.98 28.82 92.26 22.4 139.67a242.56 242.56 0 0 1-41.38 106.38 245.16 245.16 0 0 1-80.05 73.08c-44.04 25.16-96.11 35.82-146.51 30.24a18.37 18.37 0 0 1-4.33-1.11c-6.52-3.15-10.82-10.53-9.44-17.79.94-6.79 6.6-12.01 13.06-13.67 3.91-.11 7.81.2 11.7.58a210.92 210.92 0 0 0 113.83-23.99 212.27 212.27 0 0 0 79.93-74.15 210.36 210.36 0 0 0 31.64-93.59 210.52 210.52 0 0 0-18.78-107.56 212.15 212.15 0 0 0-62.08-77.85 210.95 210.95 0 0 0-137.06-44.27c-6.26.14-12.47 1.01-18.72 1.09-6.53-1.54-12.37-6.62-13.46-13.43-1.49-7.06 2.41-14.34 8.59-17.78a18.86 18.86 0 0 1 5.37-1.52z"/>\n        <path fill="#10111b" opacity=".2" d="M63.67 4088.68c38.12-44.24 92.62-74.28 150.59-81.88l2.54.44c-6.18 3.44-10.08 10.72-8.59 17.78 1.09 6.81 6.93 11.89 13.46 13.43-2.56.49-5.09 1.12-7.66 1.56a210.27 210.27 0 0 0-100.93 46.18 211.74 211.74 0 0 0-66.49 99.4 210.94 210.94 0 0 0-3.58 112.42 211 211 0 0 0 49.86 93.07c31.51 34.38 74.69 57.99 120.79 65.35 2.55.45 5.04 1.14 7.55 1.76-6.46 1.66-12.12 6.88-13.06 13.67-1.38 7.26 2.92 14.64 9.44 17.79l-3.52.11c-51.89-6.99-101.08-31.7-138.09-68.69a244.15 244.15 0 0 1-58.32-92.76 245.4 245.4 0 0 1-10.6-117.35 243.05 243.05 0 0 1 56.61-122.28z"/>\n        <path fill="#8f93e7" d="M239.38 4504.5a243.72 243.72 0 0 1 116.46 24.86c53.27 26.08 96.3 72.31 118.43 127.35 17.47 42.9 22.12 90.82 13.66 136.33a242.77 242.77 0 0 1-41.14 96.77 245.04 245.04 0 0 1-77.1 69.97c-59.28 34.48-133.46 41.95-198.41 19.97-8.11-3.18-12.21-13.44-8.67-21.38 3.02-7.83 12.53-12.1 20.41-9.27a211.82 211.82 0 0 0 131.45-.5 211.59 211.59 0 0 0 91.63-60.55 210.71 210.71 0 0 0 46.74-191.07 210.78 210.78 0 0 0-37.1-76.8 211.96 211.96 0 0 0-87.83-67.27 211.33 211.33 0 0 0-142.86-6.09c-3.55 1.2-7.41 2.06-11.12 1.01-6.83-1.54-12.22-7.89-12.53-14.91a16.37 16.37 0 0 1 7.57-14.95c2.45-1.54 5.29-2.23 8.02-3.09a244.09 244.09 0 0 1 62.39-10.38z"/>\n        <path fill="#8589d7" d="M239.41 5004.52a243.53 243.53 0 0 1 116.48 24.88c52.74 25.84 95.44 71.41 117.74 125.76 17.04 41.05 22.32 86.8 15.51 130.7a242.56 242.56 0 0 1-38.24 98 245.1 245.1 0 0 1-73.65 71.36 242.48 242.48 0 0 1-106.04 35.87c-47.07 4.49-95.41-4.95-137.17-27.19-4.91-2.87-10.84-4.95-13.79-10.18-4.27-6.87-2.38-16.7 4.17-21.47 5.59-4.4 13.8-4.29 19.61-.35 47.65 27.37 106.2 34.62 159.15 20.11a211.37 211.37 0 0 0 96.67-57.19 211.14 211.14 0 0 0 53.37-96.78c12.3-49.87 5.39-104.13-19.05-149.31a212.32 212.32 0 0 0-79.35-82.49 210.7 210.7 0 0 0-100.1-28.94 210.55 210.55 0 0 0-111.69 27.88c-5.98 3.74-14.3 3.1-19.54-1.66-8.08-6.65-7.04-20.79 2-26.1a242.5 242.5 0 0 1 113.92-32.9z"/>\n        <path fill="#7b7fc7" d="M241.4 5504.45a243.63 243.63 0 0 1 114.94 25.17c52.31 25.77 94.7 70.97 117.01 124.86 17.26 41.24 22.65 87.28 15.78 131.44a242.54 242.54 0 0 1-39.04 99.14 245.07 245.07 0 0 1-73.46 70.55 242.5 242.5 0 0 1-101.57 35.08 244.36 244.36 0 0 1-121.93-17.71 243.48 243.48 0 0 1-68.5-43.72 16.46 16.46 0 0 1-4.37-16.93c1.85-6 7.42-10.62 13.67-11.29 4.9-.65 9.92 1.16 13.48 4.55a210.89 210.89 0 0 0 84.58 46.21 211.63 211.63 0 0 0 136.47-8.4 212.07 212.07 0 0 0 93.04-74.93 210.65 210.65 0 0 0-30.5-275.41 211.12 211.12 0 0 0-87.37-48.41 211.62 211.62 0 0 0-116.55 1.5 211.06 211.06 0 0 0-79.96 45.05 16.58 16.58 0 0 1-19.48 2.19c-6.75-3.78-9.95-12.62-7.16-19.84 1.75-5.19 6.54-8.29 10.42-11.78 41.74-35.44 95.75-56.04 150.5-57.32z"/>\n        <path fill="#7274b7" d="M239.41 6004.52a243.44 243.44 0 0 1 116.28 24.78c51.02 24.95 92.7 68.33 115.57 120.32 18.61 41.84 24.84 88.98 18.18 134.26a242.44 242.44 0 0 1-34.99 94.52 245.18 245.18 0 0 1-69.32 71.69 242.78 242.78 0 0 1-96.03 38.65c-43.64 7.39-89.3 2.8-130.47-13.52a244.53 244.53 0 0 1-107.99-83.79 16.5 16.5 0 0 1-.41-18.29 16.46 16.46 0 0 1 27.23-.66 212.31 212.31 0 0 0 78.45 65.69c46.46 22.81 101.43 27.34 151.06 12.77a211.33 211.33 0 0 0 95.77-59.18 210.88 210.88 0 0 0 52.47-102.79c10.51-52.31.01-108.42-28.71-153.38a212.4 212.4 0 0 0-79.44-73.7 210.94 210.94 0 0 0-114.97-24.09 209.82 209.82 0 0 0-98.86 33.38 213.33 213.33 0 0 0-55.97 53.11c-5.04 7.18-16.04 8.84-22.96 3.44-6.93-4.86-8.78-15.36-3.89-22.28a244.3 244.3 0 0 1 115.39-86.84 243.7 243.7 0 0 1 73.61-14.09z"/>\n        <path fill="#686aa7" d="M238.42 6504.56a243.45 243.45 0 0 1 117.95 25.08c51.39 25.33 93.22 69.39 115.8 122.05 18.04 41.63 23.9 88.35 17.12 133.19a242.58 242.58 0 0 1-40.39 101.91 245.31 245.31 0 0 1-72.92 69.23 242.61 242.61 0 0 1-108.93 35.42c-49.19 3.86-99.5-7.51-142.03-32.59A244.33 244.33 0 0 1 25.06 6847a16.46 16.46 0 0 1 4.36-18.54c5.63-5.09 14.82-5.4 20.78-.69 3.23 2.3 4.95 5.98 6.51 9.5a212.07 212.07 0 0 0 71.39 84.63 209.86 209.86 0 0 0 88.94 35.15c43.88 6.58 89.78-1.14 129.02-21.88a212.33 212.33 0 0 0 81.01-75.14 210.64 210.64 0 0 0 31.94-103.05 210.69 210.69 0 0 0-24.14-106.93 212.32 212.32 0 0 0-75.71-81.19 210.55 210.55 0 0 0-97.24-31.2 210.5 210.5 0 0 0-113.62 24.6 212.21 212.21 0 0 0-92.68 99.35c-2.02 4.98-6.43 8.97-11.73 10.1a16.37 16.37 0 1 1-19.02-21.68c21.42-49.18 59.76-90.69 106.94-116.18a242.91 242.91 0 0 1 106.61-29.29z"/>\n        <path fill="#5e6097" d="M241.33 7004.45a243.64 243.64 0 0 1 115.01 25.17c53.03 26.12 95.85 72.21 117.91 127.06 16.43 40.36 21.55 85.18 15.03 128.25a242.44 242.44 0 0 1-35.63 94.73 245.28 245.28 0 0 1-70.29 71.62 242.66 242.66 0 0 1-94.25 37.46c-46.33 7.87-94.91 2.16-138.01-16.63-51.54-22.22-94.81-62.87-120.25-112.89a239.32 239.32 0 0 1-21.5-61.15c-1.6-8.59 4.95-17.55 13.61-18.69 8.3-1.55 17.03 4.42 18.62 12.71a210.85 210.85 0 0 0 41.98 88.36 211.96 211.96 0 0 0 85.42 63.56c45.18 18.42 96.78 20.26 143.21 5.34a211.53 211.53 0 0 0 90.53-57.56 210.69 210.69 0 0 0 12.59-272.19 212.09 212.09 0 0 0-86.7-66.41 211.5 211.5 0 0 0-107.63-14.28 210.2 210.2 0 0 0-105.15 44.88c-37.48 30.04-64.23 73.19-74.14 120.22-1.42 8.47-10.23 14.73-18.7 13.14-8.84-1.12-15.44-10.41-13.57-19.13 9.46-45.83 32.72-88.64 65.76-121.75a243.64 243.64 0 0 1 120.93-66.35 245.72 245.72 0 0 1 45.22-5.47z"/>\n        <path fill="#545687" d="M239.36 7504.52a243.42 243.42 0 0 1 117.03 25.13c52.32 25.79 94.71 71.01 116.99 124.92 17.11 40.91 22.53 86.54 15.9 130.36a242.38 242.38 0 0 1-35.62 94.72 245.25 245.25 0 0 1-72.1 72.82 242.55 242.55 0 0 1-101.59 37.63 244.73 244.73 0 0 1-122.68-15.4c-51.7-20.62-95.76-59.61-122.64-108.35a243.17 243.17 0 0 1-30.42-119.28 242.95 242.95 0 0 1 40.06-132.8c28.77-43.86 72.03-78.04 121.46-95.65a243.1 243.1 0 0 1 73.61-14.1m1.94 32.79a210.82 210.82 0 0 0-122.04 43.92 211.93 211.93 0 0 0-71.41 100.48 210.9 210.9 0 0 0-5.74 112.39 211 211 0 0 0 49.34 95.43 211.83 211.83 0 0 0 80.52 55.55 210.63 210.63 0 0 0 192.35-20.72 212.13 212.13 0 0 0 73.13-82.93 210.79 210.79 0 0 0 17.86-133.39 210.47 210.47 0 0 0-35.7-82.66 212.25 212.25 0 0 0-72.55-63.49 210.8 210.8 0 0 0-105.76-24.58z"/>\n        <path fill="#4c4d7a" opacity=".91" d="M214.9 8006.61c45.1-6.18 91.91.4 133.4 19.2 52.05 23.33 95.29 65.57 119.85 117.06 21.13 43.78 28.43 93.98 21.14 142.02a242.57 242.57 0 0 1-40.46 102.01 245.01 245.01 0 0 1-73.46 69.49 242.66 242.66 0 0 1-108.29 35.05c-44.28 3.48-89.47-5.32-129.07-25.47a245.07 245.07 0 0 1-81.29-66.5 242.28 242.28 0 0 1-46.69-98.19c1.69 3.91 4.61 7.4 8.56 9.16a16.5 16.5 0 0 0 19.09-3.8c3.32-3.51 4.61-8.48 4.27-13.21a210.97 210.97 0 0 0 44.4 90.23 211.85 211.85 0 0 0 84.1 60.82c45.56 18.23 97.51 19.7 144.03 4.13a211.51 211.51 0 0 0 87.28-55.8 211.06 211.06 0 0 0 49.33-86.71 210.79 210.79 0 0 0-26.18-172.99 212.33 212.33 0 0 0-75.26-69.81 210.45 210.45 0 0 0-92.46-25.9 210.7 210.7 0 0 0-119.58 31.14c-48.09 29.39-83.41 78.76-95.52 133.82.37-7.61-4.56-15.29-12.1-17.21-8.12-2.5-17.23 2.46-20.04 10.36 10.87-49.98 38.21-96.11 76.55-129.93a243.16 243.16 0 0 1 128.4-58.97z"/>\n        <path fill="#f3f3ff" d="M9.95 8195.51c2.81-7.9 11.92-12.86 20.04-10.36 7.54 1.92 12.47 9.6 12.1 17.21a215.1 215.1 0 0 0-.14 91.07c.34 4.73-.95 9.7-4.27 13.21a16.5 16.5 0 0 1-19.09 3.8c-3.95-1.76-6.87-5.25-8.56-9.16a240.47 240.47 0 0 1-.08-105.77z"/>\n        <path fill="#44466d" opacity=".82" d="M142.43 8528.39c40.01-19.37 85.41-27.22 129.62-22.87a242.83 242.83 0 0 1 113.99 41.54c45.4 31.03 79.8 77.82 95.59 130.53a245.4 245.4 0 0 1-1.38 145.77c-18.84 58.95-61.22 109.83-115.64 139.25a243.64 243.64 0 0 1-128.67 29.26 242.86 242.86 0 0 1-124.37-41.47 245.6 245.6 0 0 1-85.7-101.44c4.18 7.32 14.14 10.52 21.68 6.56 7.25-3.39 10.66-12.27 8.48-19.82a212.89 212.89 0 0 0 60.59 77.52 210.75 210.75 0 0 0 92.9 42.54 210.8 210.8 0 0 0 125.2-15.06 212.15 212.15 0 0 0 85.1-69.85 210.55 210.55 0 0 0 27.57-192.07 211.5 211.5 0 0 0-54.88-84.31 211.34 211.34 0 0 0-85.28-48.81 210.88 210.88 0 0 0-115.32-.82 211.53 211.53 0 0 0-98.28 59.78 213.7 213.7 0 0 0-37.53 56.05c2.11-7.69-1.53-16.63-8.97-19.85-7.15-3.5-16.2-.71-20.68 5.72 23.27-51.32 65.19-93.81 115.98-118.15z"/>\n        <path fill="#e7e8ff" d="M26.45 8646.54c4.48-6.43 13.53-9.22 20.68-5.72 7.44 3.22 11.08 12.16 8.97 19.85a211.49 211.49 0 0 0-18.34 71.35 211.38 211.38 0 0 0 18.27 103.68c2.18 7.55-1.23 16.43-8.48 19.82-7.54 3.96-17.5.76-21.68-6.56-29.07-63.28-29.07-139.36.58-202.42z"/>\n        <path fill="#3c3e61" opacity=".72" d="M183.92 9012.9a245.41 245.41 0 0 1 141.21 3.87C383 9035.8 432.88 9077.54 462.04 9131c22.44 40.62 32.65 87.77 29.41 134.04a242.72 242.72 0 0 1-34.68 109.62 245.04 245.04 0 0 1-62.28 68.73 242.67 242.67 0 0 1-95.37 43.43c-45.06 9.61-92.84 6.24-136.03-9.88-43.58-16.23-82.56-45.12-110.13-82.62 3.43 2.61 7.65 4.4 12.03 4.05 7-.27 13.41-5.58 14.98-12.4 1.18-4.4.16-9.07-2.02-12.98a212.68 212.68 0 0 0 78.67 65.42c46.56 22.65 101.58 27.12 151.2 12.28a211.34 211.34 0 0 0 93.46-57.37 211.02 211.02 0 0 0 51.34-92.9c13.22-50.98 6.25-106.81-19.13-152.95a212.44 212.44 0 0 0-68.83-75.08 210.69 210.69 0 0 0-205.66-15.4c-31.75 14.77-59.55 37.68-80.49 65.72 1.6-3.61 2.51-7.66 1.6-11.57a16.46 16.46 0 0 0-15.09-12.99c-3.97-.36-7.71 1.24-11.09 3.14.89-2.36 2.8-4.1 4.28-6.09 31.91-39.69 76.52-69.03 125.71-82.3z"/>\n        <path fill="#dbdcff" d="M53.93 9101.29c3.38-1.9 7.12-3.5 11.09-3.14 7.19.3 13.73 5.91 15.09 12.99.91 3.91 0 7.96-1.6 11.57a214.31 214.31 0 0 0-28.68 53.38 211.22 211.22 0 0 0-11.13 97.85c4.25 35.67 18 70.11 39.25 99.05 2.18 3.91 3.2 8.58 2.02 12.98a16.41 16.41 0 0 1-14.98 12.4c-4.38.35-8.6-1.44-12.03-4.05-1.91-1.89-3.33-4.2-4.9-6.36a242.4 242.4 0 0 1-42.2-110.81c-7.02-57.27 7.19-116.87 39.53-164.69 2.74-3.79 5.06-8 8.54-11.17z"/>\n        <path fill="#343554" opacity=".63" d="M223 9505.65c44.54-4.63 90.35 3.17 130.69 22.68 53.31 25.45 96.66 70.99 119.39 125.52 19.5 46.18 24.04 98.42 13.19 147.33a242.87 242.87 0 0 1-43.7 94.36 245.09 245.09 0 0 1-81.21 68.81c-38.33 20.23-82.16 29.72-125.42 27.52-54.65-2.52-108.23-24.23-149.06-60.67 3.81 2.17 8.38 3.2 12.7 2.12a16.46 16.46 0 0 0 12.65-14.36c.54-4.11-1.01-8.09-2.96-11.62 15.69 13.09 32.8 24.63 51.5 33.02 46.32 21.29 100.46 24.8 149.16 9.7a211.53 211.53 0 0 0 92.82-58.31 211.24 211.24 0 0 0 47.21-81.83 210.81 210.81 0 0 0 7.57-87.97 210.36 210.36 0 0 0-31.83-87.6 212.24 212.24 0 0 0-72.76-69.2 210.54 210.54 0 0 0-217.27 4.6c-9.28 5.65-17.66 12.58-26.24 19.18 3.75-5.97 4-14.21-.58-19.82-4.63-6.24-13.59-7.89-20.51-4.7 1.5-2.16 3.79-3.55 5.73-5.26a242.93 242.93 0 0 1 128.93-53.5z"/>\n        <path fill="#ced0ff" d="M88.34 9564.41c6.92-3.19 15.88-1.54 20.51 4.7 4.58 5.61 4.33 13.85.58 19.82-2.67 2.85-5.64 5.39-8.42 8.12a212.45 212.45 0 0 0-35.51 45.5 210.2 210.2 0 0 0-28.09 116.42 209.66 209.66 0 0 0 33.63 104.02c10.58 16.5 23.76 31.17 38.23 44.35 1.95 3.53 3.5 7.51 2.96 11.62a16.46 16.46 0 0 1-12.65 14.36c-4.32 1.08-8.89.05-12.7-2.12-46.93-40.67-76.88-100.24-81.82-162.14a244.07 244.07 0 0 1 8.33-87.5 243.83 243.83 0 0 1 66.31-109.81c2.8-2.54 5.36-5.42 8.64-7.34z"/>\n        <g>\n          <path fill="#2d2e48" opacity=".54" d="M237.86 10004.58a243.65 243.65 0 0 1 114.45 23.09c50.96 23.97 93.04 66.19 116.8 117.26 21.71 46.04 28.16 98.97 18.65 148.94a242.9 242.9 0 0 1-49.58 107.28 244.74 244.74 0 0 1-93.04 70.96c-41.01 17.88-87 23.92-131.27 17.67a243.8 243.8 0 0 1-86.89-29.72c5.33 2.57 11.99 2.17 16.82-1.31a16.46 16.46 0 0 0 6.49-17.33c-.83-3.8-3.26-6.99-6.18-9.45 23.2 12.9 48.69 21.79 75.03 25.35a210.71 210.71 0 0 0 135.31-26.81 212.35 212.35 0 0 0 78.19-79.9 210.66 210.66 0 0 0-7.74-217.5 212.25 212.25 0 0 0-73.92-69.07 210.59 210.59 0 0 0-199.35-3.43c-1.92.99-3.77 2.16-5.88 2.72 5.24-5.4 6.77-14.24 2.6-20.7-4.32-7.47-14.78-10.04-22.17-5.72a244 244 0 0 1 111.68-32.33z"/>\n          <path fill="#c2c5ff" d="M126.18 10036.91c7.39-4.32 17.85-1.75 22.17 5.72 4.17 6.46 2.64 15.3-2.6 20.7-2.15 1.72-4.59 3.01-6.92 4.44a211.9 211.9 0 0 0-83.7 95.13c-17.93 40.19-22.62 86.07-13.46 129.1a210 210 0 0 0 42.47 89c16.55 20.57 37.13 37.76 59.97 50.97 2.92 2.46 5.35 5.65 6.18 9.45a16.46 16.46 0 0 1-6.49 17.33c-4.83 3.48-11.49 3.88-16.82 1.31-49.08-27.94-87.85-73.5-107.47-126.47a243.76 243.76 0 0 1-14.39-106.65c4.37-53.1 27.09-104.41 63.2-143.57a245.09 245.09 0 0 1 57.86-46.46z"/>\n        </g>\n        <g>\n          <path fill="#25263b" opacity=".44" d="M173.95 10515.81a246.09 246.09 0 0 1 126.16-5.89 243.05 243.05 0 0 1 104.04 50.87c39.77 32.98 68.64 78.89 80.85 129.12 11.69 47.55 8.75 98.63-8.59 144.44-21.87 58.52-67.24 107.72-123.74 134.34-54.61 26.07-119.2 30.8-176.88 12.42 4.92.34 10.05-1.18 13.56-4.74a16.53 16.53 0 0 0 3.15-18.99c-1.47-3.14-4.13-5.48-6.96-7.38 22.83 6.66 46.65 10.2 70.45 9.18a210.74 210.74 0 0 0 107.8-34.46 212.46 212.46 0 0 0 72.03-80.05 210.71 210.71 0 0 0 22.58-114.55 210.45 210.45 0 0 0-27.8-87.78 212.48 212.48 0 0 0-78.96-77.94 210.92 210.92 0 0 0-105.71-27.2c-20.33.1-40.47 3.68-60 9.15 6.21-3.87 9.84-11.68 7.7-18.85-2.07-8.38-11.35-13.75-19.68-11.69z"/>\n          <path fill="#b6b9ff" d="M120.36 10540.39a240.68 240.68 0 0 1 53.59-24.58c8.33-2.06 17.61 3.31 19.68 11.69 2.14 7.17-1.49 14.98-7.7 18.85-4.98 1.98-10.13 3.49-15.08 5.53a211.63 211.63 0 0 0-103.45 87.47 209.6 209.6 0 0 0-30.03 98.62 210.3 210.3 0 0 0 25.44 111.23 211.53 211.53 0 0 0 80.03 81.94c13.47 7.9 27.94 13.88 42.7 18.86 2.83 1.9 5.49 4.24 6.96 7.38a16.53 16.53 0 0 1-3.15 18.99c-3.51 3.56-8.64 5.08-13.56 4.74-53.58-15.97-100.66-51.98-131.39-98.57a242.37 242.37 0 0 1-38.53-105.45 244.27 244.27 0 0 1 19.24-127.89 245.07 245.07 0 0 1 95.25-108.81z"/>\n        </g>\n        <g>\n          <path fill="#1d1e2f" opacity=".35" d="M226.59 11005.56c4.41-.91 8.94-.82 13.42-1.06a243.45 243.45 0 0 1 121.03 27.51c50.87 26.46 91.78 71.44 113.2 124.64 16.97 41.67 21.86 88.07 14.39 132.41a242.8 242.8 0 0 1-41.84 100.74 245.23 245.23 0 0 1-66.45 63.46 242.57 242.57 0 0 1-113.31 38.18c-13.56.87-27.28 1.31-40.77-.51 7.47-.95 13.88-7.3 14.41-14.89.83-7.21-3.81-14.14-10.33-16.98 3.58-.33 7.17-.04 10.76.15a210.64 210.64 0 0 0 111.5-27.63 212.31 212.31 0 0 0 74.47-71.56 210.67 210.67 0 0 0 11.49-202.65 212.18 212.18 0 0 0-66.88-80.1 210.52 210.52 0 0 0-96.67-38.34c-15.34-2.06-30.88-2.11-46.29-.97 7.21-2.17 12.65-9.34 11.99-16.98-.28-7.71-6.65-14.15-14.12-15.42z"/>\n          <path fill="#aaaeff" d="M137.12 11030.97a242.75 242.75 0 0 1 80.8-24.8c2.87-.31 5.77-.81 8.67-.61 7.47 1.27 13.84 7.71 14.12 15.42.66 7.64-4.78 14.81-11.99 16.98-29.76 3.03-58.99 11.92-84.95 26.86a212.16 212.16 0 0 0-88.05 96.66c-17.3 38.08-22.71 81.37-15.61 122.57a210.32 210.32 0 0 0 41.26 93.54c32.83 42.56 82.43 71.78 135.67 79.43 4.42.75 8.96.85 13.3 2.04 6.52 2.84 11.16 9.77 10.33 16.98-.53 7.59-6.94 13.94-14.41 14.89-12.36-.41-24.57-2.99-36.59-5.77-57.4-13.91-109-49.75-142.41-98.41A242.47 242.47 0 0 1 5.99 11278c-5.63-45.59 1.86-92.75 21.64-134.23 22.78-48.27 61.93-88.56 109.49-112.8z"/>\n        </g>\n        <g>\n          <path fill="#9ea2ff" d="M104.88 11550.79c48.51-35.53 110.58-51.91 170.3-44.9l2.45.57c7.24 2.84 12.09 10.9 10.39 18.64-1.13 6.85-7.05 11.93-13.64 13.38-2.82-.07-5.63-.24-8.44-.5a211.03 211.03 0 0 0-108.16 19.61 212.43 212.43 0 0 0-95.04 89.97 210.56 210.56 0 0 0 5.61 211.09 212.36 212.36 0 0 0 77.1 73.91 210.78 210.78 0 0 0 118.49 26.15c3.54-.35 7.1-.6 10.66-.58 6.71 1.47 12.6 6.88 13.51 13.86 1.32 7.28-3.05 14.67-9.63 17.74-1.4.57-2.89.87-4.38 1.07-46.21 5.01-93.82-3.46-135.33-24.42a244.89 244.89 0 0 1-79.99-64.29 243.41 243.41 0 0 1-44.76-85.05 245.57 245.57 0 0 1-.29-136.58c14.82-51.78 47.53-98.12 91.15-129.67z"/>\n          <path fill="#151622" opacity=".26" d="M277.63 11506.46c4.17-.1 8.26.84 12.37 1.49a242.85 242.85 0 0 1 104.13 44.92c43.78 32.61 76.12 80.29 89.88 133.15a245.52 245.52 0 0 1-3.76 137.34c-18.55 58-59.85 108.21-113.04 137.81a242.81 242.81 0 0 1-84.27 28.55 24.6 24.6 0 0 1-4.46.01c6.58-3.07 10.95-10.46 9.63-17.74-.91-6.98-6.8-12.39-13.51-13.86 10.75-2.4 21.73-3.83 32.27-7.16a211.33 211.33 0 0 0 93.45-56.63 211.12 211.12 0 0 0 52.05-92.92c13.87-52.42 6.33-110.08-20.65-157.13-28.1-49.93-77.34-87.43-133.06-100.94-8-2.11-16.21-3.13-24.28-4.87 6.59-1.45 12.51-6.53 13.64-13.38 1.7-7.74-3.15-15.8-10.39-18.64z"/>\n        </g>\n        <g>\n          <path fill="#9397ee" d="M156.37 12022.19c52.82-21.58 113.29-23.67 167.49-5.85a18.3 18.3 0 0 1 5.28 2.87c5.87 5.19 7.6 14.5 3.32 21.19-2.39 4.2-6.82 6.56-11.3 7.87-4.53.47-8.86-1.06-13.11-2.39a211.36 211.36 0 0 0-125.99 1.97 211.73 211.73 0 0 0-99.06 69.16 210.64 210.64 0 0 0-25.24 222.25 212.2 212.2 0 0 0 66.28 79.6 210.44 210.44 0 0 0 81.95 36.18 211.78 211.78 0 0 0 91.88-1.63c6.49-1.48 12.77-3.72 19.24-5.28 6.63-.18 13.42 3.35 16.18 9.55 3.4 6.85 1.04 15.52-4.87 20.21-3.29 2.28-7.27 3.16-11.04 4.33-50.77 15.05-106.44 13.02-155.93-5.87-56.47-21.29-104.26-64.44-131.26-118.41-18.39-36.28-27.25-77.26-25.86-117.89a243.11 243.11 0 0 1 39.51-125.14 244.83 244.83 0 0 1 112.53-92.72z"/>\n          <path fill="#0d0e16" opacity=".16" d="M329.14 12019.21c1.44-.06 2.86.09 4.24.46 53.42 19.8 99.29 59.05 127.2 108.71 22.77 40.03 33.58 86.66 31.11 132.63a242.66 242.66 0 0 1-33.84 111.84c-26.88 45.35-68.84 81.57-117.72 101.36-3.81 1.48-7.54 3.47-11.71 3.68 5.91-4.69 8.27-13.36 4.87-20.21-2.76-6.2-9.55-9.73-16.18-9.55 14.08-5.79 28.2-11.7 41.11-19.87a212.5 212.5 0 0 0 75.13-78.93 210.63 210.63 0 0 0-5.36-211.36c-24.93-40.78-64.1-72.52-109.1-88.59.75-.39 1.5-.75 2.27-1.11 4.48-1.31 8.91-3.67 11.3-7.87 4.28-6.69 2.55-16-3.32-21.19z"/>\n        </g>\n        <g>\n          <path fill="#898cdd" d="M239.38 12504.51a243.8 243.8 0 0 1 123.55 28.5c4.96 2.84 10.94 5.09 13.55 10.61 4.06 7.39 1.19 17.51-6.13 21.69-5.28 3.26-12.29 3.03-17.48-.31a210.5 210.5 0 0 0-116.8-27.44 210.5 210.5 0 0 0-104.02 34.54 212.24 212.24 0 0 0-78.52 94.53 210.71 210.71 0 0 0 32.78 216.97 211.97 211.97 0 0 0 79.29 58.88c45.72 19.62 98.46 22.19 145.89 7.16a213.7 213.7 0 0 0 42.49-18.71c7.42-4.37 17.9-1.48 22.07 6.04 4.46 7.17 2.13 17.54-5.06 22.01a242.34 242.34 0 0 1-120.02 33.16 243.04 243.04 0 0 1-137-40.13 245.35 245.35 0 0 1-72.64-74.33 242.39 242.39 0 0 1-35.49-101.16c-4.97-42.65 1.44-86.61 18.71-125.94a245.02 245.02 0 0 1 102.6-114.16 242.85 242.85 0 0 1 112.23-31.91z"/>\n        </g>\n        <g>\n          <path fill="#7e81cb" d="M239.36 13004.52a243.67 243.67 0 0 1 107.45 20.63 243.19 243.19 0 0 1 64.85 42.17c6.46 5.8 6.79 16.84.71 23.04-5.85 6.66-17.1 6.94-23.38.72a210.65 210.65 0 0 0-104.04-50.69 211.52 211.52 0 0 0-117.09 12.71 212.1 212.1 0 0 0-93.78 75.93 210.58 210.58 0 0 0-12.29 218.24 212.25 212.25 0 0 0 76 80.83c45.18 28.05 101.2 37.79 153.22 26.88a210.81 210.81 0 0 0 98.23-49.74c6.39-6.14 17.65-5.59 23.38 1.18 5.73 6.15 5.43 16.7-.66 22.51a242.83 242.83 0 0 1-89.53 51.71 245.46 245.46 0 0 1-127.46 5.72c-45.74-10.07-88.28-33.85-121.01-67.33a244.04 244.04 0 0 1-56.86-92.34 245.6 245.6 0 0 1-7.82-128.11c9.99-48.84 35.62-94.26 72.04-128.27 42.43-40.08 99.68-63.99 158.04-65.79z"/>\n        </g>\n        <g>\n          <path fill="#7477ba" d="M239.37 13504.52a243.57 243.57 0 0 1 116.29 24.78 244.72 244.72 0 0 1 84.94 69.14c3.04 4.21 7.11 8.15 7.8 13.56a16.47 16.47 0 0 1-9.77 17.63c-6.83 3.07-15.51.62-19.78-5.52a213 213 0 0 0-65.23-58.69 210.11 210.11 0 0 0-100.55-28.17 210.86 210.86 0 0 0-107.99 26.89 212.3 212.3 0 0 0-88.14 94.81 210.6 210.6 0 0 0 20.23 212.94 212.18 212.18 0 0 0 85.58 69.36c45.63 20.39 98.59 23.66 146.4 9.13 43.72-13.07 82.73-40.95 109.57-77.81a16.57 16.57 0 0 1 18.93-6.06 16.42 16.42 0 0 1 10.91 14.54 16.54 16.54 0 0 1-3.42 11.05 245.22 245.22 0 0 1-82.45 71.54c-38.63 20.68-82.93 30.44-126.68 28.23a242.9 242.9 0 0 1-125.61-42.27 245.29 245.29 0 0 1-69.85-73.19 242.78 242.78 0 0 1-35.83-112.45c-2.9-44.39 6.54-89.55 27.31-128.91a245.1 245.1 0 0 1 114.38-108.54 243.02 243.02 0 0 1 92.96-21.99z"/>\n        </g>\n        <g>\n          <path fill="#696ca9" d="M239.35 14004.52a243.96 243.96 0 0 1 110.25 21.91c53.95 24.54 98.34 69.46 121.89 123.88 3.06 8.01-1.5 17.81-9.55 20.7-7.98 3.33-17.92-.96-21.1-8.96a212.21 212.21 0 0 0-61.68-79.24 210.14 210.14 0 0 0-103.24-43.79c-36.7-4.88-74.66.09-108.81 14.39a212.17 212.17 0 0 0-97.82 82.91 210.56 210.56 0 0 0-6.11 213.52 212.32 212.32 0 0 0 73.39 77.51 210.54 210.54 0 0 0 98.37 31.56 210.57 210.57 0 0 0 118.42-27.65 212.4 212.4 0 0 0 87.36-96.53c2.23-5.46 7.44-9.6 13.35-10.2a16.41 16.41 0 0 1 17.03 22.7 244.36 244.36 0 0 1-54.99 77.89 243.93 243.93 0 0 1-98.86 57.09 245.45 245.45 0 0 1-139.16-.24c-53.22-15.78-100.46-50.53-131.62-96.44a242.7 242.7 0 0 1-40.56-108.45c-5.33-44.83 1.94-91.14 21.15-132.02 23.42-50.36 64.61-92.16 114.62-116.31a242.8 242.8 0 0 1 97.67-24.23z"/>\n        </g>\n        <g>\n          <path fill="#5f6198" d="M240.43 14504.49a243.43 243.43 0 0 1 119.97 27.19c50.97 26.31 92.03 71.2 113.59 124.36a242.59 242.59 0 0 1 12.65 40.99 16.53 16.53 0 0 1-4.71 15.89 16.49 16.49 0 0 1-18.57 2.71 16.5 16.5 0 0 1-8.84-11.81 210.41 210.41 0 0 0-35.66-79.67 212.2 212.2 0 0 0-73.57-63.31 210.31 210.31 0 0 0-109.24-23.29 210.47 210.47 0 0 0-99.74 31.8 212.22 212.22 0 0 0-80.63 92.34A210.68 210.68 0 0 0 81 14877.01a212.08 212.08 0 0 0 87.43 66.66c45.89 18.89 98.51 20.78 145.63 5.17a211.35 211.35 0 0 0 88.28-56.47 210.63 210.63 0 0 0 52.06-99.16c.92-5.6 4.69-10.69 10.02-12.8 7.51-3.3 17.13.15 20.79 7.51 2.49 4.4 2.15 9.7.81 14.42a243.4 243.4 0 0 1-45.61 96.02 245.17 245.17 0 0 1-77.14 64.98 243.06 243.06 0 0 1-111.28 28.79 243.09 243.09 0 0 1-121.14-29.95c-50.89-27.79-91.22-74.32-111.34-128.71-16.42-43.88-19.65-92.52-9.51-138.24 10.79-49.21 37.51-94.69 75.01-128.31 42.27-38.31 98.37-60.91 155.42-62.43z"/>\n        </g>\n        <g>\n          <path fill="#545687" d="M241.42 15004.46a243.3 243.3 0 0 1 114.95 25.18c52.32 25.78 94.71 70.99 117 124.9 17.11 40.9 22.54 86.52 15.92 130.33a242.66 242.66 0 0 1-37.61 97.82 245.3 245.3 0 0 1-73.82 72.16 242.42 242.42 0 0 1-97.89 35.25c-41.56 5.45-84.51.11-123.35-15.67-53.96-21.7-99.48-63.45-125.81-115.31-20.02-38.97-29-83.44-26.05-127.13a242.87 242.87 0 0 1 45.65-126.59c30.6-42.44 75.18-74.65 125.2-90.08a243.44 243.44 0 0 1 65.81-10.86m-.1 32.85a210.66 210.66 0 0 0-104.39 31.65 212.17 212.17 0 0 0-81.55 93.4 210.6 210.6 0 0 0 25.19 214.09 211.93 211.93 0 0 0 89.23 67.77 210.92 210.92 0 0 0 143.16 4.88 211.59 211.59 0 0 0 92.19-59.97 210.99 210.99 0 0 0 50.23-101.01c10.14-51.61-.13-106.84-28.13-151.35a212.5 212.5 0 0 0-79.5-74.51 210.64 210.64 0 0 0-106.43-24.95z"/>\n        </g>\n      </svg>\n    </div>\n  </div>\n  <span take-focus-from="{{::$ctrl.takeFocusFrom}}" class="bcast-busy-overlay-status" data-tid="bcast-busy-overlay-status" tabindex="-1">{{::$ctrl.text}}</span>\n</div>\n'},2073:function(e,t){e.exports='<div class="ts-bcast-object">\n    <div class="meeting-objects" ng-if="ctrl.meetingObjectsViewModel">\n      <div ng-if="ctrl.isDeleted()" class="deleted-reports">\n        <div ng-if="ctrl.meetingObjectsViewModel.meetingObjects.isDeleted">\n            <span translate-once="{{::$root.resources.strings.broadcast_objects_deletemessage}}"></span>\n            <button class="ts-btn restore-btn small-font" ng-click="ctrl.restore()" ng-disabled="ctrl.restoreInProgress" ng-class="{\'disabled\': ctrl.restoreInProgress}" translate-once="{{::$root.resources.strings.broadcast_object_undo}}" take-focus-as="fromDeleteAllButton" send-focus-to="fromUndoButton" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.restoreMeetingObjects}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.restoreButtonInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{isByoe: \'{{ctrl.isByoe}}\'}" track-summary="Restore deleted meeting objects">\n            </button>\n        </div>\n        <span ng-if="ctrl.meetingObjectsViewModel.isExpired" translate-once="{{::$root.resources.strings.broadcast_objects_expired}}">\n        </span>\n      </div>\n      <div class="reports-wrapper" ng-if="ctrl.meetingObjectsViewModel.hasReports && !ctrl.isDeleted()">\n        <div class="report-header">\n          <div class="report-header-h1">\n            <label class="text" translate-once="{{::$root.resources.strings.broadcast_objects_summary}}">\n            </label>\n            <div class="header-button-wrapper">\n              <button class="ts-sym toggle-btn objects-arrow app-icons-fill-hover inset-border inset-border-themed" ng-click="ctrl.isCollapsed=!ctrl.isCollapsed" ng-class="{ \'flip-toggle\': ctrl.isCollapsed }" ng-attr-aria-label="{{(ctrl.isCollapsed ? $root.resources.strings.expand_broadcast_objects_summary : $root.resources.strings.collapse_broadcast_objects_summary) | translate}}">\n                  <ng-include src="\'svg/icons-dropdown.html\'"></ng-include>\n              </button>\n            </div>\n          </div>\n        </div>\n        <div class="report-body-footer" ng-if="!ctrl.isCollapsed">\n          <div class="report-body">\n            <broadcast-meeting-single-object resource="ctrl.meetingObjectsViewModel.meetingObjects.recording" is-byoe="ctrl.isByoe" thread-id="ctrl.threadId" ng-if="ctrl.meetingObjectsViewModel.meetingObjects.recording"></broadcast-meeting-single-object>\n            <broadcast-meeting-single-object resource="ctrl.meetingObjectsViewModel.meetingObjects.qnaReport" is-byoe="ctrl.isByoe" thread-id="ctrl.threadId" ng-if="ctrl.meetingObjectsViewModel.meetingObjects.qnaReport"></broadcast-meeting-single-object>\n            <broadcast-meeting-single-object resource="ctrl.meetingObjectsViewModel.meetingObjects.attendeeReport" is-byoe="ctrl.isByoe" thread-id="ctrl.threadId" ng-if="ctrl.meetingObjectsViewModel.meetingObjects.attendeeReport"></broadcast-meeting-single-object>\n            <div class="object-row vod-controls" ng-if="!ctrl.isByoe && ctrl.viewModel && ctrl.viewModel.isOrganizer">\n              <div class="text">\n                <span>{{::$root.resources.strings.broadcast_meeting_objects_edit_vod|translate}}</span>\n              </div>\n              <div class="right-button">\n                <button class="ts-sym edit-vod-button inset-border inset-border-themed" ng-if="!ctrl.updateVodInProgress" ng-click="::ctrl.toggleVodSettings()" aria-label="{{ctrl.viewModel.broadcastSettings.teamsStreamingSettings.isVodEnabled ?\n                                      $root.resources.strings.broadcast_meeting_objects_edit_vod_disable_message : $root.resources.strings.broadcast_meeting_objects_edit_vod_enable_message | translate}}">\n                  {{ctrl.viewModel.broadcastSettings.teamsStreamingSettings.isVodEnabled ?\n                    $root.resources.strings.broadcast_meeting_objects_edit_vod_disable_button : $root.resources.strings.broadcast_meeting_objects_edit_vod_enable_button | translate}}\n                </button>\n                <div class="download-progress" ng-if="ctrl.updateVodInProgress">\n                  <busy-animation size="small"></busy-animation>\n                </div>\n              </div>\n            </div>\n            <div class="ts-tree-header" ng-if="ctrl.meetingObjectsViewModel.meetingObjects.transcript">\n              <div class="expand-option-wrapper" ng-click="ctrl.isTranscriptExpanded = !ctrl.isTranscriptExpanded">\n                <div class="expand-button-wrapper">\n                  <button class="ts-sym icons-gray-06-triangle-fill" aria-label="{{::$root.resources.strings.broadcast_objects_transcript | translate}}" aria-expanded="{{ctrl.isTranscriptExpanded}}">\n                    <ng-include ng-if="!ctrl.isTranscriptExpanded" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                    <ng-include ng-if="ctrl.isTranscriptExpanded" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                  </button>\n                </div>\n                <div class="expand-label-wrapper">\n                  <span translate-once="{{::$root.resources.strings.broadcast_objects_transcript}}"></span>\n                </div>\n              </div>\n            </div>\n            <div class="ts-tree-group expanded-options" ng-if="ctrl.meetingObjectsViewModel.meetingObjects.transcript && ctrl.isTranscriptExpanded">\n              <broadcast-meeting-single-object ng-repeat="(key, value) in ctrl.meetingObjectsViewModel.meetingObjects.transcript.urls" resource="ctrl.meetingObjectsViewModel.meetingObjects.transcript" resource-id="::key" is-byoe="ctrl.isByoe" thread-id="ctrl.threadId"></broadcast-meeting-single-object>\n            </div>\n            <div class="ts-tree-header" ng-if="ctrl.showAdvancedOptions">\n              <div class="expand-option-wrapper" ng-click="ctrl.isAdvancedOptionsExpanded = !ctrl.isAdvancedOptionsExpanded">\n                <div class="expand-button-wrapper">\n                  <button class="ts-sym icons-gray-06-triangle-fill" aria-label="{{::$root.resources.strings.broadcast_objects_advanced_options | translate}}" aria-expanded="{{ctrl.isAdvancedOptionsExpanded}}">\n                    <ng-include ng-if="!ctrl.isAdvancedOptionsExpanded" src="\'svg/icons-triangle-right-small.html\'"></ng-include>\n                    <ng-include ng-if="ctrl.isAdvancedOptionsExpanded" src="\'svg/icons-triangle-down-small.html\'"></ng-include>\n                  </button>\n                </div>\n                <div class="expand-label-wrapper">\n                  <span translate-once="{{::$root.resources.strings.broadcast_objects_advanced_options}}"></span>\n                </div>\n              </div>\n            </div>\n            <div class="ts-tree-group expanded-options" ng-if="ctrl.showAdvancedOptions && ctrl.isAdvancedOptionsExpanded">\n              <broadcast-meeting-single-object resource="ctrl.meetingObjectsViewModel.meetingObjects.altRecording" is-byoe="ctrl.isByoe" text-to-show="::$root.resources.strings.broadcast_objects_secondary_recording | translate" thread-id="ctrl.threadId" ng-if="ctrl.meetingObjectsViewModel.meetingObjects.altRecording"></broadcast-meeting-single-object>\n            </div>\n          </div>\n          <hr class="division">\n          <div class="report-footer">\n            <button class="ts-btn refresh-btn small-font inset-border inset-border-themed" ng-click="!ctrl.refreshInProgress && ctrl.refresh()" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.refreshMeetingObjects}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.refreshButtonInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{isByoe: \'{{ctrl.isByoe}}\', hasMeetingObjects: true}" track-summary="Refresh meeting objects">\n              {{(ctrl.refreshInProgress ? $root.resources.strings.broadcast_meeting_objects_refresh_in_progress : $root.resources.strings.broadcast_meeting_objects_refresh)|translate}}\n            </button>\n            <button class="ts-btn delete-btn small-font inset-border inset-border-themed" ng-click="ctrl.deleteAll()" ng-disabled="ctrl.deleteInProgress" ng-class="{\'disabled\': ctrl.deleteInProgress}" translate-once="{{::$root.resources.strings.broadcast_object_deleteall}}" take-focus-as="fromUndoButton" send-focus-to="fromDeleteAllButton" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.deleteMeetingObjects}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.deleteButtonInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{isByoe: \'{{ctrl.isByoe}}\'}" track-summary="Delete meeting objects">\n            </button>\n          </div>\n      </div>\n    </div>\n    <div class="sdn-objects" ng-if="ctrl.meetingObjectsViewModel && ctrl.meetingObjectsViewModel.hasSdnReports">\n      <div class="hive-reports" ng-if="ctrl.showHiveReports()">\n        <ng-include class="hive-icon meeting-objects-brand-icon icon" src="\'svg/icons-hive.html\'"></ng-include>\n        <a href="{{::ctrl.meetingObjectsViewModel.meetingObjects.hive.url}}" title="{{::$root.resources.strings.broadcast_objects_hive_insights|translate}}" target="_blank" analytics-on="{{::$root.events.actions.click}}" analytics-event="{{::$root.events.tab.select}}" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.openHiveReports}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.resourceLinkInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.link}}" track-summary="Open hive reports" track-data="{resourceType: \'Hive\'}">\n          {{::$root.resources.strings.broadcast_objects_hive_insights|translate}}</a>\n      </div>\n      <div class="kollective-reports" ng-if="ctrl.showKollectiveReports()">\n        <ng-include class="kollective-icon meeting-objects-brand-icon icon" src="\'svg/icons-kollective.html\'"></ng-include>\n        <a href="{{::ctrl.meetingObjectsViewModel.meetingObjects.kollective.url}}" title="{{::$root.resources.strings.broadcast_objects_kollective|translate}}" target="_blank" analytics-on="{{::$root.events.actions.click}}" analytics-event="{{::$root.events.tab.select}}" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.openKollectiveReports}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.resourceLinkInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.link}}" track-summary="Open kollective reports" track-data="{resourceType: \'Kollective\'}">\n          {{::$root.resources.strings.broadcast_objects_kollective|translate}}</a>\n      </div>\n    </div>\n  </div>\n  <div class="no-meeting-objects" ng-if="!ctrl.meetingObjectsViewModel && (ctrl.shouldShowTmbResources || ctrl.shouldShowByoeResources)">\n    <div class="report-header">\n      <label class="text" translate-once="{{::$root.resources.strings.broadcast_objects_summary}}">\n      </label>\n      <div class="refresh-wrapper">\n        <button class="ts-btn refresh-btn small-font inset-border inset-border-themed" ng-click="!ctrl.refreshInProgress && ctrl.refresh()" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.refreshMeetingObjects}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.refreshButtonInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{isByoe: \'{{ctrl.isByoe}}\', hasMeetingObjects: false}" track-summary="Refresh meeting objects">\n          {{(ctrl.refreshInProgress ? $root.resources.strings.broadcast_meeting_objects_refresh_in_progress : $root.resources.strings.broadcast_meeting_objects_refresh)|translate}}\n        </button>\n      </div>\n    </div>\n    <p class="text" translate-once="{{::$root.resources.strings.broadcast_meeting_objects_available_after_broadcast}}">\n    </p>\n  </div>\n  <div class="stream-link-object" ng-if="::!!ctrl.streamExternalLink">\n    <ng-include class="stream-link-icon meeting-objects-brand-icon icon" src="\'svg/icons-msft-stream.html\'"></ng-include>\n    <a href="{{::ctrl.streamExternalLink}}" title="{{::$root.resources.strings.icons_msft_stream|translate}}" target="_blank" analytics-on="{{::$root.events.actions.click}}" analytics-event="{{::$root.events.tab.select}}" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.openStreamLink}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.resourceLinkInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.link}}" track-summary="Open stream link" track-data="{resourceType: \'Stream\'}">\n      {{::$root.resources.strings.icons_msft_stream|translate}}</a>\n  </div>\n  <div class="stream-recording-info" ng-if="::!!ctrl.streamExternalLink">\n    {{::$root.resources.strings.broadcast_byoe_stream_recording_info|translate}}\n  </div>\n</div>'},2074:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2075),i=a(133),n=a(133),r=function(){function e(e,t,a,s,i,n,r,o,c){this.$element=e,this.loggingService=t,this.resources=a,this.constants=s,this.$translate=i,this.utilityService=n,this.filesNotificationService=r,this.settingsService=o,this.broadcastMeetingService=c,this.logger=t.newLogger("BroadcastMeetingSingleObjectController"),this.isGettingShortLiveUrl={}}return e.$inject=["$element","loggingService","resources","constants","$translate","utilityService","filesNotificationService","settingsService","broadcastMeetingService"],e.prototype.$onInit=function(){this.resource?(this.logger.info("Rendering meeting object of type {0}",this.resource.type),this.resourceUrl=this.getUrlForMeetingResourceToDownload(),this.resourceIconPath="svg/icons-download.html"):this.logger.error("No resource available")},e.prototype.getText=function(){if(this.textToShow)return this.textToShow;var e="";switch(this.resource.type){case i.BroadcastMeetingObjectType.AttendeeReport:e=this.$translate.instant(this.resources.strings.broadcast_objects_attendee);break;case i.BroadcastMeetingObjectType.QnaReport:e=this.$translate.instant(this.resources.strings.broadcast_objects_qna);break;case i.BroadcastMeetingObjectType.Recording:e=this.$translate.instant(this.resources.strings.broadcast_objects_recording);break;case i.BroadcastMeetingObjectType.Transcript:e=this.$translate.instant("broadcast_captions_language_"+this.resourceId)}switch(this.resource.status){case n.BroadcastMeetingResourceStatusString.NotStarted:case n.BroadcastMeetingResourceStatusString.Pending:return this.$translate.instant(this.resources.strings.broadcast_objects_waiting_format,{objectName:e});case n.BroadcastMeetingResourceStatusString.Available:default:return e}},Object.defineProperty(e.prototype,"meetingObjectTitle",{get:function(){return this.canDownload()?this.$translate.instant(this.resources.strings.icons_download):this.$translate.instant(this.resources.strings.broadcast_objects_download_in_desktop)},enumerable:!0,configurable:!0}),e.prototype.download=function(){var e=this;this.downloadFrame||(this.downloadFrame=document.createElement("iframe"),this.downloadFrame.style.display="none",this.$element.find(".download-container").append(this.downloadFrame)),this.logger.info("User triggered download for report {0}. Url {1}",this.resource.type,this.resourceUrl),this.filesNotificationService.showDownloadingNotification(this.resources.strings.files_fileDownloadStartedCountSingular),this.getShortLiveUrl().then(function(t){e.utilityService.downloadFromUrl(t,e.settingsService.valueAsBoolean(e.constants.settings.names.isDesktopApp),e.downloadFrame)}).catch(function(t){e.filesNotificationService.showFailureNotification(e.resources.strings.files_fileDownloadFailed)})},e.prototype.canDownload=function(){return!(this.resource.type==i.BroadcastMeetingObjectType.Recording&&!this.settingsService.valueAsBoolean(this.constants.settings.names.isDesktopApp)&&!this.settingsService.valueAsBoolean(this.constants.settings.names.enableBroadcastRecordingDownloadOnWeb))},Object.defineProperty(e.prototype,"downloadMeetingObjectAriaLabel",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_object_download_title_format,{meetingObjectName:this.getText()})},enumerable:!0,configurable:!0}),e.prototype.getShortLiveUrl=function(){var e=this;return new Promise(function(t,a){var s=e.utilityService.generateUUID(),i=e.loggingService.newScenario(e.constants.scenarios.broadcast.getOneTimeUrl);i.cancelIfOffline=!0,i.eventData[e.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({type:e.resource.type,language:e.resourceId}),i.eventData[e.constants.categories.threadId]=e.threadId,i.eventData[e.constants.categories.requestId]=s,i.eventData[e.constants.categories.broadcastType]=e.isByoe?"byoe":"tmb",e.utilityService.isValidUrl(e.resourceUrl)||(e.logger.error("getShortTermUrl: Invalid url to download {0}",e.resourceUrl),i.fail(),a()),e.isGettingShortLiveUrl[e.resource.type]=!0,e.broadcastMeetingService.getMeetingReportsOneTimeDownloadableUrl(e.resourceUrl,s).then(function(a){e.logger.info("Successful got the one time url"),i.stop(),e.isGettingShortLiveUrl[e.resource.type]=!1,t(a.resourceUrl)}).catch(function(t){e.isGettingShortLiveUrl[e.resource.type]=!1,e.logger.error("Failed to get the one time url for resource {0}",e.resourceUrl),teamspace.services.BroadcastUtilities.handleBroadcastScenarioOnError(i,e.constants,t,null,[401,403,404]),a(t)})})},e.prototype.getUrlForMeetingResourceToDownload=function(){return this.resource.type!==i.BroadcastMeetingObjectType.Transcript?this.resource.url:this.resource.urls[this.resourceId]},e}();t.BroadcastMeetingSingleObjectController=r,angular.module("teamspace.broadcastMeetingSingleObject",["teamspace.loggingService","teamspace.filesNotificationService","teamspace.broadcastMeetingService"]).component("broadcastMeetingSingleObject",{bindings:{resource:"<",resourceId:"<",isByoe:"<",textToShow:"<",threadId:"<"},controllerAs:"ctrl",controller:r,templateUrl:"components/broadcast/producer/broadcast-meeting-objects/broadcast-meeting-single-object.html"}).run(["$templateCache",function(e){e.put("components/broadcast/producer/broadcast-meeting-objects/broadcast-meeting-single-object.html",s)}])},2075:function(e,t){e.exports='<div class="object-row {{ctrl.resource.status}}" ng-if="ctrl.resource && ctrl.resource.status != \'Deleted\' && ctrl.resourceUrl">\n  <div class="text">\n    <span>{{::ctrl.getText()}}</span>\n  </div>\n  <div class="right-icon" ng-if="ctrl.resource.status == \'Available\'">\n    <button class="ts-sym app-icons-fill-hover inset-border inset-border-themed" title="{{::ctrl.meetingObjectTitle}}" ng-disabled="!ctrl.canDownload()" ng-click="::ctrl.download()" ng-if="!ctrl.isGettingShortLiveUrl[ctrl.resource.type]" aria-label="{{::ctrl.downloadMeetingObjectAriaLabel}}" track-panel-type="{{::$root.trackConstants.panelType.meetingObjects}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.downloadMeetingObjects}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.downloadButtonInMeetingObjects}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{resourceType: \'{{ctrl.resource.type}}\', isByoe: \'{{ctrl.isByoe}}\'}" track-summary="Download meeting objects">\n      <ng-include src="::ctrl.resourceIconPath"></ng-include>\n    </button>\n    <div class="download-progress" ng-if="ctrl.isGettingShortLiveUrl[ctrl.resource.type]">\n        <busy-animation size="small">\n        </busy-animation>\n    </div>\n  </div>\n  <div class="download-container" ng-hide="true"></div>\n</div>\n'},2076:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2077),i=a(2078),n=a(2079),r=a(2080),o=1e4,c=function(){function e(e,t,a,s,i,n,c,l,d,p,g,u,h,m,b,v,S,y){var f=this;this.appConfig=e,this.$scope=t,this.$translate=a,this.constants=i,this.resources=n,this.broadcastPlaybackService=c,this.calendarService=l,this.conversationsService=d,this.ariaLiveService=p,this.authenticationService=g,this.eventingService=u,this.audioService=h,this.broadcastJoinService=m,this.settingsService=b,this.loggingService=v,this.objectLeaksDetector=S,this.$rootScope=y,this.isBYOEProducer=!1,this.isQuestionnaireEnabled=!1,this.shouldShowQuestionnaire=!1,this.isTranscriptionSuppressedPrevious=!1,this.showPostPlaybackScreen=!1,this.isQuestionnaireEnabled=!b.valueAsBoolean(i.settings.names.disableBroadcastAttendeeQuestionnaire),this.isAnonymous=g.isAnonymous(),this.broadcastPlaybackHostAlertsProvider=new r.BroadcastPlaybackHostAlertsProvider(n,a);var k;this.isQuestionnaireEnabled&&(k=s(function(){f.shouldShowQuestionnaire=!0},o)),t.$on("$destroy",function(){f.onDestroy(),s.cancel(k)})}return e.$inject=["appConfig","$scope","$translate","$timeout","constants","resources","broadcastPlaybackService","calendarService","conversationsService","ariaLiveService","authenticationService","eventingService","audioService","broadcastJoinService","settingsService","loggingService","objectLeaksDetector","$rootScope"],Object.defineProperty(e.prototype,"navCtx",{get:function(){return"broadcast-playback-host"},enumerable:!0,configurable:!0}),e.prototype.$onInit=function(){var e=this;this.activeBroadcastPlayback.type===teamspace.services.BroadcastPlaybackType.AMS?(this.amsAttendeeMeeting=this.activeBroadcastPlayback.attendeeMeeting,this.handleTranscriptionUpdate(this.amsAttendeeMeeting.transcription.isSuppressed),this.suppressTranscriptionSubscriptionCleanup=this.$rootScope.$on(this.constants.events.broadcast.suppressTranscriptionUpdate,function(t,a){e.loggingService.info("Received transcription suppression state update to: "+a),e.handleTranscriptionUpdate(a)})):this.activeBroadcastPlayback.type===teamspace.services.BroadcastPlaybackType.Stream?this.activeBroadcastPlayback.userRole===teamspace.services.BroadcastParticipantRole.Producer&&(this.isBYOEProducer=!0):this.activeBroadcastPlayback.type===teamspace.services.BroadcastPlaybackType.Overflow&&(this.amsAttendeeMeeting=this.activeBroadcastPlayback.attendeeMeeting,this.handleOverflowJoin(),this.isOverflow=!0),this.initializeMeetingPanel().then(function(){e.settingsService.valueAsBoolean(e.constants.settings.names.skipTwoStepJoinForByoeAttendee)||(e.isInitialized=!0)}),this.settingsService.valueAsBoolean(this.constants.settings.names.skipTwoStepJoinForByoeAttendee)&&(this.isInitialized=!0),this.eventingService.$emit(this.constants.events.desktopApp.broadcast.attendee.viewing,!0),this.setLoggingContext()},e.prototype.leaveBroadcast=function(){var e=this;if(this.broadcastCorrelationId=this.amsAttendeeMeeting&&this.amsAttendeeMeeting.correlationId,this.eventingService.$emit(this.constants.events.desktopApp.broadcast.attendee.viewing,!1),this.activeBroadcastPlayback.hadError&&(this.shouldShowQuestionnaire=!1),this.shouldShowQuestionnaire&&this.isQuestionnaireEnabled||this.isAnonymous){if(this.showPostPlaybackScreen=!0,this.isQuestionnaireEnabled&&!this.isAnonymous){var t=this.eventingService.$on(this.$scope,this.constants.events.broadcast.broadcastQualityFeedbackComplete,function(){e.leaveBroadcastInternal()});this.broadcastPlaybackService.safeSubscribe(this.$scope,function(){e.broadcastPlaybackService.leaveBroadcastPlayback(),t()},teamspace.services.BroadcastPlaybackServiceEvents.BroadcastPlaybackMonitorVisibilityChanged)}}else this.leaveBroadcastInternal()},e.prototype.leaveBroadcastInternal=function(){this.broadcastPlaybackService.leaveBroadcastPlayback(),this.broadcastJoinService.navigateToPreviousPage(this.navCtx)},e.prototype.initializeMeetingPanel=function(){var e=this;this.$scope.$on(this.constants.events.calling.toggleRightPanel,function(t,a){return e.setMeetingPanel(a)});var t=this.authenticationService.getUserRole(),a=this.activeBroadcastPlayback.userRole;if(this.panelManager=new teamspace.components.BroadcastPlaybackPanelManager(this.activeBroadcastPlayback,t,this.ariaLiveService,this.$translate,this.resources,this.$scope,this.constants,this.eventingService,this.settingsService),this.panelComponentsOptions=this.panelManager.meetingPanelComponentsOptions,this.panelButtonOptions=this.panelManager.meetingPanelButtonOptions,this.activeBroadcastPlayback.type===teamspace.services.BroadcastPlaybackType.Stream&&(a===teamspace.services.BroadcastParticipantRole.Producer||a===teamspace.services.BroadcastParticipantRole.Contributor)){var s=this.activeBroadcastPlayback.threadId,i=this.loggingService.newScenario(this.constants.scenarios.broadcast.initChatPanel);i.cancelIfOffline=!0,this.calendarService.showPrivateMeetingConversation(s,"broadcast_init_meeting_panel").then(function(){e.conversation=e.conversationsService.getCallingConversation(s),e.panelManager.initializeChatConversationPanel(e.conversation,s),i.stop()}).catch(function(e){i.fail({error:e})})}return this.activeBroadcastPlayback.getModalityLinks().then(function(t){e.onModalityLinksReceieved(t)})},e.prototype.onModalityLinksReceieved=function(e){var t=this;if(this.modalityLinks=e,e){if(this.activeBroadcastPlayback.type===teamspace.services.BroadcastPlaybackType.AMS?this.qnaUrl=e.qnaAttendee:this.activeBroadcastPlayback.type===teamspace.services.BroadcastPlaybackType.Stream&&(this.activeBroadcastPlayback.userRole===teamspace.services.BroadcastParticipantRole.Producer||this.activeBroadcastPlayback.userRole===teamspace.services.BroadcastParticipantRole.Contributor?(this.qnaUrl=e.qnaModerator,this.streamAnalyticsEmbedUrl=e.stream.analyticsEmbed):this.qnaUrl=e.qnaAttendee),this.panelManager.initialize(this.modalityLinks,this.qnaUrl),!this.settingsService.valueAsBoolean(this.constants.settings.names.skipTwoStepJoinForByoeAttendee)){var a=teamspace.components.Calling.RightPanel.None;this.isBYOEProducer?a=teamspace.components.Calling.RightPanel.DeviceSettings:this.panelManager.meetingModalityLinks&&this.panelManager.meetingModalityLinks.yammer?a=teamspace.components.Calling.RightPanel.BroadcastYammer:this.qnaUrl&&(a=teamspace.components.Calling.RightPanel.BroadcastQna),a!==teamspace.components.Calling.RightPanel.None&&this.panelManager.openMeetingPanel(a)}this.refreshMeetingPanel(),this.panelButtonOptions.qnaPanelButtonOptions&&this.panelButtonOptions.qnaPanelButtonOptions.shouldCreate&&(this.audio=this.settingsService.valueAsBoolean(this.constants.settings.names.enableNotificationSoundV2)?this.audioService.getAudioElement(this.constants.audio.notification.notificationAudioV2):this.audioService.getAudioElement(this.constants.audio.calling.chatNotificationSound),this.qnaUrl&&this.eventingService.$on(this.$scope,this.constants.events.broadcast.qnaUpdateNotification,function(e){return t.handleQnaUpdateNotification()})),this.loggingService.setContext("isYammerEnabled",!(!this.panelManager.meetingModalityLinks||!this.panelManager.meetingModalityLinks.yammer))}else this.panelManager.initialize(null)},e.prototype.setMeetingPanel=function(e){this.panelManager.toggleMeetingPanel(e),this.refreshMeetingPanel()},e.prototype.refreshMeetingPanel=function(){this.panelButtonOptions=this.panelManager.meetingPanelButtonOptions,this.panelComponentsOptions=this.panelManager.meetingPanelComponentsOptions},e.prototype.handleQnaUpdateNotification=function(){this.panelManager&&(this.panelManager.handleQnaUpdateNotification(),this.panelButtonOptions&&this.panelButtonOptions.qnaPanelButtonOptions&&this.panelButtonOptions.qnaPanelButtonOptions.hasNewMessages&&this.audio.play())},e.prototype.handleOverflowJoin=function(){this.loggingService.info("Showing overflow room entrance warning UFD"),this.broadcastPlaybackHostAlertsProvider.showOverflowEntranceUFD()},e.prototype.setLoggingContext=function(){this.amsAttendeeMeeting?(this.loggingService.setContext(this.constants.counters.eventNames.correlationId,this.amsAttendeeMeeting.correlationId),this.amsAttendeeMeeting.signalR&&this.amsAttendeeMeeting.signalR.querystrings&&this.loggingService.setContext(this.constants.categories.requestId,this.amsAttendeeMeeting.signalR.querystrings.joinid),this.isOverflow?this.loggingService.setContext(this.constants.categories.broadcastType,"overflow"):this.loggingService.setContext(this.constants.categories.broadcastType,"tmb")):this.loggingService.setContext(this.constants.categories.broadcastType,"byoe"),this.loggingService.setContext(this.constants.categories.threadId,this.activeBroadcastPlayback.threadId)},e.prototype.resetLoggingContext=function(){this.amsAttendeeMeeting&&(this.loggingService.setContext(this.constants.counters.eventNames.correlationId,void 0),this.loggingService.setContext(this.constants.categories.requestId,void 0)),this.loggingService.setContext(this.constants.categories.broadcastType,void 0),this.loggingService.setContext("isYammerEnabled",void 0),this.loggingService.setContext(this.constants.categories.threadId,void 0)},e.prototype.handleTranscriptionUpdate=function(e){this.amsAttendeeMeeting&&(this.amsAttendeeMeeting.transcription.isSuppressed=e,!this.isTranscriptionSuppressedPrevious&&this.amsAttendeeMeeting.transcription.isSuppressed&&this.broadcastPlaybackService.subscribeToCaptionsCalled?(this.loggingService.info("Showing producer disabled captions UFD"),this.broadcastPlaybackHostAlertsProvider.showProducerDisabledCaptionsUFD()):this.amsAttendeeMeeting.transcription.isSuppressed||this.broadcastPlaybackHostAlertsProvider.hideProducerDisabledCaptionsUFD(),this.isTranscriptionSuppressedPrevious=this.amsAttendeeMeeting.transcription.isSuppressed)},e.prototype.onDestroy=function(){this.resetLoggingContext(),this.eventingService.$emit(this.constants.events.desktopApp.broadcast.attendee.viewing,!1),this.panelManager&&(this.panelManager.dispose(),this.panelManager=null),this.panelButtonOptions=null,this.panelComponentsOptions=null,this.conversation&&this.conversation.dispose(),this.audio=null,this.suppressTranscriptionSubscriptionCleanup&&this.suppressTranscriptionSubscriptionCleanup(),this.objectLeaksDetector.track("broadcast-playback-host",this)},e}();t.BroadcastPlaybackHostController=c,angular.module("teamspace.broadcastPlaybackHost",["teamspace.ariaLiveService","teamspace.broadcastPostPlaybackScreen","teamspace.azureMediaPlayer","teamspace.broadcastAttendeeMeetingInfo","teamspace.broadcastPlaybackService","teamspace.broadcastQnaButton","teamspace.broadcastQnaExtension","teamspace.broadcastYammerButton","teamspace.broadcastYammerExtension","teamspace.overflowCaptionsButton","teamspace.constants","teamspace.calendarService","teamspace.conversationsService","teamspace.deviceSettingsButton","teamspace.loggingService","teamspace.meetingInfoButton","teamspace.deviceSettingsAudio","teamspace.broadcastAnalyticsButton","teamspace.broadcastAttendeeSettings","teamspace.authenticationService","teamspace.broadcastJoinService","teamspace.producerStreamPlayer","teamspace.producerStreamSourceSettings","teamspace.settingsService","teamspace.streamPlayer","teamspace.streamBroadcastAnalytics","teamspace.anonymousUtils","teamspace.callingAlertBanner"]).run(["$templateCache",function(e){e.put("components/broadcast/playback/broadcast-playback-host/panel-buttons/broadcast-playback-panel-buttons.html",i),e.put("components/broadcast/playback/broadcast-playback-host/panel-components/broadcast-playback-panel-components.html",n)}]).component("broadcastPlaybackHost",{bindings:{activeBroadcastPlayback:"<",isDocked:"<"},controllerAs:"ctrl",controller:c,template:s})},2077:function(e,t){e.exports='<div class="ts-attendee-container flex-fill" ng-class="[ctrl.panelManager.showClassName,\n     {\'has-panel\': ctrl.panelManager.hasPanel},\n     {\'immersive\': ctrl.immersiveModeHandler.isImmersive},\n     {\'has-post-playback-screen\': ctrl.showPostPlaybackScreen}]" simple-mousemove="ctrl.immersiveModeHandler.onHover($event)">\n  <div class="playback-and-side-panel-container" ng-if="!ctrl.showPostPlaybackScreen">\n    <div class="playback-and-alerts-container">\n      <calling-alert-banner ng-if="!ctrl.isDocked" alerts-provider="ctrl.broadcastPlaybackHostAlertsProvider" alert-events-provider="ctrl.broadcastPlaybackHostAlertsProvider"></calling-alert-banner>\n      <div ng-if="!ctrl.showPostPlaybackScreen" ng-attr-role="{{!ctrl.isDocked ? \'main\' : \'region\'}}" aria-label="{{::ctrl.activeBroadcastPlayback.title}}" class="ts-attendee-main-container">\n        <div ng-if="!ctrl.isDocked" class="ts-attendee-header-container ts-calling-header">\n          <div class="ts-attendee-header-title-container">\n            <h3 class="ts-attendee-meeting-title" title="{{::ctrl.activeBroadcastPlayback.title}}" ng-bind="ctrl.activeBroadcastPlayback.title"></h3>\n          </div>\n          <div class="ts-bcast-header-help-link-container" ng-if="!ctrl.isBYOEProducer">\n            <a class="broadcast-attendee-help-link inset-border inset-border-themed" ng-if="!ctrl.isOverflow" translate-once="{{::$root.resources.strings.broadcast_learn_more_and_help_link_title}}" href="{{::ctrl.appConfig.broadcastPolicyDefaults.attendeeLearnMoreURL}}" target="_blank">\n            </a>\n          </div>\n          <div class="ts-attendee-header-controls">\n            <button class="ts-btn ts-bcast-secondary-btn inset-border" ng-click="ctrl.leaveBroadcast()" set-focus="true" data-tid="leave-playback" set-focus-in="100" aria-label="{{::$root.resources.strings.aria_broadcast_leave_button|translate}}" translate-once="{{::$root.resources.strings.calling_leave_meetup}}" ng-mouseenter="ctrl.immersiveModeHandler.suppressImmersiveMode(ctrl.immersiveContext.BroadcastPlaybackScreen)" ng-mouseleave="ctrl.immersiveModeHandler.allowImmersiveMode(ctrl.immersiveContext.BroadcastPlaybackScreen)" track-panel-type="{{::$root.trackConstants.panelType.attendeeScreen}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.leaveBroadcastPlayback}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.leaveBroadcastButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-summary="Leave broadcast meeting">\n            </button>\n          </div>\n          <div class="ts-attendee-header-buttons">\n            <div>\n              <ng-include class="header" src="\'components/broadcast/playback/broadcast-playback-host/panel-buttons/broadcast-playback-panel-buttons.html\'"></ng-include>\n            </div>\n          </div>\n        </div>\n        <div class="ts-attendee-content-container flex-fill" ng-if="ctrl.isInitialized">\n          <azure-media-player ng-if="ctrl.amsAttendeeMeeting" attendee-meeting="ctrl.amsAttendeeMeeting" leave-broadcast-callback="ctrl.leaveBroadcastInternal()" is-docked="ctrl.isDocked">\n          </azure-media-player>\n          <stream-player ng-if="!ctrl.isBYOEProducer && ctrl.activeBroadcastPlayback.streamUrl" video-src="{{::ctrl.activeBroadcastPlayback.streamUrl}}" video-id="{{::ctrl.activeBroadcastPlayback.videoId}}" deeplink-id="{{::ctrl.activeBroadcastPlayback.deeplinkId}}" thread-id="{{::ctrl.threadId}}">\n          </stream-player>\n          <producer-stream-player ng-if="ctrl.isBYOEProducer && ctrl.activeBroadcastPlayback.streamUrl" video-src="{{::ctrl.activeBroadcastPlayback.streamUrl}}" video-id="{{::ctrl.activeBroadcastPlayback.videoId}}" is-docked="ctrl.isDocked">\n          </producer-stream-player>\n        </div>\n      </div>\n    </div>\n    <div ng-class="{\'epc-hidden\': ctrl.isDocked}" ng-if="!ctrl.showPostPlaybackScreen" class="ts-bcast-attendee-side-container">\n      <div class="broadcast-attendee-meeting-tabs">\n        <div>\n          <ng-include class="rail" src="\'components/broadcast/playback/broadcast-playback-host/panel-buttons/broadcast-playback-panel-buttons.html\'"></ng-include>\n        </div>\n        <div class="ts-meeting-panel-components" ng-if="ctrl.panelManager.isPanelCreated" ng-class="{\'hide-meetings-panel\': !ctrl.panelManager.hasPanel}">\n          <ng-include src="\'components/broadcast/playback/broadcast-playback-host/panel-components/broadcast-playback-panel-components.html\'"></ng-include>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <broadcast-post-playback-screen class="attendee-aqf" ng-if="ctrl.isQuestionnaireEnabled && ctrl.showPostPlaybackScreen" is-anonymous="::ctrl.isAnonymous" show-post-playback-screen="ctrl.showPostPlaybackScreen" broadcast-correlation-id="{{ctrl.broadcastCorrelationId}}">\n  </broadcast-post-playback-screen>\n</div>'},2078:function(e,t){e.exports='<div class="ts-calling-action-buttons">\n  <div class="actions">\n    <div class="inside-panel">\n      <overflow-captions-button ng-if="ctrl.isOverflow">\n      </overflow-captions-button>\n      <broadcast-analytics-button ng-if="ctrl.panelButtonOptions.analyticsPanelButtonOptions.shouldCreate" options="ctrl.panelButtonOptions.analyticsPanelButtonOptions">\n      </broadcast-analytics-button>\n      <broadcast-qna-button ng-if="ctrl.panelButtonOptions.qnaPanelButtonOptions.shouldCreate" options="ctrl.panelButtonOptions.qnaPanelButtonOptions">\n      </broadcast-qna-button>\n      <broadcast-yammer-button ng-if="ctrl.panelButtonOptions.yammerPanelButtonOptions.shouldCreate" options="ctrl.panelButtonOptions.yammerPanelButtonOptions">\n      </broadcast-yammer-button>\n      <chat-button ng-if="ctrl.panelButtonOptions.chatPanelButtonOptions.shouldCreate" options="ctrl.panelButtonOptions.chatPanelButtonOptions">\n      </chat-button>\n      <device-settings-button ng-if="ctrl.panelButtonOptions.deviceSettingsPanelButtonOptions.shouldCreate" options="ctrl.panelButtonOptions.deviceSettingsPanelButtonOptions">\n      </device-settings-button>\n      <meeting-info-button ng-if="ctrl.panelButtonOptions.meetingInfoPanelButtonOptions.shouldCreate" options="ctrl.panelButtonOptions.meetingInfoPanelButtonOptions">\n      </meeting-info-button>\n    </div>\n  </div>\n</div>\n'},2079:function(e,t){e.exports='<stream-broadcast-analytics class="flex-fill calling-panel broadcast-analytics-panel" ng-if="ctrl.panelComponentsOptions.analytics.shouldDisplay" ng-class="{\'epc-hidden\': !ctrl.panelComponentsOptions.analytics.isSelected}" embed-url="{{::ctrl.streamAnalyticsEmbedUrl}}">\n</stream-broadcast-analytics>\n\n<broadcast-qna-extension class="flex-fill calling-panel broadcast-qna-panel" ng-if="ctrl.panelComponentsOptions.qna.shouldDisplay" ng-class="{\'hide-qna\': !ctrl.panelComponentsOptions.qna.isSelected}" is-selected="ctrl.panelComponentsOptions.qna.isSelected" qna-url="::ctrl.qnaUrl" video-id="::ctrl.videoId" is-byoe-producer="::ctrl.isBYOEProducer">\n</broadcast-qna-extension>\n\n<broadcast-yammer-extension class="flex-fill calling-panel broadcast-yammer-panel" ng-if="ctrl.panelComponentsOptions.yammer.shouldDisplay" ng-class="{\'hide-yammer\': !ctrl.panelComponentsOptions.yammer.isSelected}" acc-role="tab-handler-broadcast-yammer" yammer-settings="::ctrl.modalityLinks && ctrl.modalityLinks.yammer" video-id="::ctrl.videoId" is-byoe-producer="::ctrl.isBYOEProducer">\n</broadcast-yammer-extension>\n\n<div class="flex-fill calling-panel call-settings-tab ts-call-settings-tab" ng-if="ctrl.panelComponentsOptions.deviceSettings.shouldDisplay" ng-show="ctrl.panelComponentsOptions.deviceSettings.isSelected">\n  <broadcast-attendee-settings ng-if="!ctrl.isBYOEProducer" is-anonymous="::ctrl.isAnonymous">\n  </broadcast-attendee-settings>\n  <producer-stream-source-settings ng-if="ctrl.isBYOEProducer" stream-info="::ctrl.modalityLinks && ctrl.modalityLinks.stream" simple-scrollbar>\n  </producer-stream-source-settings>\n</div>\n\n<calling-chat class="flex-fill ts-right-rail thread-right-rail calling-panel" conversation="::ctrl.conversation" ng-if="ctrl.panelComponentsOptions.chat.shouldDisplay" ng-show="ctrl.panelComponentsOptions.chat.isSelected" surface-hub-calling-panel-resizer>\n</calling-chat>\n\n<broadcast-attendee-meeting-info class="flex-fill calling-panel" ng-if="ctrl.panelComponentsOptions.meetingInfo.shouldDisplay" ng-show="ctrl.panelComponentsOptions.meetingInfo.isSelected" broadcast-attendee-meeting="::ctrl.amsAttendeeMeeting">\n</broadcast-attendee-meeting-info>\n'},2080:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=1e4,n=function(e){function t(t,a){var s=e.call(this)||this;return s.resources=t,s.$translate=a,s.alerts=[],s.producerDisabledCaptionsAlert={dismissable:!0,type:teamspace.services.AlertType.Info,name:"Broadcast_captions_disabled_by_ETM",title:s.$translate.instant(s.resources.strings.broadcast_captions_producer_disabled_captions_title),text:s.$translate.instant(s.resources.strings.broadcast_captions_producer_disabled_captions_text),isAffirmational:!0},s.overflowRoomEntranceAlert={dismissable:!0,type:teamspace.services.AlertType.Info,name:"Broadcast_overflow_room_entrance_warning",title:s.$translate.instant(s.resources.strings.broadcast_overflow_entrance_alert_title),text:s.$translate.instant(s.resources.strings.broadcast_overflow_entrance_alert_description),isAffirmational:!0,timeout:i},s}return s(t,e),t.prototype.getAlerts=function(){return this.alerts},t.prototype.dismiss=function(e){var t=this.alerts.indexOf(e);t>-1&&this.alerts.splice(t,1),this.trigger()},t.prototype.showOverflowEntranceUFD=function(){this.alerts.indexOf(this.overflowRoomEntranceAlert)<0&&this.alerts.push(this.overflowRoomEntranceAlert),this.trigger()},t.prototype.hideOverflowEntranceUFD=function(){this.dismiss(this.overflowRoomEntranceAlert)},t.prototype.showProducerDisabledCaptionsUFD=function(){this.alerts.indexOf(this.producerDisabledCaptionsAlert)<0&&this.alerts.push(this.producerDisabledCaptionsAlert),this.trigger()},t.prototype.hideProducerDisabledCaptionsUFD=function(){this.dismiss(this.producerDisabledCaptionsAlert)},t}(SkypeX.Services.ObservableBase);t.BroadcastPlaybackHostAlertsProvider=n},2081:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=a(2082),n=a(82),r=function(e){function t(t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b,v,S,y){var f=e.call(this,l,a,s,i,n,r,o,c,d,g,p,u,h,m,b,v,S)||this;f.broadcastPlaybackService=t,f.customRightRailHeader=!1,f.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.broadcast,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close live event analytics panel from header"},f.useIframeInElectron=m.valueAsBoolean(d.settings.names.disableBroadcastElectronWebview),f.skipWebviewResizeHandling=!m.valueAsBoolean(d.settings.names.enableWebViewResizingForBroadcast);var k=g.newScenario(d.scenarios.broadcast.initAnalyticsPanel);k.cancelIfOffline=!0,k.eventData=f.getHostCorrelationIdEventData();var _=t.getActiveBroadcastPlayback();f.videoId=_.videoId,f.externalUrl=teamspace.services.BroadcastUtilities.getStreamAttendeeExternalLink(f.videoId),f.customRightRailHeader=m.valueAsBoolean(d.settings.names.customRightRailHeader),f.panelType=teamspace.components.Calling.RightPanel.BroadcastAnalytics;var P=function(e){var t=f.getUrlWithQueryOverride(f.embedUrl,l.broadcastSettings.byoe.producerQueryParams,e);f.beginLoad(t,!0).then(function(e){k.stop()}).catch(function(e){k.fail()})};return y.getUserInformation().then(function(e){P(e.profile.upn)}).catch(function(e){f.logger.error('Couldn\'t get current user info: ["{0}"]',teamspace.services.CallingTelemetryService.getErrorMessage(e)),P()}),f}return s(t,e),t.$inject=["broadcastPlaybackService","$q","$sce","$scope","$element","$interval","$timeout","$window","appConfig","constants","extensionTabService","loggingService","utilityService","sdkHelperService","settingsService","htmlSanitizer","navigationService","exceptionUtilityService","authenticationService"],t.prototype.handleMessage=function(t){var a=e.prototype.handleMessage.call(this,t),s=t.data;if(!s||!s.name)return a;switch(s.name){case n.StreamEvents.initializeConnection:return this.broadcastPlaybackService.streamDiagnosticsData.analyticsSessionId=this.clientSessionId,!0}},t}(n.StreamFrameBase);t.StreamBroadcastAnalyticsController=r,angular.module("teamspace.streamBroadcastAnalytics",["teamspace.streamFrameBase"]).component("streamBroadcastAnalytics",{bindings:{embedUrl:"@",videoId:"@"},controller:r,templateUrl:"components/broadcast/playback/broadcast-playback-host/panel-components/stream-broadcast-analytics.html",controllerAs:"ctrl"}).run(["$templateCache",function(e){e.put("components/broadcast/playback/broadcast-playback-host/panel-components/stream-broadcast-analytics.html",i)}])},2082:function(e,t){e.exports='<div id="broadcastAnalyticsExtension" class="broadcast-analytics-panel broadcast-panel" ng-class="::{\'right-pane-header\': ctrl.customRightRailHeader}">\n  <h2 ng-if="!ctrl.customRightRailHeader" class="broadcast-panel-title">{{::$root.resources.strings.stream_live_event_analytics_header|translate}}</h2>\n  <right-pane-header ng-if="ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{ctrl.panelType}}" text="{{::$root.resources.strings.stream_live_event_analytics_header|translate}}" telemetry-bag="ctrl.telemetryBag"></right-pane-header>\n  <embedded-page-container class="stream-broadcast-analytics" url="{{::ctrl.frameSrc}}" definition-id="{{::ctrl.definitionId}}" iframe-title="{{::$root.resources.strings.stream_live_event_analytics_header|translate}}" enable-message-passing="true" on-content-loaded="ctrl.onContentLoaded(isSuccessful, frameInfo)" on-message-received="ctrl.onMessageReceived(source, data, origin)" page-identifier="byoe_producer_stream_analytics" skip-resize-handling="::ctrl.skipWebviewResizeHandling" is-electron-webview-unsupported="::ctrl.useIframeInElectron">\n  </embedded-page-container>\n</div>'},2083:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=a(2084),n={producerEvent:"producerevent"},r={selectStartSetup:"selectstartsetup",selectStartEvent:"selectstartevent",selectDisconnect:"selectdisconnect",selectEndEvent:"selectendevent",setupStarted:"setupstarted",eventStarted:"eventstarted",setupDisconnected:"setupdisconnected",eventEnded:"eventended",selectStartSetupFailed:"selectstartsetupfailed",selectStartEventFailed:"selectstarteventfailed",selectDisconnectFailed:"selectdisconnectfailed",selectEndEventFailed:"selectendeventfailed"},o={producerStartSetup:"stream_producer_start_setup",producerDisconnect:"stream_producer_disconnect",producerStartEvent:"stream_producer_start_event",producerEndEvent:"stream_producer_end_event"},c=function(e){function t(t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b,v,S,y,f,k,P,C,w){var M=e.call(this,r,g,u,s,h,i,y,t,o,c,d,p,a,m,b,v,n,S,f,k,P,C,w)||this;M.$element=t,M.$window=a,M.appConfig=s,M.constants=i,M.loggingService=n,M.resizeThrottleInMs=250,M.dimensionDiffThresholdInPx=2,M.titleTopOffsetFromContentInPx=30,M.enforcedHeightWidthRatio=9/16,M.logger=n.newLogger("ProducerStreamPlayerController");var B=l.$on(i.events.calling.toggleRightPanel,function(e){return _.defer(function(){return M.updateLayoutIfNeeded()})});return M.resizeHandler=_.throttle(M.updateLayoutIfNeeded.bind(M),M.resizeThrottleInMs),a.addEventListener("resize",M.resizeHandler),M.externalUrl=teamspace.services.BroadcastUtilities.getStreamProducerExternalLink(M.videoId),p.$on("$destroy",function(){a.removeEventListener("resize",M.resizeHandler),B&&B(),M.cancelAllProducerScenarios()}),_.defer(function(){return M.updateLayoutIfNeeded()}),M}return s(t,e),t.$inject=["$element","$window","appConfig","constants","loggingService","layoutService","$interval","$q","$rootScope","$sce","$scope","$timeout","$translate","broadcastPlaybackService","desktopUtilityService","extensionTabService","htmlSanitizer","navigationService","resources","sdkHelperService","settingsService","utilityService","exceptionUtilityService","authenticationService"],Object.defineProperty(t.prototype,"frameElement",{get:function(){return this._frameElement&&0!==this._frameElement.length||(this._frameElement=this.$element.find("webview, iframe")),this._frameElement},enumerable:!0,configurable:!0}),t.prototype.$onChanges=function(e){null!=e.isDocked&&e.isDocked.currentValue!==e.isDocked.previousValue&&(this.isDocked?(this.logger.info("Navigating away from producer full page view"),this.frameElement.css({width:"",height:"",left:"",top:""}),this.titleElement.css({left:"",top:""}),this.$window.removeEventListener("resize",this.resizeHandler)):(this.logger.info("Navigated to producer full page view"),this.$window.removeEventListener("resize",this.resizeHandler),this.$window.addEventListener("resize",this.resizeHandler),this.updateLayoutIfNeeded()))},t.prototype.handleMessage=function(t){var a=e.prototype.handleMessage.call(this,t),s=t.data;if(!(s&&s.name&&s.eventData&&s.eventData.eventname))return a;switch(s.name){case n.producerEvent:switch(s.eventData.eventname){case r.selectStartSetup:this.createProducerScenario(o.producerStartSetup,s.eventData);break;case r.selectStartEvent:this.createProducerScenario(o.producerStartEvent,s.eventData);break;case r.selectDisconnect:this.createProducerScenario(o.producerDisconnect,s.eventData);break;case r.selectEndEvent:this.createProducerScenario(o.producerEndEvent,s.eventData);break;case r.setupStarted:this.stopProducerScenario(o.producerStartSetup,s.eventData);break;case r.eventStarted:this.stopProducerScenario(o.producerStartEvent,s.eventData);break;case r.setupDisconnected:this.stopProducerScenario(o.producerDisconnect,s.eventData);break;case r.eventEnded:this.stopProducerScenario(o.producerEndEvent,s.eventData);break;case r.selectStartSetupFailed:this.failProducerScenario(o.producerStartSetup,s.eventData);break;case r.selectStartEventFailed:this.failProducerScenario(o.producerStartEvent,s.eventData);break;case r.selectDisconnectFailed:this.failProducerScenario(o.producerDisconnect,s.eventData);break;case r.selectEndEventFailed:this.failProducerScenario(o.producerEndEvent,s.eventData)}return!0}return a},t.prototype.getUserRole=function(){return"producer"},t.prototype.getQueryParams=function(){return this.appConfig.broadcastSettings.byoe.producerQueryParams},t.prototype.updateLayoutIfNeeded=function(){if(this.containerElement&&0!==this.containerElement.length||(this.containerElement=this.$element.find("#producerStreamContainer")),this.titleElement&&0!==this.titleElement.length||(this.titleElement=this.$element.find("#producerEmbedTitle")),this.containerElement&&this.frameElement&&this.titleElement){var e=this.containerElement.width(),t=this.containerElement.height(),a=void 0,s=void 0;e*this.enforcedHeightWidthRatio>t?(a=t,s=t/this.enforcedHeightWidthRatio):(s=e,a=e*this.enforcedHeightWidthRatio);var i=Math.abs(this.frameElement.width()-s),n=Math.abs(this.frameElement.height()-a),r=(e-s)/2,o=(t-a)/2,c=this.frameElement.offset(),l=this.containerElement.offset();if(c&&l){var d=Math.abs(c.left-l.left),p=Math.abs(c.top-l.top),g=Math.abs(r-d),u=Math.abs(o-p);(i>this.dimensionDiffThresholdInPx||n>this.dimensionDiffThresholdInPx||g>this.dimensionDiffThresholdInPx||u>this.dimensionDiffThresholdInPx)&&(this.frameElement.css({width:s,height:a,left:r,top:o}),this.titleElement.css({left:r,top:o-this.titleTopOffsetFromContentInPx}),this.logger.info("updateLayoutIfNeeded: layout updated"))}}},t.prototype.createProducerScenario=function(e,t){var a=this.loggingService.newScenario(e);a.cancelIfOffline=!0;var s=this.broadcastPlaybackService.getActiveBroadcastPlayback();a.eventData[this.constants.categories.threadId]=s&&s.threadId,a.eventData[this.constants.counters.eventNames.correlationId]=this.clientSessionId,a.eventData[this.constants.counters.eventNames.streamId]=this.videoId,a.eventData[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify({videoSrc:this.videoSrc})},t.prototype.stopProducerScenario=function(e,t){var a=this.loggingService.findScenario(e);a&&a.stop()},t.prototype.failProducerScenario=function(e,t){var a=this.loggingService.findScenario(e);a&&a.fail(this.getErrorData(t))},t.prototype.cancelAllProducerScenarios=function(){this.cancelProducerScenario(o.producerStartSetup),this.cancelProducerScenario(o.producerStartEvent),this.cancelProducerScenario(o.producerDisconnect),this.cancelProducerScenario(o.producerEndEvent)},t.prototype.cancelProducerScenario=function(e){var t=this.loggingService.findScenario(e);t&&t.cancel()},t}(a(294).StreamPlayerController);t.ProducerStreamPlayerController=c,angular.module("teamspace.producerStreamPlayer",["teamspace.streamPlayer","teamspace.exceptionUtilityService"]).component("producerStreamPlayer",{bindings:{videoId:"@",videoSrc:"@",isDocked:"<"},controller:c,template:i,controllerAs:"ctrl"})},2084:function(e,t){e.exports='<div class="producer-stream-container" ng-class="{\'full-page\': !ctrl.isDocked}" id="producerStreamContainer">\n  <div ng-show="!ctrl.isDocked && !ctrl.isLoading && !ctrl.errorMessage" class="producer-embed-title" translate-once="{{::$root.resources.strings.broadcast_byoe_producer_encoder_preview_title}}" id="producerEmbedTitle">\n  </div>\n  <embedded-page-container url="{{ctrl.frameSrc}}" definition-id="{{::ctrl.definitionId}}" iframe-title="{{::$root.resources.strings.broadcast_byoe_producer_encoder_preview_title | translate}}" enable-message-passing="true" on-content-loaded="ctrl.onContentLoaded(isSuccessful, frameInfo)" skip-resize-handling="ctrl.skipResizeForStreamEvent" on-message-received="ctrl.onMessageReceived(source, data, origin)" page-identifier="byoe_producer_stream_player" load-timeout="ctrl.loadTimeout" process-tag="streamBroadcast">\n  </embedded-page-container>\n  <div class="loading-container" ng-if="ctrl.isLoading">\n    <busy-animation size="medium"></busy-animation>\n  </div>\n  <div class="error-container" ng-if="ctrl.errorMessage">\n    <div ng-bind="ctrl.errorMessage" class="error-message"></div>\n  </div>\n</div>'},2085:function(e,t){e.exports='<div class="ts-stream-container">\n  <div class="loading-container" ng-if="ctrl.isLoading">\n    <busy-animation size="medium"></busy-animation>\n  </div>\n  <embedded-page-container acc-focus-default iframe-title="{{::$root.resources.strings.broadcast_byoe_attendee_video_player_frame_title | translate}}" url="{{ctrl.frameSrc}}" definition-id="{{::ctrl.definitionId}}" enable-message-passing="true" skip-resize-handling="ctrl.skipResizeForStreamEvent" on-content-loaded="ctrl.onContentLoaded(isSuccessful, frameInfo)" on-message-received="ctrl.onMessageReceived(source, data, origin)" page-identifier="byoe_attendee_stream_player" load-timeout="ctrl.loadTimeout" process-tag="streamBroadcast">\n  </embedded-page-container>\n  <div class="debug-info" ng-if="!ctrl.layoutService.disableDebugVisuals && !ctrl.layoutService.hideDebug">\n    <div>Stream Player Debug Info</div>\n    <div>clientSessionId: <span>{{ctrl.broadcastPlaybackService.streamDiagnosticsData.clientSessionId}}</span></div>\n    <div>videoId: <span>{{ctrl.videoId}}</span></div>\n  </div>\n  <div class="error-container" ng-if="ctrl.errorMessage">\n    <div ng-bind="ctrl.errorMessage" class="error-message"></div>\n  </div>\n</div>'},2086:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2087),i={type:{primary:"primary",secondary:"secondary"},protocol:{rtmp:"rtmp",rtmps:"rtmps"}},n=function(){function e(e,t,a,s,i,n,r,o,c,l,d,p){this.$element=e,this.$scope=t,this.$timeout=a,this.$translate=s,this.resources=i,this.ariaLiveService=n,this.tooltipCssApplicators=o,this.tooltipService=c,this.utilityService=l,this.customRightRailHeader=!1,this.telemetryBag={trackScenario:teamspace.components.PanelActionScenario.meetingShowPanel,trackScenarioType:teamspace.components.PanelActionScenarioType.broadcast,trackType:teamspace.components.PanelModuleType.button,trackSummary:"Close encoder settings panel from header"},this.logger=r.newLogger("ProducerStreamSourceSettingsController"),this.sslSelected=!1,this.switchSslState=s.instant(i.strings.settings_off),this.sslSwitchTitle=s.instant(i.strings.broadcast_byoe_producer_secure_connection_ssl),this.customRightRailHeader=d.valueAsBoolean(p.settings.names.customRightRailHeader),this.panelType=teamspace.components.Calling.RightPanel.DeviceSettings,this.updateIngestUrl()}return e.$inject=["$element","$scope","$timeout","$translate","resources","ariaLiveService","loggingService","tooltipCssApplicators","tooltipService","utilityService","settingsService","constants"],e.prototype.toggleProtocol=function(){this.sslSelected=!this.sslSelected,this.switchSslState=this.sslSelected?this.$translate.instant(this.resources.strings.settings_on):this.$translate.instant(this.resources.strings.settings_off),this.updateIngestUrl()},e.prototype.copyPrimaryUrl=function(e){var t=this.$element.find("#primaryIngestUrl"),a=this.selectedIngestUrl;this.copyUrl(e,a,t)},e.prototype.copySecondaryUrl=function(e){var t=this.$element.find("#secondaryIngestUrl"),a=this.selectedSecondaryIngestUrl;this.copyUrl(e,a,t)},e.prototype.copyUrl=function(e,t,a){this.utilityService.copyToClipboard(t),this.showUrlCopiedTooltip(e,a),e.target&&e.target.focus&&e.target.focus(),this.ariaLiveService.update(this.$translate.instant(this.resources.strings.copied_to_clipboard))},e.prototype.showUrlCopiedTooltip=function(e,t){var a=this,s=this.utilityService.generateUUID(),i={templateUrl:"components/message-actions/message-link-copied.html",trigger:"manual",container:"body",placement:"auto",target:this.$element,scope:this.$scope,autoClose:!0},n={sourceElement:this.$element,tooltipType:teamspace.services.TooltipType.Popover,options:i,tooltipId:s,cssApplicator:function(){a.tooltipCssApplicators.contextMenu(e,"#messageLinkCopied",null,t,null,null)}};e.preventDefault(),e.stopPropagation(),this.tooltipService.showTooltip(n),this.$timeout(function(){a.tooltipService.clearTooltip(teamspace.services.TooltipType.Popover,s)},2e3,!1)},e.prototype.updateIngestUrl=function(){var e=this.sslSelected?i.protocol.rtmps:i.protocol.rtmp;this.selectedIngestUrl=this.getIngestUrl(i.type.primary,e),this.selectedSecondaryIngestUrl=this.getIngestUrl(i.type.secondary,e)},e.prototype.getIngestUrl=function(e,t){var a=_.find(this.streamInfo.ingestUrls,function(a){var s=a.type&&a.type.toLowerCase(),i=a.protocol&&a.protocol.toLowerCase();return s===e&&i===t});return a?a.url:(this.logger.error("Could not find the ingest url for type: "+e+" and protocol: "+t),null)},e}();t.ProducerStreamSourceSettingsController=n,angular.module("teamspace.producerStreamSourceSettings",["teamspace.ariaLiveService","teamspace.loggingService","teamspace.tooltipService","teamspace.utilityService"]).component("producerStreamSourceSettings",{bindings:{streamInfo:"<"},controllerAs:"ctrl",controller:n,templateUrl:"components/broadcast/playback/producer-stream-player/producer-stream-source-settings/producer-stream-source-settings.html"}).run(["$templateCache",function(e){e.put("components/broadcast/playback/producer-stream-player/producer-stream-source-settings/producer-stream-source-settings.html",s)}])},2087:function(e,t){e.exports='<div class="ps-source-settings-container broadcast-panel" ng-class="::{\'right-pane-header\': ctrl.customRightRailHeader}">\n  <h2 ng-if="!ctrl.customRightRailHeader" class="broadcast-panel-title" translate-once="{{::$root.resources.strings.broadcast_byoe_producer_source_settings_title}}"></h2>\n  <right-pane-header ng-if="ctrl.customRightRailHeader" usage-scenario="meeting-pane" panel-type="{{ctrl.panelType}}" text="{{::$root.resources.strings.broadcast_byoe_producer_source_settings_title|translate}}" telemetry-bag="ctrl.telemetryBag"></right-pane-header>\n  <div class="ps-source-steps">\n    <h3 class="broadcast-panel-subtitle" translate-once="{{::$root.resources.strings.broadcast_byoe_producer_setup_steps_title}}"></h3>\n    <p translate-once="{{::$root.resources.strings.broadcast_byoe_producer_setup_steps_description}}">\n    </p>\n    <ol>\n      <li translate-once="{{::$root.resources.strings.broadcast_byoe_producer_setup_step_first}}"></li><br>\n      <li translate-once="{{::$root.resources.strings.broadcast_byoe_producer_setup_step_second}}"></li><br>\n      <li translate-once="{{::$root.resources.strings.broadcast_byoe_producer_setup_step_third}}"></li>\n    </ol>\n    <a target="_blank" href="https://go.microsoft.com/fwlink/?linkid=874999" translate-once="{{::$root.resources.strings.broadcast_byoe_producer_setup_steps_learn_more}}">\n    </a>\n  </div>\n  <div class="ps-source-options">\n    <h3 class="broadcast-panel-subtitle">{{::ctrl.sslSwitchTitle}}</h3>\n    <div class="switch-ssl">\n      <toggle-switch is-checked="ctrl.sslSelected" ds-aria-label="{{::ctrl.sslSwitchTitle}}" on-toggle="ctrl.toggleProtocol()">\n      </toggle-switch>\n      <span class="switch-ssl-text">{{ctrl.switchSslState}}</span>\n    </div>\n    <label class="url-header" translate-once="{{::$root.resources.strings.broadcast_byoe_producer_server_ingest_url_title}}"></label>\n    <div class="ingest-url-container">\n      <input sanitized type="text" id="primaryIngestUrl" class="ingest-url" readonly="readonly" ng-model="ctrl.selectedIngestUrl"/>\n      <button ng-click="ctrl.copyPrimaryUrl($event)" id="primaryCopyButton" aria-label="{{::$root.resources.strings.broadcast_byoe_producer_copy_url_text|translate}}" title="{{::$root.resources.strings.broadcast_byoe_producer_copy_url_text|translate}}" class="ts-btn ts-btn-primary inset-border inset-border-themed copy-button" track-panel-type="{{::$root.trackConstants.panelType.broadcastProducerByoeScreen}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.broadcastCopyIngestUrl}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.byoeProducerCopyIngestUrlButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{type: \'primary\', protocol: ctrl.sslSelected ? \'rtmps\': \'rtmp\'}" track-summary="Copy Ingest URL">\n        <ng-include src="\'svg/icons-link.html\'"></ng-include>\n      </button>\n    </div>\n    <label class="url-header" translate-once="{{::$root.resources.strings.broadcast_byoe_producer_secondary_server_ingest_url_title}}"></label>\n    <div class="ingest-url-container">\n      <input sanitized type="text" id="secondaryIngestUrl" class="ingest-url" readonly="readonly" ng-model="ctrl.selectedSecondaryIngestUrl"/>\n      <button ng-click="ctrl.copySecondaryUrl($event)" id="secondaryCopyButton" aria-label="{{::$root.resources.strings.broadcast_byoe_producer_copy_url_text|translate}}" title="{{::$root.resources.strings.broadcast_byoe_producer_copy_url_text|translate}}" class="ts-btn ts-btn-primary inset-border inset-border-themed copy-button" track-panel-type="{{::$root.trackConstants.panelType.broadcastProducerByoeScreen}}" track-outcome="{{::$root.trackConstants.trackOutcome.select}}" track-scenario="{{::$root.trackConstants.trackScenario.broadcastCopyIngestUrl}}" track-scenario-type="{{::$root.trackConstants.trackScenarioType.broadcast}}" track-name="{{::$root.trackConstants.trackModuleName.byoeProducerCopyIngestUrlButton}}" track-type="{{::$root.trackConstants.trackType.button}}" track-data="{type: \'secondary\', protocol: ctrl.sslSelected ? \'rtmps\': \'rtmp\'}" track-summary="Copy Secondary Ingest URL">\n        <ng-include src="\'svg/icons-link.html\'"></ng-include>\n      </button>\n    </div>\n  </div>\n</div>\n'},2088:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2089),i=function(){function e(e,t,a,s,i,n){var r=this;this.resources=e,this.constants=t,this.$translate=i,this.$rootScope=n,this.isPolicyEnabled=!1,this.isSelected=!1,this.logger=a.newLogger("overflowCaptionsButton"),s.enabledByPolicy().then(function(e){r.isPolicyEnabled=e})}return e.$inject=["resources","constants","loggingService","callClosedCaptionsService","$translate","$rootScope"],e.prototype.toggleCaptions=function(){this.isSelected=!this.isSelected,this.logger.info("Overflow captions activity set to "+this.isSelected),this.$rootScope.$emit(this.constants.events.broadcast.overflowCaptionsUpdate,this.isSelected)},Object.defineProperty(e.prototype,"title",{get:function(){return this.isSelected?this.$translate.instant(this.resources.strings.broadcast_toggleCaptions_off):this.$translate.instant(this.resources.strings.broadcast_toggleCaptions_on)},enumerable:!0,configurable:!0}),e}();t.OverflowCaptionsButtonController=i,angular.module("teamspace.overflowCaptionsButton",["teamspace.callClosedCaptionsService","teamspace.constants","teamspace.loggingService","pascalprecht.translate"]).component("overflowCaptionsButton",{bindings:{isSelected:"<"},controllerAs:"ctrl",controller:i,template:s})},2089:function(e,t){e.exports='<button class="toggle-overflow-captions inset-border inset-border-round inset-border-themed" title="{{ctrl.title}}" ng-class="{\'active\': ctrl.isSelected}" ng-click="ctrl.toggleCaptions()" ng-if="ctrl.isPolicyEnabled" track-summary="User clicking on overflow captions button" aria-label="{{ctrl.title}}">\n  <ng-include aria-hidden="true" src="\'svg/icons-closed-caption.html\'"></ng-include>\n</button>'},2090:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2091),i=function(){function e(e,t,a,s){this.objectLeaksDetector=e,this.callingDebugService=a,this.broadcastService=s,this.logger=t.newLogger("broadcast-screen"),this.panelRegions=teamspace.PanelRegion}return e.$inject=["objectLeaksDetector","loggingService","callingDebugService","broadcastService"],e.prototype.$onInit=function(){this.call.broadcastMeeting?(this.localBroadcastState=this.broadcastService.getLocalBroadcastState(this.call.teamsCallId),this.localBroadcastState?this.logger.info("onInit: Starting with role ["+(this.call.broadcastMeeting.role||this.localBroadcastState.role)+"]"):this.logger.error("onInit: Not a valid broadcast call.")):this.logger.error("onInit: Broadcast meeting object not present {0}",this.call.callId)},e.prototype.shouldShowProducerScreen=function(){return!this.callingDebugService.hideProducerScreen&&(this.localBroadcastState&&this.localBroadcastState.showProducerScreen())},e.prototype.$onDestroy=function(){this.objectLeaksDetector.track("broadcast-screen",this,{enableAlerting:!0})},e}();t.BroadcastScreenController=i,angular.module("teamspace.broadcastScreen",["teamspace.loggingService","teamspace.callingDebugService","teamspace.broadcastService"]).component("broadcastScreen",{bindings:{call:"<",conversation:"<",isMeetupCreation:"<",isMultiTasking:"<",isSharingPanelRequested:"<"},template:s,controllerAs:"ctrl",controller:i})},2091:function(e,t){e.exports='<div class="ts-broadcast-screen" analytics-panel="{{::ctrl.panelRegions.main}}" analytics-panel-view="{ panel: {type: {{$root.trackConstants.panelType.broadcastScreen}} }}">\n    <broadcast-producer-screen ng-if="ctrl.shouldShowProducerScreen()" conversation="::ctrl.conversation" call="::ctrl.call" is-sharing-panel-requested="::ctrl.isSharingPanelRequested">\n    </broadcast-producer-screen>\n    <calling-screen class="flex-fill" ng-if="!ctrl.shouldShowProducerScreen()" conversation="::ctrl.conversation" call="::ctrl.call" is-multi-tasking="::ctrl.isMultiTasking" is-sharing-panel-requested="::ctrl.isSharingPanelRequested">\n    </calling-screen>\n</div>'},283:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=a(41),n=a(284),r=function(e){function t(t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b){var v=e.call(this)||this;return v.$scope=t,v.peopleService=a,v.$q=s,v.$timeout=i,v.callingDebugService=n,v.callingParticipantService=r,v.loggingService=o,v.appConfig=c,v.$translate=l,v.call=d,v.constants=p,v.utilityService=g,v.callPropsStoreService=u,v.settingsService=h,v.eventingService=m,v.pstnNumberService=b,v.logger=o.newLogger(p.loggingContexts.broadcastParticipantManager),v.paricipantStreams=[],v}return s(t,e),t.prototype.init=function(){var e=this;this.streamFactory=new n.BroadcastParticipantStreamFactory(this.call,this.$translate,this.loggingService,this.constants,this.settingsService),this.participantsManager=new teamspace.components.Calling.ParticipantsManager(this.peopleService,this.$timeout,this.$q,this.onParticipantStreamAdded.bind(this),this.onParticipantStreamRemoved.bind(this),this.onParticipantsChanged.bind(this),this.onParticipantNoop.bind(this),this.onParticipantNoop.bind(this),this.onParticipantNoop.bind(this),this.onParticipantNoop.bind(this),this.callingDebugService,this.callingParticipantService,this.loggingService,this.call,this.constants.loggingContexts.broadcastParticipantManager,this.utilityService,this.callPropsStoreService,this.settingsService,this.constants,this.eventingService,this.appConfig.broadcastSettings.composerBotMris,this.pstnNumberService),this.callingParticipantService.safeSubscribe(this.$scope,function(t,a){a.teamsCallId===e.call.teamsCallId&&e.onParticipantsChanged()},this.constants.events.participants.participantStateChanged),this.myVideoStream=this.streamFactory.getMyLocalStream(!1,this.onStreamStateChanged.bind(this)),this.myScreenShareStream=this.streamFactory.getMyLocalStream(!0,this.onStreamStateChanged.bind(this)),this.participantsManager.init()},t.prototype.getMyStreams=function(){return this.participantsManager?[this.myScreenShareStream,this.myVideoStream]:[]},t.prototype.getOtherStreams=function(){return this.participantsManager?this.paricipantStreams:[]},t.prototype.getStream=function(e,t,a){return a&&t?this.myScreenShareStream:a&&!t?this.myVideoStream:teamspace.services.BroadcastUtilities.isComposerBotMri(e,this.appConfig.broadcastSettings.composerBotMris)?this.composerStream:this.paricipantStreams.find(function(a){return a.item.participant.id===e&&!!t==!!a.isScreenShare})},t.prototype.dispose=function(){this.paricipantStreams&&_.forEach(this.paricipantStreams,function(e){e.dispose(),e=null}),this.composerStream&&(this.composerStream.dispose(),this.composerStream=null),this.myVideoStream&&(this.myVideoStream.dispose(),this.myVideoStream=null),this.myScreenShareStream&&(this.myScreenShareStream.dispose(),this.myScreenShareStream=null),this.participantsManager&&(this.participantsManager.dispose(),this.participantsManager=null)},t.prototype.onParticipantStreamAdded=function(e){if(this.logger.info("onParticipantStreamAdded: "+e.getIdForLogging()),_.filter(this.paricipantStreams,function(t){return t.id===e.id})[0])this.logger.error("onParticipantStreamAdded: Duplicate stream detected {0} and rejected. Screenshare: {1}",e.getIdForLogging(),e.isScreenShare);else{var t=this.streamFactory.getParticipantStream(e,this.onStreamStateChanged.bind(this));teamspace.services.BroadcastUtilities.isComposerBotMri(t.id,this.appConfig.broadcastSettings.composerBotMris)?(this.composerStream=t,this.trigger(i.ComposerStreamAddedEventName,t.id,t)):(this.paricipantStreams.push(t),this.trigger(i.ParticipantStreamAddedEventName,t.id,t))}},t.prototype.onParticipantStreamRemoved=function(e){this.logger.info("onParticipantStreamRemoved: "+e.getIdForLogging());var t=_.find(this.paricipantStreams,function(t){return t.id===e.id});t?teamspace.services.BroadcastUtilities.isComposerBotMri(e.id,this.appConfig.broadcastSettings.composerBotMris)?(this.removeItem(t,!0),this.trigger(i.ComposerStreamRemovedEventName,t.id,t)):(this.trigger(i.ParticipantStreamRemovedEventName,t.id,t),this.removeItem(t,!1)):this.logger.warn("Stream for item "+e.getIdForLogging()+" not found.")},t.prototype.onParticipantsChanged=function(){this.$scope.$broadcast(this.constants.events.calling.participantsChanged,{})},t.prototype.onStreamStateChanged=function(e){this.logger.info("Stream changed: Id "+e.id+". Is StreamOn "+e.isStreamOn),this.trigger(i.StreamStateChanged,e.id,e)},t.prototype.onParticipantNoop=function(){this.logger.log("Participation noop")},t.prototype.removeItem=function(e,t){if(t)return this.composerStream=void 0,e.dispose(),void this.callingDebugService.log("removing item: "+e.id);var a=this.paricipantStreams.indexOf(e);-1!==a?(this.paricipantStreams.splice(a,1),e.dispose(),this.callingDebugService.log("removing item: "+e.id)):this.logger.error("could not remove item: "+e.id)},t}(SkypeX.Services.ObservableBase);t.BroadcastParticipantsManager=r},284:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(285),i=a(287),n=function(){function e(e,t,a,s,i){this.call=e,this.$translate=t,this.loggingService=a,this.constants=s,this.settingsService=i}return e.prototype.getParticipantStream=function(e,t){return new i.BroadcastParticipantStream(this.call,e,this.$translate,t,this.loggingService)},e.prototype.getMyLocalStream=function(e,t){var a=this.constants.settings.names.disableBroadcastLocalMediaStreamCheckForProducers,i=this.settingsService.valueAsBoolean(a);return new s.BroadcastMyLocalStream(this.call,e,t,this.loggingService,i)},e}();t.BroadcastParticipantStreamFactory=n},285:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(286),i=function(){function e(e,t,a,s,i){var n=this;void 0===i&&(i=!1),this.call=e,this.isScreenShare=t,this.onVideoChanged=a,this.loggingService=s,this.disableLocalMediaStreamCheck=i,this.isMe=!0,this._isStreaming=!1,this._handleCallChanged=function(){if(n.disableLocalMediaStreamCheck){n._logger.info("disableLocalMediaStreamCheck is true, will fall back to old logic");var e=n.isStreamOn;!!e!=!!n._isStreamOnCached&&(n._isStreamOnCached=e,n._logger.info("isStreamOn switched to "+n._isStreamOnCached+", streamId - "+n.id),n.onVideoChanged(n))}else if(n._localMediaStream)!n.call.localMediaStreams.find(function(e){return e===n._localMediaStream})&&(n._logger.info("existing local media stream removed, streamId - "+n.id),n._disposeLocalMediaStream(),n._handleLocalMediaStreamingStateChanged());else{var t=n.isScreenShare?3:1;n._localMediaStream=n.call.localMediaStreams.find(function(e){return e.mediaType===t}),n._localMediaStream&&(n._logger.info("local media stream added, streamId - "+n.id),n._localMediaStreamSubscription=n._localMediaStream.changed(n._handleLocalMediaStreamingStateChanged),n._handleLocalMediaStreamingStateChanged())}},this._handleLocalMediaStreamingStateChanged=function(){var e=n._localMediaStream&&n._localMediaStream.isStreaming||!1;e!==n._isStreaming&&(n._isStreaming=e,n._logger.info("local media stream - isStreaming switched to "+n._isStreaming+", streamId - "+n.id),n.onVideoChanged(n))},this._disposeLocalMediaStream=function(){n._localMediaStreamSubscription&&(n._localMediaStreamSubscription.dispose(),n._localMediaStreamSubscription=null),n._localMediaStream=null},this._logger=s.newLogger("BroadcastMyLocalStream"),this.id="mystream_"+(t?"s":"v"),this._callSubscription=e.changed(this._handleCallChanged),this._handleCallChanged()}return Object.defineProperty(e.prototype,"isStreamOn",{get:function(){return this.disableLocalMediaStreamCheck?this.isScreenShare?this.call.isScreenSharingOn:this.call.isVideoOn:this._isStreaming},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._callSubscription&&(this._callSubscription.dispose(),this._callSubscription=null),this._disposeLocalMediaStream()},e.prototype.toLayoutSource=function(){var e={isMe:!0,mri:this.call&&this.call.callerMri},t=this.isScreenShare?"vbss":"video";return new s.LocalBroadcastSource(e,t,this.call,this.loggingService)},e}();t.BroadcastMyLocalStream=i},286:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t,a,s){this.participant=e,this.type=t,this.call=a,this.logger=s.newLogger("LocalBroadcastSource")}return e.prototype.getMediaId=function(){return teamspace.services.BroadcastUtilities.getMediaId(this,this.call,this.logger)},e.prototype.equals=function(e){return null!==e&&this.type===e.type&&this.participant.isMe===e.participant.isMe&&this.participant.mri===e.participant.mri},e}();t.LocalBroadcastSource=s},287:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(286),i=function(){function e(e,t,a,s,i){this.call=e,this.item=t,this.$translate=a,this.onParticipantStreamChanged=s,this.loggingService=i,this.id=t.id,this.isScreenShare=t.isScreenShare,!this.isScreenShare&&this.item.participant&&(this.participantSubscription=this.item.participant.changed(this.onParticipantChanged.bind(this))),this.isStreamOn=this.isScreenShare||this.item&&this.item.participant&&!!skype.calling.ICallParticipantHelpers.bestAvailableVideoFor(t.participant),this.isMe=!1}return Object.defineProperty(e.prototype,"name",{get:function(){return this.item&&this.item.isInitialized?this.item.isScreenShare?this.$translate.instant("broadcast_activeshare_subtitle_format",{userName:this.item.userName}):this.item.userName:""},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.participantSubscription&&(this.participantSubscription.dispose(),this.participantSubscription=null),this.item&&this.item.destroy()},e.prototype.toLayoutSource=function(){var e={isMe:!1,mri:this.item&&this.item.participant&&this.item.participant.id},t=this.isScreenShare?"vbss":"video";return new s.LocalBroadcastSource(e,t,this.call,this.loggingService)},e.prototype.onParticipantChanged=function(){var e=this.isScreenShare||this.item&&this.item.participant&&!!skype.calling.ICallParticipantHelpers.bestAvailableVideoFor(this.item.participant);!!e!=!!this.isStreamOn&&(this.isStreamOn=e,this.onParticipantStreamChanged(this))},e}();t.BroadcastParticipantStream=i},288:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.onItemPositionChanged=e,this.logger=t}return e.prototype.onItemAdded=function(e){if(e.isMe)this.logger.warn("Only valid for participants stream");else{var t=e.isStreamOn?0:1;e.item.layout||(this.logger.info("Adding element at index {0} ",t),e.item.layout=new teamspace.components.Calling.Layout(t),e.item.position=5,this.onItemPositionChanged(e)),e.item.position=5,e.item.layout.order=t}},e.prototype.onItemStreamStateChanged=function(e){e.isMe&&this.logger.warn("Only valid for participants stream"),e.item.layout.order=e.isStreamOn?0:1,this.onItemPositionChanged(e)},e.prototype.dispose=function(){this.onItemPositionChanged=null},e}();t.BroadcastParticipantLayoutManager=s},289:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.localBroadcastState=e,this.participantsManager=t,this.streamsDisableStateForActiveSection={},this.subscriptionNumber=e.subscribe(this.onActiveSectionChanged.bind(this),teamspace.services.localBroadcastStateEvents.activeSectionChanged)}return e.prototype.isStreamDisabled=function(e){var t=this.streamsDisableStateForActiveSection[e.id];return angular.isUndefined(t)&&(t=this.getAndUpdateStreamDisableState(e)),!(e.isStreamOn||e.isScreenShare)||t},e.prototype.onActiveSectionChanged=function(){var e=this;_.forEach(this.participantsManager.getMyStreams(),function(t){e.getAndUpdateStreamDisableState(t)}),_.forEach(this.participantsManager.getOtherStreams(),function(t){e.getAndUpdateStreamDisableState(t)})},e.prototype.getAndUpdateStreamDisableState=function(e){if(this.localBroadcastState.stagedLayout.activeSection){var t=!this.localBroadcastState.stagedLayout.activeSection.canSet(e.isScreenShare?"vbss":"video");return this.streamsDisableStateForActiveSection[e.id]=t,t}return!1},e.prototype.dispose=function(){this.localBroadcastState.unsubscribe(this.subscriptionNumber),this.streamsDisableStateForActiveSection=null},e}();t.BroadcastSourcePickerPreviewItemDisabledBehavior=s},290:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(291),i=function(){function e(e){this.template=e,this.stateValue=teamspace.services.BroadcastItemState.Inactive,this.isReadyValue=!1,this.templateId=e.id,this.sections=[];for(var t=0,a=Array.from(e.sectionMap.keys());t<a.length;t++){var i=a[t];this.sections.push(new s.BroadcastLayoutSection(i,e.sectionMap.get(i)))}this.sections.length>0&&(this.activeSection=this.sections[0])}return Object.defineProperty(e.prototype,"activeSection",{get:function(){return this.activeSectionValue},set:function(e){e!==this.activeSectionValue&&(this.activeSectionValue=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this.stateValue},set:function(e){e!==this.stateValue&&(this.stateValue=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!_.some(this.sections,function(e){return!e.source})},enumerable:!0,configurable:!0}),e.prototype.getComposerLayout=function(){return this.template.getComposerLayout(this.sections)},e.prototype.getSection=function(e){return this.sections.find(function(t){return t.id===e})},e}();t.BroadcastLayout=i},291:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.id=e,this.supportedSourceTypes=t}return e.prototype.canSet=function(e){return this.supportedSourceTypes&&-1!==this.supportedSourceTypes.indexOf(e)||!1},Object.defineProperty(e.prototype,"source",{get:function(){return this.layoutSource},set:function(e){this.layoutSource!==e&&this.canSet(e.type)&&(this.layoutSource=e)},enumerable:!0,configurable:!0}),e.prototype.clear=function(){this.layoutSource=null},e}();t.BroadcastLayoutSection=s},292:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.resources=e,this.$translate=t}return Object.defineProperty(e.prototype,"displayName",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_stage_layout_template_single)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"single"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iconUrl",{get:function(){return"svg/icons-broadcast-view-fullscreen.html"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sectionMap",{get:function(){var e=new Map;return e.set("single",["image","ppt","vbss","video"]),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"templateUrl",{get:function(){return"components/broadcast/producer/layout/templates/single-layout.html"},enumerable:!0,configurable:!0}),e.prototype.getComposerLayout=function(e){if(!e||0===e.length)return null;var t=e[0];return{sources:[{type:t.source.type,id:t.source.getMediaId()}]}},e}();t.SingleLayoutBroadcastLayoutTemplate=s},293:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s={left:"large-left",right:"small-right"},i=function(){function e(e,t){this.resources=e,this.$translate=t}return Object.defineProperty(e.prototype,"displayName",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_stage_layout_template_content_left)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return"two-large-left"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iconUrl",{get:function(){return"svg/icons-broadcast-view-left.html"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sectionMap",{get:function(){var e=new Map;return e.set(s.left,["image","ppt","vbss"]),e.set(s.right,["image","video"]),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"templateUrl",{get:function(){return"components/broadcast/producer/layout/templates/two-large-left-layout.html"},enumerable:!0,configurable:!0}),e.prototype.getComposerLayout=function(e){if(!e||e.length<2)return null;var t=e.find(function(e){return e.id===s.left}),a=e.find(function(e){return e.id===s.right});return t&&a?{sources:[{type:t.source.type,id:t.source.getMediaId()},{type:a.source.type,id:a.source.getMediaId()}]}:null},e}();t.TwoLargeLeftBroadcastLayoutTemplate=i},294:function(e,t,a){"use strict";var s=this&&this.__extends||function(){var e=function(t,a){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(t,a)};return function(t,a){function s(){this.constructor=t}e(t,a),t.prototype=null===a?Object.create(a):(s.prototype=a.prototype,new s)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++){t=arguments[a];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var n=a(2085),r=a(82),o=function(e){function t(t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b,v,S,y,f,k,_,P){var C=e.call(this,i,d,p,g,c,l,a,u,r,v,m,k,y,f,b,S,_)||this;C.layoutService=t,C.$timeout=a,C.$translate=s,C.appConfig=i,C.broadcastPlaybackService=n,C.constants=r,C.resources=o,C.wasMessageReceived=!1,C.logger=v.newLogger("StreamPlayerController"),C.skipResizeForStreamEvent=!f.valueAsBoolean(r.settings.names.enableWebViewResizingForBroadcast),n.streamDiagnosticsData.hostCorrelationId=C.hostCorrelationId,C.loadFrameScenario=v.newScenario(r.scenarios.broadcast.byoeLoadStreamEmbed),C.loadFrameScenario.cancelIfOffline=!0,C.loadFrameScenario.eventData=C.getScenarioData(),C.externalUrl=teamspace.services.BroadcastUtilities.getStreamAttendeeExternalLink(C.videoId),C.isLoading=!0,C.loadTimeout=i.broadcastSettings.frameLoadTimeoutInMs,g.$on("$destroy",function(){C.loadFrameScenario&&(C.loadFrameScenario.cancel(),C.loadFrameScenario=null)});var w=function(e){var t=C.getUrlWithQueryOverride(C.videoSrc,C.getQueryParams(),e);C.beginLoad(t,!0).catch(function(e){C.handleFrameLoadError(e)})};return P.getUserInformation().then(function(e){w(e.profile.upn)}).catch(function(e){C.logger.error('Couldn\'t get current user info: ["{0}"]',teamspace.services.CallingTelemetryService.getErrorMessage(e)),w()}),C}return s(t,e),t.$inject=["layoutService","$timeout","$translate","appConfig","broadcastPlaybackService","constants","resources","$element","$interval","$q","$sce","$scope","$window","desktopUtilityService","extensionTabService","htmlSanitizer","loggingService","navigationService","sdkHelperService","settingsService","utilityService","exceptionUtilityService","authenticationService"],t.prototype.handleMessage=function(t){var a;if(this.settingsService.valueAsBoolean(this.constants.settings.names.debugStreamMessages)){var s=t.data;this.logger.info((s&&s.name)+" | "+JSON.stringify(s&&s.eventData,null,2))}var n=e.prototype.handleMessage.call(this,t);this.loadFrameScenario&&(this.logger.info("Frame load completed implicitly"),this.loadFrameScenario.stop(),this.loadFrameScenario=null),this.wasMessageReceived=!0;var o=t.data;if(!o||!o.name)return n;var c=o.eventData,l=this.broadcastPlaybackService.getActiveBroadcastPlayback();switch(o.name){case r.StreamEvents.initializeConnection:return this.broadcastPlaybackService.streamDiagnosticsData.videoSrc=this.videoSrc,this.broadcastPlaybackService.streamDiagnosticsData.clientSessionId=this.clientSessionId,!0;case r.StreamEvents.playerEvent:if(c&&c.eventname===r.StreamPlayerEvents.setSource&&(this.broadcastPlaybackService.streamDiagnosticsData.playerSessionId=c.playersessionid),c&&c.eventname===r.StreamPlayerEvents.error&&!this.isExpectedPlaybackError(c.errorcode)){var d=this.loggingService.newScenario(this.constants.scenarios.broadcast.byoeReliability),p=i(i({},this.getScenarioData()),(a={errorCode:c.errorcode},a[this.constants.scenarioDataPropNames.broadcastError]=c.message,a));this.exceptionUtilityService.failScenarioIfOnline(d,p)}return c&&c.eventname===r.StreamPlayerEvents.error&&(l.hadError=!0),!0;case r.StreamEvents.signinEvent:return!c||c.eventname!==r.StreamSigninEvents.signinFailed&&c.eventname!==r.StreamSigninEvents.signinIncomplete||(this.isLoading=!1,this.errorMessage=this.$translate.instant(this.resources.strings.error_message_broadcast_join_failure),l.hadError=!0),!0;case r.StreamEvents.loadData:return c&&c.eventname===r.StreamLoadDataEvents.dataLoaded&&(this.isLoading=!1),!0;case r.StreamEvents.serverError:return this.isLoading=!1,l.hadError=!0,!0}return n},t.prototype.createVideoStartScenario=function(){var e=this.loggingService.newScenario(this.constants.scenarios.streamEmbed.videoStart);return e.cancelIfOffline=!0,e.eventData=this.getScenarioData(),e},t.prototype.createVideoPlaybackScenario=function(){var e=this.getScenarioData();this.loggingService.newScenario(this.constants.scenarios.broadcast.byoeReliability).stop(e);var t=this.loggingService.newScenario(this.constants.scenarios.streamEmbed.videoPlayback,null,null,this.constants.timeInMiliseconds.day,!0);return t.eventData=e,t},t.prototype.getUserRole=function(){return"attendee"},t.prototype.getErrorData=function(e){var t,a=e.message&&e.customerrormessage?e.message+": "+e.customerrormessage:e.message||e.customerrormessage,s=JSON.stringify({eventName:e.eventname,errorCode:e.errorcode,message:a,responsecode:e.responsecode});return t={},t[this.constants.scenarioDataPropNames.broadcastError]=s,t},t.prototype.getQueryParams=function(){return this.appConfig.broadcastSettings.byoe.attendeeQueryParams},t.prototype.onLoadHandler=function(){var e=this;this.logger.info("Content loaded for stream-player"),this.$timeout(function(){e.logger.info("Stream player iframe loaded"),e.loadFrameScenario&&(e.loadFrameScenario.stop(),e.loadFrameScenario=null)})},t.prototype.onLoadErrorHandler=function(){var e="Failed to load embedded-page-container";this.logger.error(e),this.handleFrameLoadError(e)},t.prototype.handleFrameLoadError=function(e){var t;if(!this.wasMessageReceived){var a=(t={},t[this.constants.scenarioDataPropNames.broadcastError]=JSON.stringify({reason:e}),t[this.constants.categories.deeplinkId]=this.deeplinkId,t);this.loadFrameScenario&&(this.loadFrameScenario.fail(a),this.loadFrameScenario=null),this.videoStartScenario&&(this.videoStartScenario.cancel(a),this.videoStartScenario=null),this.isLoading=!1,this.errorMessage=this.$translate.instant(this.resources.strings.error_message_broadcast_join_failure)}},t.prototype.getScenarioData=function(){var e,t={videoSrc:this.videoSrc,hostCorrelationId:this.hostCorrelationId};return e={},e[this.constants.categories.threadId]=this.threadId,e[this.constants.counters.eventNames.streamId]=this.videoId,e[this.constants.categories.broadcastRole]=this.getUserRole(),e[this.constants.scenarioDataPropNames.broadcastData]=JSON.stringify(t),e[this.constants.counters.eventNames.correlationId]=this.clientSessionId,e[this.constants.categories.deeplinkId]=this.deeplinkId,e},t}(r.StreamFrameBase);t.StreamPlayerController=o,angular.module("teamspace.streamPlayer",["teamspace.extensionFrameBase","teamspace.constants","teamspace.loggingService","teamspace.extensionTabService","teamspace.utilityService","teamspace.sdkHelperService","teamspace.settingsService","teamspace.config","teamspace.broadcastPlaybackService","teamspace.exceptionUtilityService"]).component("streamPlayer",{bindings:{videoId:"@",videoSrc:"@",threadId:"@",deeplinkId:"@"},controller:o,templateUrl:"components/broadcast/playback/stream-player/stream-player.html",controllerAs:"ctrl"}).run(["$templateCache",function(e){e.put("components/broadcast/playback/stream-player/stream-player.html",n)}])},41:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParticipantStreamAddedEventName="ParticipantStreamAdded",t.ParticipantStreamRemovedEventName="ParticipantStreamRemoved",t.StreamStateChanged="StreamStateChanged",t.ParticipantPanelCreated="ParticipantPanelCreated",t.ComposerStreamAddedEventName="ComposerStreamAdded",t.ComposerStreamRemovedEventName="ComposerStreamRemoved"},84:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a(2022),i=a(130),n=function(){function e(e,t,a){this.streamItem=e,this.element=t,this.scope=a}return e.$inject=["streamItem","element","scope"],e.prototype.dispose=function(){this.scope.$destroy(),this.element.remove(),this.scope=null,this.element=null},e}();t.BroadcastParticipantPreviewUIWrapper=n;var r;!function(e){e[e.tray=0]="tray",e[e.stage=1]="stage"}(r=t.BroadcastProducerPreviewRenderArea||(t.BroadcastProducerPreviewRenderArea={}));var o=function(){function e(e,t,a,s,i,n,r,o,c,l,d,p,g,u,h,m,b){var v=this;this.$scope=e,this.$element=t,this.ariaLiveService=a,this.constants=s,this.callTogglingService=i,this.callMuteService=n,this.deviceManagerService=r,this.settingsService=o,this.$translate=c,this.dialogService=l,this.resources=d,this.coachmarkEngine=p,this.coachmarksService=g,this.loggingService=h,this.callingAlertsService=m,this.adminSettingsService=b,this.immersiveContext=teamspace.components.Calling.ImmersiveEventContext,this.turnOnVideoButtonClicked=!1,this.logger=h.newLogger("broadcast-producer-preview-item"),this.muteParticipantEnabled=o.valueAsBoolean(s.settings.names.enableRemoteMuteParticipant),e.$on("$destroy",function(){u.track("broadcast-producer-preview-item",v),v.broadcastChangedSubscription&&(v.broadcastChangedSubscription.dispose(),v.broadcastChangedSubscription=null),v.participantChangedSubscription&&(v.participantChangedSubscription.dispose(),v.participantChangedSubscription=null),v.broadcastStreamRenderingAlertsHelper&&(v.broadcastStreamRenderingAlertsHelper.dispose(),v.broadcastStreamRenderingAlertsHelper=null),g.dismissCoachmark(teamspace.services.coachmarks.Coachmark.TurnOnMediaInBroadcast)})}return e.$inject=["$scope","$element","ariaLiveService","constants","callTogglingService","callMuteService","deviceManagerService","settingsService","$translate","dialogService","resources","coachmarkEngine","coachmarksService","objectLeaksDetector","loggingService","callingAlertsService","adminSettingsService"],e.prototype.$onInit=function(){var e=this;this.call=this.localBroadcastState&&this.localBroadcastState.call,this.isFocusable&&this.getPreviewItemElement().attr("tabindex","0"),this.call&&this.call.broadcastMeeting&&(this.broadcastChangedSubscription=this.call.broadcastMeeting.changed(function(){e.updateLiveIndicator()}),this.updateLiveIndicator(),this.streamItem.isMe&&!this.streamItem.isScreenShare&&(this.turnOnVideoCoachmarkNeeded=!this.call.isVideoOn,this.adminSettingsService.getAdminSettings().then(function(t){e.isIPVideoEnabledByPolicy=t.isVideoEnabled,_.defer(function(){return e.showCoachmarksIfNeeded()})}))),this.streamItem.item&&(this.participantChangedSubscription=this.streamItem.item.participant.changed(this.updateParticipantCapabilities.bind(this)),this.updateParticipantCapabilities()),this.streamItem.isScreenShare&&(this.broadcastStreamRenderingAlertsHelper=new i.BroadcastStreamRenderingAlertsHelper(this.loggingService,this.constants,this.resources,this.$translate,this.$scope,this.callingAlertsService,this.call,this.settingsService),this.broadcastStreamRenderingAlertsHelper.safeSubscribe(this.$scope,this.onRendererAlertsReceived.bind(this),this.constants.events.calling.screenShareRenderingAlert))},e.prototype.updateLiveIndicator=function(){this.streamItem.isMe?this.isLive=this.streamItem&&this.streamItem.isScreenShare?teamspace.services.BroadcastUtilities.isScreenShareBroadcasting(this.call):teamspace.services.BroadcastUtilities.isMyVideoBroadcasting(this.call):this.streamItem&&this.streamItem.item&&this.streamItem.item.participant&&(this.isLive=teamspace.services.BroadcastUtilities.isParticipantStreamLive(this.call,this.streamItem.item.participant,this.streamItem.isScreenShare))},e.prototype.showCoachmarksIfNeeded=function(){if(this.turnOnVideoCoachmarkNeeded&&this.isIPVideoEnabledByPolicy&&(!this.call.broadcastMeeting.broadcastState||this.call.broadcastMeeting.broadcastState.status!==teamspace.services.BroadcastStatus.Stopped)&&!this.call.isVideoOn&&this.isIPVideoEnabledByPolicy){var e=this.$translate.instant(this.resources.strings.coachmark_turn_on_video);this.coachmarkEngine.showTurnOnMediaInBroadcast("broadcast-producer-preview-item calling-video-button",e),this.turnOnVideoCoachmarkNeeded=!1}},e.prototype.updateParticipantCapabilities=function(){this.isSpeaking=this.streamItem.item&&this.streamItem.item.participant&&this.streamItem.item.participant.voiceLevel>0&&4!==this.streamItem.item.participant.state,this.isMuted=this.streamItem.item.participant.isServerMuted,this.isMuteParticipantDisabled=!this.muteParticipantEnabled||!this.callMuteService.hasParticipantCapabilityToUnmuteSelf(this.streamItem.item.participant)||this.isMuted},e.prototype.toggleMuteAudio=function(e){e&&(e.stopPropagation(),e.preventDefault()),this.logger.info("Toggling microphone from the tray");var t={};t.context=this.constants.scenarios.calling.context.producerScreen,this.callTogglingService.toggleMuteAudio(this.call,1,null,t)},e.prototype.isCallConnecting=function(){return 2===this.call.state||9===this.call.state},e.prototype.muteParticipant=function(e){e&&(e.stopPropagation(),e.preventDefault()),this.streamItem.isMe||this.streamItem.item.participant.isServerMuted||(this.logger.info("Muting participant {0}",this.streamItem.id),this.callMuteService.muteParticipant(this.call,this.streamItem.item.participant))},e.prototype.toggleVideo=function(e){e&&(e.stopPropagation(),e.preventDefault()),this.streamItem.isMe?(this.turnOnVideoButtonClicked||(this.turnOnVideoButtonClicked=!0,this.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.TurnOnMediaInBroadcast)),this.logger.info("Toggling video from the tray"),this.callTogglingService.toggleVideo(this.call,this.constants.scenarios.calling.context.producerScreen)):this.logger.warn("Cannot toggle video for participant")},e.prototype.toggleCamera=function(e){this.deviceManagerService.toggleCamera(),e.stopPropagation()},e.prototype.canSwitchCamera=function(){return this.deviceManagerService.getCameras()&&this.deviceManagerService.getCameras().length>1},e.prototype.onSwitchCameraClick=function(e){var t=this;if(teamspace.services.BroadcastUtilities.isMyVideoBroadcasting(this.call)){var a={okButtonText:this.$translate.instant(this.resources.strings.broadcast_dialog_confirm_button_text),closeButtonText:this.$translate.instant(this.resources.strings.cancel),confirmMessageTitle:this.$translate.instant(this.resources.strings.broadcast_switch_camera_confirm_title_text),confirmMessageHtmlBody:this.$translate.instant(this.resources.strings.broadcast_switch_camera_confirm_message_text),callback:function(){t.toggleCamera(e)}};this.dialogService.open(this.constants.dialogs.confirmDialog,a)}else this.logger.info("Toggling the camera"),this.toggleCamera(e)},e.prototype.onItemSelected=function(){if(this.logger.info("Item "+this.streamItem.id+" selected from source tray"),this.renderArea!==r.stage)if(this.localBroadcastState.stagedLayout)if(this.disabledBehavior.isStreamDisabled(this.streamItem)||this.isScreenShareRenderingAlertActive)this.logger.info("Cannot set item {0} on the selected section",this.streamItem.id);else{var e=this.streamItem.toLayoutSource();this.localBroadcastState.setActiveSectionSource(e),this.ariaLiveService.update(this.$translate.instant(this.resources.strings.broadcast_video_added));var t=this.getPreviewItemElement();t&&t.focus()}else this.logger.error("There is no default selected layout");else this.logger.info("Item "+this.streamItem.id+" selected is in stage")},Object.defineProperty(e.prototype,"participantStreamAriaLabel",{get:function(){return this.$translate.instant(this.resources.strings.broadcast_participant_video_title_format,{userName:this.streamItem.name,contentType:this.streamItem.isScreenShare?"content":"video"})},enumerable:!0,configurable:!0}),e.prototype.getPreviewItemElement=function(){return this.$element.children(".bp-previewitem")},e.prototype.onRendererAlertsReceived=function(){this.isScreenShareRenderingAlertActive=this.broadcastStreamRenderingAlertsHelper.isScreenShareWindowMinimized||this.broadcastStreamRenderingAlertsHelper.isScreenShareRenderingError,this.logger.info("Screenshare renderer error: "+this.isScreenShareRenderingAlertActive)},e}();t.BroadcastProducerPreviewItemController=o,angular.module("teamspace.broadcastProducerPreviewItem",["teamspace.ariaLiveService","teamspace.deviceManagerService","teamspace.dialogService","teamspace.coachmarksService","teamspace.userScreensharingPreview","teamspace.adminSettingsService"]).component("broadcastProducerPreviewItem",{bindings:{streamItem:"<",localBroadcastState:"<",conversation:"<",onlyStream:"<",disabledBehavior:"<",renderArea:"<",priority:"<?",expanded:"<?",takeFocusAs:"@",isFocusable:"<?"},controller:o,controllerAs:"ctrl",templateUrl:"components/broadcast/producer/broadcast-producer-preview-item/broadcast-producer-preview-item.html"}).run(["$templateCache",function(e){e.put("components/broadcast/producer/broadcast-producer-preview-item/broadcast-producer-preview-item.html",s)}])}},[2015]);