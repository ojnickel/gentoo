(this.webpackJsonp=this.webpackJsonp||[]).push([[102],{"/wJI":function(e,t,n){"use strict";n.r(t),n.d(t,"CalendarService",(function(){return F})),n.d(t,"ICalendarService",(function(){})),n.d(t,"ITeamCalendarService",(function(){})),n.d(t,"TeamCalendarService",(function(){return k}));var r=n("+7/b"),a=n("zQSw"),i=n("3J71"),s=n("Gb3T"),o=n("vtvO"),c=n("ifNO"),d=n("8tsx"),l="error=",u="claims=",v="insufficient_claims";function h(e,t,n){for(var a=[],s=3;s<arguments.length;s++)a[s-3]=arguments[s];return function(s){return e(s).then((function(o){if(a.indexOf(o.status)>-1)return o;if(o.status===i.j.NOT_AUTHORIZED){var l=o.headers;if(l){var u=p(l);if(u&&u.error===v){var h=t.authorize(e,n,u.claims);return d.a.apply(void 0,Object(r.o)([h],a))(s).then((function(e){return e}))}}}throw Object(c.a)(i.e.RequireStatus,i.d.RemoteOperationFailed,i.e.RequireStatus,{requiredStatus:1===a.length?a[0]:a,status:o.status},void 0,o)}))}}function p(e){var t={error:void 0,claims:void 0},n=e&&e["www-authenticate"];if(n)for(var r=0,a=n.split(",");r<a.length;r++){var i=a[r],s=i&&i.trim();if(s&&s.startsWith(l))try{t.error=s.slice(l.length+1,s.length-1)}catch(e){t.error=void 0}else if(s&&s.startsWith(u))try{t.claims=s.slice(u.length+1,s.length-1)}catch(e){t.claims=void 0}}return t}var E="x-ms-client-type",g=function(){function e(e,t,n){this.mtAuthResourceURL=e.get(a.a.Auth).mtResource,this.aad=t,this.clientType=n.config.clientType}return e.prototype.deleteRaw=function(e,t,n,a,i){var s;void 0===i&&(i={});var o=Object(r.a)(((s={})[E]=this.clientType,s),i);return this.rawRequest(e,t,n,"DELETE",a,o)},e.prototype.getRaw=function(e,t,n,a,i){var s;void 0===i&&(i={});var o=Object(r.a)(((s={})[E]=this.clientType,s),i);return this.rawRequest(e,t,n,"GET",a,o)},e.prototype.postRaw=function(e,t,n,a,i,s){var o;void 0===s&&(s={});var c=Object(r.a)(((o={"content-type":"application/json"})[E]=this.clientType,o),s),d=i?JSON.stringify(i):void 0;return this.rawRequest(e,t,n,"POST",a,c,d)},e.prototype.putRaw=function(e,t,n,a,i,s){var o;void 0===s&&(s={});var c=Object(r.a)(((o={"content-type":"application/json"})[E]=this.clientType,o),s),d=i?JSON.stringify(i):void 0;return this.rawRequest(e,t,n,"PUT",a,c,d)},e.prototype.rawRequest=function(e,t,n,a,i,s,c){var d=h.apply(void 0,Object(r.o)([n,this.aad,this.mtAuthResourceURL],t)),l={url:e,method:a,serviceName:o.a.MiddleTier,apiName:i};return s&&(l.headers=s),c&&(l.body=c),d(l)},e}(),f=n("z4q9"),b=n("AHKw"),T=n("rR83"),m=n("svWY"),I=n("7AWT");function O(e){var t,n,a;return e.skypeTeamsData&&(e=Object(r.a)(Object(r.a)({},e),{skypeTeamsDataObj:Object(T.a)(e.skypeTeamsData)})),e.meetingAgenda&&(e=Object(r.a)(Object(r.a)({},e),{meetingAgendaObj:(t=e.meetingAgenda,n=Object(T.a)(t),a=null==n?void 0:n.metadata,{type:n.type,location:n.location,shareLink:n.ShareLink,metadata:{state:s.b.MeetingAgendaState[null==a?void 0:a.state]||s.b.MeetingAgendaState.Disabled,isShared:Object(T.a)(null==a?void 0:a.isShared,!1)}})})),e}function _(e){return e.skypeTeamsDataObj?Object(r.a)(Object(r.a)({},e),{skypeTeamsDataObj:Object(T.a)(e.skypeTeamsData||"")}):Object(r.a)({},e)}var C=function(e,t,n){var a=Object(r.a)(Object(r.a)({},e),{startTime:t,endTime:n,skypeTeamsDataObj:void 0});return Object(m.omitBy)(a,m.isNil)},j=function(e,t){return{startTime:Object(I.g)(e),endTime:Object(I.g)(t)}},y=function(e){return e===s.b.AppointmentType.Occurrence||e===s.b.AppointmentType.Exception},S="Invalid start date. Start date cannot be null or undefined",w="Invalid end date. End date cannot be null or undefined",D="Start date cannot greater than end date",N="Invalid event id",A="atleast one attendee is required",U="invalid mri",R="Invalid Meeting Response",M="Invalid start time. Start time cannot be null or undefined for operation on instance of a series event using ICalUid",G={MiddleTier:{V1:{Private:{CREATE_EMPTY_SCHEDULING_SERVICE_EVENT:"beta/me/calendarEvents/privateMeeting/schedulingService/create",UPDATE_SCHEDULING_SERVICE_EVENT:"beta/me/calendarEvents/schedulingService/update",DELETE_SCHEDULING_SERVICE_EVENT:"beta/me/calendarEvents/schedulingService/delete",CREATE_EVENT_USING_EXISTING_SCHEDULING_SERVICE_EVENT:"beta/me/calendarEvents/privateMeeting/exchangeandlink?useGraphApi=false",UPDATE_CALENDAR_EVENT:"beta/me/calendarEvents/privateMeeting/{eventId}?useSchedulingService=true&useGraphApi=false",GET_CALENDAR_EVENT:"beta/me/calendarEvents/{eventId}?useICalUId={useICalUId}&eventType={eventType}&eventStartDateTime={eventStartDateTime}",GET_CALENDAR_EVENTS:"beta/me/calendarEvents?StartDate={startDate}&EndDate={endDate}",DELETE_CALENDAR_EVENT:"beta/me/calendarEvents/{eventId}?useICalUId={useICalUId}",UPDATE_MEETING_RESPONSE:"beta/me/calendarEvents/{eventId}/respond?useICalUid={useICalUid}&eventType={eventType}&eventStartDateTime={eventStartDateTime}",UPDATE_ATTENDEE_EVENT:"beta/me/calendarEvents/{eventId}/attendeeEvent?useICalUid={useICalUid}",CANCEL_CALENDAR_EVENT:"beta/me/calendarEvents/{eventId}/cancel?useICalUid={useICalUid}",CANCEL_PRIVATE_EVENT:"beta/me/calendarEvents/privateMeeting/{eventId}/cancel?useSchedulingService=true&useICalUid={useICalUid}",GET_USER_MAILBOX_SETTINGS:"beta/users/mailboxSettings",GET_USER_TIMEZONE:"beta/me/calendarEvents/timeZoneSettingsWithOffset?timezone={timezone}",GET_BUILDINGS:"beta/me/calendarEvents/roomlist",GET_ROOMS_IN_BUILDING:"beta/me/calendarEvents/roomlist?topLevel={buildingAddress}",GET_SUGGESTED_TIME:"beta/me/calendarEvents/availability"},Channel:{GET_CHANNEL_EVENTS:"beta/teams/{smtpAddress}/calendarEvents?StartDate={startDate}&EndDate={endDate}",GET_CHANNEL_EVENT:"beta/teams/{smtpAddress}/calendarEvents/{eventId}?useICalUid={useICalUid}&eventType={eventType}&eventStartDateTime={eventStartDateTime}",ADD_TO_MY_CALENDAR:"beta/teams/{smtpAddress}/addtomycalendar/{eventId}?useICalUid={useICalUid}",CANCEL_TEAM_EVENT:"beta/teams/{smtpAddress}/calendarEvents/{iCalUID}/cancel?useICalUid={useICalUid}&useSchedulingService=true",CREATE_TEAM_EVENT:"beta/teams/{smtpAddress}/calendarEvents?useSchedulingService=true&useGraphApi=false&enablePstn={enablePstn}",UPDATE_TEAM_EVENT:"beta/teams/{smtpAddress}/calendarEvents/{iCalUID}/update?useICalUID=true&useSchedulingService=true&useGraphApi=false",GET_ATTACHMENT_BY_ID:"beta/teams/{smtpAddress}/calendarEvents/{eventId}/attachments/{attachmentId}"}},V2:{Channel:{FORWARD_TEAM_EVENT:"v2.0/groups/smtp:{smtpAddress}/calendars/events/{eventId}/forward?useICalUid={useICalUid}"}}}},L={DEFAULT:"calendar_error_generic",CalendarEventCreationFailedOccurrenceTimeSpanTooBig:"calendar_error_create_overlapping_occurences",CalendarEventEndDateIsEarlierThanStartDate:"calendar_error_end_date_earlier_than_start_date",CalendarEventNotFound:"calendar_error_event_not_found_404_fail",CalendarEventNull:"calendar_error_create_event_failed",HtmlViewNotPresent:"calendar_error_create_event_failed",EmptySchedulingServiceMeetingSettings:"calendar_error_create_event_failed",ErrorCalendarIsOrganizerForRsvp:"calendar_error_event_already_present",ErrorCalendarIsCancelledForRsvp:"calendar_error_event_cancelled",ExchangeInvalidLicense:"calendar_error_invalid_license",ErrorInvalidRecipients:"calendar_error_invalid_attendee_email",ErrorNonExistentMailbox:"calendar_error_non_existent_mailbox",ErrorTimeZone:"calendar_error_unsupported_timezone",ErrorOccurrenceCrossingBoundary:"calendar_error_overlapping_occurrences",ErrorCalendarIsNotOrganizer:"calendar_error_only_organizer_can_cancel",ErrorInSchedulingServiceOutdatedEvent:"calendar_error_event_changed_refresh",InvalidCancellationMessageFormat:"calendar_error_cancel_event_fail",InvalidConversationId:"calendar_error_invalid_conversation_id",InvalidExchangeId:"calendar_error_update_action_fail",InvalidICalUid:"calendar_error_update_action_fail",InvalidMailboxAddress:"calendar_error_invalid_group_email",InvalidMailboxAddressOrGuid:"calendar_error_invalid_group_email",InvalidMeetingOrganizer:"calendar_error_rsvp_fail",InvalidUpdateMessageFormat:"calendar_error_update_event_fail"},P=function(e,t,n){return Object(r.f)(void 0,void 0,Promise,(function(){var a,i,s,o;return Object(r.i)(this,(function(c){switch(c.label){case 0:a=Object(r.a)({},t),c.label=1;case 1:return c.trys.push([1,3,,4]),a.httpStatusCode=e.status,[4,e.body.json()];case 2:return(null==(i=c.sent())?void 0:i.errorCode)&&(a.serverErrorCode=i.errorCode),a.detailedMessage=(null===(o=null==i?void 0:i.message)||void 0===o?void 0:o.length)?"Error code  : "+i.errorCode+". Error message : "+Object(b.a)(i.message):t.detailedMessage,a.userMessage=n&&i.errorCode&&function(e,t){return t(L[e])}(i.errorCode,n)||t.userMessage,[3,4];case 3:return s=c.sent(),a.detailedMessage="Error encountered in extractErrorMessage. "+(null==s?void 0:s.message),[3,4];case 4:return[2,a]}}))}))},x="Personal",V=function(){function e(e){var t=this;this.logger=e,this.throwException=function(e,n,r){throw void 0===r&&(r="CalendarService"),t.logger.error(r+" failed with error : "+n),Object(c.a)(r,e,"throwException",void 0,n)},this.handleGetCalendarEventsFailure=function(e,n){return void 0===n&&(n="CalendarService"),Object(r.f)(t,void 0,void 0,(function(){var t,a,i,s,o,c,d,l,u;return Object(r.i)(this,(function(r){switch(r.label){case 0:return t=null===(c=null==e?void 0:e.reason)||void 0===c?void 0:c.status,a=null===(l=null===(d=null==e?void 0:e.serverResponse)||void 0===d?void 0:d.headers)||void 0===l?void 0:l["x-serverrequestid"],i=n+" Fetch Failed as: "+(null==e?void 0:e.message),s="",(null==e?void 0:e.hasOwnProperty("serverResponse"))&&(null===(u=null==e?void 0:e.serverResponse)||void 0===u?void 0:u.body)?[4,P(e.serverResponse,(v=void 0,h=i,{userMessage:h||(v?v(L.DEFAULT):"Something went wrong. Let's try again."),detailedMessage:"Unknown error",httpStatusCode:-1}))]:[3,2];case 1:return o=r.sent(),s=i+"; ServerResponse: "+o.detailedMessage+"; StatusCode: "+t+" requestId: "+a,[3,3];case 2:s=i+"; StatusCode: "+t+" requestId: "+a,r.label=3;case 3:return this.logger.error(s),[2,s]}var v,h}))}))},this.convertIEventTypesToIFilteredEvents=function(e,t){void 0===t&&(t=x);var n=Object(m.map)(e.inDayEvents,(function(e,n){return{date:n,events:e,mailboxAddress:t}})),r=Object(m.map)(e.allDayEvents,(function(e,n){return{date:n,events:e,mailboxAddress:t}})),a=[];return Object(m.forOwn)(e.recurringEvents,(function(e,n){a.push({cleanGlobalObjectId:n,events:e,mailboxAddress:t})})),{inDayEvents:n,allDayEvents:r,recurrenceEvents:a}},this.generateEmptyBuckets=function(e,n){var r=t.getDatesSpanningDuration(e,n);return Object(m.fromPairs)(Object(m.map)(r,(function(e){return[e,[]]})))},this.getDatesSpanningDuration=function(e,t){if(!e||!t)return[];var n=new Date(e),r=new Date(t);if(Object(I.h)(n,r))return[Object(I.g)(n,void 0,"date")];for(var a=[],i=Object(I.j)(n,{hours:0,minutes:0}),s=Object(I.j)(new Date(r.getTime()-1),{hours:0,minutes:0});i<=s;)a.push(Object(I.g)(i,void 0,"date")),i=Object(I.a)(i,1);return a},this.addEventsToDayGroups=function(e,t,n){var r;return null===(r=e[t])||void 0===r?void 0:r.push(n)},this.addAllDayEventToDayGroups=function(e,n){t.getDatesSpanningDuration(n.startTime,n.endTime).forEach((function(r){t.addEventsToDayGroups(e,r,n)}))}}return e.prototype.throwIfNotValid=function(e){if(e.attendees&&0!==e.attendees.length){for(var t=0,n=e.attendees;t<n.length;t++){var r=n[t];r.mri&&!Object(f.w)(r.mri)&&this.throwException(i.d.InvalidInput,U)}Object(I.i)(e.startTime,e.endTime)||this.throwException(i.d.InvalidInput,D)}else this.throwException(i.d.InvalidInput,A)},e.prototype.isValidDateInput=function(e,t){var n=!0,r="";return e?t?e.getTime()>t.getTime()&&(n=!1,r=D):(n=!1,r=w):(n=!1,r=S),{isValid:n,errorMessage:r}},e.prototype.filterCalendarEvents=function(e,t,n,r){void 0===n&&(n=x);var a=this.filterEvents(e,t,r);return this.convertIEventTypesToIFilteredEvents(a,n)},e.prototype.filterEvents=function(e,t,n){var r=this,a=this.generateEmptyBuckets(e,t),i=this.generateEmptyBuckets(e,t),s={};return null==n||n.forEach((function(e){e=O(e),y(e.eventType)&&e.cleanGlobalObjectId&&(s[e.cleanGlobalObjectId]||(s[e.cleanGlobalObjectId]=[]),s[e.cleanGlobalObjectId].push(e));var t=function(e){var t=new Date(e.startTime),n=new Date(e.endTime),r=Object(I.g)(t,void 0,"date"),a=Object(I.g)(n,void 0,"date"),i=!Object(I.h)(t,n),s=!1;if(i){var o=Object(I.e)(t,n,"days"),c=0===Object(I.d)(t),d=1440===Object(I.d)(n);s=o>=1||c||d}return{start:r,end:a,isMultiDay:i,isMultipleFullDays:s,isAllDay:s||!!e.isAllDayEvent}}(e);t.isAllDay?r.addAllDayEventToDayGroups(i,e):(t.isMultiDay&&Object(I.d)(e.endTime)>0&&r.addEventsToDayGroups(a,t.end,e),r.addEventsToDayGroups(a,t.start,e))})),{inDayEvents:a,allDayEvents:i,recurringEvents:s}},e}();function H(e,t){return void 0===t&&(t=""),Object(r.f)(this,void 0,Promise,(function(){var n;return Object(r.i)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,e.regionGtm(a.b.Gtm.middleTier)];case 1:return n=r.sent(),[3,3];case 2:throw r.sent();case 3:return[2,n=""+n+t]}}))}))}var q="X-Client-UI-Language",F=function(){function e(e,t,n,r,i,s){this.discover=n,this.coreSettings=r,this.loggerFactory=i,this.eventIdMinLength=32,this.send=t.authorize(e,this.coreSettings.get(a.a.Auth).mtResource),this.calendarServiceHttp=new g(r,t,s),this.logger=this.loggerFactory.newLogger("EWSCalendarService"),this.calendarServiceHelper=new V(this.logger),this.userLocale=s.config.localeCode,this.endPoints=G.MiddleTier.V1.Private}return e.prototype.getCalendarEvents=function(e,t){return Object(r.f)(this,void 0,void 0,(function(){var n,a=this;return Object(r.i)(this,(function(s){switch(s.label){case 0:return e&&t&&(e.setHours(0,0,0,0),t.setDate(t.getDate()+1),t.setHours(0,0,0,0)),this.isValidDateInputForFetchingEvents(e,t),[4,this.generateGetCalendarEventsUrl(e,t)];case 1:return n=s.sent(),[2,this.calendarServiceHttp.getRaw(n,[i.j.OK],this.send,"getCalendarEvents").then((function(e){var t=e.body,n=e.headers;return Object(r.f)(a,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=r.sent(),e.headers=n,e)]}}))}))})).then((function(n){var r=n.body,i=n.headers;return a.logger.log("Get Calendar Events Success"),a.logger.log("Call suceeded with requestId "+i["x-serverrequestid"]),a.calendarServiceHelper.filterCalendarEvents(e,t,x,r.value)})).catch((function(e){return Object(r.f)(a,void 0,void 0,(function(){return Object(r.i)(this,(function(t){throw this.calendarServiceHelper.handleGetCalendarEventsFailure(e),e}))}))}))]}}))}))},e.prototype.getSuggestedTime=function(e){return Object(r.f)(this,void 0,Promise,(function(){var t,n=this;return Object(r.i)(this,(function(a){switch(a.label){case 0:return[4,H(this.discover,this.endPoints.GET_SUGGESTED_TIME)];case 1:return t=a.sent(),[2,this.calendarServiceHttp.putRaw(t,[i.j.OK],this.send,"getSuggestedTime",e).then((function(e){var t=e.body,a=e.headers;return Object(r.f)(n,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(n){switch(n.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=n.sent(),e.headers=a,e)]}}))}))})).then((function(e){var t=e.body,r=e.headers;return n.logger.log("Call suceeded with requestId "+r["x-serverrequestid"]),t}))]}}))}))},e.prototype.createEvent=function(e,t){return Object(r.f)(this,void 0,void 0,(function(){var n,a,s,o,c,d,l=this;return Object(r.i)(this,(function(u){switch(u.label){case 0:return this.calendarServiceHelper.throwIfNotValid(e),n=j(new Date(e.startTime),new Date(e.endTime)),a=n.startTime,s=n.endTime,c=(o=this.calendarServiceHttp).postRaw,[4,H(this.discover,this.endPoints.CREATE_EVENT_USING_EXISTING_SCHEDULING_SERVICE_EVENT)];case 1:return[2,c.apply(o,[u.sent(),[i.j.CREATED],this.send,"createEvent",{calendarEvent:C(e,a,s),schedulingServiceEvent:t},(d={},d[q]=this.userLocale,d)]).then((function(e){var t=e.body,n=e.headers;return Object(r.f)(l,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=r.sent(),e.headers=n,e)]}}))}))})).then((function(e){var t=e.body,n=e.headers;return l.logger.log("Call suceeded with requestId "+n["x-serverrequestid"]),_(t.value)}))]}}))}))},e.prototype.createSchedulingServiceEvent=function(e,t,n,a,s){return Object(r.f)(this,void 0,void 0,(function(){var o,c,d,l,u,v=this;return Object(r.i)(this,(function(h){switch(h.label){case 0:return[4,this.generateCreateEmptySchedulingServiceEventUrl()];case 1:return o=h.sent(),[4,this.discover.validateSkypeToken()];case 2:return c=h.sent(),d=!Object(m.isEmpty)(c)&&((l={})["x-skypetoken"]=c,l),[2,this.calendarServiceHttp.postRaw(o,[i.j.CREATED],this.send,"createSchedulingServiceEvent",{isStreamEnabled:t,meetingType:e,subject:n,startTime:a,endTime:s},Object(r.a)((u={},u[q]=this.userLocale,u),d)).then((function(e){var t=e.body,n=e.headers;return Object(r.f)(v,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=r.sent(),e.headers=n,e)]}}))}))})).then((function(e){var t=e.body,n=e.headers;return v.logger.log("Call suceeded with requestId "+n["x-serverrequestid"]),t.value}))]}}))}))},e.prototype.deleteSchedulingServiceEvent=function(e){return Object(r.f)(this,void 0,void 0,(function(){var t,n=this;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,H(this.discover,this.endPoints.DELETE_SCHEDULING_SERVICE_EVENT)];case 1:return t=r.sent(),[2,this.calendarServiceHttp.putRaw(t,[i.j.NO_CONTENT],this.send,"deleteSchedulingServiceEvent",e).then((function(e){var t=e.headers;return n.logger.log("Call suceeded with requestId "+t["x-serverrequestid"]),!0}))]}}))}))},e.prototype.getUserTimezone=function(e){return Object(r.f)(this,void 0,void 0,(function(){var t,n=this;return Object(r.i)(this,(function(a){switch(a.label){case 0:return[4,H(this.discover,this.endPoints.GET_USER_TIMEZONE.replace("{timezone}",encodeURIComponent(e)))];case 1:return t=a.sent(),[2,this.calendarServiceHttp.getRaw(t,[i.j.OK],this.send,"getUserTimezone").then((function(e){var t=e.body,a=e.headers;return Object(r.f)(n,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(n){switch(n.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=n.sent(),e.headers=a,e)]}}))}))})).then((function(e){var t=e.body,r=e.headers;return n.logger.log("Call suceeded with requestId "+r["x-serverrequestid"]),t}))]}}))}))},e.prototype.getUserMailboxSettings=function(){return Object(r.f)(this,void 0,void 0,(function(){var e,t=this;return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,H(this.discover,this.endPoints.GET_USER_MAILBOX_SETTINGS)];case 1:return e=n.sent(),[2,this.calendarServiceHttp.getRaw(e,[i.j.OK,i.j.NO_CONTENT],this.send,"getUserMailboxSettings").then((function(e){var n=e.body,r=e.headers;return t.logger.log("Call suceeded with requestId "+r["x-serverrequestid"]),n.text()})).then((function(e){var n={};return Object(m.isEmpty)(e)||(n=JSON.parse(e)),t.logger.log("Get user-mailbox settings success"),n})).catch((function(e){return Object(r.f)(t,void 0,void 0,(function(){return Object(r.i)(this,(function(t){return this.calendarServiceHelper.throwException(i.d.RemoteOperationFailed,"Get UserMailbox Settings failed : "+e.message),[2,{}]}))}))}))]}}))}))},e.prototype.updateEvent=function(e){return Object(r.f)(this,void 0,void 0,(function(){var t,n,a,s,o,c,d=this;return Object(r.i)(this,(function(r){switch(r.label){case 0:return this.calendarServiceHelper.throwIfNotValid(e),t=j(new Date(e.startTime),new Date(e.endTime)),n=t.startTime,a=t.endTime,o=(s=this.calendarServiceHttp).putRaw,[4,H(this.discover,this.endPoints.UPDATE_CALENDAR_EVENT.replace("{eventId}",e.objectId||""))];case 1:return[2,o.apply(s,[r.sent(),[i.j.NO_CONTENT],this.send,"updateEvent",{updatedCalendarEvent:C(e,n,a)},(c={},c[q]=this.userLocale,c)]).then((function(e){var t=e.headers;d.logger.log("Call suceeded with requestId "+t["x-serverrequestid"])}))]}}))}))},e.prototype.createOrUpdateEvent=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){return Object(r.i)(this,(function(n){return e.objectId?[2,this.updateEvent(e).then((function(){return _(e)}))]:[2,this.createEvent(e,t)]}))}))},e.prototype.getCalendarEvent=function(e,t,n,a){return void 0===t&&(t=!1),Object(r.f)(this,void 0,void 0,(function(){var s,o=this;return Object(r.i)(this,(function(c){switch(c.label){case 0:return[4,H(this.discover,this.endPoints.GET_CALENDAR_EVENT.replace("{eventId}",e).replace("{useICalUId}",t?"true":"false").replace("{eventType}",n||"").replace("{eventStartDateTime}",a?encodeURIComponent(a):""))];case 1:return s=c.sent(),[2,this.calendarServiceHttp.getRaw(s,[i.j.OK],this.send,"getCalendarEvent").then((function(e){var t=e.body,n=e.headers;return Object(r.f)(o,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=r.sent(),e.headers=n,e)]}}))}))})).then((function(e){var t=e.body,n=e.headers;return{body:O(t),headers:n}})).then((function(e){var t=e.body,n=e.headers;return o.logger.log("Call suceeded with requestId "+n["x-serverrequestid"]),t}))]}}))}))},e.prototype.getBuildings=function(){return Object(r.f)(this,void 0,Promise,(function(){var e,t=this;return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,H(this.discover,this.endPoints.GET_BUILDINGS)];case 1:return e=n.sent(),[2,this.calendarServiceHttp.getRaw(e,[i.j.OK],this.send,"getBuildings").then((function(e){var n=e.body,a=e.headers;return Object(r.f)(t,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(t){switch(t.label){case 0:return e={},[4,n.json()];case 1:return[2,(e.body=t.sent(),e.headers=a,e)]}}))}))})).then((function(e){var n=e.body,r=e.headers;return t.logger.log("Call suceeded with requestId "+r["x-serverrequestid"]),n}))]}}))}))},e.prototype.getRoomsInBuilding=function(e){return Object(r.f)(this,void 0,Promise,(function(){var t,n=this;return Object(r.i)(this,(function(a){switch(a.label){case 0:return[4,H(this.discover,this.endPoints.GET_ROOMS_IN_BUILDING.replace("{buildingAddress}",e?encodeURIComponent(e):""))];case 1:return t=a.sent(),[2,this.calendarServiceHttp.getRaw(t,[i.j.OK],this.send,"getRoomsInBuilding").then((function(e){var t=e.body,a=e.headers;return Object(r.f)(n,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(n){switch(n.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=n.sent(),e.headers=a,e)]}}))}))})).then((function(t){var a=t.body,i=t.headers;return n.logger.log("Call suceeded with requestId "+i["x-serverrequestid"]),a.map((function(t){return Object(r.a)(Object(r.a)({},t),{buildingAddress:e})}))}))]}}))}))},e.prototype.deleteCalendarEvent=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var a,s=this;return Object(r.i)(this,(function(r){switch(r.label){case 0:return this.logger.log("Deleting calendar event "+e+", isSeries: "+n),(!e||e.length<this.eventIdMinLength)&&(this.logger.log("Delete event failed"),this.calendarServiceHelper.throwException(i.d.InvalidInput,N)),[4,H(this.discover,this.endPoints.DELETE_CALENDAR_EVENT.replace("{eventId}",e).replace("{useICalUId}",t?"true":"false"))];case 1:return a=r.sent(),[2,this.calendarServiceHttp.deleteRaw(a,[i.j.NO_CONTENT],this.send,"deleteCalendarEvent").then((function(e){var t=e.headers;return s.logger.log("Delete event success"),s.logger.log("Call suceeded with requestId "+t["x-serverrequestid"]),!0}))]}}))}))},e.prototype.updateMeetingResponse=function(e,t,n,a,s,o,c,d){return void 0===a&&(a=!0),Object(r.f)(this,void 0,Promise,(function(){var l;return Object(r.i)(this,(function(r){switch(r.label){case 0:return this.logger.log("Updating meeting response "+t+" for the event "+e+", isSeries: "+o),e||this.calendarServiceHelper.throwException(i.d.InvalidInput,N),n&&y(c)&&!d&&this.calendarServiceHelper.throwException(i.d.InvalidInput,M),[4,H(this.discover,this.endPoints.UPDATE_MEETING_RESPONSE.replace("{eventId}",e).replace("{useICalUid}",n?"true":"false").replace("{eventType}",c||"").replace("{eventStartDateTime}",d?encodeURIComponent(d):""))];case 1:return l=r.sent(),[2,this.sendUpdateMeetingResponse(l,t,!!a,s)]}}))}))},e.prototype.updateAttendeeEvent=function(e,t,n){return Object(r.f)(this,void 0,void 0,(function(){var a;return Object(r.i)(this,(function(r){switch(r.label){case 0:return this.logger.log("Updating attendee event partially for the event "+e),[4,H(this.discover,this.endPoints.UPDATE_ATTENDEE_EVENT.replace("{eventId}",e).replace("{useICalUid}",t?"true":"false"))];case 1:return a=r.sent(),[2,this.calendarServiceHttp.putRaw(a,[i.j.OK],this.send,"updateAttendeeEvent",n).then((function(){return!0}))]}}))}))},e.prototype.cancelCalendarEvent=function(e,t,n,a,s,o){return Object(r.f)(this,void 0,Promise,(function(){var c,d,l=this;return Object(r.i)(this,(function(u){switch(u.label){case 0:return this.logger.log("Cancelling calendar event "+e+", isSeries: "+a),(!e||e.length<this.eventIdMinLength)&&this.handleCancelValidationFailure(),[4,this.generateCancelCalendarEventUrl(t,e,n)];case 1:return c=u.sent(),d=t?{conversationId:t}:{},d=o?Object(r.a)(Object(r.a)({},d),{webinarId:o}):d,d=s?Object(r.a)(Object(r.a)({},d),{cancellationMessage:s}):d,[2,this.calendarServiceHttp.putRaw(c,[i.j.NO_CONTENT],this.send,"cancelCalendarEvent",d).then((function(e){var t=e.headers;return l.logger.log("Cancel Event Success"),l.logger.log("Call suceeded with requestId "+t["x-serverrequestid"]),!0}))]}}))}))},e.prototype.generateCreateEmptySchedulingServiceEventUrl=function(){return H(this.discover,this.endPoints.CREATE_EMPTY_SCHEDULING_SERVICE_EVENT)},e.prototype.generateGetCalendarEventsUrl=function(e,t){return H(this.discover,this.endPoints.GET_CALENDAR_EVENTS.replace("{startDate}",e.toISOString()).replace("{endDate}",t.toISOString()))},e.prototype.generateCancelCalendarEventUrl=function(e,t,n){return H(this.discover,(e?this.endPoints.CANCEL_PRIVATE_EVENT:this.endPoints.CANCEL_CALENDAR_EVENT).replace("{eventId}",t).replace("{useICalUid}",n?"true":"false"))},e.prototype.isValidDateInputForFetchingEvents=function(e,t){var n=this.calendarServiceHelper.isValidDateInput(e,t),r=n.isValid,a=n.errorMessage;r||this.calendarServiceHelper.throwException(i.d.InvalidInput,a)},e.prototype.handleCancelValidationFailure=function(){this.logger.error("Calendar - Cancel event failed"),this.calendarServiceHelper.throwException(i.d.InvalidInput,N)},e.prototype.sendUpdateMeetingResponse=function(e,t,n,a){var s=this,o={responseType:this.getMeetingResponseAction(t),sendResponse:!!n,comment:a};return this.calendarServiceHttp.putRaw(e,[i.j.NO_CONTENT],this.send,"updateMeetingResponse",o).then((function(e){var t=e.headers;return s.logger.log("Meeting Rsvp Success"),s.logger.log("Call suceeded with requestId "+t["x-serverrequestid"]),!0})).catch((function(e){return Object(r.f)(s,void 0,void 0,(function(){return Object(r.i)(this,(function(t){return[2,Promise.reject(e)]}))}))}))},e.prototype.getMeetingResponseAction=function(e){switch(e){case s.b.MeetingResponseType.Accepted:return"Accept";case s.b.MeetingResponseType.Tentative:return"TentativelyAccept";case s.b.MeetingResponseType.Declined:return"Decline";default:this.calendarServiceHelper.throwException(i.d.NotImplemented,R)}return""},e}(),k=function(){function e(e,t,n,r,i,s){this.discover=n,this.coreSettings=r,this.loggerFactory=i,this.eventIdMinLength=32,this.getBodyForUpdateTeamEvent=function(e,t,n,r){return{updateMessageFormat:"The meeting has been updated",updatedCalendarEvent:C(e,t,n),fetchEventContract:{eventType:r.eventType,startTime:r.startTime,eventTimeZone:r.eventTimeZone}}},this.send=t.authorize(e,this.coreSettings.get(a.a.Auth).mtResource),this.calendarServiceHttp=new g(r,t,s),this.logger=this.loggerFactory.newLogger("NorthStarTeamCalendarService"),this.calendarServiceHelper=new V(this.logger),this.userLocale=s.config.localeCode,this.endPoints=G.MiddleTier.V1.Channel}return e.prototype.createOrUpdateTeamEvent=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var a;return Object(r.i)(this,(function(i){return(a=Object(r.a)(Object(r.a)({},e),{startTime:new Date(e.startTime),endTime:new Date(e.endTime)})).objectId?[2,this.updateTeamEvent(a,t,n).then((function(){return _(a)}))]:[2,this.createTeamEvent(a,t)]}))}))},e.prototype.getTeamEvent=function(e,t,n,a,s){return void 0===n&&(n=!1),Object(r.f)(this,void 0,Promise,(function(){var o,c,d=this;return Object(r.i)(this,(function(l){switch(l.label){case 0:return(!e||e.length<this.eventIdMinLength)&&this.calendarServiceHelper.throwException(i.d.InvalidInput,N),c=(o=this.calendarServiceHttp).getRaw,[4,this.generateGetCalendarEventUrl(e,t,n,a,s)];case 1:return[2,c.apply(o,[l.sent(),[i.j.OK],this.send,"getTeamEvent"]).then((function(e){var t=e.body,n=e.headers;return Object(r.f)(d,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=r.sent(),e.headers=n,e)]}}))}))})).then((function(e){var t=e.body,n=e.headers;return d.logger.log("Call suceeded with requestId "+n["x-serverrequestid"]),_(t.value)}))]}}))}))},e.prototype.cancelTeamEvent=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var a,o,c,d,l,u,v,h,p;return Object(r.i)(this,(function(E){switch(E.label){case 0:return this.logger.log("Cancelling team calendar event "+e.iCalUId),a=e.iCalUId,o=e.useICalUId,c=e.messageId,d=e.conversationId,l=e.rootMessageId,u=e.cancellationMessageFormat,v=e.cancellationMessage,(!a||a.length<this.eventIdMinLength)&&(this.logger.error("Calendar - Cancel team event failed due to validation error"),this.calendarServiceHelper.throwException(i.d.InvalidInput,N)),[4,this.generateCancelEventUrl(a,!!o,n)];case 1:return h=E.sent(),p=d&&t?{conversationId:d,messageId:c,rootMessageId:l,cancellationMessageFormat:u,fetchEventContract:{eventType:t.isSeries?s.b.AppointmentType.RecurringMaster:t.eventType,eventTimeZone:t.eventTimeZone,startTime:t.startTime}}:{},p=v?Object(r.a)(Object(r.a)({},p),{cancellationMessage:v}):p,[2,this.cancelCalendarEvent(h,p)]}}))}))},e.prototype.addToMyCalendar=function(e,t,n,a){return Object(r.f)(this,void 0,Promise,(function(){var s,o=this;return Object(r.i)(this,(function(r){switch(r.label){case 0:return this.logger.log("Adding event "+e+" to user's calendar, isSeries: "+a),(!e||e.length<this.eventIdMinLength)&&this.calendarServiceHelper.throwException(i.d.InvalidInput,N),[4,this.generateAddToMyCalendarUrl(t,e,!!n)];case 1:return s=r.sent(),[2,this.calendarServiceHttp.postRaw(s,[i.j.NO_CONTENT],this.send,"addToMyCalendar").then((function(e){var t=e.headers;return o.logger.log("AddToMyCalendar suceeded with requestId "+t["x-serverrequestid"]),!0}))]}}))}))},e.prototype.forwardTeamEvent=function(e,t,n,a,s){return Object(r.f)(this,void 0,void 0,(function(){var o,c,d,l=this;return Object(r.i)(this,(function(r){switch(r.label){case 0:if(this.logger.log("Forwarding team calendar event: "+e+", useICalUid: "+a),!e||e.length<this.eventIdMinLength)throw this.logger.error("Calendar - Forward team event failed due to validation error"),this.calendarServiceHelper.throwException(i.d.InvalidInput,N);return[4,this.generateForwardEventUrl(e,a,s)];case 1:return o=r.sent(),c={forwardAttendees:t,messageBodyPrefix:n},[2,this.calendarServiceHttp.postRaw(o,[i.j.NO_CONTENT],this.send,"forwardTeamEvent",c,(d={},d["X-Client-UI-Language"]=this.userLocale,d)).then((function(e){var t=e.headers;return l.logger.log("Calendar - forward team event success with requestId "+t["x-serverrequestid"]),!0}))]}}))}))},e.prototype.cancelCalendarEvent=function(e,t){var n=this;return this.calendarServiceHttp.putRaw(e,[i.j.NO_CONTENT],this.send,"cancelTeamEvent",t).then((function(e){var t=e.headers;return n.logger.log("Cancel Team Event Success suceeded with requestId "+t["x-serverrequestid"]),!0}))},e.prototype.generateGetCalendarEventUrl=function(e,t,n,a,i){return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(r){return[2,H(this.discover,this.endPoints.GET_CHANNEL_EVENT.replace("{eventId}",e).replace("{smtpAddress}",t).replace("{useICalUid}",n?"true":"false").replace("{eventType}",a||"").replace("{eventStartDateTime}",i?encodeURIComponent(i):""))]}))}))},e.prototype.generateAddToMyCalendarUrl=function(e,t,n){return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(r){return[2,H(this.discover,this.endPoints.ADD_TO_MY_CALENDAR.replace("{smtpAddress}",e).replace("{eventId}",t).replace("{useICalUid}",n?"true":"false"))]}))}))},e.prototype.generateCancelEventUrl=function(e,t,n){return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(r){return[2,H(this.discover,this.endPoints.CANCEL_TEAM_EVENT.replace("{iCalUID}",e).replace("{useICalUid}",t?"true":"false").replace("{smtpAddress}",n))]}))}))},e.prototype.generateForwardEventUrl=function(e,t,n){return H(this.discover,G.MiddleTier.V2.Channel.FORWARD_TEAM_EVENT.replace("{eventId}",e).replace("{useICalUid}",t?"true":"false").replace("{smtpAddress}",n))},e.prototype.updateTeamEvent=function(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var a,s,o,c,d,l,u=this;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n?(a=j(e.startTime,e.endTime),s=a.startTime,o=a.endTime,c=this.getBodyForUpdateTeamEvent(e,s,o,n),[4,H(this.discover,this.endPoints.UPDATE_TEAM_EVENT.replace("{iCalUID}",e.iCalUID||"").replace("{smtpAddress}",t))]):[2,Promise.reject("Fetch contract missing")];case 1:return d=r.sent(),[2,this.calendarServiceHttp.putRaw(d,[i.j.NO_CONTENT],this.send,"updateTeamEvent",c,(l={},l["X-Client-UI-Language"]=this.userLocale,l)).then((function(e){var t=e.headers;return u.logger.log("Call suceeded with requestId "+t["x-serverrequestid"]),!0}))]}}))}))},e.prototype.createTeamEvent=function(e,t){return Object(r.f)(this,void 0,Promise,(function(){var n,a,s,o,c,d,l=this;return Object(r.i)(this,(function(u){switch(u.label){case 0:return t?(n=j(e.startTime,e.endTime),a=n.startTime,s=n.endTime,c=(o=this.calendarServiceHttp).postRaw,[4,this.generateCreateTeamEventUrl(t)]):[2,Promise.reject("smtp address is invalid - empty")];case 1:return[2,c.apply(o,[u.sent(),[i.j.CREATED],this.send,"createTeamEvent",C(e,a,s),(d={},d["X-Client-UI-Language"]=this.userLocale,d)]).then((function(e){var t=e.body,n=e.headers;return Object(r.f)(l,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={},[4,t.json()];case 1:return[2,(e.body=r.sent(),e.headers=n,e)]}}))}))})).then((function(e){var t=e.body,n=e.headers;return l.logger.log("Call suceeded with requestId "+n["x-serverrequestid"]),_(t.value)}))]}}))}))},e.prototype.generateCreateTeamEventUrl=function(e){return H(this.discover,this.endPoints.CREATE_TEAM_EVENT.replace("{smtpAddress}",e).replace("{enablePstn}",String(!0)))},e}()}}]);