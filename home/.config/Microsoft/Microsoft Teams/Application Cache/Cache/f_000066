webpackJsonp([5],{2285:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2286)},2286:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2287),n(2288),n(2289),n(2290),n(2291),n(2292),n(2293),n(2294),n(2295),n(2296),n(2297),n(2298),n(2299),n(2300),n(2301),n(2302),n(2303),n(2304),n(2305),n(2306),n(2307),n(2308),n(2309),n(2310),n(2311),n(2312),n(2313),n(2314),n(2315),n(2316),n(2318),n(2319),n(2321),n(2322),n(2323),n(2324),n(2325),n(2326),n(2327),n(2328),n(2329),n(2330),n(2331),n(2332),n(2333),n(2334),n(2335),n(2337),n(2338),n(2339),n(2340),n(2341),n(2342),n(2343),n(2344),n(2345),n(2346),n(2347),n(2348)},2287:function(e,t,n){"use strict";var a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var a=Array(e),r=0,t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,r++)a[r]=i[o];return a};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,f,m,v,y,S,A,C,T,b,w,P,E,k,O,$,_,q,H,N,D,M,F,x,j,L){var B=this;this.$q=e,this.esParser=t,this.esTriggers=n,this.navigateToMostActiveChannelActionHandler=a,this.navigateToAppsActionHandler=r,this.navigateToFilesActionHandler=i,this.navigateToChatActionHandler=o,this.navigateToChatWithContactActionHandler=s,this.navigateToTeamsActionHandler=c,this.navigateToCalendarActionHandler=u,this.navigateToCallsActionHandler=l,this.navigateToActivityActionHandler=p,this.navigateToNewChatActionHandler=g,this.navigateToTwtCreateActionHandler=d,this.navigateToSettingActionHandler=h,this.enableOneClickJoinActionHandler=f,this.playFreVideoActionHandler=m,this.navigateToDocumentViewerActionHandler=v,this.downloadDesktopActionHandler=y,this.updateUserProfileActionHandler=S,this.sendMemberInvitesActionHandler=A,this.openInvitationWizardActionHandler=C,this.clickBodyActionHandler=T,this.navigateToMostRecentTeamActionHandler=b,this.navigateToAggregateFilesActionHandler=w,this.expandChannelListsActionHandler=P,this.collapseChannelListsActionHandler=E,this.downloadAndroidAppActionHandler=k,this.navigateToUrlAcionHandler=O,this.updateDiscoverySettingsActionHandler=$,this.updateCortanaConsentHandler=_,this.displaySurfaceActionHandler=q,this.navigateToWhatsNewActionHandler=H,this.changeThemeActionHandler=N,this.openDialogActionHandler=D,this.navigateToPeopleAppActionHandler=M,this.pinPeopleAppToMenuActionHandler=F,this.enableMultiWindowAndReloadAppActionHandler=x,this.navigateToFreemiumLiveChatActionHandler=j,this.clickElementActionHandler=L,this.actionHandlers={};var R=Array.from(arguments);this.actionHandlers={},R.forEach(function(e){B.isActionHandler(e)&&(B.actionHandlers[e.actionKey]=e)})}return e.$inject=["$q","esParser","esTriggers","navigateToMostActiveChannelActionHandler","navigateToAppsActionHandler","navigateToFilesActionHandler","navigateToChatActionHandler","navigateToChatWithContactActionHandler","navigateToTeamsActionHandler","navigateToCalendarActionHandler","navigateToCallsActionHandler","navigateToActivityActionHandler","navigateToNewChatActionHandler","navigateToTwtCreateActionHandler","navigateToSettingActionHandler","enableOneClickJoinActionHandler","playFreVideoActionHandler","navigateToDocumentViewerActionHandler","downloadDesktopActionHandler","updateUserProfileActionHandler","sendMemberInvitesActionHandler","openInvitationWizardActionHandler","clickBodyActionHandler","navigateToMostRecentTeamActionHandler","navigateToAggregateFilesActionHandler","expandChannelListsActionHandler","collapseChannelListsActionHandler","downloadAndroidAppActionHandler","navigateToUrlAcionHandler","updateDiscoverySettingsActionHandler","updateCortanaConsentHandler","displaySurfaceActionHandler","navigateToWhatsNewActionHandler","changeThemeActionHandler","openDialogActionHandler","navigateToPeopleAppActionHandler","pinPeopleAppToMenuActionHandler","enableMultiWindowAndReloadAppActionHandler","navigateToFreemiumLiveChatActionHandler","clickElementActionHandler"],e.prototype.isActionHandler=function(e){return e&&e.actionKey&&e.handleAction},e.prototype.hasRegisteredAction=function(e){if(!e)return!1;var t=this.parseActionKey(e).key;return!(!t||!this.actionHandlers[t])},e.prototype.actionTitle=function(e){var t,n=this;if(this.hasRegisteredAction(e)){var a=this.parseActionKey(e),r=a.key,i=a.params;if(this.actionHandlers[r].title){var o=this.esTriggers.getResolutionContext(),s=i.map(function(e){return n.esParser.evaluateExpression(e,o)});return(t=this.actionHandlers[r]).title.apply(t,s)}}},e.prototype.handleAction=function(e,t,n){var r,i=this;if(!this.hasRegisteredAction(e))return this.$q.reject(e+" is not a registered action");var o=this.parseActionKey(e),s=o.key,c=o.params.map(function(e){return i.esParser.evaluateExpression(e,n)});return(r=this.actionHandlers[s]).handleAction.apply(r,a([t],c))},e.prototype.parseActionKey=function(e){var t=this.esParser.parseFnCall(e);return{key:t.fnName,params:t.params}},e}();t.EsActionHandler=r,angular.module("teamspace.esActionHandler",["teamspace.esParser","teamspace.esTriggers","teamspace.navigateToMostActiveChannelActionHandler","teamspace.navigateToAppsActionHandler","teamspace.navigateToAppBarItemActionHandlers","teamspace.navigateToChatWithContactActionHandler","teamspace.navigateToNewChatActionHandler","teamspace.navigateToTwtCreateActionHandler","teamspace.navigateToSettingActionHandler","teamspace.enableOneClickJoinActionHandler","teamspace.playFreVideoActionHandler","teamspace.navigateToDocumentViewerActionHandler","teamspace.downloadDesktopActionHandler","teamspace.updateUserProfileActionHandler","teamspace.sendMemberInvitesActionHandler","teamspace.openInvitationWizardActionHandler","teamspace.navigateToUrlActionHandler","teamspace.clickBodyActionHandler","teamspace.navigateToMostRecentTeamActionHandler","teamspace.navigateToAggregateFilesActionHandler","teamspace.expandCollapseChannelListsActionHandlers","teamspace.updateDiscoverySettingsActionHandler","teamspace.updateCortanaConsentHandler","teamspace.displaySurfaceActionHandler","teamspace.displaySurfaceActionHandler","teamspace.navigateToWhatsNewActionHandler","teamspace.changeThemeActionHandler","teamspace.openDialogActionHandler","teamspace.navigateToPeopleAppActionHandler","teamspace.pinPeopleAppToMenuActionHandler","teamspace.enableMultiWindowAndReloadAppActionHandler","teamspace.navigateToFreemiumLiveChatActionHandler","teamspace.clickElementActionHandler"]).service("esActionHandler",r)},2288:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.$qNoApply=e,this.constants=t}return e.$inject=["$qNoApply","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickBody},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return $("body").click(),this.$qNoApply.resolve().finally(function(){return e.close()})},e}();t.ClickBodyActionHandler=a,angular.module("teamspace.clickBodyActionHandler",["teamspace.constants"]).service("clickBodyActionHandler",a)},2289:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.freemiumUtilities=n}return e.$inject=["$qNoApply","constants","freemiumUtilities"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToFreemiumLiveChat},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return this.$qNoApply.resolve().then(function(){t.freemiumUtilities.openFreemiumLiveChatUrl()}).finally(function(){return e.close()})},e}();t.NavigateToFreemiumLiveChatActionHandler=a,angular.module("teamspace.navigateToFreemiumLiveChatActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.freemiumUtilities"]).service("navigateToFreemiumLiveChatActionHandler",a)},2290:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.logger=n.newLogger("ClickElementActionHandler")}return e.$inject=["$qNoApply","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickElement.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.clickElement.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(!t||1!=t.length||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(t);return this.logger.error(a),this.$qNoApply.reject(a)}return this.$qNoApply.resolve().then(function(){$(t[0]).click()}).finally(function(){return e.close()})},e}();t.ClickElementActionHandler=a,angular.module("teamspace.clickElementActionHandler",["teamspace.qNoApply","teamspace.constants"]).service("clickElementActionHandler",a)},2291:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e.PendingJoinRequests="pendingJoinRequests"}(a||(a={}));var r=function(){function e(e,t,n,a,r,i){this.$qNoApply=e,this.constants=t,this.manageTenantService=a,this.dialogService=r,this.tenantMembershipService=i,this.logger=n.newLogger("EnableOneClickJoinActionHandler")}return e.$inject=["$qNoApply","constants","esLogger","manageTenantService","dialogService","tenantMembershipService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableOneClickJoin.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableOneClickJoin.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];if(!n||2!=n.length||2!=this.paramsDesc.length){var i="Action handler "+this.actionKey+" expects 2 arguments, received "+JSON.stringify(n);return this.logger.error(i),this.$qNoApply.reject(i)}var o=n[0],s=n[1],c=this.manageTenantService.setAutoApproveJoinRequestsEnabled(o).catch(function(){t.logger.error("Action handler "+t.actionKey+" failed to enable or disable one click join.")});return s==a.PendingJoinRequests&&this.navigateToPendingJoinRequests(),c},e.prototype.navigateToPendingJoinRequests=function(){this.tenantMembershipService.getTenantJoinRequestCount()>0&&this.dialogService.open(this.constants.dialogs.pendingJoinRequests,{source:teamspace.services.PendingJoinRequestsDialogSource.OneClickJoinCoachmark})},e}();t.EnableOneClickJoinActionHandler=r,angular.module("teamspace.enableOneClickJoinActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.manageTenantService"]).service("enableOneClickJoinActionHandler",r)},2292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.$qNoApply=e,this.constants=t,this.dialogService=n,this.loggingService=a,this.videoUrl=i.fre.videos.base+t.azureVideos.freemiumFiveThingsVideo[r.getSupportedVideoLocale()]+i.fre.videos.videoParams}return e.$inject=["$qNoApply","constants","dialogService","loggingService","localizationService","appConfig"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.playFreVideo},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.freemium.freemiumFreVideoCoachmarkPlayVideo);return this.$qNoApply.resolve().then(function(){t.showVideo(),n.stop()}).catch(function(){n.fail({message:"Error playing freemium fre video"})}).finally(function(){e.close()})},e.prototype.showVideo=function(){this.dialogService.open(this.constants.dialogs.displayVideo,{videoSrc:this.videoUrl,videoType:"video/mp4",videoCallerId:"freemium-fre-video-coachmark"})},e}();t.PlayFreVideoActionHandler=a,angular.module("teamspace.playFreVideoActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.config","teamspace.videoIframeDialog","teamspace.dialogService","teamspace.loggingService","teamspace.localizationService"]).service("playFreVideoActionHandler",a)},2293:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.$qNoApply=e,this.constants=t,this.downloadAppService=n}return e.$inject=["$qNoApply","constants","downloadAppService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.downloadDesktopApp},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.downloadAppService.download()}).finally(function(){return e.close()})},e}();t.DownloadDesktopActionHandler=a,angular.module("teamspace.downloadDesktopActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.downloadAppService"]).service("downloadDesktopActionHandler",a)},2294:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.Expand=0]="Expand",e[e.Collapse=1]="Collapse"}(a=t.ExpandCollapseAction||(t.ExpandCollapseAction={}));var r=function(){function e(e,t,n){this.$qNoApply=e,this._actionKey=t,this.action=n}return Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=$('[data-tid="team-channel-list"]').controller("channelList")||{};return _.each(n.teamsByOrder,function(e){return e&&e.isCollapsed==(t.action==a.Expand)&&n.expandCollapseTeam(e)}),this.$qNoApply.resolve()},e}();t.ExpandCollapseChannelListsActionHandler=r,angular.module("teamspace.expandCollapseChannelListsActionHandlers",["teamspace.qNoApply","teamspace.constants"]).factory("expandChannelListsActionHandler",["$qNoApply","constants",function(e,t){return new r(e,t.growth.engagementSurfaces.actionKey.expandChannelLists,a.Expand)}]).factory("collapseChannelListsActionHandler",["$qNoApply","constants",function(e,t){return new r(e,t.growth.engagementSurfaces.actionKey.collapseChannelLists,a.Collapse)}])},2295:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t,n,a,r,i,o){this.esTranslate=e,this.constants=t,this.loggingService=n,this.resources=a,this.localizationService=r,this.mobileDownloadEmailService=i,this.mobileDownloadSmsService=o}return e.$inject=["esTranslate","constants","loggingService","resources","localizationService","mobileDownloadEmailService","mobileDownloadSmsService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.mobileUpsell},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.mobileUpsell);if(e)if(e.getIsLoading())t.incomplete({message:"action is currently on-going"});else{var n=_(e.getUiControls()).filter(function(e){return a.IsUserInterfaceEmailSms(e.control)}).first();if(n)if(n.isValid){e.setIsLoading(!0),e.setErrorText(""),n.isLoading=!0,(validator.isEmail(n.value)?this.sendEmail(n.value,e,t):this.sendSms(n.phoneNumber,e,t)).finally(function(){e.setIsLoading(!1),n.isLoading=!1})}else t.incomplete({message:"user input is not valid"});else t.fail({message:"unable to find input context for mobile upsell"})}else t.fail({message:"controller is a required argument to handleAction!"})},e.prototype.sendEmail=function(e,t,n){var a=this;return this.mobileDownloadEmailService.sendDownloadMail(e,this.localizationService.getLocale()).then(function(){n.stop({message:"success sending email"}),a.setIsCompleted(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_send_completed,{sendTo:"email"},{email:e}),t)}).catch(function(e){var r=(e||{}).statusCode;n.fail({message:"unable to send mobile download email. statusCode="+r}),t.setErrorText(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_error_message))})},e.prototype.sendSms=function(e,t,n){var a=this,r=libphonenumber.PhoneNumberUtil.getInstance();return this.mobileDownloadSmsService.sendSms(e).then(function(){n.stop({message:"success sending sms"}),a.setIsCompleted(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_send_completed,{sendTo:"phoneNo"},{phoneNo:r.format(e,libphonenumber.PhoneNumberFormat.NATIONAL)}),t)}).catch(function(e){var r=(e||{}).statusCode;n.fail({message:"unable to send mobile download sms. statusCode="+r}),t.setErrorText(a.esTranslate.instant(a.resources.strings.download_mobile_dialog_sms_error_message))})},e.prototype.setIsCompleted=function(e,t){t.getUiControls().forEach(function(e){var t=a.IsUserInterfaceControlImage(e.control),n=a.IsUserInterfaceControlQrCodeImage(e.control),r=a.IsUserInterfaceControlBoldText(e.control);e.isHidden=!t&&!r||n}),t.setIsCompleted(e,this.esTranslate.instant(this.resources.strings.mobile_upsell_dialog_send_another_link))},e}();t.MobileUpsellActionHandler=r,angular.module("teamspace.mobileUpsellActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.localizationService","teamspace.esTranslate","teamspace.mobileDownloadEmailService","teamspace.mobileDownloadSmsService"]).service("mobileUpsellActionHandler",r)},2296:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.constants=e,this.navigationService=t}return e.$inject=["constants","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToMostRecentTeam},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return this.navigationService.navigateToLastTeamState("engagement-surfaces").then(function(){}).finally(function(){return e.close()})},e}();t.NavigateToMostRecentTeamActionHandler=a,angular.module("teamspace.navigateToMostRecentTeamActionHandler",["teamspace.navigationService","teamspace.constants"]).service("navigateToMostRecentTeamActionHandler",a)},2297:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.navigationService=a,this.logger=n.newLogger("NavigateToAppsActionHandler")}return e.$inject=["$qNoApply","constants","loggingService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToApps},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToAppsView()}).catch(function(e){return t.logger.error("unable to navigate to apps"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToAppsActionHandler=a,angular.module("teamspace.navigateToAppsActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.navigationService"]).service("navigateToAppsActionHandler",a)},2298:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i,o,s,c,u,l){this.$rootScope=e,this.$qNoApply=t,this.esLogger=n,this._actionKey=a,this.appId=r,this.appBarItemType=i,this.layoutService=o,this.userAppsStore=s,this.appBarService=c,this.settingsService=u,this.constants=l}return Object.defineProperty(e.prototype,"enableDynamicAppBarRendering",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableDynamicAppBarRendering)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.userAppsStore.waitForPinnedAndCoreAppsToInitialize().then(function(){if(t.enableDynamicAppBarRendering)return(e=t.appBarService.getAppBarItem(t.appId))?t.appBarService.onAppSelected(t.$rootScope,e,services.AppSelectionSource.EngagementSurface):t.$qNoApply.reject("app bar item not found");var e=t.layoutService.getAppBarItem(t.appBarItemType);if(!e)return t.$qNoApply.reject("app bar item not found");t.layoutService.onAppBarItemClick(e),e.clicked(e)}).catch(function(e){var n=teamspace.services.AppBarItemType[t.appBarItemType];return t.esLogger.error("unable to navigate to app bar item: "+n+" "+t.appId+"-"+t.enableDynamicAppBarRendering),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToAppBarItemActionHandler=a,angular.module("teamspace.navigateToAppBarItemActionHandlers",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.userAppsStore","teamspace.appBarService","teamspace.layoutService","teamspace.userAppsStore","teamspace.settingsService"]).factory("navigateToFilesActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToFilesActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToFiles,n.appId.files,teamspace.services.AppBarItemType.Files,i,o,s,c,n)}]).factory("navigateToChatActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToChatActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToChat,n.appId.chat,teamspace.services.AppBarItemType.Chat,i,o,s,c,n)}]).factory("navigateToTeamsActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToTeamsActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToTeams,n.appId.teamsAndChannel,teamspace.services.AppBarItemType.Teams,i,o,s,c,n)}]).factory("navigateToCalendarActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToCalendarActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToCalendar,n.appId.calendar,teamspace.services.AppBarItemType.Calendar,i,o,s,c,n)}]).factory("navigateToCallsActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToCallsActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToCalls,n.appId.calling,teamspace.services.AppBarItemType.Call,i,o,s,c,n)}]).factory("navigateToActivityActionHandler",["$rootScope","$qNoApply","constants","esLogger","layoutService","userAppsStore","appBarService","settingsService","identityService",function(e,t,n,r,i,o,s,c,u){return new a(e,t,r.newLogger("navigateToActivityActionHandler"),n.growth.engagementSurfaces.actionKey.navigateToActivity,n.appId.activity,teamspace.services.AppBarItemType.Alerts,i,o,s,c,n)}])},2299:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.$q=e,this.constants=t,this.conversationsService=a,this.peopleService=r,this.navigationService=i,this.logger=n.newLogger("NavigateToChatWithContactActionHandler")}return e.$inject=["$q","constants","esLogger","conversationsService","peopleService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToConversationWithContact.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToConversationWithContact.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$q.reject(r)}var i=n[0];return i&&i.email&&!i.mri?this.peopleService.getAllShortPeopleProfileFromAAD([i.email],"navigate-to-conversation-with-contact",!0).then(function(n){if(!n||!n.length){var a="Could not find any contact with that email";return t.logger.error(a),e.close(),t.$q.reject(a)}var r=n[0];return t.navigateToContactWithConversation(e,r)}):this.navigateToContactWithConversation(e,i)},e.prototype.navigateToContactWithConversation=function(e,t){var n=this,a=t&&this.conversationsService.getConversationWith(t.mri);if(!a||!a.id){var r="Unable to create conversation with "+JSON.stringify(t);return this.logger.error(r),e.close(),this.$q.reject(r)}return this.navigationService.navigateToChat(a.id,"esp_"+this.actionKey).catch(function(e){n.logger.error("Unable to navigate to contact"),n.$q.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToChatWithContactActionHandler=a,angular.module("teamspace.navigateToChatWithContactActionHandler",["teamspace.constants","teamspace.esLogger","teamspace.conversationsService","teamspace.peopleService","teamspace.navigationService"]).service("navigateToChatWithContactActionHandler",a)},2300:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.constants=e,this.channelService=n,this.navigationService=a,this.logger=t.newLogger("NavigateToMostActiveChannelActionHandler")}return e.$inject=["constants","loggingService","channelService","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToMostActiveChannel},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"navCtx",{get:function(){return"nav-to-most-active-channel"},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.channelService.getTeams().then(function(e){var n=e.reduce(function(e,t){return e.concat(t.channels)},[]),a=_(n).map(function(e){return{lastSeen:e.lastSeen||"0",unreadCount:e.unreadCount||0,objectId:e.objectId}}).orderBy(["unreadCount","lastSeen"],["desc","desc"]).first();a?t.navigationService.navigateToChannel(a.objectId,t.navCtx):t.navigationService.navigateToDefaultTeamState(t.navCtx)}).catch(function(){t.logger.error("unable to navigate to most active channel")}).finally(function(){e.close()})},e}();t.NavigateToMostActiveChannelActionHandler=a,angular.module("teamspace.navigateToMostActiveChannelActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.channelService","teamspace.navigationService"]).service("navigateToMostActiveChannelActionHandler",a)},2301:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.newChatService=a,this.logger=n.newLogger("NavigateToNewChatActionHandler")}return e.$inject=["$qNoApply","constants","loggingService","newChatService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToNewChat},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.newChatService.navigateToNewChat("navigate-to-new-chat-action-handler")}).catch(function(e){return t.logger.error("unable to navigate to new chat"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToNewChatActionHandler=a,angular.module("teamspace.navigateToNewChatActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.newChatService"]).service("navigateToNewChatActionHandler",a)},2302:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.teamActionDialogUtilityService=a,this.logger=n.newLogger("NavigateToMostActiveChannelActionHandler")}return e.$inject=["$qNoApply","constants","loggingService","teamActionDialogUtilityService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToTwtCreateStep},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return e.close()}).then(function(){return t.teamActionDialogUtilityService.openCreateTeamDialog(0,!0)}).catch(function(e){return t.logger.error("unable to navigate to create team wizard"),t.$qNoApply.reject(e)})},e}();t.NavigateToTwtCreateActionHandler=a,angular.module("teamspace.navigateToTwtCreateActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.loggingService","teamspace.teamActionDialogUtilityService"]).service("navigateToTwtCreateActionHandler",a)},2303:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.dialogService=a,this.logger=n.newLogger("NavigateToSettingActionHandler")}return e.$inject=["$qNoApply","constants","esLogger","dialogService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToSetting},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.dialogService.open(t.constants.dialogs.optionsSettingsDialog,{tabItemId:"Privacy"})}).catch(function(e){return t.logger.error("unable to navigate to setting"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToSettingActionHandler=a,angular.module("teamspace.navigateToSettingActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.dialogService"]).service("navigateToSettingActionHandler",a)},2304:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.esLogger=n,this.navigationService=a}return e.$inject=["$qNoApply","constants","esLogger","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToWhatsNew},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToHelpAppWhatsNew()}).catch(function(e){return t.esLogger.error("unable to navigate to whats new"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToWhatsNewActionHandler=a,angular.module("teamspace.navigateToWhatsNewActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.navigationService"]).service("navigateToWhatsNewActionHandler",a)},2305:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$q=e,this.constants=t,this.navigationService=a,this.logger=n.newLogger("NavigateToDocumentViewerActionHandler")}return e.$inject=["$q","constants","esLogger","navigationService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToDocumentViewer.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToDocumentViewer.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||n.length<1||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 or more arguments, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$q.reject(r)}var i=n[0];if(i){var o={documentViewerParams:{fileType:i.type,objectUrl:i.objectUrl,baseUrl:i.siteUrl,fileId:i.objectId,serviceName:this.constants.files.serviceName.aggregate,threadId:i.teamId,viewerAction:this.constants.files.fileActions.viewer.view},viewerState:this.constants.states.appDocumentViewer};return this.navigationService.navigateToFileViewer(o).catch(function(e){t.logger.error("Unable to navigate to file viewer"),t.$q.reject(e)}).finally(function(){return e.close()})}return e.close(),this.logger.error("AggregateDto is undefined"),this.$q.reject("No selected aggregateDto")},e}();t.NavigateToDocumentViewerActionHandler=a,angular.module("teamspace.navigateToDocumentViewerActionHandler",["teamspace.constants","teamspace.esLogger","teamspace.navigationService"]).service("navigateToDocumentViewerActionHandler",a)},2306:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.navigationService=n,this.esLogger=a}return e.$inject=["$qNoApply","constants","navigationService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToAggregateFiles},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){return t.navigationService.navigateToAggregateFiles()}).catch(function(e){return t.esLogger.error("unable to navigate to aggregate files"),t.$qNoApply.reject(e)}).finally(function(){return e.close()})},e}();t.NavigateToAggregateFilesActionHandler=a,angular.module("teamspace.navigateToAggregateFilesActionHandler",["teamspace.qNoApply","teamspace.navigationService","teamspace.esLogger","teamspace.constants"]).service("navigateToAggregateFilesActionHandler",a)},2307:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t,n,a,r){this.$q=e,this.constants=t,this.loggingService=n,this.channelService=a,this.conversationsService=r}return e.$inject=["$q","constants","loggingService","channelService","conversationsService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateDiscoverySettings},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this,n=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.discoverySettings);if(e)if(e.getIsLoading())n.incomplete({message:"loading is currently on-going"});else{var r=_(e.getUiControls()).filter(function(e){return a.IsUserInterfaceDiscoverySettings(e.control)}).first();if(r)if(r.isPending)n.incomplete({message:"action is currently on-going"});else{r.isPending=!0;var i=void 0!==r.erroredSettings&&r.erroredSettings.length>0,o=i?r.erroredSettings:r.discoverySettings.filter(function(e){return e.isDiscoverable});if(0!==o.length){var s=_.map(o,function(e){var n=t.$q.defer(),a=t.conversationsService.getConversation(e.team.objectId).groupId;return t.channelService.setTeamIsDiscoverable(a,!0).then(function(t){if(i){var a=r.erroredSettings.indexOf(e,0);a>-1&&r.erroredSettings.splice(a,1)}n.resolve()}).catch(function(t){e.retryFailed=i,i||r.erroredSettings.push(e),n.reject()}),n.promise});return this.$q.all(s).then(function(e){n.stop({message:"success updating discovery settings"}),r.isPending=!1,r.isSuccess=!0,r.handleSuccess()}).catch(function(e){n.fail({message:"unable to update discovery setting for one or more teams"}),r.isPending=!1,r.handleError()})}}else n.fail({message:"unable to find input context for discovery settings"})}else n.fail({message:"controller is a required argument to handleAction!"})},e}();t.UpdateDiscoverySettingsActionHandler=r,angular.module("teamspace.updateDiscoverySettingsActionHandler",["teamspace.constants","teamspace.loggingService","teamspace.channelService","teamspace.conversationsService"]).service("updateDiscoverySettingsActionHandler",r)},2308:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t,n){this.$q=e,this.constants=t,this.logger=n.newLogger("UpdateUserProfileActionHandler")}return e.$inject=["$q","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateUserProfile},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=_(e.getUiControls()).filter(function(e){return a.IsUserInterfaceUpdateUserProfile(e.control)||a.IsUserInterfaceUpdateUserProfileV2(e.control)}).first();return t?(t.onSave(),this.$q.resolve()):(this.logger.error("unable to find input context for update user profile"),e.close(),this.$q.reject())},e}();t.UpdateUserProfileActionHandler=r,angular.module("teamspace.updateUserProfileActionHandler",["teamspace.constants","teamspace.esLogger"]).service("updateUserProfileActionHandler",r)},2309:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t){this.$q=e,this.constants=t}return e.$inject=["$q","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.sendMemberInvites},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return _(e.getUiControls()).filter(function(e){return a.IsUserInterfaceControlMemberInvite(e.control)}).first().sendInvitations(),this.$q.resolve()},e}();t.SendMemberInvitesActionHandler=r,angular.module("teamspace.sendMemberInvitesActionHandler",["teamspace.constants"]).service("sendMemberInvitesActionHandler",r)},2310:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t){this.$q=e,this.constants=t}return e.$inject=["$q","constants"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openInvitationWizard},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){return _(e.getUiControls()).filter(function(e){return a.IsUserInterfaceControlPendingJoinRequests(e.control)}).first().openInvitationWizard(),this.$q.resolve()},e}();t.OpenInvitationWizardActionHandler=r,angular.module("teamspace.openInvitationWizardActionHandler",["teamspace.constants"]).service("openInvitationWizardActionHandler",r)},2311:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.esLogger=t,this.$window=n,this._actionKey=a,this.url=r}return Object.defineProperty(e.prototype,"actionKey",{get:function(){return this._actionKey},enumerable:!0,configurable:!0}),e.prototype.title=function(){return this.url},e.prototype.handleAction=function(e){var t=this;return this.$qNoApply.resolve().then(function(){t.$window.open(t.url,"_blank"),t.esLogger.info("User successfully navigated to "+t.url)}).finally(function(){return e.close()})},e}();t.NavigateToUrlLegacyActionHandler=a;var r=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.$window=t,this.constants=n,this.deepLinkService=r,this.logger=a.newLogger("NavigateToUrlActionHandler")}return e.$inject=["$qNoApply","$window","constants","esLogger","deepLinkService"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToUrl.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToUrl.params},enumerable:!0,configurable:!0}),e.prototype.title=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e?e[0]:void 0},e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$qNoApply.reject(r)}var i=n[0];return i.startsWith("https://teams.microsoft.com/l/")?this.$qNoApply.resolve().then(function(){return t.deepLinkService.resolveURL(i)}).catch(function(e){return t.logger.error("unable to navigate to deeplink url"),t.$qNoApply.reject(e)}).finally(function(){return e.close()}):this.$qNoApply.resolve().then(function(){t.$window.open(i,"_blank"),t.logger.info("User successfully navigated to "+i)}).finally(function(){return e.close()})},e}();t.NavigateToUrlActionHandler=r,angular.module("teamspace.navigateToUrlActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.deepLinkService"]).service("navigateToUrlAcionHandler",r).factory("downloadAndroidAppActionHandler",["$qNoApply","constants","$window","esLogger",function(e,t,n,r){return new a(e,r.newLogger("downloadAndroidAppActionHandler"),n,t.growth.engagementSurfaces.actionKey.downloadAndroidApp,t.growth.engagementSurfaces.externalUrls.androidAppStoreUrl)}])},2312:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.$injector=t,this.constants=n,this.loggingService=a,this.logger=r.newLogger("DisplaySurfaceActionHandler")}return e.$inject=["$qNoApply","$injector","constants","loggingService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.displaySurface.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.displaySurface.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(e.close(),!t||1!=t.length||1!=this.paramsDesc.length){var a="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(t);return this.logger.error(a),this.$qNoApply.reject(a)}var r=t[0],i=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.handleAction.displaySurface);return this.$injector.get("esDisplayManager").displayById(r,e,i)},e}();t.DisplaySurfaceActionHandler=a,angular.module("teamspace.displaySurfaceActionHandler",["teamspace.constants","teamspace.esDisplayManager"]).service("displaySurfaceActionHandler",a)},2313:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){this.banner=t,this.id=e.id,this.treatment=e.treatment}return e.prototype.close=function(){this.banner.hide()},e}(),r=function(){function e(e,t,n,a,r,i,o,s,c,u){this.$rootScope=e,this.$q=t,this.constants=n,this.esTranslate=r,this.esActionHandler=i,this.esSurfaceStack=o,this.appStateAdapter=s,this.analyticsService=c,this.eventingService=u}return e.$inject=["$rootScope","$q","constants","loggingService","esTranslate","esActionHandler","esSurfaceStack","appStateAdapter","analyticsService","eventingService"],e.prototype.displayBanner=function(e,t,n){var a,r=this,i=this.$q.defer(),o=e.params,s=o.actionCssClass||"",c=function(){a&&a.hide(),i.resolve()},u=(o.actions||[]).map(function(t,i){return{message:r.esTranslate.instant(t.resxKey,t.resxParams,n),icon:t.icon,title:r.esActionHandler.actionTitle(t.actionKey),run:function(){r.esSurfaceStack.setCurrentAction(t.actionKey);var i=r.createBannerActionContext(e,a);r.esActionHandler.handleAction(t.actionKey,i,n).catch(function(){return i.close()})},telemetryOptions:{moduleName:teamspace.components.PanelModuleName.engagementSurfaceBannerButton,moduleType:teamspace.components.PanelModuleType.button,scenario:teamspace.components.PanelActionScenario.engagementSurfaceBannerButton,scenarioType:teamspace.components.PanelActionScenarioType.engagementSurface,moduleSummary:"engagment surface banner button resx="+t.resxKey,gesture:teamspace.components.PanelActionGesture.click,dataBag:{id:e.id,currIndex:i,treatment:e.treatment,actionKey:r.esActionHandler.parseActionKey(t.actionKey).key}}}});a=this.appStateAdapter.mainNotificationBannerStore.showBanner(teamspace.services.Severity.Promo,this.esTranslate.instant(o.resxKey,o.resxParams,n),e.id+"-"+e.treatment,{countdownInSeconds:-1,autoHideTimer:o.autoCloseInSeconds||0,action:u,hideAction:function(t){r.setActionFromBannerHideSource(e,t),i.resolve()},cssClass:"engagement-surface",bannerIcon:o.icon,actionCssClass:s,telemetryOptions:{panelRegion:teamspace.PanelRegion.banner,panelType:teamspace.PanelType.engagementSurfaceBanner,moduleName:teamspace.components.PanelModuleName.notificationBanner,closeGesture:teamspace.components.PanelActionGesture.click,closeModuleType:teamspace.components.PanelModuleType.button,closeScenario:teamspace.components.PanelActionScenario.engagementSurfaceBannerButton,scenarioType:teamspace.components.PanelActionScenarioType.engagementSurface,closeOutcome:teamspace.components.PanelActionOutcome.dismiss,closeModuleSummary:"close engagement surface banner",dataBag:{id:e.id,treatment:e.treatment}}}),t.stop();var l=this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return c()});return i.promise.finally(function(){return l()}),i.promise},e.prototype.setActionFromBannerHideSource=function(e,t){var n,a=this,r=(n={},n[teamspace.services.BannerHideSource.Close]=this.constants.growth.engagementSurfaces.actionKey.xClose,n[teamspace.services.BannerHideSource.Timeout]=this.constants.growth.engagementSurfaces.actionKey.timeout,n)[t];if(r){if(r===this.constants.growth.engagementSurfaces.actionKey.timeout){var i={panelType:teamspace.PanelType.engagementSurfaceBanner,dataBag:{id:e.id,treatment:e.treatment,actionKey:r}};_.defer(function(){return a.analyticsService.sendPseudoPanelView(i)})}this.esSurfaceStack.setCurrentAction(r)}},e.prototype.createBannerActionContext=function(e,t){return new a(e,t)},e}();t.EsBannerService=r,angular.module("teamspace.esBannerService",["teamspace.esTranslate","teamspace.loggingService","teamspace.appStateAdapter","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.constants","teamspace.analyticsService","teamspace.eventingService"]).service("esBannerService",r)},2314:function(e,t,n){"use strict";var a,r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var a=Array(e),r=0,t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,r++)a[r]=i[o];return a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),s=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,f,m,v,y,S,A,C,T){this.$q=e,this.constants=t,this.esRepository=n,this.dialogService=a,this.settingsService=r,this.loggingService=i,this.analyticsService=o,this.$state=s,this.utilityService=c,this.esTriggers=u,this.esSurfaceStack=l,this.esBannerService=p,this.esHelpBotService=g,this.esCarouselService=d,this.esCoachmarkService=h,this.esQuickGuideService=f,this.esMenuService=m,this.esActivityService=v,this.esActionHandler=y,this.esFetchDataHandler=S,this.esParser=A,this.firstRunService=C,this.logger=T.newLogger("EsDisplayManger"),this.queue=[]}return e.$inject=["$q","constants","esRepository","dialogService","settingsService","loggingService","analyticsService","$state","utilityService","esTriggers","esSurfaceStack","esBannerService","esHelpBotService","esCarouselService","esCoachmarkService","esQuickGuideService","esMenuService","esActivityService","esActionHandler","esFetchDataHandler","esParser","firstRunService","esLogger"],e.prototype.initialize=function(e){this.esConfig=e,this.queue.forEach(function(e){e.scenario.incomplete({message:"re-initializing display manager after updated esConfig"})}),this.queue=[]},e.prototype.enqueue=function(e,t,n){var a=this;if(this.logger.info("enqueuing surface "+e.id+" "+e.treatment),this.settingsService.valueAsBoolean(this.constants.settings.names.sendPanelViewOnEngagementSurfaceQueued)&&this.sendPanelView(e,teamspace.PanelType.enqueuedEngagementSurface),e.trigger===o.Trigger.SurfaceShown)return this.displaySurface(e,t,n);this.queue.push({esSurfaceConfig:e,scenario:t,context:n});var r=this.$q.defer();return _.defer(function(){return a.processQueue().then(r.resolve,r.reject)}),r.promise},e.prototype.display=function(t,n){var a=e.onDemandSurfaceEcsMap[t],r=this.settingsService.valueFor(a),i=this.esTriggers.getResolutionContext();if(!_.isNil(r)){var o=this.esRepository.expandOnDemandSurfaceConfig(r,a);return this.displaySurface(o,n,i)}return this.$q.reject("on-demand surface is not configured")},e.prototype.displayById=function(e,t,n){var a=this.esConfig.engagementSurfaces.find(function(t){return t.id===e}),r=this.esTriggers.getResolutionContext();if(a){var i=this.esRepository.convertToProgrammaticSurface(a,t.id);return this.displaySurface(i,n,r)}return this.$q.reject("surface id is not defined")},e.prototype.getDateUntilNextPriority=function(e){if(e.trigger===o.Trigger.FirstRun)return moment(new Date(0));var t=e.priority,n=this.esConfig.priorityThrottlesInMinutes[t],a=this.esConfig.engagementSurfaces.reduce(function(e,t){return i(e,t.displayed)},[]);if(!a.length)return moment(new Date(0));var r=moment.max(a).clone();return r.add(n,this.constants.momentjs.unitOfTime.minutes),r},e.prototype.processQueue=function(){var e=this;return this.processingQueuePromise||(this.processingQueuePromise=this._processQueue().finally(function(){return e.processingQueuePromise=void 0})),this.processingQueuePromise},e.prototype._processQueue=function(){var e=this,t=this.$q.resolve(),n=_.partition(this.queue,function(e){return e.esSurfaceConfig.displayed.length<e.esSurfaceConfig.recur}),a=n[0];if(n[1].forEach(function(t){var n="not showing surface "+t.esSurfaceConfig.id+". already shown "+t.esSurfaceConfig.displayed.length+" times";e.logger.warn(n),t.scenario.stop({message:n})}),this.queue=a,!this.queue.length)return t;this.queue=_.sortBy(this.queue,[function(e){return e.esSurfaceConfig.displayed.length},function(e){return e.esSurfaceConfig.priority},function(e){return e.esSurfaceConfig.isSettled},function(e){return e.esSurfaceConfig.order}]);var r=!!this.esSurfaceStack.getSurfaceState().curr,i=moment(new Date),s=_.find(this.queue,function(t){var n=t.esSurfaceConfig,a=t.context;return e.esMenuService.isMenuInProgress(n,a,e.esConfig)})||_.find(this.queue,function(t){var n=t.esSurfaceConfig,a=t.context;if(-1===n.priority)return!0;var o=e.getDateUntilNextPriority(n),s=i.isAfter(o)&&!r,c=e.esMenuService.isMenuComplete(n,a,e.esConfig);return s&&!c});if(s){_.remove(this.queue,function(e){return e.esSurfaceConfig.id===s.esSurfaceConfig.id});var c=s.esSurfaceConfig,u=s.scenario,l=s.context;if(t=this.displaySurface(c,u,l),c.trigger===o.Trigger.FirstRun){var p=_.partition(this.queue,function(e){return e.esSurfaceConfig.trigger===o.Trigger.FirstRun}),g=p[0];return p[1].forEach(function(t){var n="not showing surface "+t.esSurfaceConfig.id+". does not meet display requirements";t.scenario.stop({message:n}),e.logger.info(n)}),this.queue=g,t=this.queue.length?t.finally(function(){return e._processQueue()}):t.finally(function(){e.firstRunService.setFreComplete(),e.esTriggers.onFirstRunComplete(),e.esTriggers.fire(o.Trigger.AppReady)})}}else this.logger.info("not showing "+this.queue.length+" surface(s) due to time-based throttling."),r&&this.logger.error("not showing surface. the surface "+this.esSurfaceStack.getSurfaceState().curr.id+" is currently showing");return this.queue.forEach(function(e){e.scenario.stop({message:"not showing surface. does not meet display requirements"})}),this.queue=[],t},e.prototype.getSurfaceDisplayAction=function(e,t,n){var a,r=this,i=(a={},a[o.EngagementSurface.Modal]=this.displayModal,a[o.EngagementSurface.Coachmark]=this.displayCoachmark,a[o.EngagementSurface.Banner]=this.displayBanner,a[o.EngagementSurface.HelpBot]=this.postProactiveMessage,a[o.EngagementSurface.Carousel]=this.displayCarousel,a[o.EngagementSurface.QuickGuide]=this.displayQuickGuide,a[o.EngagementSurface.Menu]=this.displayMenu,a[o.EngagementSurface.Activity]=this.postActivityFeed,a);return function(){return i[e.surface].bind(r)(e,t,n)}},e.prototype.executePreActions=function(e,t,n){var a,r=this,i=this.$q.resolve(),o=e.id,s=e.treatment;return(e.preActionKeys||[]).forEach(function(e){i=i.then(function(){return a=e,r.esActionHandler.handleAction(e,{id:o,treatment:s,close:$.noop},n)}).then(function(){return r.logger.info("pre-display action "+e+" executed by "+o)})}),i.catch(function(e){var n="not showing surface "+o+". failed to execute pre-display action "+a+". "+e;return r.logger.error(n),t.fail({message:n}),r.$q.reject(e)}),i},e.prototype.executeFetchDataActions=function(e,t,n){var a=this;n=n||{now:moment(new Date),moment:moment};var i={},s=[],c=(e.fetchDataKeys||[]).filter(function(e){return void 0===n[e]}).map(function(t){return a.esFetchDataHandler.fetchData(t).then(function(e){return i=r(r({},i),e)}).then(function(){return(e.trigger===o.Trigger.SurfaceShown||e.trigger===o.Trigger.Programmatic)&&a.logger.warn("Suboptimal configuration for chained surface "+e.id+": consider adding fetchedDataKey "+t+" to the first surface of the chain as well.")}).catch(function(e){var n="failed to execute fetchdata action "+t+": "+e;return s.push(n),a.$q.reject(e)})});return this.$q.all(c).then(function(){return i}).catch(function(){var e="not showing surface. failed to execute one of the fetchdata actions:\n"+s.join("\n");return a.logger.error(e),t.fail({message:e}),a.$q.reject(e)})},e.prototype.evaluateDataCondition=function(e,t,n){n=n||{now:moment(new Date),moment:moment};var a=e.dataCondition,r=a&&this.esParser.evaluateExpression(a,n),i=!a||!!r;return i||this.logger.warn("Data condition ("+a+") is false for "+e.id),i},e.prototype.displaySurface=function(e,t,n){var a=this;n=n||{now:moment(new Date),moment:moment},this.logger.info("displaying surface "+e.id);var r=this.loggingService.newScenario("display_"+e.id),i=function(){var e="engagement surfaces control group bi logging only";return t.stop({message:e}),r.stop({message:e}),a.logger.info(e),a.$q.resolve()},s=0;return this.executeFetchDataActions(e,t,n).then(function(e){return _.merge(n,e)}).then(function(){return a.evaluateDataCondition(e,t,n)}).then(function(e){return e||a.$q.reject()}).then(function(){return a.sendEligiblePanelView(e)}).then(function(){return e.isControlGroup?i():a.$q.resolve().then(function(){return a.esSurfaceStack.setCurrentSurface(e)}).then(function(){return a.executePreActions(e,t,n)}).then(function(){return s=Date.now()}).then(function(){return r.pause({reason:"displaying surface"})}).then(function(){return a.getSurfaceDisplayAction(e,t,n)()}).then(function(){return a.sendElapsedPanelView(e,s)}).catch(function(){return a.esSurfaceStack.unsetCurrentSurface(),a.$q.reject()}).then(function(){return e.displayed.push(moment(new Date))}).then(function(){return a.esSurfaceStack.onSurfaceClosed()}).then(function(){a.esRepository.updateSurfaceAsDisplayed(e)}).then(function(){return a.esTriggers.fire(o.Trigger.SurfaceShown)})}).finally(function(){return r.stop()})},e.prototype.displayBanner=function(e,t,n){return this.esBannerService.displayBanner(e,t,n)},e.prototype.displayCoachmark=function(e,t,n){return this.esCoachmarkService.displayCoachmark(e,t,n)},e.prototype.displayModal=function(e,t,n){var a=this,r=this.$q.defer(),i=e.params,o=function(){return a.dialogService.open(a.constants.dialogs.engagementSurfaceDialog,{id:e.id,treatment:e.treatment,uiControls:e.userInterfaceControls,params:i,context:n,scenario:t}).closePromise.then(r.resolve).catch(r.reject)};if(this.dialogService.isAnyDialogOpen()&&!i.displayAtopOtherModals){var s="waiting for existing dialog to close before showing engagement modal";t.pause({reason:s}),this.logger.warn(s),this.dialogService.onAllDialogsClosed().then(function(){t.resume(),o()})}else o();return r.promise},e.prototype.displayCarousel=function(e,t,n){return this.esCarouselService.displayCards(e,t,n)},e.prototype.displayQuickGuide=function(e,t,n){return this.esQuickGuideService.displayQuickGuide(e,t,n)},e.prototype.displayMenu=function(e,t,n){return this.esMenuService.displayMenu(e,t,n,this.esConfig)},e.prototype.postProactiveMessage=function(e,t,n){return this.esHelpBotService.invokeMessage(e,t,n)},e.prototype.postActivityFeed=function(e,t,n){return this.esActivityService.postActivityFeed(e,t,n)},e.prototype.sendEligiblePanelView=function(e){return e.eligibleTimes.length<e.recur?(this.sendPanelView(e,teamspace.PanelType.eligibleEngagementSurface),this.sendPseudoSurfacePanelView(e),e.eligibleTimes.push(moment(new Date)),this.esRepository.updateEligiblePanelViewSent(e).then(function(){})):this.$q.resolve()},e.prototype.sendPseudoSurfacePanelView=function(e){var t;if(this.settingsService.valueAsBoolean(this.constants.settings.names.sendPseudoEngagementSurfacePanelViewInControl)&&e.isControlGroup){var n=(t={},t[o.EngagementSurface.Modal]={panelRegion:teamspace.PanelRegion.modal,panelType:teamspace.PanelType.engagementSurfaceDialog},t[o.EngagementSurface.Coachmark]={panelRegion:teamspace.PanelRegion.popover,panelType:teamspace.PanelType.engagementSurfaceCoachmark},t[o.EngagementSurface.Banner]={panelRegion:teamspace.PanelRegion.banner,panelType:teamspace.PanelType.engagementSurfaceBanner},t[o.EngagementSurface.HelpBot]={panelRegion:teamspace.PanelRegion.main,panelType:teamspace.PanelType.engagementSurfaceProactiveMessage},t[o.EngagementSurface.Carousel]={panelRegion:teamspace.PanelRegion.modal,panelType:teamspace.PanelType.engagementSurfaceCarousel},t[o.EngagementSurface.Activity]={panelRegion:teamspace.PanelRegion.main,panelType:teamspace.PanelType.engagementSurfaceActivity},t);this.sendPanelView(e,n[e.surface].panelType,n[e.surface].panelRegion)}},e.prototype.sendElapsedPanelView=function(e,t){this.sendPanelView(e,teamspace.PanelType.elapsedEngagementSurface,teamspace.PanelRegion.main,{elapsedMs:Date.now()-t})},e.prototype.sendPanelView=function(e,t,n,a){this.analyticsService.sendPanelView({panel:{launchMethod:teamspace.components.LaunchMethod[teamspace.components.LaunchMethod.direct],previousUri:void 0,previousUriParams:void 0,region:teamspace.PanelRegion[n||teamspace.PanelRegion.main],uri:this.$state.current.name,uriParams:this.loggingService.hashUriParamsPII(this.$state.params),viewId:this.utilityService.generateUUID(),type:teamspace.PanelType[t]},dataBag:r({id:e.id,treatment:e.treatment,isControlGroup:e.isControlGroup,pseudo:!0},a)})},e.onDemandSurfaceEcsMap=(a={},a[teamspace.services.engagementSurfaces.OnDemandSurface.PromoteMobileDownloadModal]=teamspace.Constants.Instance.settings.names.promoteMobileDownloadModal,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumUpdateProfileDialogFre]=teamspace.Constants.Instance.settings.names.freemiumUpdateProfileDialogFre,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumUpdateProfileDialogFreV2]=teamspace.Constants.Instance.settings.names.freemiumUpdateProfileDialogFreV2,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumInviteMembersDialogFre]=teamspace.Constants.Instance.settings.names.freemiumInviteMembersDialogFre,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreOneClickJoinCoachmark]=teamspace.Constants.Instance.settings.names.freemiumFreOneClickJoinCoachmark,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumJoinByUrlDialogFre]=teamspace.Constants.Instance.settings.names.freemiumJoinByUrlDialogFre,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreQuickGuideSurface]=teamspace.Constants.Instance.settings.names.freemiumFreQuickGuideSurface,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreQuickGuideSurfaceV2]=teamspace.Constants.Instance.settings.names.freemiumFreQuickGuideSurfaceV2,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreSweepCardSurface]=teamspace.Constants.Instance.settings.names.freemiumFreSweepCardSurface,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreSweepCardWithVideoSurface]=teamspace.Constants.Instance.settings.names.freemiumFreSweepCardWithVideoSurface,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreSweepCardWithReadyCardSurface]=teamspace.Constants.Instance.settings.names.freemiumFreSweepCardWithReadyCardSurface,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreInviteMembersDialogV2]=teamspace.Constants.Instance.settings.names.freemiumFreInviteMembersDialogV2,a[teamspace.services.engagementSurfaces.OnDemandSurface.FreemiumFreVideoCoachmark]=teamspace.Constants.Instance.settings.names.freemiumFreVideoCoachmark,a[teamspace.services.engagementSurfaces.OnDemandSurface.DefaultFrePromptCards]=teamspace.Constants.Instance.settings.names.defaultFrePromptCards,a[teamspace.services.engagementSurfaces.OnDemandSurface.CortanaConsentModal]=teamspace.Constants.Instance.settings.names.cortanaConsentModal,a[teamspace.services.engagementSurfaces.OnDemandSurface.ExternalCortanaConsentModal]=teamspace.Constants.Instance.settings.names.externalCortanaConsentModal,a[teamspace.services.engagementSurfaces.OnDemandSurface.LongCortanaConsentModal]=teamspace.Constants.Instance.settings.names.longCortanaConsentModal,a[teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackNpsCoachmark]=teamspace.Constants.Instance.settings.names.customerFeedbackNpsCoachmark,a[teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackBpsCoachmark]=teamspace.Constants.Instance.settings.names.customerFeedbackBpsCoachmark,a[teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackNlqsCoachmark]=teamspace.Constants.Instance.settings.names.customerFeedbackNlqsCoachmark,a[teamspace.services.engagementSurfaces.OnDemandSurface.CustomerFeedbackSuiteNpsCoachmark]=teamspace.Constants.Instance.settings.names.customerFeedbackSuiteNpsCoachmark,a),e}();t.EsDisplayManager=s,angular.module("teamspace.esDisplayManager",["teamspace.constants","teamspace.esRepository","teamspace.loggingService","teamspace.settingsService","teamspace.analyticsService","teamspace.esTriggers","teamspace.esSurfaceStack","teamspace.esBannerService","teamspace.esHelpBotService","teamspace.esCarouselService","teamspace.esCoachmarkService","teamspace.esQuickGuideService","teamspace.esActionHandler","teamspace.esFetchDataHandler","teamspace.esParser","teamspace.firstRunService","teamspace.esMenuService","teamspace.esActivityService"]).service("esDisplayManager",s)},2315:function(e,t,n){"use strict";var a=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var a=Array(e),r=0,t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,r++)a[r]=i[o];return a};Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,f,m,v){this.$rootScope=e,this.$q=t,this.$timeout=n,this.$interval=a,this.esRepository=r,this.esTriggers=i,this.esParser=o,this.esDisplayManager=s,this.constants=u,this.loggingService=l,this.appStateService=p,this.settingsService=g,this.firstRunService=h,this.eventingService=f,this.esParseService=m,this.ecsFoundation=v,this.TEAMS_ESP_CONFIG_NAMESPACE="TeamsESPConfigs",this._syncCount=0,this.haveUserSeenNonFreSurface=!1,this._numOfPendingFirstRunSurfaces=0,this._configContainsFirstRunSurfaces=!1,this._enqueuedFirstRunSurface=!1,this._firstRunFired=!1,this._subscriptionComplete=!1,this.logger=c.newLogger("EsEngine"),this.initializeOnAppLaunchAndReinit(),d.registerForMtma(this)}return e.$inject=["$rootScope","$q","$timeout","$interval","esRepository","esTriggers","esParser","esDisplayManager","esLogger","constants","loggingService","appStateService","settingsService","orchestrationService","firstRunService","eventingService","esParseService","ecsFoundation"],e.prototype.cleanupOnAppTeardown=function(){this.resetFirstRunState(),this.config=void 0,this._hasStarted=!1,this._syncCount=0,this.esTriggers.clear(),this.initialConfigSyncDeferred=void 0,this.esDisplayManager.initialize(this.config),this.haveUserSeenNonFreSurface=!1},e.prototype.initializeOnAppLaunchAndReinit=function(){var e=this;this.initialConfigSyncDeferred=this.$q.defer(),this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.engagementSurfaces.onAction,function(t,n){e.config&&(e.config.userState.completedActions=_.uniq(a(e.config.userState.completedActions,n)))})},e.prototype.mtmaTelemetryIdentifier=function(){return"EsEngine"},e.prototype.onFirstRunFired=function(){return this._firstRunFired=!0,this.checkFirstRun(),this.$q.resolve()},e.prototype.resetFirstRunState=function(){this._numOfPendingFirstRunSurfaces=0,this._configContainsFirstRunSurfaces=!1,this._enqueuedFirstRunSurface=!1,this._firstRunFired=!1,this._subscriptionComplete=!1},e.prototype.startUp=function(){var e=this;this._hasStarted||(this._hasStarted=!0,this.logger.info("starting up the engagement surface engine"),this.settingsService.valueAsBoolean(this.constants.settings.names.enableESPConfigFetching)&&(this.ecsFoundation.addNamespaceToFetch(this.TEAMS_ESP_CONFIG_NAMESPACE,null),this.ecsFoundation.onFetchCompleted(function(){e.esRepository.loadEcsPayloadOnSettingsUpdate(e.ecsFoundation.getEcsPayload())})),this.syncConfig(),this.$timeout(function(){e.shouldSyncDaily()&&e.syncConfig(),e.$interval(function(){e.shouldSyncDaily()&&e.syncConfig()},e.constants.timeInMiliseconds.day,0,!1)},this.getMillisecondsUntilTomorrowBetween1amAnd4am(),!1))},e.prototype.getUserCompletedActions=function(){var e=this;return this.initialConfigSyncDeferred.promise.then(function(){return _.cloneDeep(e.config.userState.completedActions)})},e.prototype.syncConfig=function(){var e=this;this._syncCount++,this.logger.info("syncing the engagement surface config");var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.startUp);this.resetFirstRunState(),this.esTriggers.clear(),this.esTriggers.subscribe(r.Trigger.FirstRun,void 0,void 0,function(){return e.onFirstRunFired()}),this._syncCount>1&&this.eventingService.$emit(this.constants.events.fre.evaluate),this.esRepository.getConfig().then(function(n){n||(t.stop({message:"no engagement surfaces defined"}),e.logger.warn("no engagement surfaces defined"),n={engagementSurfaces:[]}),e.config=n,e.initialConfigSyncDeferred.resolve(),e.logger.info("engagement surface configuration retrieved"),e.esDisplayManager.initialize(n);var a=[];e.haveUserSeenNonFreSurface=n.engagementSurfaces.some(function(e){return e.trigger!==r.Trigger.FirstRun&&e.displayed.length>0}),n.engagementSurfaces.filter(function(e){return e.displayed.length<e.recur}).forEach(function(t){if(!t.id||_.isUndefined(t.trigger)||_.isUndefined(t.surface)){o="invalid es config. id="+t.id+" trigger="+t.trigger+" surface="+r.EngagementSurface[t.surface];return a.push(o),void e.logger.error(o)}if(!e.haveUserSeenNonFreSurface||t.trigger!==r.Trigger.FirstRun)try{var i=e.esParser.parse(t.condition,n.engagementSurfaces);e.esTriggers.subscribe(t.trigger,t.triggerFilter,e.esParseService,function(a){return e.handleTriggerFire(t,n.userState,i,a)},t.delayInSeconds),t.trigger===r.Trigger.FirstRun&&e._numOfPendingFirstRunSurfaces++}catch(n){var o="failed to parse ["+t.condition.toString()+"] or ["+t.triggerFilter.toString()+"]. "+n.message;a.push(o),e.logger.error(o)}}),e._subscriptionComplete=!0,e._configContainsFirstRunSurfaces=!e.haveUserSeenNonFreSurface&&e._numOfPendingFirstRunSurfaces>0,e.checkFirstRun(),a.length?t.fail({message:a.join(",")}):t.stop()}).catch(function(n){e.appStateService.isConnected?t.fail({message:"failed to retrieve configuration",statusCode:(n||{}).statusCode}):t.incomplete({message:"failed to retrieve configuration - app is not connected",statusCode:(n||{}).statusCode})})},e.prototype.onFirstRunWithNoSurfaces=function(){var e=this;if(this.haveUserSeenNonFreSurface)return this.logger.info("FirstRun triggered but user already saw non FRE surfaces! Not Displaying default FRE experience."),void this.setFreComplete();this.esRepository.hasSurfaceDisplayed(this.constants.settings.names.defaultFrePromptCards).then(function(t){t||(e.logger.error("FirstRun triggered with no applicable surfaces! Displaying default FRE experience."),e.showDefaultFRE())}).catch(function(t){e.logger.error("Failed to find if default FRE experience was displayed before."),e.logger.error("FirstRun triggered with no applicable surfaces! Displaying default FRE experience."),e.showDefaultFRE()})},e.prototype.showDefaultFRE=function(){var e=this;if(this.settingsService.valueAsBoolean(this.constants.settings.names.disableESPDefaultFRESurfaces))this.setFreComplete();else{var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.defaultFreFallback);this.esDisplayManager.display(teamspace.services.engagementSurfaces.OnDemandSurface.DefaultFrePromptCards,t).then(function(){e.setFreComplete()})}},e.prototype.setFreComplete=function(){this.firstRunService.setFreComplete(),this.esTriggers.onFirstRunComplete()},e.prototype.checkFirstRun=function(){this._firstRunFired&&this._subscriptionComplete&&(this._configContainsFirstRunSurfaces||this.onFirstRunWithNoSurfaces())},e.prototype.shouldSyncDaily=function(){return!this.settingsService.valueAsBoolean(this.constants.settings.names.disableEngagementSurfacesDailySync)},e.prototype.handleTriggerFire=function(e,t,n,a){var i=this,o="handling trigger "+r.Trigger[e.trigger]+" with condition "+e.condition+" for id="+e.id+" "+e.treatment;return this.logger.info(o),this.esRepository.getEcsSurfaceConfigurations().then(function(s){var c=e.trigger==r.Trigger.FirstRun;c&&i._numOfPendingFirstRunSurfaces--,s=s||[];var u=_.find(s,function(t){return t.id===e.id});if(u){var l=moment(),p=u.startTime&&moment(new Date(u.startTime)),g=u.endTime&&moment(new Date(u.endTime));if(p&&l.isBefore(p))i.logger.warn(e.id+" will not display. now ("+l.toISOString()+") is before the configured start time of "+u.startTime);else if(g&&l.isAfter(g))i.logger.warn(e.id+" will not display. now ("+l.toISOString()+") is after the configured end time of "+u.endTime);else{if(n.invoke(t)){c&&(i._enqueuedFirstRunSurface=!0);var d=i.loggingService.newScenario(i.constants.scenarios.onboarding.engagementSurfaces.handleTriggerFire,null,null,i.constants.timeInMiliseconds.hour);return d.eventData={intent:o},i.esDisplayManager.enqueue(e,d,a)}var h=e.id+" not shown: condition not satisfied";i.logger.info(h),c&&0===i._numOfPendingFirstRunSurfaces&&!i._enqueuedFirstRunSurface&&i.onFirstRunWithNoSurfaces()}}else i.logger.warn(e.id+" no longer found in ECS configuration - will not display")})},e.prototype.getMillisecondsUntilTomorrowBetween1amAnd4am=function(){var e=moment(new Date),t=moment(new Date).add(1,this.constants.momentjs.unitOfTime.days);return t.hour(1),t.minute(0),t.second(0),t.millisecond(0),t.diff(e)+Math.ceil(3*this.constants.timeInMiliseconds.hour*Math.random())},e}();t.EsEngine=i,angular.module("teamspace.esEngine",["teamspace.esRepository","teamspace.esTriggers","teamspace.esParser","teamspace.esDisplayManager","teamspace.constants","teamspace.loggingService","teamspace.appState","teamspace.settingsService","teamspace.esLogger","teamspace.orchestrationService","teamspace.firstRunService","teamspace.eventingService","teamspace.esParseService","teamspace.ecsFoundation"]).service("esEngine",i)},2316:function(e,t,n){"use strict";var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}(),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)},i=this&&this.__spreadArrays||function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;for(var a=Array(e),r=0,t=0;t<n;t++)for(var i=arguments[t],o=0,s=i.length;o<s;o++,r++)a[r]=i[o];return a};Object.defineProperty(t,"__esModule",{value:!0});var o=n(8),s=n(2317),c=function(){function e(e){this.expression=e}return e.prototype.toString=function(){return this.expression},e}(),u=function(e){function t(t,n,a,r,i,o,s,c,u,l,p,g,d,h,f,m,v,y,S,A,C,T,b,w,P,E,k,O,$,_,q,H,N,D,M,F){var x=e.call(this,t.middleTierConstants.newEndpointAddress,i,c,a,n,r,l,s)||this;return x.appConfig=t,x.$q=n,x.$http=a,x.$qNoApply=r,x.settingsService=i,x.loggingService=o,x.appStateService=s,x.constants=c,x.resources=u,x.authenticationService=l,x.myUserPreferencesStore=p,x.eventingService=g,x.channelService=d,x.tenantService=h,x.userAppsStore=f,x.utilityService=m,x.userResourcesSettingsStore=v,x.identityService=y,x.helpBotService=S,x.sfbTeamsUpgradeService=A,x.esSurfaceStack=C,x.esPortalComms=b,x.storageService=w,x.downloadAppService=P,x.callingService=E,x.callingSupportService=k,x.cortanaConfigurationService=O,x.firstRunService=$,x.desktopUtilityService=_,x.peopleTargetingService=q,x.esLocationAffiliationService=H,x.callingMultiWindowService=N,x.ecsFoundation=D,x.experienceContainerFeatureService=M,x.localizationService=F,x.logger=T.newLogger("EsRepository"),x.getEngagementSurfacesDeferred=r.defer(),x}return a(t,e),t.$inject=["appConfig","$q","$http","$qNoApply","settingsService","loggingService","appStateService","constants","resources","authenticationService","myUserPreferencesStore","eventingService","channelService","tenantService","userAppsStore","utilityService","userResourcesSettingsStore","identityService","helpBotService","sfbTeamsUpgradeService","esSurfaceStack","esLogger","esPortalComms","storageService","downloadAppService","callingService","callingSupportService","cortanaConfigurationService","firstRunService","desktopUtilityService","peopleTargetingService","esLocationAffiliationService","callingMultiWindowService","ecsFoundation","experienceContainerFeatureService","localizationService"],Object.defineProperty(t.prototype,"enableEspDebugOverride",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableEspDebugOverride)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"enableESPConfigFetching",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableESPConfigFetching)},enumerable:!0,configurable:!0}),t.prototype.getConfig=function(){var e=this,n=this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementSurfaces),a=this.$q.resolve();return this.enableESPConfigFetching&&(a=this.initialEspConfigsloadFromEcs().then(function(){e.logger.info("Fetched ESP configuration from TeamsESPConfigs namespace")})),a.then(function(){return e.getEcsSurfaceConfigurations().then(function(a){if(!n||!a||!a.length)return e.$qNoApply.resolve(void 0);var r={retryOn:["5xx","404","429"],maxRetries:3},i=e.shouldFetchEngagementProfile();e.firstRunService.isFRESession()&&(r={retryOn:[],maxRetries:0});var o=function(t){return e.convert(t,a).then(function(t){return e.esSurfaceStack.setSurfaces(t.engagementSurfaces),t})},s=e.getEspConfigUrl(i);return e.withRetry(function(){return e.performApiGet(s,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply).then(function(t){return e.applyCache(t)}).then(function(t){return e.getEngagementSurfacesDeferred.resolve(t),o(t)})},null,r.retryOn,r.maxRetries).then(function(t){return e.syncCache(),t}).catch(function(n){if(e.getEngagementSurfacesDeferred.reject("GET engagementSurfaces failed"),e.firstRunService.isFRESession())return e.logger.warn("GET engagementSurfaces failed for FRE user, falling back to naked implementation"),e.applyCache(t.NAKED_DTO).then(function(e){return o(e)});throw n})})})},t.prototype.updateSurfaceAsDisplayed=function(e){return this.updateSurfaceAsDisplayedOrEligible(e,!1)},t.prototype.updateEligiblePanelViewSent=function(e){return this.updateSurfaceAsDisplayedOrEligible(e,!0)},t.prototype.resetSurfaces=function(){var e=this;return this.withRetry(function(){return e.performApiDelete(t.API_ENDPOINT,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply)})},t.prototype.addEngagemetSurfaceActions=function(e){var n=this;if(!e||!e.length)return this.$q.resolve();this.eventingService.$emit(this.constants.events.engagementSurfaces.onAction,e);var a={items:e.map(function(e){return{action:e}})};return this.withRetry(function(){return n.performApiPut(t.API_ENDPOINT+"/actions",{callType:t.CALL_TYPE},a).toNgPromise(n.$qNoApply)}).catch(function(){var t=e.map(function(e){return o.EngagementSurfaceAction[e]}).join(",");n.logger.warn("failed to update engagement surface actions: "+t+". cacheing locally."),n.esCache.addActions(a)})},t.prototype.expandOnDemandSurfaceConfig=function(e,t){var n=r(r({},e),{id:t,treatment:"",trigger:"Programmatic",isSettled:!1,eligibleTimes:[],condition:"",order:0,priority:-1});return this.convertSurfaceConfig(n)},t.prototype.convertToProgrammaticSurface=function(e,t){return r(r({},e),{id:t?t+"->"+e.id:e.id,trigger:o.Trigger.Programmatic,priority:-1,order:0})},t.prototype.getRelevantContacts=function(){var e=this;return this.withRetry(function(){return e.performApiGet(t.RELEVANTCONTACTS_ENDPOINT,{callType:t.CALL_TYPE}).toNgPromise(e.$qNoApply).then(function(t){return e.logger.info("Retrieved "+t.value.length+" relevant contacts"),t.value})},null,["5xx"])},t.prototype.hasSurfaceDisplayed=function(e){return this.getEngagementSurfacesDeferred.promise.then(function(t){return _.some(t.displayed,function(t){return t.id===e})})},t.prototype._getAuthHeaders=function(e,t){var n=this;return void 0===e&&(e=!1),this.authenticationService.getSkypeTokens(e).then(function(e){var a={};return a[n.constants.headers.accept]=n.constants.headers.jsonContent,a[n.constants.headers.tokens.xSkypeToken]=e.skypeToken,n.authenticationService.getAuthHeaders(a,void 0,[t])})},t.prototype.getEspConfigUrl=function(e){var n=t.API_ENDPOINT,a="?";return n.indexOf(a)>=0&&(a="&"),e&&(n+=a+t.FETCH_ENGAGEMENT_PROFILE_QSP),n},t.prototype.updateSurfaceAsDisplayedOrEligible=function(e,n){var a=this;if(this.esPortalComms.isUsingEspPortal())return this.$qNoApply.resolve();if(e.trigger===o.Trigger.Programmatic&&e.id!==this.constants.settings.names.defaultFrePromptCards||e.trigger===o.Trigger.SurfaceShown)return this.$qNoApply.resolve();var r={id:e.id,priority:e.priority,isControlGroup:n};return this.withRetry(function(){return a.performApiPut(t.API_ENDPOINT+"/displayed",{callType:t.CALL_TYPE},r).toNgPromise(a.$qNoApply)}).catch(function(t){a.logger.warn("unable to update surface "+e.id+" as displayed. cacheing locally."),a.esCache.addDisplayed(r)})},t.prototype.convert=function(e,t){var n=this;return this.convertUserState(e).then(function(a){return{engagementSurfaces:n.getSurfaceConfigurations(t,e.displayed,e.engagementSurfaces),userState:a,priorityThrottlesInMinutes:e.priorityThrottlesInMinutes}})},t.prototype.convertUserState=function(e){var t=this,n=e.userState,a=i(n.completedActions||[]),s=[];return this.myUserPreferencesStore.waitForPreferenceStoreToInitialize().then(function(){var n=t.myUserPreferencesStore.getUserPreferences(),i=n&&n.firstLoginInformation||{};[{isActive:!!(i.android||i.ios||i.wp),action:o.EngagementSurfaceAction.LoginTeamsMobileApp},{isActive:!!i.electron,action:o.EngagementSurfaceAction.LoginElectron},{isActive:!!i.desktopHwa,action:o.EngagementSurfaceAction.LoginDesktopHwa},{isActive:!!i.surfaceHub,action:o.EngagementSurfaceAction.LoginSurfaceHub}].forEach(function(e){return e.isActive&&a.push({action:o.EngagementSurfaceAction[e.action]})}),(a=_.uniqBy(a,function(e){return e.action})).length&&(s=_(a).map(function(e){return _.isString(e.action)?o.EngagementSurfaceAction[e.action]:_.isNumber(e.action)?e.action:void 0}).without(void 0).value(),t.eventingService.$emit(t.constants.events.engagementSurfaces.onAction,s));var c=t.convertEngagementProfile(e.userEngagementProfile);return t.getEnhancedUserStateParams().then(function(e){var n=r(r({},e),{completedActions:s,engagementProfile:c});return t.applyUserStateDebugOverrides(n)})})},t.prototype.convertEngagementProfile=function(e){if(!e)return null;var t=[];return t=e.actions.map(function(e){return{action:e.action,updatedAt:moment.utc(e.updatedAt),actionCounts:e.actionCounts.split("|").map(function(e){return parseInt(e,10)})}}),new s.EsEngagementProfile(t,e.churnScore)},t.prototype.isEmptyEngagementProfile=function(e){return!e||_.isEmpty(e.actions)&&(_.isEmpty(e.churnScore)||"NA"===e.churnScore)},t.prototype.withTimeout=function(e,t,n){var a=this;return this.settingsService.valueAsBoolean(this.constants.settings.names.disableEngagementSurfacesStartUpDependencyTimeout)?e:(n=n||this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesStartUpDependencyTimeout)||30*this.constants.timeInMiliseconds.second,this.utilityService.getPromiseWithTimeout(e,n,this.$q,t,!0).catch(function(e){if(e===t){var r=a.loggingService.newScenario(a.constants.scenarios.onboarding.engagementSurfaces.dependencyTimeout),i=t+" exceeded "+n+"ms";r.fail({message:i})}return a.$q.reject(e)}))},t.prototype.getEnhancedUserStateParams=function(){var e=this,t=this.settingsService.valueAsBoolean(this.constants.settings.names.enableSfbSpecificFre),n=this.settingsService.valueAsBoolean(this.constants.settings.names.enableDiscoverySettingEs),a=this.myUserPreferencesStore.getFirstWebLogin()||moment(),r=this.authenticationService.getLoggedInUser().profile||{},i=this.userResourcesSettingsStore.waitForSettingAndGetValue(SkypeX.Services.UserResourcesStorageKey.licenseType),o=this.channelService.getTeams(),s=n?this.channelService.getNonDiscoverableTeams():this.$qNoApply.resolve([]),c=t?this.sfbTeamsUpgradeService.getUpgradePolicyV2():this.$qNoApply.resolve(void 0),u=this.identityService.isTenantAdmin(),l=this.identityService.isServiceAdmin(),p=this.settingsService.valueAsBoolean(this.constants.settings.names.enableCallingCanCreateTenantWideTeam),g=u&&p?this.tenantService.canCreateTenantWide():this.$q.resolve({canCreate:!1}),d=this.settingsService.valueAsBoolean(this.constants.settings.names.disableEspWaitForPstnFlag)?this.$q.resolve(this.callingSupportService.isPSTNCallingAllowed()):this.callingSupportService.isPstnCallingAllowedAsync(),h=this.callingSupportService.getPhoneNumberAsync("esRepository"),f=this.desktopUtilityService.isProPlus(),m=this.desktopUtilityService.wasPromptShown(),v=this.identityService.isTrialUserPromise(),y=this.esLocationAffiliationService.isUserInAffectedGeo();return this.utilityService.whenAllAllowFailures([this.withTimeout(i,"userLicensePromise"),this.withTimeout(o,"getTeamsPromise"),this.withTimeout(s,"getNonDiscoverableTeamsPromise"),this.withTimeout(c,"sfbUpgradePolicyPromise"),this.withTimeout(g,"canCreatePromise"),this.withTimeout(d,"isPstnCallingAllowedPromise"),this.withTimeout(h,"getPhoneNumberPromise"),this.withTimeout(v,"isTrialUserPromise")]).then(function(t){var n=t[0].result,i=t[1].result,o=t[2].result,s=t[3].result,c=t[4].result&&t[4].result.canCreate,p=t[5].result,g=!!t[6].result,d=t[7].result,h=i.some(function(e){return e.isTenantWide}),v=i.some(function(e){return 2==e.teamType});return{id:r.oid,upn:r.upn,tenantId:r.tid,locale:e.localizationService.getLocale(),teamsCount:(i||[]).length,licenseType:n,firstWebLogin:a,hasChatApp:e.userAppsStore.hasApp(e.constants.appId.chat),hasCallsApp:e.userAppsStore.hasApp(e.constants.appId.calling),hasCalendarApp:e.userAppsStore.hasApp(e.constants.appId.calendar),hasPhoneNumber:g,hasClassTeam:v,isAnonymous:e.authenticationService.isAnonymous(),isGuest:e.identityService.isGuestUserType(),isTrialUser:d,isFreemiumTenant:e.identityService.isFreemiumTenant(),isSfbUpgrade:s&&e.sfbTeamsUpgradeService.isUpgradedUserPolicy(s),isHelpBotConversationEmpty:e.helpBotService.isEmptyConversation,isTenantAdmin:u,isServiceAdmin:l,hasTWTInTenant:h,canCreateTWT:c,isHealthcareUser:e.settingsService.valueAsBoolean(e.constants.settings.names.enableHealthcareFre),earlyDesktopPromotedTimes:(e.storageService.get(e.constants.growth.earlyDesktopPromo.storageKey,!1)||[]).map(function(e){return moment(e)}),earlyMobilePromotedTimes:(e.storageService.get(e.constants.growth.earlyMobilePromo.storageKey,!1)||[]).map(function(e){return moment(e)}),canPromoteDesktop:e.downloadAppService.isDownloadSupported(),canPromoteMobile:e.settingsService.valueAsBoolean(e.constants.settings.names.promoteMobile),nonDiscoverableTeamsCount:(o||[]).length,isInCall:function(){return!!e.callingService.getActiveCall()},hasShortCortanaConsent:e.cortanaConfigurationService.getUserConsent(teamspace.services.ConsentType.Short),isSMBVoiceUser:("SmbBusinessVoice"==n||"SmallMediumBusiness"==n)&&p&&g,isProPlusUser:f,hasSeenProPlusPrompt:m,areTagsEnabled:e.peopleTargetingService.tagsEnabled(),inEventAffectedGeo:y,hasMultiWindowEnabled:e.callingMultiWindowService.getCallingMWEnabledUserPreference(),isChatHybridArchitectureEnabled:e.experienceContainerFeatureService.isChatHybridAppExperienceContainerEnabled()}})},t.prototype.getEcsSurfaceConfigurations=function(){var e=this,t=[];if(this.enableESPConfigFetching?(this.engagementSurfacesConfig=this.engagementSurfacesConfig||[],t=this._getEcsSurfaceConfigurations(function(t){return e.engagementSurfacesConfig[t]})):t=this._getEcsSurfaceConfigurations(function(t){return e.settingsService.valueFor(t)}),this.esPortalComms.isUsingEspPortal())return this.esPortalComms.getSurfacesFromPortal().then(function(t){return e.logger.info("retrieved config from ESP Portal, using --\x3e"),e.logger.info(JSON.stringify(t,null,2)),t}).catch(function(n){return e.logger.error("failed retrieving config from ESP portal"+n.message),t});var n=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesSTOverride);if(n){try{n=atob(n)}catch(e){}var a=JSON.parse(n);return this.logger.info("retrieved config from ST Override, using --\x3e"),this.logger.info(JSON.stringify(a,null,2)),this.$q.resolve(a)}return this.$q.resolve(t)},t.prototype.initialEspConfigsloadFromEcs=function(){var e=this,t=this.$q.defer();return this.ecsFoundation.fetchImmediately().then(function(n){n?t.resolve():(e.logger.warn("ESP direct configuration fetching failed"),t.reject())}).catch(function(){e.logger.warn("ESP direct configuration fetching failed"),t.reject()}),t.promise},t.prototype.loadEcsPayloadOnSettingsUpdate=function(e){var t=this.loggingService.newScenario(this.constants.scenarios.onboarding.engagementSurfaces.espConfigSync);if(!e||!e.TeamsESPConfigs){var n="no ESP Configuration found in TeamsESPConfigs namespace";return this.logger.warn(n),t.fail({message:n}),!1}return this.logger.info("Fetched ESP Surface configurations from TeamsESPConfigs namespace"),this.engagementSurfacesConfig=e.TeamsESPConfigs,t.stop(),!0},t.prototype._getEcsSurfaceConfigurations=function(e){var t=this,n=[],a=[this.constants.settings.names.engagementSurfaces,this.constants.settings.names.engagementSurfacesFre];a.forEach(function(a){var r=e(a);r?((r=_.isString(r)?JSON.parse(r):r).forEach(function(e,t){e.isSettled=!0,e.order=t}),n.push.apply(n,r)):t.logger.warn("no value found for engagement surfaces key '"+a+"'")});var r=e(this.constants.settings.names.engagementSurfacesExpManifest)||[];return _.without.apply(_,i([r],a)).forEach(function(a){var r=e(a)||[];r.forEach(function(e,t){e.isSettled=!1,e.order=t}),t.addOrReplaceSurfaces(n,r)}),n},t.prototype.addOrReplaceSurfaces=function(e,t){var n=this;(t||[]).forEach(function(t){var a=_.findIndex(e,function(e){return e.id===t.id});a>-1?(e[a]=t,n.logger.info("overwrote surface "+t.id+" from experiment config")):e.push(t)})},t.prototype.getSurfaceConfigurations=function(e,t,n){var a=this,r=_.keyBy(t,function(e){return e.id}),i=e.map(function(e){return a.convertSurfaceConfig(e,r[e.id])}),s=_.keyBy(n,function(e){return e.id}),c=i.filter(function(e){return!!s[e.id]||e.trigger===o.Trigger.SurfaceShown||e.trigger===o.Trigger.Programmatic});if(!n.length&&this.firstRunService.isFRESession()&&(c=i),i.length!==c.length&&this.esPortalComms.isUsingEspPortal()){var u=i.filter(function(e){return!s[e.id]&&e.trigger!==o.Trigger.SurfaceShown&&e.trigger!==o.Trigger.Programmatic}).map(function(e){return e.id});this.logger.warn("non-deployed surface ids detected. ensure MT is deployed prior to using these ids in production: "+u.join()),c=i}return this.applySurfaceDisplayDebugOverrides(c)},t.prototype.convertSurfaceConfig=function(e,t){var n=r(r({},e),{treatment:e.treatment||"",isControlGroup:e.isControlGroup||!1,isSettled:e.isSettled||!1,trigger:o.Trigger[e.trigger],surface:o.EngagementSurface[e.surface],recur:Math.max(1,e.recur||1),displayed:[],eligibleTimes:[],condition:new c(e.condition),triggerFilter:new c(e.triggerFilter),startTime:void 0,endTime:void 0});return t&&(n.eligibleTimes=_.map(t.controlGroupTimestamps,function(e){return moment(new Date(e))}),n.displayed=e.isControlGroup?n.eligibleTimes:_.map(t.displayedTimestamps,function(e){return moment(new Date(e))})),this.esPortalComms.isUsingEspPortal()&&(n.displayed=[]),e.startTime&&(n.startTime=moment(new Date(e.startTime))),e.endTime&&(n.endTime=moment(new Date(e.endTime))),_.isUndefined(n.trigger)&&this.logger.error("unknown trigger: "+e.trigger),_.isUndefined(n.surface)&&this.logger.error("unknown surface: "+e.surface),_.isNaN(n.recur)&&(this.logger.error("unknown recurrence: "+e.recur),n.recur=1),n},t.prototype.applyUserStateDebugOverrides=function(e){var t=this;if(!this.enableEspDebugOverride)return e;var n=this.storageService.get(this.constants.growth.engagementSurfaces.debugHook.userStateOverrideStorageKey,!0)||{};return _.forOwn(n,function(n,a){var r=moment(n,moment.ISO_8601,!0);r.isValid()?e[a]=r:e[a]="true"===n||"false"===n?t.utilityService.convertStringToBoolean(n):n}),e},t.prototype.applySurfaceDisplayDebugOverrides=function(e){if(!this.enableEspDebugOverride)return e;var t=this.storageService.get(this.constants.growth.engagementSurfaces.debugHook.displayedOverrideStorageKey,!0)||{};return _.forEach(e,function(e){if(t.hasOwnProperty(e.id))if(t[e.id]){var n=moment(t[e.id],moment.ISO_8601,!0);n.isValid()&&(e.displayed=[n])}else e.displayed=[]}),e},t.prototype.withRetry=function(e,t,n,a,r){void 0===t&&(t=null),void 0===n&&(n=["5xx","404"]),void 0===a&&(a=3),void 0===r&&(r=1e3);var i=this.$q.defer(),o=function(s){void 0===s&&(s=0),t&&t.resume(),e().then(i.resolve).catch(function(e){var c=(e||{}).statusCode;if(!n.map(function(e){return new RegExp(e.replace(/x/gi,"\\d"))}).some(function(e){return e.test(c)}))return i.reject(e);s<a?(s++,t&&t.pause({reason:"failed. will retry after delay. status="+c+" count="+s}),setTimeout(function(){return o(s)},Math.pow(s,2)*r)):i.reject(e)})};return o(0),i.promise},t.prototype.shouldFetchEngagementProfile=function(){if(!this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementProfileInESP))return!1;var e=this.settingsService.valueFor(this.constants.settings.names.engagementProfileInESPCacheTTLInDays),n=this.storageService.get(t.ENGAGEMENT_PROFILE_CACHE_KEY);if(n&&""!==n.timestamp){var a=moment.utc(new Date),r=moment.utc(n.timestamp),i=moment.duration(a.diff(r)).asDays()>=e;return i||(this.cachedEngagementProfile=n),i}return!0},t.prototype.syncCache=function(){var e=this;if(this.esCache.needsSync()){this.esCache.startSync();var n=this.$qNoApply.resolve(),a=this.esCache.cache;if(a.actions.length){var r={items:a.actions.map(function(e){return{action:e}})};n=n.finally(function(){return e.performApiPut(t.API_ENDPOINT+"/actions",{callType:t.CALL_TYPE},r).toNgPromise(e.$qNoApply).then(function(){return e.esCache.clearActions()})})}return a.displayed.forEach(function(a){n=n.finally(function(){return e.performApiPut(t.API_ENDPOINT+"/displayed",{callType:t.CALL_TYPE},a).toNgPromise(e.$qNoApply).then(function(){return e.esCache.clearDisplayed(a.id)})})}),n.finally(function(){return e.esCache.endSync()}),n}},t.prototype.applyCache=function(e){if(this.esCache.cache.displayed.forEach(function(t){var n=e.displayed.find(function(e){return e.id===t.id});if(n)t.isControlGroup?n.controlGroupTimestamps.push(t.timestamp):n.displayedTimestamps.push(t.timestamp);else{var a={id:t.id,priority:t.priority,displayedTimestamps:[],controlGroupTimestamps:[]};t.isControlGroup?a.controlGroupTimestamps.push(t.timestamp):a.displayedTimestamps.push(t.timestamp),e.displayed.push(a)}}),e.userState.completedActions=e.userState.completedActions||[],this.esCache.cache.actions.forEach(function(t){e.userState.completedActions.push({action:o.EngagementSurfaceAction[t]})}),this.settingsService.valueAsBoolean(this.constants.settings.names.enableEngagementProfileInESP))if(this.isEmptyEngagementProfile(e.userEngagementProfile))this.cachedEngagementProfile?e.userEngagementProfile=this.cachedEngagementProfile.profile:this.logger.warn("Engagement profile was neither retrieved nor found in the cache");else{var n={timestamp:moment.utc(new Date).toString(),profile:e.userEngagementProfile};this.storageService.set(t.ENGAGEMENT_PROFILE_CACHE_KEY,n)}return this.$qNoApply.resolve(e)},Object.defineProperty(t.prototype,"esCache",{get:function(){var e=this,n=function(){return e.storageService.get(t.ES_CACHE_KEY)||{isSyncing:!1,actions:[],displayed:[]}},a=function(n){return e.storageService.set(t.ES_CACHE_KEY,n)},r=function(){return e.storageService.remove(t.ES_CACHE_KEY)};return{needsSync:function(){var e=n();return(e.actions.length||e.displayed.length)&&!e.isSyncing},startSync:function(){var e=n();e.isSyncing=!0,a(e)},endSync:function(){var e=n();e.isSyncing=!1,!e.actions.length&&!e.displayed.length?r():a(e)},addDisplayed:function(e){var t=n();e.timestamp=(new Date).toISOString(),t.displayed.push(e),a(t)},addActions:function(e){var t=n(),r=e.items.map(function(e){return e.action});t.actions=_.uniq(t.actions.concat(r)),a(t)},clearActions:function(){var e=n();e.actions=[],a(e)},clearDisplayed:function(e){var t=n();t.displayed=t.displayed.filter(function(t){return t.id!==e}),a(t)},get cache(){return n()}}},enumerable:!0,configurable:!0}),t.CALL_TYPE="engagement_surfaces",t.API_ENDPOINT="/me/engagementSurfaces",t.RELEVANTCONTACTS_ENDPOINT="/users/relevantcontacts",t.ES_CACHE_KEY="esp-local-cache",t.FETCH_ENGAGEMENT_PROFILE_QSP="fetchEngagementProfile=true",t.ENGAGEMENT_PROFILE_CACHE_KEY="esp-engagement-profile-cache",t.NAKED_DTO={displayed:[],engagementSurfaces:[],lastDisplayedByPriority:[],priorityThrottlesInMinutes:[30,60,720,1440,10080],userState:{completedActions:[]}},t}(SkypeX.Services.GenericRestClient);t.EsRepository=u,angular.module("teamspace.esRepository",["teamspace.loggingService","skypeX.myUserPreferencesStore","teamspace.eventingService","teamspace.channelService","teamspace.tenantService","teamspace.userAppsStore","teamspace.authenticationService","skypeX.userResourcesSettingsStore","teamspace.utilityService","teamspace.identityService","teamspace.sfbTeamsUpgradeService","teamspace.esSurfaceStack","teamspace.esLogger","teamspace.esPortalComms","teamspace.storageService","teamspace.downloadAppService","teamspace.callingService","teamspace.callingSupportService","teamspace.cortanaConfigurationService","teamspace.firstRunService","teamspace.desktopUtilityService","teamspace.esLocationAffiliationService","teamspace.callingMultiWindowService","teamspace.ecsFoundation","teamspace.experienceContainerFeatureService","teamspace.localizationService"]).service("esRepository",u)},2317:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){void 0===e&&(e=[]),void 0===t&&(t=""),this.actionProfile=e,this.churnScore=t}return e.prototype.hasPerformedAction=function(e,t,n){var a=_.find(this.actionProfile,{action:e});if(_.isEmpty(a))return!1;var r=moment.utc(new Date).startOf("day").diff(a.updatedAt.startOf("day"),"days")-1;if(r>=t)return!1;var i=t-r;i=Math.min(a.actionCounts.length,i);for(var o=0,s=0;i;)o+=a.actionCounts[s],i--,s++;return o>=n},e}();t.EsEngagementProfile=a},2318:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t){this.id=e,this.parent=t}return e.prototype.isCyclic=function(e){return!(!e||this.id!==e)||!!this.parent&&this.parent.isCyclic(e||this.id)},e.prototype.toString=function(){return this.parent?this.parent.toString()+" -> "+this.id:this.id},e}(),i=function(){function e(e,t,n,a,r,i,o,s,c,u,l){this.esParseService=e,this.esSurfaceStack=t,this.constants=a,this.platformDetectService=r,this.desktopUtilityService=i,this.desktopHandlingService=o,this.aggregatedSettingsStore=s,this.settingsService=c,this.myUserPreferencesStore=u,this.$state=l,this.logger=n.newLogger("EsParser")}return e.$inject=["esParseService","esSurfaceStack","esLogger","constants","platformDetectService","desktopUtilityService","desktopHandlingService","aggregatedSettingsStore","settingsService","myUserPreferencesStore","$state"],e.prototype.parse=function(e,t){var n=this,i=/{\s*\$(\S+)\s*}/g,o=e.toString(),s=function(e,a){return e.replace(i,function(e,i){var o=_.find(t,function(e){return e.id===i}),c=new r(i,a);return o?c.isCyclic()?(n.logger.error("Cycle found in condition references: "+c.toString()+"!"),"(false)"):s("("+o.condition.toString()+")",c):(n.logger.error("Unknown condition reference to surface id = "+i+"!"),"(false)")})};o=s(o);var c=this.esParseService.parse(o);return{invoke:function(e){var t=$("head"),r={moment:moment,user:_.clone(e),surfaces:n.esSurfaceStack.getSurfaceState(),now:moment(),os:{name:n.platformDetectService.getOS(),version:n.platformDetectService.getOSVersion(),supportsDesktopApp:n.platformDetectService.osSupportsDesktopApp()},client:{isDesktopAppInstalled:n.desktopHandlingService.getIsAppInstalled(),type:n.getClientType(),window:{width:window.innerWidth,height:window.innerHeight},theme:n.settingsService.getActiveTheme(),version:moment(t.data(n.constants.dataNames.versionDate)),build:moment(t.data(n.constants.dataNames.buildDate))},ecs:{moment:function(e){return moment(n.settingsService.valueFor(e))},boolean:function(e){return n.settingsService.valueAsBoolean(e)},value:function(e){return n.settingsService.valueFor(e)}},route:{stateName:_.cloneDeep(n.$state.current&&n.$state.current.name),params:_.cloneDeep(n.$state.params)},userAgent:navigator.userAgent,browser:{name:n.platformDetectService.getBrowser(),version:n.platformDetectService.getBrowserVersion()}};t=null,r.user.firstWebLogin=e.firstWebLogin.clone(),r.user.settings=n.aggregatedSettingsStore.getSettings(),r.user.firstLoginInfo={};var i=_.clone(n.myUserPreferencesStore.getUserPreferences().firstLoginInformation||{});return Object.keys(i).forEach(function(e){var t=i[e];t&&moment(t).isValid()&&(r.user.firstLoginInfo[e]=moment(t))}),(e.completedActions||[]).forEach(function(e){var t=a.EngagementSurfaceAction[e],n=t.replace(/^\s*(.)/,function(e,t){return t.toLowerCase()});r.user[t]=r.user[n]=!0}),!!c.evaluate(r)}}},e.prototype.evaluateExpressions=function(e,t){var n=this,a={};return Object.keys(e).forEach(function(r){var i=e[r];if(_.isNumber(i)&&(i=i.toString()),_.isString(i)){try{i=n.esParseService.parse(i)}catch(e){var o="failed to parse ["+i+"] in resx parameters. "+e.message;n.logger.error(o),i={evaluate:function(){}}}e[r]=i}a[r]=i.evaluate(t)}),a},e.prototype.evaluateExpression=function(e,t){var n;try{n=this.esParseService.parse(e).evaluate(t)}catch(t){var a="failed to parse ["+e+"] in parameter expression. "+t.message;this.logger.error(a)}return n},e.prototype.parseFnCall=function(e){void 0===e&&(e="");var t=[e.indexOf("("),e.lastIndexOf(")")],n=t[0],a=t[1],r=e.substr(0,n).trim();if(n<0&&a<0)return{fnName:e.trim(),params:[]};if(n>0&&n+1==a)return{fnName:r,params:[]};if(n<=0||a<=0||n>a)return this.logger.error("Invalid parameter expression in "+e),{fnName:void 0,params:[]};var i=e.substring(n+1,a).trim();return 0==i.length?{fnName:r,params:[]}:{fnName:r,params:this.splitTerms(i).map(function(e){return e.trim()||"undefined"})}},e.prototype.getClientType=function(){return this.desktopUtilityService.isSurfaceHubUwp()?"surfaceHub":teamspace.services.ClientType[this.desktopUtilityService.getClientType()]},e.prototype.splitTerms=function(e){var t={"(":")","[":"]","{":"}",'"':'"',"'":"'"},n=[],a=[],r=null,i=[];return(e||"").split("").forEach(function(e){void 0!=t[e]&&(r=t[e],a.push(r)),e===r&&(a.pop(),r=a.length>0?a[a.length-1]:null),null===r&&","===e?(n.push(i.join("")),i=[]):i.push(e)}),(i.length>0||","===e[e.length-1])&&n.push(i.join("")),n},e}();t.EsParser=i,angular.module("teamspace.esParser",["teamspace.constants","teamspace.loggingService","teamspace.esSurfaceStack","teamspace.esLogger","teamspace.platformDetectService","teamspace.desktopUtilityService","teamspace.desktopHandlingService","skypeX.aggregatedSettingsStore","teamspace.settingsService","teamspace.esParseService"]).service("esParser",i)},2319:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2320),r=function(){function e(e){this.$parse=e}return e.prototype.parse=function(e){var t=this.$parse(e);return{evaluate:function(e){return t(e)}}},e}();t.EsAngularParseService=r;var i=function(){function e(e){this.binaryOps={"||":function(e,t){return e||t},"&&":function(e,t){return e&&t},"|":function(e,t){return e|t},"^":function(e,t){return e^t},"&":function(e,t){return e&t},"==":function(e,t){return e==t},"!=":function(e,t){return e!=t},"===":function(e,t){return e===t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},"<<":function(e,t){return e<<t},">>":function(e,t){return e>>t},">>>":function(e,t){return e>>>t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t}},this.unaryOps={"-":function(e){return-e},"+":function(e){return e},"~":function(e){return~e},"!":function(e){return!e}},this.logger=e.newLogger("EsParseService")}return e.prototype.parse=function(e){var t=this,n=a(e);return{evaluate:function(e){return t.evaluateExpression(n,e)}}},e.prototype.isArrayExpression=function(e){return"ArrayExpression"===e.type},e.prototype.isBinaryExpression=function(e){return"BinaryExpression"===e.type},e.prototype.isCallExpression=function(e){return"CallExpression"===e.type},e.prototype.isCompound=function(e){return"Compound"===e.type},e.prototype.isConditionalExpression=function(e){return"ConditionalExpression"===e.type},e.prototype.isIdentifier=function(e){return"Identifier"===e.type},e.prototype.isLiteral=function(e){return"Literal"===e.type},e.prototype.isLogicalExpression=function(e){return"LogicalExpression"===e.type},e.prototype.isMemberExpression=function(e){return"MemberExpression"===e.type},e.prototype.isThisExpression=function(e){return"ThisExpression"===e.type},e.prototype.isUnaryExpression=function(e){return"UnaryExpression"===e.type},e.prototype.evaluateMemberExpression=function(e,t){var n=this.evaluateExpression(e.object,t)||{},a=void 0;if(this.isIdentifier(e.property))a=n[e.property.name];else{var r=this.evaluateExpression(e.property,t);"string"==typeof r||"number"==typeof r?a=n[r]:this.logger.warn("invalid object property index type. Expected string or number, but found type "+typeof r)}return{callingContext:n,value:a}},e.prototype.evaluateExpression=function(e,t){var n=this;if(this.isCompound(e)){if(0===e.body.length)return;return this.logger.warn("Compound expression detected - only evaluating last"),this.evaluateExpression(e.body[e.body.length-1],t)}if(this.isArrayExpression(e))return e.elements.map(function(e){return n.evaluateExpression(e,t)});if(this.isBinaryExpression(e)||this.isLogicalExpression(e))return this.binaryOps[e.operator](this.evaluateExpression(e.left,t),this.evaluateExpression(e.right,t));if(this.isCallExpression(e)){var a=void 0,r=void 0;if(this.isMemberExpression(e.callee)){var i=this.evaluateMemberExpression(e.callee,t);a=i.callingContext,r=i.value}else r=this.evaluateExpression(e.callee,t);if(!_.isFunction(r))return;return r.apply(a,e.arguments.map(function(e){return n.evaluateExpression(e,t)}))}return this.isConditionalExpression(e)?this.evaluateExpression(e.test,t)?this.evaluateExpression(e.consequent,t):this.evaluateExpression(e.alternate,t):this.isIdentifier(e)?t[e.name]:this.isLiteral(e)?e.value:this.isMemberExpression(e)?this.evaluateMemberExpression(e,t).value:this.isThisExpression(e)?t:this.isUnaryExpression(e)?this.unaryOps[e.operator](this.evaluateExpression(e.argument,t)):void 0},e}();t.EsParseService=i,angular.module("teamspace.esParseService",["teamspace.constants","teamspace.settingsService","teamspace.esLogger"]).factory("esParseService",["$parse","esLogger","constants","settingsService",function(e,t,n,a){return a.valueAsBoolean(n.settings.names.enableAngularEspParser)?new r(e):new i(t)}])},2320:function(e,t,n){!function(n){"use strict";var a=function(e,t){var n=new Error(e+" at character "+t);throw n.index=t,n.description=e,n},r={"-":!0,"!":!0,"~":!0,"+":!0},i={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},o=function(e){var t,n=0;for(var a in e)(t=a.length)>n&&e.hasOwnProperty(a)&&(n=t);return n},s=o(r),c=o(i),u={true:!0,false:!1,null:null},l=function(e){return i[e]||0},p=function(e,t,n){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:n}},g=function(e){return e>=48&&e<=57},d=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=128&&!i[String.fromCharCode(e)]},h=function(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||e>=128&&!i[String.fromCharCode(e)]},f=function(e){for(var t,n,o=0,f=e.charAt,m=e.charCodeAt,v=function(t){return f.call(e,t)},y=function(t){return m.call(e,t)},S=e.length,A=function(){for(var e=y(o);32===e||9===e||10===e||13===e;)e=y(++o)},C=function(){var e,t,n=b();return A(),63!==y(o)?n:(o++,(e=C())||a("Expected expression",o),A(),58===y(o)?(o++,(t=C())||a("Expected expression",o),{type:"ConditionalExpression",test:n,consequent:e,alternate:t}):void a("Expected :",o))},T=function(){A();for(var t=e.substr(o,c),n=t.length;n>0;){if(i.hasOwnProperty(t)&&(!d(y(o))||o+t.length<e.length&&!h(y(o+t.length))))return o+=n,t;t=t.substr(0,--n)}return!1},b=function(){var e,t,n,r,i,s,c,u,g;if(s=w(),!(t=T()))return s;for(i={value:t,prec:l(t)},(c=w())||a("Expected expression after "+t,o),r=[s,i,c];(t=T())&&0!==(n=l(t));){for(i={value:t,prec:n},g=t;r.length>2&&n<=r[r.length-2].prec;)c=r.pop(),t=r.pop().value,s=r.pop(),e=p(t,s,c),r.push(e);(e=w())||a("Expected expression after "+g,o),r.push(i,e)}for(e=r[u=r.length-1];u>1;)e=p(r[u-1].value,r[u-2],e),u-=2;return e},w=function(){var t,n,a;if(A(),t=y(o),g(t)||46===t)return P();if(39===t||34===t)return E();if(91===t)return q();for(a=(n=e.substr(o,s)).length;a>0;){if(r.hasOwnProperty(n)&&(!d(y(o))||o+n.length<e.length&&!h(y(o+n.length))))return o+=a,{type:"UnaryExpression",operator:n,argument:w(),prefix:!0};n=n.substr(0,--a)}return!(!d(t)&&40!==t)&&$()},P=function(){for(var e,t,n="";g(y(o));)n+=v(o++);if(46===y(o))for(n+=v(o++);g(y(o));)n+=v(o++);if("e"===(e=v(o))||"E"===e){for(n+=v(o++),"+"!==(e=v(o))&&"-"!==e||(n+=v(o++));g(y(o));)n+=v(o++);g(y(o-1))||a("Expected exponent ("+n+v(o)+")",o)}return t=y(o),d(t)?a("Variable names cannot start with a number ("+n+v(o)+")",o):46===t&&a("Unexpected period",o),{type:"Literal",value:parseFloat(n),raw:n}},E=function(){for(var e,t="",n=v(o++),r=!1;o<S;){if((e=v(o++))===n){r=!0;break}if("\\"===e)switch(e=v(o++)){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return r||a('Unclosed quote after "'+t+'"',o),{type:"Literal",value:t,raw:n+t+n}},k=function(){var t,n=y(o),r=o;for(d(n)?o++:a("Unexpected "+v(o),o);o<S&&(n=y(o),h(n));)o++;return t=e.slice(r,o),u.hasOwnProperty(t)?{type:"Literal",value:u[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},O=function(e){for(var t,n,r=[],i=!1,s=0;o<S;){if(A(),(t=y(o))===e){i=!0,o++,41===e&&s&&s>=r.length&&a("Unexpected token "+String.fromCharCode(e),o);break}if(44===t){if(o++,++s!==r.length)if(41===e)a("Unexpected token ,",o);else if(93===e)for(var c=r.length;c<s;c++)r.push(null)}else(n=C())&&"Compound"!==n.type||a("Expected comma",o),r.push(n)}return i||a("Expected "+String.fromCharCode(e),o),r},$=function(){var e,t;for(t=40===(e=y(o))?_():k(),A(),e=y(o);46===e||91===e||40===e;)o++,46===e?(A(),t={type:"MemberExpression",computed:!1,object:t,property:k()}):91===e?(t={type:"MemberExpression",computed:!0,object:t,property:C()},A(),93!==(e=y(o))&&a("Unclosed [",o),o++):40===e&&(t={type:"CallExpression",arguments:O(41),callee:t}),A(),e=y(o);return t},_=function(){o++;var e=C();if(A(),41===y(o))return o++,e;a("Unclosed (",o)},q=function(){return o++,{type:"ArrayExpression",elements:O(93)}},H=[];o<S;)59===(t=y(o))||44===t?o++:(n=C())?H.push(n):o<S&&a('Unexpected "'+v(o)+'"',o);return 1===H.length?H[0]:{type:"Compound",body:H}};f.version="0.3.5",f.toString=function(){return"JavaScript Expression Parser (JSEP) v"+f.version},f.addUnaryOp=function(e){return s=Math.max(e.length,s),r[e]=!0,this},f.addBinaryOp=function(e,t){return c=Math.max(e.length,c),i[e]=t,this},f.addLiteral=function(e,t){return u[e]=t,this},f.removeUnaryOp=function(e){return delete r[e],e.length===s&&(s=o(r)),this},f.removeAllUnaryOps=function(){return r={},s=0,this},f.removeBinaryOp=function(e){return delete i[e],e.length===c&&(c=o(i)),this},f.removeAllBinaryOps=function(){return i={},c=0,this},f.removeLiteral=function(e){return delete u[e],this},f.removeAllLiterals=function(){return u={},this};void 0!==e&&e.exports?t=e.exports=f:t.parse=f}()},2321:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.$q=e,this.helpBotService=t,this.proactiveMessageService=n}return e.$inject=["$q","helpBotService","proactiveMessageService"],e.prototype.invokeMessage=function(e,t,n){var a=this,r=e.params,i=r.messageId,o=r.action;return this.helpBotService.initialize().then(function(){return a.proactiveMessageService.postProactiveMessage(r)}).then(function(){return t.stop()}).catch(function(e){var n=e.errorCode,r=e.statusCode,s="Failed to post proactive message with messageId:"+i+" action: "+o;return t.fail({errorMessage:s,errorCode:n,statusCode:r}),a.$q.reject({errorMessage:s})})},e}();t.EsHelpBotService=a,angular.module("teamspace.esHelpBotService",["teamspace.loggingService","teamspace.constants","teamspace.helpBotService","teamspace.proactiveMessageService"]).service("esHelpBotService",a)},2322:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=n(8),i=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,f){this.$window=e,this.$rootScope=t,this.$q=n,this.utilityService=a,this.constants=r,this.coachmarksService=i,this.esActionHandler=o,this.esSurfaceStack=s,this.esTranslate=c,this.esParser=u,this.$sce=p,this.resources=g,this.analyticsService=d,this.eventingService=h,this.ariaLiveService=f,this.logger=l.newLogger("EsMenuService")}return e.$inject=["$window","$rootScope","$q","utilityService","constants","coachmarksService","esActionHandler","esSurfaceStack","esTranslate","esParser","esLogger","$sce","resources","analyticsService","eventingService","ariaLiveService"],e.prototype.isMenuInProgress=function(e,t,n){if(e.surface!==r.EngagementSurface.Menu)return!1;if(!e.displayed.length)return!1;var a=e.params,i=e.id,o=e.treatment,s=this.getTasks(i,o,a,n,t);if(!s||0===s.length)return!1;var c=s.filter(function(e){return e.isComplete}).length;return c>0&&c<s.length},e.prototype.isMenuComplete=function(e,t,n){if(e.surface!==r.EngagementSurface.Menu)return!1;var a=e.params,i=e.id,o=e.treatment,s=this.getTasks(i,o,a,n,t);return!_.some(s,function(e){return!e.isComplete})},e.prototype.displayMenu=function(e,t,n,r){var i=this,o=e.params,s=e.id,c=e.treatment,u=this.getElementAndPlacement(o),l=u.element,p=u.placement,g=this.getImage(o,n),d=this.getTasks(s,c,o,r,n);if(!d)return this.$q.reject();var h=d.filter(function(e){return e.isComplete}).map(function(e){return e.associatedAction}).join(),f=this.esTranslate.instant(o.resxKey,a(a({},o.resxParams||{}),{numTasks:d.length,numCompletedTasks:d.filter(function(e){return e.isComplete}).length}),n),m=function(){i.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc)},v=function(e){var t=e.which||e.keyCode;if(t===i.constants.keyCodes.escape&&(m(),e.stopPropagation()),e.ctrlKey&&t===i.constants.keyCodes.m){var n=i.utilityService.stripHtml(f);i.ariaLiveService.update(n,!0),_.defer(function(){return $(".task-items button.menu-item:first").focus()}),e.stopPropagation()}},y=[];return this.coachmarksService.showAdHocCoachmark({element:l,placement:p,className:o.className,viewport:o.viewport,containedIn:o.containedIn,isSticky:o.isSticky,showStickyClose:o.showStickyClose,autoCloseInSeconds:o.autoCloseInSeconds,hideArrow:o.hideArrow,appendTo:o.appendTo,content:this.$sce.trustAsHtml(f),panelType:teamspace.PanelType.engagementSurfaceMenu,img:g,taskInfo:{tasks:d},trackData:{id:s,treatment:c,state:h},onClose:function(){return i.esSurfaceStack.setCurrentAction(i.constants.growth.engagementSurfaces.actionKey.xClose)},onTimeout:function(){return i.onTimeout(s,c)}},t).then(function(e){if(!e)return i.$q.reject()},function(e){return i.$q.reject(e)},function(){i.$window.addEventListener("keydown",v,!0),y=[i.eventingService.$on(i.$rootScope,i.constants.events.engagementSurfaces.killActive,function(){return m()}),function(){return i.$window.removeEventListener("keydown",v,!0)}],i.ariaLiveService.update(i.esTranslate.instant(i.resources.strings.esp_menu_surface_aria_announcement),!1)}).finally(function(){return y.forEach(function(e){return e()})})},e.prototype.getElementAndPlacement=function(e){var t=e.element,n=e.placement,a=0;return _.isArray(t)&&(t=_.find(t,function(e){return $(e).is(":visible")})||_.first(t),a=_.indexOf(e.element,t)),_.isArray(n)&&(n=n[a]),{element:t,placement:n}},e.prototype.getImage=function(e,t){var n=e.img||{src:void 0};return{src:n.src,altResxKey:n.altResxKey,headerContent:n.headerResxKey&&this.$sce.trustAsHtml(this.esTranslate.instant(n.headerResxKey,n.headerResxParams,t))}},e.prototype.getTasks=function(e,t,n,a,r){var i=this;n.tasks=n.tasks||[];var o=Math.max(n.minTasks||1,1),s=Math.max(n.maxTasks||n.tasks.length,o),c=n.tasks.filter(function(e){var t=_.trim(e.condition)||""+!0;return i.esParser.parse(t,a.engagementSurfaces).invoke(a.userState)}).slice(0,s);if(!(c.length<o))return this.convertTasks(e,t,c,a.userState,r);this.logger.warn("not showing "+e+" due to insufficient number of applicable tasks, tasks="+c.length+" min="+o+" max="+s)},e.prototype.convertTasks=function(e,t,n,i,o){var s=this,c=this.constants.growth.engagementSurfaces.actionKey.displaySurface.name,u={id:e,treatment:t,close:function(){}};return n.map(function(t,n){return{isComplete:i.completedActions.some(function(e){return r.EngagementSurfaceAction[t.associatedAction]===e}),associatedAction:t.associatedAction,content:s.$sce.trustAsHtml(s.esTranslate.instant(t.resxKey,t.resxParams,o)),trackData:{currIndex:n,actionKey:s.esActionHandler.parseActionKey(t.actionKey).key},onClick:function(){s.esSurfaceStack.setCurrentAction(t.actionKey);var n=s.eventingService.$on(s.$rootScope,s.constants.events.engagementSurfaces.onAction,function(e,n){n.some(function(e){return r.EngagementSurfaceAction[t.associatedAction]===e})&&s.eventingService.$emit(s.constants.events.engagementSurfaces.killActive)});s.esActionHandler.handleAction(t.actionKey,u,o).finally(function(){return n()}).finally(function(){return s.esActionHandler.handleAction(c+"('"+e+"')",a(a({},u),{id:""}),o)})}}})},e.prototype.onTimeout=function(e,t){var n=this,a={panelType:teamspace.PanelType.engagementSurfaceMenu,dataBag:{id:e,treatment:t,actionKey:this.constants.growth.engagementSurfaces.actionKey.timeout}};_.defer(function(){return n.analyticsService.sendPseudoPanelView(a)}),this.esSurfaceStack.setCurrentAction(this.constants.growth.engagementSurfaces.actionKey.timeout)},e}();t.EsMenuService=i,angular.module("teamspace.esMenuService",["teamspace.esTranslate","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.coachmarksService","teamspace.analyticsService","teamspace.esLogger","teamspace.esParser","teamspace.eventingService","teamspace.ariaLiveService","teamspace.utilityService","teamspace.locales"]).service("esMenuService",i)},2323:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$translate=e,this.esParser=t,this.settingsService=n,this.constants=a,this.locale=r.getLocale().replace("-","_")}return e.$inject=["$translate","esParser","settingsService","constants","localizationService"],e.prototype.instant=function(e,t,n){var a=this.settingsService.valueFor(this.constants.settings.names.engagementSurfacesResx)||{};if(!t)return a[this.locale]&&a[this.locale][e]?a[this.locale][e]:this.$translate.instant(e);var r=this.esParser.evaluateExpressions(t,n);if(a[this.locale]&&a[this.locale][e]){var i=a[this.locale][e];return t&&Object.keys(t).forEach(function(e){var t=new RegExp("{{"+e+"}}","g");i=i.replace(t,r[e])}),i}var o=r.html;r.html="{{html}}";var s=this.$translate.instant(e,r);return o&&(s=s.replace(/{{html}}/g,o)),s},e}();t.EsTranslate=a,angular.module("teamspace.esTranslate",["pascalprecht.translate","teamspace.esParser","teamspace.settingsService","teamspace.constants","teamspace.localizationService"]).service("esTranslate",a)},2324:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(){}return e.Action={Gesture:"Action.Gesture",Outcome:"Action.Outcome",Scenario:"Action.Scenario",ScenarioType:"Action.ScenarioType"},e.App={Name:"App.Name"},e.DataBag={id:"DataBag.id",currIndex:"DataBag.currIndex",messageType:"DataBag.messageType",atmentions:"DataBag.atmentions",attachments:"DataBag.attachments",slashCommand:"DataBag.slashCommand",value:"DataBag.value"},e.Tab={Ordinal:"Tab.Ordinal"},e.Module={Name:"Module.Name",State:"Module.State"},e.Panel={Type:"Panel.Type",LaunchMethod:"Panel.LaunchMethod"},e.Thread={Type:"Thread.Type"},e}(),i=function(){function e(){}return e.PanelView="panelView",e.PanelAction="panelAction",e}(),o=function(){function e(){}return e.Scenario={composeSendMessage:"composeSendMessage",addChannel:"addChannel",addMember:"addMember",chatStartAudioCall:"chatStartAudioCall",chatStartAudioCallSFB:"chatStartAudioCallSFB",chatStartVideoCall:"chatStartVideoCall",chatStartVideoCallSFB:"chatStartVideoCallSFB",chatListFavoriteConversation:"chatListFavoriteConversation",composeExpandComposer:"composeExpandComposer",sendInvites:"sendInvites",executeSlashCommand:"executeSlashCommand",teamCreate:"teamCreate",remindMeLater:"remindMeLater",teamDiscoverJoin:"teamDiscoverJoin",activityFeedClick:"activityFeedClick",cortanaInvoke:"cortanaInvoke",channelNavTab:"channelNavTab",composeSelectExtension:"composeSelectExtension",channelComposeFocus:"channelComposeFocus",channelNewPost:"channelNewPost",messageReply:"messageReply",changeTheme:"changeTheme",hasUsedLeftRailFilter:"hasUsedLeftRailFilter",manageTenantSettings:"manageTenantSettings",chnlSetSaved:"chnlSetSaved",newGroupChatToggle:"newGroupChatToggle",channelAddTab:"channelAddTab",navInContextAppStoreDialog:"navInContextAppStoreDialog",callingMWEnabledUserPreference:"callingMWEnabledUserPreference"},e.ScenarioType={admin:"admin",inviteMembers:"inviteMembers",cortana:"cortana",manageLink:"manageLink",tabs:"tabs",select:"select"},e.Gesture={click:"click"},e.Module={Name:{addMember:"addMember",sendInvites:"sendInvites",reviewTeamDiscoverySettings:"reviewTeamDiscoverySettings",leftRailFilter:"leftRailFilter",toggleJoinTenantByUrl:"toggleJoinTenantByUrl",newChatGroupNameToggle:"newChatGroupNameToggle",inContextAppStoreDialog:"inContextAppStoreDialog",callingMeetingMWUserSetting:"callingMeetingMWUserSetting"},State:{multiWindow:"MultiWindow"}},e.Outcome={submit:"submit",select:"select",closeDialog:"closeDialog",openDialog:"openDialog",checked:"checked",unchecked:"unchecked"},e.DataBag={newConversation:"newConversation",replyConversation:"replyConversation",newP2PMessage:"newP2PMessage",atMentionCommand:"atMention"},e.Panel={Type:{channel:"channel",activity:"activity",appsFlyoutPopover:"appsFlyoutPopover",messagingExtensionFlyout:"messagingExtensionFlyout"},LaunchMethod:{nav:"nav"}},e.Thread={Type:{Channel:"Channel",OneOnOneChat:"OneOnOneChat",GroupChat:"GroupChat"}},e}(),s=function(){function e(e,t,n,a,r){this.$rootScope=e,this.constants=t,this.eventingService=n,this.esRepository=a,this.matchers=this.getDataMatchRegistrants(),r.registerForMtma(this),this.initializeOnAppLaunchAndReinit()}return e.$inject=["$rootScope","constants","eventingService","esRepository","orchestrationService"],e.prototype.isPanelAction=function(e){return(e.eventType||"").toLowerCase()===i.PanelAction.toLowerCase()},e.prototype.isPanelView=function(e){return(e.eventType||"").toLowerCase()===i.PanelView.toLowerCase()},e.prototype.propEqual=function(e,t,n){return e.properties[t]&&e.properties[t].value==n},e.prototype.propGreaterThan=function(e,t,n){return e.properties[t]&&e.properties[t].value>n},e.prototype.getDataMatchRegistrants=function(){var e=this;return[{action:a.EngagementSurfaceAction.ComposeChannelMessage,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeSendMessage)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.newConversation)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.Channel)}},{action:a.EngagementSurfaceAction.ComposeChannelReply,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeSendMessage)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.replyConversation)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.Channel)}},{action:a.EngagementSurfaceAction.AddMention,match:function(t){return e.propGreaterThan(t,r.DataBag.atmentions,0)}},{action:a.EngagementSurfaceAction.ComposeOneOnOneChatMessage,match:function(t){return e.propEqual(t,r.DataBag.messageType,o.DataBag.newP2PMessage)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.OneOnOneChat)}},{action:a.EngagementSurfaceAction.ShareFile,match:function(t){return e.propGreaterThan(t,r.DataBag.attachments,0)&&e.propEqual(t,r.Panel.Type,o.Panel.Type.channel)}},{action:a.EngagementSurfaceAction.AddChannel,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.addChannel)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)}},{action:a.EngagementSurfaceAction.AddMember,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.Action.Scenario,o.Scenario.addMember)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.admin)&&e.propEqual(t,r.Module.Name,o.Module.Name.addMember)}},{action:a.EngagementSurfaceAction.ComposeOneOnManyChatMessage,match:function(t){return e.propEqual(t,r.DataBag.messageType,o.DataBag.newP2PMessage)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.GroupChat)}},{action:a.EngagementSurfaceAction.StartAudioCall,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartAudioCall)||e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartAudioCallSFB)}},{action:a.EngagementSurfaceAction.StartVideoCall,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartVideoCall)||e.propEqual(t,r.Action.Scenario,o.Scenario.chatStartVideoCallSFB)}},{action:a.EngagementSurfaceAction.FavoriteConversation,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.chatListFavoriteConversation)}},{action:a.EngagementSurfaceAction.ExpandComposer,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeExpandComposer)}},{action:a.EngagementSurfaceAction.InviteTenantMember,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.select)&&e.propEqual(t,r.Action.Scenario,o.Scenario.sendInvites)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.inviteMembers)&&e.propEqual(t,r.Module.Name,o.Module.Name.sendInvites)}},{action:a.EngagementSurfaceAction.SendMessageWithAtCommand,match:function(t){return e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.Action.Scenario,o.Scenario.executeSlashCommand)&&e.propEqual(t,r.DataBag.slashCommand,o.DataBag.atMentionCommand)}},{action:a.EngagementSurfaceAction.CreateTeam,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.teamCreate)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)}},{action:a.EngagementSurfaceAction.SetDiscoverySettingModalReminder,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.remindMeLater)&&e.propEqual(t,r.Action.Outcome,o.Outcome.closeDialog)&&e.propEqual(t,r.Module.Name,o.Module.Name.reviewTeamDiscoverySettings)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask1,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->viewActivityQuickGuide->complete")||e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.activityFeedClick)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask2,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->newChatInteractiveGuide->complete")||e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.newP2PMessage)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask3,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->sendChannelMessageInteractiveGuide->complete")||e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.DataBag.messageType,o.DataBag.newConversation)&&e.propEqual(t,r.Thread.Type,o.Thread.Type.Channel)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask4,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsMenu->joinATeamInteractiveGuide->complete")||e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.teamDiscoverJoin)}},{action:a.EngagementSurfaceAction.CortanaInvoke,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.cortanaInvoke)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.cortana)}},{action:a.EngagementSurfaceAction.ChannelNavTab,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.channelNavTab)&&e.propGreaterThan(t,r.Tab.Ordinal,3)}},{action:a.EngagementSurfaceAction.ComposeSelectExtension,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.composeSelectExtension)}},{action:a.EngagementSurfaceAction.ChannelComposeFocus,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.channelComposeFocus)||e.propEqual(t,r.Action.Scenario,o.Scenario.channelNewPost)||e.propEqual(t,r.Action.Scenario,o.Scenario.messageReply)}},{action:a.EngagementSurfaceAction.ChangeTheme,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.changeTheme)}},{action:a.EngagementSurfaceAction.HasUsedLeftRailFilter,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.hasUsedLeftRailFilter)&&e.propEqual(t,r.Module.Name,o.Module.Name.leftRailFilter)}},{action:a.EngagementSurfaceAction.ManageLinkSettings,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Scenario,o.Scenario.manageTenantSettings)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.manageLink)&&e.propEqual(t,r.Module.Name,o.Module.Name.toggleJoinTenantByUrl)}},{action:a.EngagementSurfaceAction.FollowChannel,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.submit)&&e.propEqual(t,r.Action.Scenario,o.Scenario.chnlSetSaved)&&(e.propEqual(t,r.DataBag.value,"BannerAndFeed|false|BannerAndFeed")||e.propEqual(t,r.DataBag.value,"BannerAndFeed|true|BannerAndFeed"))}},{action:a.EngagementSurfaceAction.RenameNewGroupChat,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.select)&&e.propEqual(t,r.Action.Scenario,o.Scenario.newGroupChatToggle)&&e.propEqual(t,r.Module.Name,o.Module.Name.newChatGroupNameToggle)}},{action:a.EngagementSurfaceAction.AddTab,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.Action.Outcome,o.Outcome.openDialog)&&e.propEqual(t,r.Action.Scenario,o.Scenario.channelAddTab)}},{action:a.EngagementSurfaceAction.OpenPersonalFlyout,match:function(t){return e.propEqual(t,r.Panel.Type,o.Panel.Type.appsFlyoutPopover)&&e.propEqual(t,r.Panel.LaunchMethod,o.Panel.LaunchMethod.nav)}},{action:a.EngagementSurfaceAction.AddChatTab,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.navInContextAppStoreDialog)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.tabs)&&(e.propEqual(t,r.Thread.Type,o.Thread.Type.OneOnOneChat)||e.propEqual(t,r.Thread.Type,o.Thread.Type.GroupChat))}},{action:a.EngagementSurfaceAction.OpenMessagingExtensionFlyout,match:function(t){return e.propEqual(t,r.Panel.LaunchMethod,o.Panel.LaunchMethod.nav)&&e.propEqual(t,r.Panel.Type,o.Panel.Type.messagingExtensionFlyout)}},{action:a.EngagementSurfaceAction.EnableMultiWindow,match:function(t){return e.propEqual(t,r.Action.Scenario,o.Scenario.callingMWEnabledUserPreference)&&e.propEqual(t,r.Action.ScenarioType,o.ScenarioType.select)&&e.propEqual(t,r.Module.State,o.Module.State.multiWindow)&&e.propEqual(t,r.Action.Outcome,o.Outcome.checked)||e.propEqual(t,r.Action.Outcome,o.Outcome.unchecked)}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask6,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsV2->viewActivityQuickGuide->complete")}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask7,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsV2->newChatInteractiveGuide->complete")||e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsV2->newChatHybridArchitectureInteractiveGuide->complete")}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask8,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsV2->sendChannelMessageInteractiveGuide->complete")}},{action:a.EngagementSurfaceAction.LearnTheBasicsTask9,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"learnTheBasicsV2->joinATeamInteractiveGuide->complete")}},{action:a.EngagementSurfaceAction.PowerAppsBannerAction,match:function(t){return e.propEqual(t,r.Action.Gesture,o.Gesture.click)&&e.propEqual(t,r.DataBag.id,"tabViewPowerAppsLinkCoachmark")}}]},e.prototype.cleanupOnAppTeardown=function(){this.unbindActionEventFn&&this.unbindActionEventFn(),this.unbindBiEventFn&&this.unbindBiEventFn(),this._hasStarted=!1,this.unbindActionEventFn=void 0,this.unbindBiEventFn=void 0},e.prototype.initializeOnAppLaunchAndReinit=function(){},e.prototype.mtmaTelemetryIdentifier=function(){return"EsDataCollector"},e.prototype.startUp=function(){var e=this;this._hasStarted||(this._hasStarted=!0,this.unbindActionEventFn=this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.engagementSurfaces.onAction,function(t,n){for(var a=0,r=n||[];a<r.length;a++)!function(t){_.remove(e.matchers,function(e){return e.action===t})}(r[a]);!e.matchers.length&&e.unbindBiEventFn&&e.unbindBiEventFn()}),this.unbindBiEventFn=this.eventingService.$onWithTenantScope(this.$rootScope,this.constants.events.logging.biEvent,function(t,n){_.defer(function(){var t=_(e.matchers).filter(function(e){return e.match(n)}).map(function(e){return e.action}).value();e.esRepository.addEngagemetSurfaceActions(t)})}))},e}();t.EsDataCollector=s,angular.module("teamspace.esDataCollector",["teamspace.constants","teamspace.eventingService","teamspace.esRepository","teamspace.orchestrationService"]).service("esDataCollector",s)},2325:function(e,t,n){"use strict";var a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++){t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.surfaces={}}return e.prototype.setSurfaces=function(e){this.surfaces=_.keyBy(e,function(e){return e.id})},e.prototype.setCurrentSurface=function(e){this.current&&(this.previous=this.current),this.current=a({},e)},e.prototype.unsetCurrentSurface=function(){this.current=void 0},e.prototype.setCurrentAction=function(e){_.isNil(this.current)||(this.current.action=e)},e.prototype.onSurfaceClosed=function(){this.previous=this.current,this.current=void 0},e.prototype.getSurfaceState=function(){var e=_.cloneDeep({prev:this.previous,curr:this.current,all:this.surfaces});return e.prev&&(e.prev.displayed=_.map(e.prev.displayed,function(e){return e.clone()})),e.curr&&(e.curr.displayed=_.map(e.curr.displayed,function(e){return e.clone()})),Object.keys(e.all||{}).forEach(function(t){var n=e.all[t];n.displayed=_.map(n.displayed,function(e){return e.clone()})}),e},e}();t.EsSurfaceStack=r,angular.module("teamspace.esSurfaceStack",[]).service("esSurfaceStack",r)},2326:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.$q=e,this.constants=t,this.esParser=n,this.esSurfaceStack=a,this.dialogService=r,this.analyticsService=i}return e.$inject=["$q","constants","esParser","esSurfaceStack","dialogService","analyticsService"],e.prototype.displayCards=function(e,t,n){var a=this,r=this.$q.defer(),i=e.params,o=i.map(function(t){return a.transform(e,t,n)}),s=i.find(function(e){return e&&!1===e.closeByDocument}),c={cards:o,scenario:t,preCloseCallback:function(e){var t=[a.constants.promptCards.eventSource.overlayClick,a.constants.promptCards.eventSource.escape];if(_.includes(t,e)){var n=angular.element(".prompt-cards-holder"),r=n&&n.scope();r&&a.sendDismissPanelAction(r)}return!0},closeByDocument:s&&s.closeByDocument},u=function(){return a.dialogService.open(a.constants.dialogs.promptCardsHolder,c).closePromise.then(function(e){var t,n=(t={},t[a.constants.promptCards.eventSource.doneBtn]=a.constants.growth.engagementSurfaces.actionKey.completedClose,t[a.constants.promptCards.eventSource.xClose]=a.constants.growth.engagementSurfaces.actionKey.xClose,t[a.constants.promptCards.eventSource.overlayClick]=a.constants.growth.engagementSurfaces.actionKey.xClose,t[a.constants.promptCards.eventSource.escape]=a.constants.growth.engagementSurfaces.actionKey.xClose,t);a.esSurfaceStack.setCurrentAction(n[e.value]),r.resolve()}).catch(r.reject)};return this.dialogService.isAnyDialogOpen()?(t.pause({reason:"waiting for existing dialog to close before showing swipe cards modal"}),this.dialogService.onAllDialogsClosed().then(function(){t.resume(),u()})):u(),r.promise},e.prototype.transform=function(e,t,n){return t.text=t.text||{},{image:t.imageSrc,heading:t.headingResxKey,scenarioStepName:t.name,customClass:t.customClass,hideCloseBtn:t.hideCloseBtn,translationContext:{id:t.text.resxKey,values:this.getResxParamsForPromptCard(t.text.resxParams,n)},video:t.video&&t.video.text&&{hasTranslations:!1,translationContext:{id:t.video.text.resxKey,values:this.getResxParamsForPromptCard(t.video.text.resxParams,n)},videoOnMainImage:t.video.videoOnMainImage,videoSource:t.video.videoSource,playScenarioMarker:t.name+"-playVideo",doneScenarioMarker:t.name+"-closeVideo"},panelType:teamspace.PanelType.engagementSurfaceCarousel,trackData:{id:e.id,treatment:e.treatment,card:t.name}}},e.prototype.getResxParamsForPromptCard=function(e,t){var n=e;return e&&(n=this.esParser.evaluateExpressions(e,t)),n?JSON.stringify(n):void 0},e.prototype.sendDismissPanelAction=function(e){this.analyticsService.onPanelAction(e,{action:{gesture:teamspace.components.PanelActionGesture.click,outcome:teamspace.components.PanelActionOutcome.dismiss,scenario:teamspace.components.PanelActionScenario.closeFreCard,scenarioType:teamspace.components.PanelActionScenarioType.quitFRE},module:{name:teamspace.components.PanelModuleName.promptCardHolder.toString(),type:teamspace.components.PanelModuleType.closeDialog,summary:"Close FRE Card"}})},e}();t.EsCarouselService=a,angular.module("teamspace.esCarouselService",["teamspace.esTranslate","teamspace.loggingService","teamspace.appStateAdapter","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.esParser","teamspace.constants"]).service("esCarouselService",a)},2327:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,f,m){this.$window=e,this.$rootScope=t,this.$q=n,this.constants=a,this.coachmarksService=r,this.esActionHandler=i,this.esSurfaceStack=o,this.esTranslate=s,this.$sce=c,this.analyticsService=u,this.eventingService=l,this.esTriggers=p,this.resources=g,this.ariaLiveService=d,this.utilityService=h,this.esParseService=f,this.platformDetectService=m}return e.$inject=["$window","$rootScope","$q","constants","coachmarksService","esActionHandler","esSurfaceStack","esTranslate","$sce","analyticsService","eventingService","esTriggers","resources","ariaLiveService","utilityService","esParseService","platformDetectService"],e.prototype.displayCoachmark=function(e,t,n){var r=this,i=this.$q.defer(),o=e.params,s=e.id,c=e.treatment,u=$.noop,l=function(){r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),i.resolve(!0)},p=o.primaryAction&&{title:this.esTranslate.instant(o.primaryAction.resxKey,o.primaryAction.resxParams,n),tooltip:this.esActionHandler.actionTitle(o.primaryAction.actionKey),onClick:function(){r.esSurfaceStack.setCurrentAction(o.primaryAction.actionKey),r.esActionHandler.handleAction(o.primaryAction.actionKey,{id:s,treatment:c,close:function(){}},n)},trackScenario:teamspace.components.PanelActionScenario.engagementSurfaceCoachmarkPrimaryButton,trackSummary:"engagement surface coachmark primary button",trackOutcome:teamspace.components.PanelActionOutcome.primary,trackData:{id:e.id,treatment:e.treatment,actionKey:this.esActionHandler.parseActionKey(o.primaryAction.actionKey).key}},g=o.secondaryAction&&{title:this.esTranslate.instant(o.secondaryAction.resxKey,o.secondaryAction.resxParams,n),tooltip:this.esActionHandler.actionTitle(o.secondaryAction.actionKey),onClick:function(){r.esSurfaceStack.setCurrentAction(o.secondaryAction.actionKey),r.esActionHandler.handleAction(o.secondaryAction.actionKey,{id:s,treatment:c,close:function(){}},n)},trackScenario:teamspace.components.PanelActionScenario.engagementSurfaceCoachmarkSecondaryButton,trackSummary:"engagement surface coachmark secondary button",trackOutcome:teamspace.components.PanelActionOutcome.secondary,trackData:{id:e.id,treatment:e.treatment,actionKey:this.esActionHandler.parseActionKey(o.secondaryAction.actionKey).key}},d=o.img||{src:void 0},h=o.element,f=o.placement,m=0;_.isArray(h)&&(h=_.find(h,function(e){return $(e).is(":visible")})||_.first(h),m=_.indexOf(o.element,h)),_.isArray(f)&&(f=f[m]);var v=function(){_.defer(function(){var e=$("#coachmark-tooltip").find("[tabbable]:not([data-tid=coachmark-close-button]):visible:not(.invisible):first");e.length||(e=$("#coachmark-tooltip").find("[tabbable]:visible:not(.invisible):first")),e.focus()})},y=function(){u(),o.closeOnBiEvent&&(u=r.esTriggers.subscribe(a.Trigger.BIEvent,o.closeOnBiEvent,r.esParseService,function(){r.esSurfaceStack.setCurrentAction(r.constants.growth.engagementSurfaces.actionKey.biEvent);var t={panelType:teamspace.PanelType.engagementSurfaceCoachmark,dataBag:{id:e.id,treatment:e.treatment,actionKey:r.constants.growth.engagementSurfaces.actionKey.biEvent}};return _.defer(function(){return r.analyticsService.sendPseudoPanelView(t)}),r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),r.$q.resolve()}))},S=function(e){var t=e.which||e.keyCode;e.ctrlKey&&e.altKey&&e.shiftKey&&t===r.constants.keyCodes.p&&v()},A=this.esTranslate.instant(o.resxKey,o.resxParams,n),C=p||g||o.isSticky&&o.showStickyClose;this.coachmarksService.showAdHocCoachmark({element:h,content:this.$sce.trustAsHtml(A),placement:f,className:o.className,viewport:o.viewport,containedIn:o.containedIn,panelType:teamspace.PanelType.engagementSurfaceCoachmark,asModal:o.asModal,isSticky:o.isSticky,showStickyClose:o.showStickyClose,onClose:function(){return r.esSurfaceStack.setCurrentAction(r.constants.growth.engagementSurfaces.actionKey.xClose)},onTimeout:function(){var t={panelType:teamspace.PanelType.engagementSurfaceCoachmark,dataBag:{id:e.id,treatment:e.treatment,actionKey:r.constants.growth.engagementSurfaces.actionKey.timeout}};_.defer(function(){return r.analyticsService.sendPseudoPanelView(t)}),r.esSurfaceStack.setCurrentAction(r.constants.growth.engagementSurfaces.actionKey.timeout)},autoCloseInSeconds:o.autoCloseInSeconds,hideArrow:o.hideArrow,appendTo:o.appendTo,primaryAction:p,secondaryAction:g,img:{src:d.src,altResxKey:d.altResxKey,headerContent:d.headerResxKey&&this.$sce.trustAsHtml(this.esTranslate.instant(d.headerResxKey,d.headerResxParams,n))},markDisplayedOnTargetMove:o.markDisplayedOnTargetMove,trackData:{id:e.id,treatment:e.treatment}},t).then(i.resolve,i.reject,function(e){var t;if(C){var n=r.utilityService.stripHtml(A),a=r.esTranslate.instant(r.resources.strings.shift),s=r.esTranslate.instant(r.resources.strings.ctrl),c=r.esTranslate.instant(r.resources.strings.alt),u=r.esTranslate.instant(r.resources.strings.cmd_short),l=r.esTranslate.instant(r.resources.strings.option),p=r.platformDetectService.getOS()===r.constants.os.mac?u+"+"+l+"+"+a:s+"+"+c+"+"+a;r.ariaLiveService.update(r.esTranslate.instant(r.resources.strings.esp_actionable_coachmark_aria_anouncement,{description:"description",key:"key"},(t={},t.description=n,t.key=p,t)),!1),r.$window.addEventListener("keydown",S,!0)}o.closeOnBiEvent&&y(),i.notify(e)});var T=[this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return l()}),function(){return o.closeOnBiEvent&&u()},function(){return r.$window.removeEventListener("keydown",S,!0)}];return i.promise.finally(function(){return T.forEach(function(e){return e()})}),i.promise.then(function(e){if(!e)return r.$q.reject()})},e}();t.EsCoachmarkService=r,angular.module("teamspace.esCoachmarkService",["teamspace.esTranslate","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.coachmarksService","teamspace.analyticsService","teamspace.eventingService","teamspace.esTriggers","teamspace.utilityService","teamspace.ariaLiveService","teamspace.locales","teamspace.esParseService"]).service("esCoachmarkService",r)},2328:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){var e=this;this.debouncedOnResize=_.debounce(function(t){return e.hoistTargets(t.data.config)},100)}return e.prototype.init=function(e){this.removeBottomOverlay(),this.bottomOverlay=$("<div>",{id:"es-bottom-overlay"}).addClass("es-overlay-full").addClass("es-overlay-bottom"),!e.hideDisabledOverlay&&this.bottomOverlay.addClass("es-overlay-full-semiopaque"),_.isFunction(e.onOverlayClick)&&this.bottomOverlay.on("click",function(){return e.onOverlayClick()}),$("body").append(this.bottomOverlay)},e.prototype.next=function(e){$(window).off("resize",this.debouncedOnResize),this.hoistTargets(e),$(window).on("resize",{config:e},this.debouncedOnResize)},e.prototype.hide=function(){$(window).off("resize",this.debouncedOnResize),this.demoteTargets(),this.removeBottomOverlay()},e.prototype.removeBottomOverlay=function(){this.bottomOverlay&&this.bottomOverlay.remove(),this.bottomOverlay=null},e.prototype.hoistTargets=function(e){if(this.demoteTargets(),this.primaryTarget=$(e.targetSelector),this.primaryTarget.length&&(this.primaryTarget.parents().addClass("es-overlay-target-parents-zfix"),this.primaryTarget=this.primaryTarget.first(),this.primaryTarget.is(":visible"))){this.primaryTarget.addClass("es-overlay-primary-target"),this.addRelativePositionIfNecessary(this.primaryTarget),this.primaryOverlay=$("<div>",{id:"es-top-overlay"}).addClass("es-overlay-top"),e.hideDisabledTargetOverlay||(this.primaryOverlay.addClass("es-overlay-primary-semiopaque"),this.primaryOverlay.css("background-color",this.findNearestBackgroundColor(this.primaryTarget))),e.allowTargetInteraction&&this.primaryOverlay.css("z-index",-1),_.isFunction(e.onTargetOverlayClick)&&this.primaryOverlay.on("click",function(){return e.onTargetOverlayClick()});var t=this.findNearestBackgroundColor(this.primaryTarget);if(t&&$("<style>").text(".es-overlay-primary-target { background-color: "+t+" }").appendTo(this.primaryOverlay),this.affixToTargetPosition(this.primaryOverlay,this.primaryTarget),this.primaryTarget.append(this.primaryOverlay),e.focusSelector&&(!(this.secondaryTarget=$(e.focusSelector))||this.secondaryTarget.length)&&(this.secondaryTarget=this.secondaryTarget.first(),this.secondaryTarget.is(":visible"))){this.secondaryTarget.addClass("es-overlay-secondary-target"),this.addRelativePositionIfNecessary(this.secondaryTarget),this.highlightBorder=$("<div>",{id:"es-highlight-border"}).addClass("es-overlay-highlight").addClass("shadow-level-3");var n=e.focusBorderPadding||{vertical:0,horizontal:0};0===n.vertical&&0===n.horizontal||(this.secondaryOverlay=$("<div>").addClass("es-overlay-secondary-overlay"),_.isFunction(e.onTargetOverlayClick)&&this.secondaryOverlay.on("click",function(){return e.onTargetOverlayClick()}),this.affixToTargetPosition(this.secondaryOverlay,this.secondaryTarget),$("body").append(this.secondaryOverlay)),this.affixToTargetPosition(this.highlightBorder,this.secondaryTarget,n.vertical,n.horizontal),$("body").append(this.highlightBorder)}}},e.prototype.demoteTargets=function(){this.primaryOverlay&&this.primaryOverlay.remove(),this.highlightBorder&&this.highlightBorder.remove(),this.secondaryOverlay&&this.secondaryOverlay.remove(),this.primaryTarget&&this.primaryTarget.removeClass("es-overlay-primary-target"),this.primaryTarget&&this.primaryTarget.parents().removeClass("es-overlay-target-parents-zfix"),this.secondaryTarget&&this.secondaryTarget.removeClass("es-overlay-secondary-target"),this.primaryTarget=this.secondaryTarget=this.primaryOverlay=this.highlightBorder=this.secondaryOverlay=null},e.prototype.affixToTargetPosition=function(e,t,n,a){void 0===n&&(n=0),void 0===a&&(a=0),e.css({position:"fixed",height:t.outerHeight()-2*n,width:t.outerWidth()-2*a,top:t.offset().top+n,left:t.offset().left+a})},e.prototype.addRelativePositionIfNecessary=function(e){var t=e.css("position");_.includes(["absolute","relative","fixed"],t)||e.addClass("es-overlay-relative")},e.prototype.findNearestBackgroundColor=function(e){for(var t=void 0;!t&&e&&!e.first().is(":root");){var n=(e=e.first()).css("background-color");n&&"rgba(0, 0, 0, 0)"!==n&&(t=n),e=e.parent()}return t},e}();t.EsOverlayService=a,angular.module("teamspace.esOverlayService",[]).service("esOverlayService",a)},2329:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(8),r=function(){function e(e,t,n,a,r,i,o,s,c,u,l,p,g,d,h,f,m){this.$window=e,this.$rootScope=t,this.$q=n,this.$timeout=a,this.constants=r,this.esActionHandler=i,this.coachmarksService=o,this.esSurfaceStack=s,this.esTranslate=c,this.esTriggers=u,this.esOverlayService=p,this.eventingService=g,this.resources=d,this.ariaLiveService=h,this.utilityService=f,this.esParseService=m,this.logger=l.newLogger("EsQuickGuideService")}return e.$inject=["$window","$rootScope","$q","$timeout","constants","esActionHandler","coachmarksService","esSurfaceStack","esTranslate","esTriggers","esLogger","esOverlayService","eventingService","resources","ariaLiveService","utilityService","esParseService"],e.prototype.displayQuickGuide=function(e,t,n){var r=this,i=this.$q.defer(),o=e.id,s=e.treatment,c=e.params,u=c.cards||[],l=$.noop,p=$.noop,g=$.noop,d=$.noop,h=function(){_.defer(function(){return $("#coachmark-tooltip").find("[tabbable]:visible:not(.invisible):first").focus()})},f=void 0,m=function(v,y,S){if(void 0===y&&(y=!1),void 0===S&&(S=1),v!==f){if(f=v,p(),(v=Math.max(v,0))>=u.length){var A=y?r.constants.growth.engagementSurfaces.actionKey.xClose:r.constants.growth.engagementSurfaces.actionKey.completedClose;return r.esSurfaceStack.setCurrentAction(A),angular.element(".outer-shell").attr("aria-hidden","false"),r.esOverlayService.hide(),t.stop(),void i.resolve()}t.pause({reason:"showing quick guide index "+v});var C=u[v],T=C.preActionKeys||[],b=C.ariaKey&&r.esTranslate.instant(C.ariaKey),w=r.$q.resolve();T.forEach(function(e){w=w.finally(function(){return r.esSurfaceStack.setCurrentAction(e),r.esActionHandler.handleAction(e,{id:o,treatment:s,close:function(){}},n)})});var P=Math.max(C.delayInSeconds?C.delayInSeconds*r.constants.timeInMiliseconds.second:1,1),E=function(e){return e&&e.split(",").map(function(e){return e.trim()+":visible:first"}).join(", ")},k=E(C.focusSelector),O=E(C.targetSelector),q=k||O,H=_.isBoolean(C.hideDisabledTargetOverlay)?C.hideDisabledTargetOverlay:!!C.nextOnBiEvent,N=_.isBoolean(C.allowTargetInteraction)?C.allowTargetInteraction:!!C.nextOnBiEvent,D=_.isBoolean(C.hideProgress)?C.hideProgress:!!c.hideProgress,M=_.isBoolean(C.hideArrowNavigation)?C.hideArrowNavigation:!!C.nextOnBiEvent,F=_.isBoolean(C.preventFocusGrab)?C.preventFocusGrab:!(!C.nextOnBiEvent&&!C.allowTargetInteraction),x=C.name?e.id+"->"+C.name:e.id,j=r.esTranslate.instant(C.resxKey,C.resxParams,n);N&&k&&(r.logger.error("card ["+(C.name||v)+"] interactive target with focus selector is not allowed"),r.logger.error("card ["+(C.name||v)+"] removing focus selector to allow target to be interactive!"),k=void 0,q=O),d=function(e){var t=$(q),n=$("#coachmark-tooltip");N&&t.is(e)||t.has(e).length||n.is(e)||n.has(e).length||h()},g=function(){if(N&&F){var e=$(q),t=document.activeElement;e.has(t).length||(e.is("button, input, [tabindex]")?e.focus():e.find("button, input, [tabindex]").filter(":visible:not([disabled]):not([tabindex=-1])").filter(function(){return $(this).width()&&$(this).height()}).first().focus())}},w.then(function(){return r.$timeout(P,!1)}).then(function(){return l=function(){r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),m(v+1)}}).then(function(){return r.esOverlayService.next({targetSelector:O,focusSelector:k,focusBorderPadding:C.focusPadding,hideDisabledTargetOverlay:H,allowTargetInteraction:N})}).then(function(){return r.logger.info("displaying card "+(C.name?x:e.id+"->"+(v+1)))}).then(function(){var e=!1;return r.coachmarksService.showAdHocCoachmark({element:q,content:j,placement:C.placement,className:C.className,containedIn:C.containedIn,panelType:teamspace.PanelType.engagementSurfaceCoachmark,allowOnPopover:c.allowOnPopover,onClose:function(){return m(u.length,!0)},quickGuideInfo:{count:u.length,current:v+1,onPrevious:function(){return m(v-1,!1,-1)},onNext:function(){return m(v+1)},hideCloseBtn:c.hideCloseBtn,hideProgress:D,hideArrowNavigation:M,preventFocusGrab:F,ariaLabel:b},trackData:{currIndex:v,id:x,treatment:s},img:{src:C.imageSrc}}).then(function(n){if(!n&&!e)return r.logger.warn("skipping card "+(v+1)+" as "+O+" was not visible or moved"),c.recordSkippedCard&&t.mark("skipping card "+C.resxKey),m(v+S)},function(e){return r.$q.reject(e)},function(){var t=r.utilityService.stripHtml(j);r.ariaLiveService.update(t,!0),C.nextOnBiEvent&&(p=r.esTriggers.subscribe(a.Trigger.BIEvent,C.nextOnBiEvent,r.esParseService,function(){return e=!0,r.$q.resolve(l())})),g()})}).catch(function(e){return e=e||{},r.logger.error("skipping index "+v+". Exception thrown "+e.message),c.recordSkippedCard&&t.mark("skipping card "+C.resxKey),m(v+S)}).finally(function(){return f=void 0})}},v=function(){r.coachmarksService.dismissCoachmark(teamspace.services.coachmarks.Coachmark.AdHoc),m(u.length)},y={hideDisabledOverlay:c.hideDisabledOverlay,onOverlayClick:function(){c.nextOnOverlayClick&&l&&l()}};angular.element(".outer-shell").attr("aria-hidden","true"),this.esOverlayService.init(y),this.ariaLiveService.update(this.esTranslate.instant(this.resources.strings.esp_quickguides_aria_anouncement),!0),m(0);var S=function(e){e.target&&d(e.target)},A=function(e){var t=e.which||e.keyCode;t===r.constants.keyCodes.escape&&(v(),e.stopPropagation()),e.ctrlKey&&e.altKey&&e.shiftKey&&t===r.constants.keyCodes.t&&g(),e.ctrlKey&&e.altKey&&e.shiftKey&&t===r.constants.keyCodes.g&&h()};this.$window.addEventListener("focus",S,!0),this.$window.addEventListener("keydown",A,!0);var C=[this.eventingService.$on(this.$rootScope,this.constants.events.engagementSurfaces.killActive,function(){return v()}),this.eventingService.$on(this.$rootScope,this.constants.events.calling.callConnecting,function(){return v()}),function(){return r.$window.removeEventListener("focus",S,!0)},function(){return r.$window.removeEventListener("keydown",A,!0)}];return i.promise.finally(function(){return C.forEach(function(e){return e()})}),i.promise},e}();t.EsQuickGuideService=r,angular.module("teamspace.esQuickGuideService",["teamspace.constants","teamspace.esTranslate","teamspace.coachmarksService","teamspace.esActionHandler","teamspace.esSurfaceStack","teamspace.esOverlayService","teamspace.esTriggers","teamspace.eventingService","teamspace.ariaLiveService","teamspace.utilityService","teamspace.locales","teamspace.esParseService"]).service("esQuickGuideService",r)},2330:function(e,t,n){"use strict";var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=function(e){function t(t,n,a,r,i,o,s,c,u){var l=e.call(this,c.middleTierConstants.newEndpointAddress,r,o,n,t,a,s,i)||this;return l.$q=t,l.$http=n,l.$qNoApply=a,l.settingsService=r,l.appStateService=i,l.constants=o,l.authenticationService=s,l.appConfig=c,l.esTranslate=u,l}return a(t,e),t.$inject=["$q","$http","$qNoApply","settingsService","appStateService","constants","authenticationService","appConfig","esTranslate"],Object.defineProperty(t.prototype,"activityParamsDataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.activityParams},enumerable:!0,configurable:!0}),t.prototype.postActivityFeed=function(e,n,a){var r=this,i=e.params;if(!i||!i.activityType||!i.topic){var o="Invalid pararameters for generating activity feed.";return n.fail({errorMessage:o}),this.$q.reject(o)}var s="text"===i.topic.source?{source:i.topic.source,value:this.esTranslate.instant(i.topic.resxKey,i.topic.resxParams,a),webUrl:i.topic.deeplink?i.topic.deeplink:a[this.activityParamsDataKey].deeplink}:{source:i.topic.source,value:i.topic.value},c=void 0;i.previewText&&(c={content:this.esTranslate.instant(i.previewText.resxKey,i.previewText.resxParams,a)});var u={topic:s,activityType:i.activityType,previewText:c,recipient:i.recipient};i.templateParameters&&i.templateParameters.length?u.templateParameters=i.templateParameters:a[this.activityParamsDataKey]&&a[this.activityParamsDataKey].templateParameters&&a[this.activityParamsDataKey].templateParameters.length&&(u.templateParameters=a[this.activityParamsDataKey].templateParameters);var l={retryOn:["5xx","404","429"],maxRetries:3};return this.withRetry(function(){return r.performApiPost(t.API_ENDPOINT,{callType:t.CALL_TYPE},u).toNgPromise(r.$qNoApply)},null,l.retryOn,l.maxRetries).then(function(){return n.stop()}).catch(function(e){var t=e.errorCode,a=e.statusCode;return n.fail({errorMessage:"Failed to post activity feed.",errorCode:t,statusCode:a}),r.$q.reject({errorMessage:"Failed to post activity feed."})})},t.prototype._getAuthHeaders=function(e,t){return void 0===e&&(e=!1),this.authenticationService.getAuthHeaders({},void 0,[t])},t.prototype.withRetry=function(e,t,n,a,r){void 0===t&&(t=null),void 0===n&&(n=["5xx","404"]),void 0===a&&(a=3),void 0===r&&(r=1e3);var i=this.$q.defer(),o=function(s){void 0===s&&(s=0),t&&t.resume(),e().then(i.resolve).catch(function(e){var c=(e||{}).statusCode;if(!n.map(function(e){return new RegExp(e.replace(/x/gi,"\\d"))}).some(function(e){return e.test(c)}))return i.reject(e);s<a?(s++,t&&t.pause({reason:"failed. will retry after delay. status="+c+" count="+s}),setTimeout(function(){return o(s)},Math.pow(s,2)*r)):i.reject(e)})};return o(0),i.promise},t.CALL_TYPE="synthetic_notifications",t.API_ENDPOINT="/me/syntheticnotifications/generate",t}(SkypeX.Services.GenericRestClient);t.EsActivityService=r,angular.module("teamspace.esActivityService",["teamspace.constants","teamspace.authenticationService"]).service("esActivityService",r)},2331:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.settingsService=t,this.localizationService=n}return e.$inject=["constants","settingsService","localizationService"],e.prototype.isUserInAffectedGeo=function(){var e=this.localizationService.getCountryCode(),t=this.settingsService.valueFor(this.constants.settings.names.particularEventAffectedCountries);return!!(e&&t&&t.length>0)&&void 0!=t.find(function(t){return t.toLowerCase()===e.toLowerCase()})},e}();t.EsLocationAffiliationService=a,angular.module("teamspace.esLocationAffiliationService",["teamspace.constants","teamspace.settingsService","teamspace.localizationService"]).service("esLocationAffiliationService",a)},2332:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i,o,s,c,u){var l=this;this.$q=e,this.fetchRelevantContactsHandler=t,this.fetchWhatsNewHandler=n,this.fetchAggregateFilesHandler=a,this.fetchJoinTenantUrlHandler=r,this.fetchUserPhoneNumberHandler=i,this.fetchPendingJoinRequestsHandler=o,this.fetchOneClickJoinSettingHandler=s,this.fetchTeamRecommendationHandler=c,this.fetchEduNotebookTypeHandler=u,this.dataHandlers={};var p=Array.from(arguments);this.dataHandlers={},p.forEach(function(e){l.isDataHandler(e)&&(l.dataHandlers[e.dataKey]=e)})}return e.$inject=["$q","fetchRelevantContactsHandler","fetchWhatsNewHandler","fetchAggregateFilesHandler","fetchJoinTenantUrlHandler","fetchUserPhoneNumberHandler","fetchPendingJoinRequestsHandler","fetchOneClickJoinSettingHandler","fetchTeamRecommendationHandler","fetchEduNotebookTypeHandler"],e.prototype.isDataHandler=function(e){return e&&e.dataKey&&e.fetchData},e.prototype.hasRegisteredData=function(e){return!!this.dataHandlers[e]},e.prototype.fetchData=function(e){return this.hasRegisteredData(e)?this.dataHandlers[e].fetchData():this.$q.reject(e+" is not a registered data key")},e}();t.EsFetchDataHandler=a,angular.module("teamspace.esFetchDataHandler",["teamspace.fetchRelevantContactsHandler","teamspace.fetchWhatsNewHandler","teamspace.fetchAggregateFilesHandler","teamspace.fetchJoinTenantUrlHandler","teamspace.fetchUserPhoneNumberHandler","teamspace.fetchPendingJoinRequestsHandler","teamspace.fetchOneClickJoinSettingHandler","teamspace.fetchTeamRecommendationHandler","teamspace.fetchEduNotebookTypeHandler"]).service("esFetchDataHandler",a)},2333:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.esRepository=t,this.logger=n.newLogger("FetchRelevantContactsHandler")}return e.$inject=["constants","esRepository","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.relevantContacts},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching data");var t={};return this.esRepository.getRelevantContacts().then(function(n){return t[e.dataKey]=n}).then(function(){return t})},e}();t.FetchRelevantContactsHandler=a,angular.module("teamspace.fetchRelevantContactsHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchRelevantContactsHandler",a)},2334:function(e,t,n){"use strict";var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function a(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(a.prototype=n.prototype,new a)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=teamspace.services.CortanaServiceEvents,i=function(e){function t(t,n,a,r,i){var o=e.call(this)||this;return o.$q=t,o.constants=n,o.cortanaFREService=a,o.cortanaEventingService=r,o.cortanaConfigurationService=i,o}return a(t,e),t.$inject=["$q","constants","cortanaFREService","cortanaEventingService","cortanaConfigurationService"],Object.defineProperty(t.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateCortanaConsent.name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.updateCortanaConsent.params},enumerable:!0,configurable:!0}),t.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return n&&2==n.length&&(n[0]||this.cortanaEventingService.triggerEvent(r.consentUpdated,!1,{showPopup:!1}),n[1]?this.cortanaConfigurationService.setUserConsent(teamspace.services.ConsentType.Long,n[0]).then(function(){t.cortanaFREService.isConsentModalRequired()||t.cortanaEventingService.triggerEvent(r.consentUpdated,!0,{showPopup:!0})}):this.cortanaConfigurationService.setUserConsent(teamspace.services.ConsentType.Short,n[0]).then(function(){t.cortanaFREService.isConsentModalRequired()?n[0]&&t.cortanaFREService.showConsentModal():t.cortanaEventingService.triggerEvent(r.consentUpdated,!0,{showPopup:!0})})),e.close(),this.$q.resolve()},t}(SkypeX.Services.ObservableBase);t.UpdateCortanaConsentHandler=i,angular.module("teamspace.updateCortanaConsentHandler",["teamspace.constants","teamspace.cortanaFREService","teamspace.cortanaEventingService","teamspace.cortanaConfigurationService"]).service("updateCortanaConsentHandler",i)},2335:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(2336),r=(function(){}(),function(){}(),function(){}(),function(){}(),function(){function e(e,t,n,a,r,i,o,s,c,u,l,p){this.$rootScope=e,this.$qNoApply=t,this.$timeout=n,this.$compile=a,this.constants=r,this.htmlSanitizer=i,this.tenantSettingsStore=o,this.loggingService=s,this.prefix="/api/teamsgrowth/",this.view="/json/whatsnew/",this.suffix="whats-new",this.logger=p.newLogger("fetchWhatsNewHandler"),this.locale=l.getLocale();var g=u.valueFor(r.settings.names.cxcsDomain);this.whatsNewUrl=g+this.getWhatsNewUrl();var d=new teamspace.services.DataManagerOptions(r.urls.whatsNewDataManager.type,function(e){return e.content.title});d.useTeamspaceTokens=!1,this.whatsNewDataManager=c.registerManager(d)}return e.$inject=["$rootScope","$qNoApply","$timeout","$compile","constants","htmlSanitizer","tenantSettingsStore","loggingService","dataManagerService","settingsService","localizationService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.whatsNew},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching whats new data");var t={};return this.getWhatsNew().then(function(n){return t[e.dataKey]=n}).then(function(){return t})},e.prototype.getWhatsNewUrl=function(){var e=this.getTenantSkuAndUserType();switch(e.tenantSKU){case"edu":return this.prefix+this.locale+this.view+"edu/"+e.userType+"/"+this.suffix;case"enterprise":case"free":return this.prefix+this.locale+this.view+e.tenantSKU+"/"+this.suffix;default:return this.prefix+this.locale+this.view+this.suffix}},e.prototype.getWhatsNew=function(){var e=this,t=this.$qNoApply.defer(),n=this.loggingService.newScenario(this.constants.scenarios.extensibility.whatsNewDataManager.getContentNetwork),a={dataSource:"CXCS"},r=new teamspace.services.DataManagerRequestOptions;r.skipApply=!0,r.scenario=n;var i={method:"GET",url:this.whatsNewUrl,skipCommonHeaders:!0};return this.whatsNewDataManager.invoke(i,r).then(function(r){if(r)e.logger.info("Fetched whats new data"),n.stop(a),e.parseCxcsResponse(r).then(function(e){t.resolve(e)});else{var i="Empty response for whats new call.";e.logger.error(i),a.cxcsError=i,n.fail(a),t.reject(i)}}).catch(function(r){var i="Error: "+JSON.stringify(e.sanitizeError(r));e.logger.error("Failed to fetch what's new data. "+i),a.cxcsError=i,a.cxcsStatus=r&&r.status,n.fail(a),t.reject(r)}),t.promise},e.prototype.parseCxcsResponse=function(e){var t=e.content,n=e.metadata;if(n&&n.updateDate&&t&&t.title&&t.features&&t.features.length>0&&!t.features.includes(void 0)){var a=moment(n.updateDate),r={title:t.title,features:t.features};return this.compileCoachmarkHtml(r).then(function(e){return{html:e,updateDate:a}})}this.$qNoApply.reject("Invalid 'what's new' content")},e.prototype.compileCoachmarkHtml=function(e){var t=this,n=this.$rootScope.$new(!0);n.data=e;var r=this.$compile(a)(n);return this.$timeout(function(){return n.$destroy(),t.htmlSanitizer.sanitizeHtml(r.html())})},e.prototype.sanitizeError=function(e){return e=e||{},{status:e.statusCode||e.status,errorCode:e.errorCode,code:e.code,errorSubCode:e.errorSubCode}},e.prototype.getTenantSkuAndUserType=function(){for(var e={tenantSKU:this.constants.skuType.unknown,userType:""},t=this.tenantSettingsStore.getSettings(),n=t&&t.licenseCategorySettingsMap&&Object.keys(t.licenseCategorySettingsMap)||[],a=0;a<n.length;a++){var r=n[a].toLowerCase();if(r===this.constants.tenantCategoryType.EducationFaculty){e.tenantSKU=this.constants.skuType.edu,e.userType="teacher";break}if(r===this.constants.tenantCategoryType.EducationStudent){e.tenantSKU=this.constants.skuType.edu,e.userType="student";break}if(r===this.constants.tenantCategoryType.BusinessEnterprise){e.tenantSKU=this.constants.skuType.enterprise;break}if(r===this.constants.tenantCategoryType.Free){e.tenantSKU=this.constants.skuType.free;break}}return e},e}());t.FetchWhatsNewHandler=r,angular.module("teamspace.fetchWhatsNewHandler",["teamspace.constants","teamspace.esLogger","teamspace.htmlSanitizer","teamspace.settingsService","teamspace.loggingService","teamspace.dataManagerService","teamspace.localizationService"]).service("fetchWhatsNewHandler",r)},2336:function(e,t){e.exports='<div class="whats-new-promotion-coachmark-content">\n  <div class="whats-new-promotion-coachmark-title">\n    <span>{{data.title}}</span>\n  </div>\n  <div class="whats-new-promotion-coachmark-features">\n    <ul ng-if="data.features.length > 1">\n      <li ng-repeat="feature in data.features">\n        <span>{{feature}}</span>\n      </li>\n    </ul>\n    <span ng-if="data.features.length == 1">\n      {{data.features[0]}}\n    </span>\n  </div>\n</div>'},2337:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.$qNoApply=e,this.constants=t,this.authenticationService=n,this.aggregateFilesRepository=a,this.filesProviderFactory=r,this.logger=i.newLogger("FetchAggregateFilesHandler")}return e.$inject=["$qNoApply","constants","authenticationService","aggregateFilesRepository","filesProviderFactory","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.teamFiles},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching aggregate files");var t={};return this.getAggregateFiles().then(function(n){var a=n.filter(function(e){return e.files.length});t[e.dataKey]=a}).then(function(){return t})},e.prototype.getAggregateFiles=function(){var e=this,t=this.authenticationService.getLoggedInUser().profile||{},n={serviceName:this.constants.files.serviceName.aggregate,provider:this.filesProviderFactory.create(teamspace.services.files.FilesProviderType.Aggregate)};return this.aggregateFilesRepository.getItems(n).then(function(n){return e.convertAggregateResponseToTeamFilesData(n,t.upn)}).catch(function(t){return e.logger.error("Couldn't fetch aggregate files with "+t),e.$qNoApply.reject(t)})},e.prototype.convertAggregateResponseToTeamFilesData=function(e,t){var n=[];return e.items.forEach(function(e){var a=[];a=e.files.map(function(n){return{siteUrl:e.siteUrl,objectId:n.objectId,objectUrl:n.objectUrl,title:n.title,isFolder:n.isFolder,createdByUser:n.createdByUser,type:n.type,teamId:e.teamId,teamDisplayName:n.teamDisplayName,createdByCurrentUser:t==n.createdByUser.email}});var r={siteUrl:e.siteUrl,teamId:e.teamId,isSuccess:e.isSuccess,files:a};n.push(r)}),n},e}();t.FetchAggregateFilesHandler=a,angular.module("teamspace.fetchAggregateFilesHandler",["teamspace.constants","teamspace.authenticationService","teamspace.services.files.modules.aggregate.aggregateFilesRepository","teamspace.services.files.filesProviderFactory","teamspace.esLogger"]).service("fetchAggregateFilesHandler",a)},2338:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.constants=e,this.manageTenantService=t,this.identityService=n,this.esTranslate=a,this.resources=r,this.logger=i.newLogger("fetchJoinTenantUrlHandler")}return e.$inject=["constants","manageTenantService","identityService","esTranslate","resources","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.joinTenantUrl},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching join tenant url");var t={};return this.manageTenantService.getJoinTenantUrl().then(function(t){return t&&t.joinUrl||!e.identityService.isTenantAdmin()?t:e.manageTenantService.generateJoinTenantUrl()}).then(function(n){return t[e.dataKey]={url:n&&n.joinUrl,isOneClickJoinEnabled:n&&n.autoApproveJoinRequestsEnabled,tooltipText:n&&n.autoApproveJoinRequestsEnabled?e.esTranslate.instant(e.resources.strings.freemium_invite_copy_link_tooltip_one_click_join_enabled):e.esTranslate.instant(e.resources.strings.freemium_invite_copy_link_tooltip_one_click_join_disabled)}}).then(function(){return t})},e}();t.FetchJoinTenantUrlHandler=a,angular.module("teamspace.fetchJoinTenantUrlHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchJoinTenantUrlHandler",a)},2339:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.manageTenantService=t,this.logger=n.newLogger("fetchOneClickJoinSettingHandler")}return e.$inject=["constants","manageTenantService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.oneClickJoinSetting},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching one click join setting");var t={};return this.manageTenantService.getJoinTenantUrl().then(function(n){return t[e.dataKey]={url:n&&n.joinUrl,isOneClickJoinEnabled:n&&n.autoApproveJoinRequestsEnabled},t})},e}();t.FetchOneClickJoinSettingHandler=a,angular.module("teamspace.fetchOneClickJoinSettingHandler",["teamspace.constants","teamspace.esLogger"]).service("fetchOneClickJoinSettingHandler",a)},2340:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.callingSupportService=t,this.logger=n.newLogger("FetchUserPhoneNumberHandler")}return e.$inject=["constants","callingSupportService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.userPhoneNumber},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("fetching user phone number from CallingSupportService");var t={};return this.callingSupportService.getPhoneNumberAsync("fetch-user-phone-number-handler").then(function(n){return t[e.dataKey]=n}).then(function(){return t})},e}();t.FetchUserPhoneNumberHandler=a,angular.module("teamspace.fetchUserPhoneNumberHandler",["teamspace.constants","teamspace.esLogger","teamspace.callingSupportService"]).service("fetchUserPhoneNumberHandler",a)},2341:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.tenantMembershipService=t,this.logger=n.newLogger("fetchPendingJoinRequestsHandler")}return e.$inject=["constants","tenantMembershipService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.pendingJoinRequests},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching pending join requests");var t={};return this.tenantMembershipService.getTenantJoinRequests().then(function(n){return t[e.dataKey]={joinRequests:n}}).then(function(){return t})},e}();t.FetchPendingJoinRequestsHandler=a,angular.module("teamspace.fetchPendingJoinRequestsHandler",["teamspace.constants","teamspace.tenantMembershipService","teamspace.esLogger"]).service("fetchPendingJoinRequestsHandler",a)},2342:function(e,t,n){"use strict";var a=this&&this.__awaiter||function(e,t,n,a){function r(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function o(e){try{c(a.next(e))}catch(e){i(e)}}function s(e){try{c(a.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):r(e.value).then(o,s)}c((a=a.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){function n(e){return function(t){return a([e,t])}}function a(n){if(r)throw new TypeError("Generator is already executing.");for(;c;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.constants=t,this.discoverService=n,this.peopleService=a,this.logger=r.newLogger("FetchTeamRecommendationHandler")}return e.$inject=["$qNoApply","constants","discoverService","peopleService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.teamRecommendation},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching suggested teams");var t={};return this.getSuggestedTeam().then(function(n){t[e.dataKey]=n}).then(function(){return t})},e.prototype.getSuggestedTeam=function(){var e=this;return this.discoverService.getSuggestedTeams().then(function(t){return a(e,void 0,void 0,function(){var e,n,a,i,o,s;return r(this,function(r){switch(r.label){case 0:return!t||t.length<1||t[0].relevantMembers.length<1?(this.logger.warn("No valid suggested teams retrieved."),[2,this.$qNoApply.resolve({})]):(e=t[0],[4,this.peopleService.getAllPeopleProfile(e.relevantMembers,"fetch-suggested-team",!0,!0)]);case 1:return n=r.sent(),a=_.map(n,function(e){return e.displayName.split(" ")[0]}).filter(function(e){return!_.isNil(e)}),i=2,o=a.slice(0,i),s=o.join(", "),i<a.length&&(s+=", +"+(a.length-i)),[2,{teamName:e.teamName,teamId:e.teamId,joinState:e.joinState,usersInTeam:s}]}})})}).catch(function(t){return e.logger.error("Couldn't fetch suggested team with "+t),e.$qNoApply.reject(t)})},e}();t.FetchTeamRecommendationHandler=i,angular.module("teamspace.fetchTeamRecommendationHandler",["teamspace.constants","teamspace.esLogger","teamspace.discoverService","teamspace.peopleService"]).service("fetchTeamRecommendationHandler",i)},2343:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n){this.constants=e,this.oneNoteService=t,this.logger=n.newLogger("FetchEduNotebookTypeHandler")}return e.$inject=["constants","oneNoteService","esLogger"],Object.defineProperty(e.prototype,"dataKey",{get:function(){return this.constants.growth.engagementSurfaces.dataKey.eduNotebookType},enumerable:!0,configurable:!0}),e.prototype.fetchData=function(){var e=this;this.logger.info("Fetching notebook type");var t={};return this.oneNoteService.getOneNoteNotebookType().then(function(n){return t[e.dataKey]=n,t})},e}();t.FetchEduNotebookTypeHandler=a,angular.module("teamspace.fetchEduNotebookTypeHandler",["teamspace.constants","teamspace.esLogger","teamspace.oneNoteService"]).service("fetchEduNotebookTypeHandler",a)},2344:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r){this.$qNoApply=e,this.constants=t,this.settingsService=n,this.layoutService=a,this.logger=r.newLogger("ChangeThemeActionHandler")}return e.$inject=["$qNoApply","constants","settingsService","layoutService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.changeTheme.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.changeTheme.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length||1!=this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$qNoApply.reject(r)}var i=n[0];return this.$qNoApply.resolve().then(function(){var e=_(t.settingsService.getThemes()).find(function(e){return e.key===i});if(!e){var n="Unable to find "+i+" in available themes";throw t.logger.error(n),n}t.layoutService.setThemeCookie(e)}).catch(function(n){return t.logger.error("unable to change "+i+" theme"),e.close(),t.$qNoApply.reject(n)}).finally(function(){return e.close()})},e}();t.ChangeThemeActionHandler=a,angular.module("teamspace.changeThemeActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.settingsService","teamspace.layoutService"]).service("changeThemeActionHandler",a)},2345:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.constants=t,this.dialogService=n,this.logger=a.newLogger("OpenDialogActionHandler")}return e.$inject=["$qNoApply","constants","dialogService","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openDialog.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.openDialog.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!==n.length||1!==this.paramsDesc.length){var r="Action handler "+this.actionKey+" expects 1 argument, received "+JSON.stringify(n);return this.returnFailure(r,e)}var i=n[0];return i in this.constants.dialogs?this.$qNoApply.resolve().then(function(){return t.dialogService.open(i)}).catch(function(){return t.returnFailure("Unable to open dialog "+i,e)}).finally(function(){return e.close()}):this.returnFailure("Dialog "+i+" does not exist",e)},e.prototype.returnFailure=function(e,t){return this.logger.error(e),t.close(),this.$qNoApply.reject(e)},e}();t.OpenDialogActionHandler=a,angular.module("teamspace.openDialogActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.dialogService","teamspace.esLogger"]).service("openDialogActionHandler",a)},2346:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i,o,s,c){this.$qNoApply=e,this.$rootScope=t,this.esLogger=n,this.layoutService=a,this.$q=r,this.appBarService=i,this.constants=o,this.settingsService=s,this.userAppsStore=c}return Object.defineProperty(e.prototype,"enableDynamicAppBarRendering",{get:function(){return this.settingsService.valueAsBoolean(this.constants.settings.names.enableDynamicAppBarRendering)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToPeopleApp.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.navigateToPeopleApp.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];return n&&n[0]?this.userAppsStore.waitForPinnedAndCoreAppsToInitialize().then(function(){if(t.enableDynamicAppBarRendering){var e=t.appBarService.getAppBarItem(t.constants.appId.peopleApp);return e?t.appBarService.onAppSelected(t.$rootScope,e,services.AppSelectionSource.EngagementSurface):t.$qNoApply.reject("people app not found")}var n=t.layoutService.getAppBarItem(teamspace.services.AppBarItemType.PeopleApp);if(!n)return t.$qNoApply.reject("app bar people item not found");t.layoutService.onAppBarItemClick(n),n.clicked(n)}).catch(function(e){var n=teamspace.services.AppBarItemType[teamspace.services.AppBarItemType.PeopleApp];return t.esLogger.error("unable to navigate to app bar item: "+n+" "+t.constants.appId.peopleApp+"-"+t.enableDynamicAppBarRendering),t.$qNoApply.reject(e)}).finally(function(){return e.close()}):(this.esLogger.error("navigate to people app param missing"),e.close(),this.$q.resolve())},e}();t.NavigateToPeopleAppActionHandler=a,angular.module("teamspace.navigateToPeopleAppActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.esLogger","teamspace.userAppsStore","teamspace.appBarService","teamspace.layoutService","teamspace.userAppsStore","teamspace.settingsService"]).factory("navigateToPeopleAppActionHandler",["$qNoApply","$rootScope","esLogger","layoutService","$q","appBarService","constants","settingsService","userAppsStore",function(e,t,n,r,i,o,s,c,u){return new a(e,t,n.newLogger("navigateToPeopleAppActionHandler"),r,i,o,s,c,u)}])},2347:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a){this.$qNoApply=e,this.appBarService=t,this.constants=n,this.logger=a.newLogger("PinPeopleAppToMenuActionHandler")}return e.$inject=["$qNoApply","appBarService","constants","esLogger"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.pinPeopleAppToMenu},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){var t=this.appBarService.getAppBarItem(this.constants.appId.peopleApp);if(t)return this.appBarService.togglePinApp(t),this.$qNoApply.resolve();var n="people app not found";return this.logger.warn(n),this.$qNoApply.reject(n)},e}();t.PinPeopleAppToMenuActionHandler=a,angular.module("teamspace.pinPeopleAppToMenuActionHandler",["teamspace.qNoApply","teamspace.constants","teamspace.appBarService","teamspace.esLogger"]).service("pinPeopleAppToMenuActionHandler",a)},2348:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t,n,a,r,i){this.$qNoApply=e,this.callingMultiWindowService=t,this.constants=n,this.layoutService=r,this.resources=i,this.logger=a.newLogger("EnableMultiWindowAndReloadAppActionHandler")}return e.$inject=["$qNoApply","callingMultiWindowService","constants","esLogger","layoutService","resources"],Object.defineProperty(e.prototype,"actionKey",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableMultiWindowAndReloadApp.name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"paramsDesc",{get:function(){return this.constants.growth.engagementSurfaces.actionKey.enableMultiWindowAndReloadApp.params},enumerable:!0,configurable:!0}),e.prototype.handleAction=function(e){for(var t=this,n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];if(!n||1!=n.length){r="Action handler "+this.actionKey+": expects 1 argument, received "+JSON.stringify(n);return this.logger.error(r),e.close(),this.$qNoApply.reject(r)}if(!this.callingMultiWindowService.isCallingMultiWindowEnabledUserSettingAvailable()){var r="Action handler "+this.actionKey+": expects callingMultiWindowService.isCallingMultiWindowEnabledUserSettingAvailable to be true";return this.logger.error(r),e.close(),this.$qNoApply.reject(r)}var i=n[0];return i?(this.callingMultiWindowService.setCallingMWUserPreference(i),e.close(),this.$qNoApply.resolve().then(function(){t.layoutService.reloadApp(t.resources.strings.refresh_message_default)})):(e.close(),this.logger.info("Action handler "+this.actionKey+": user did not enable MultiWindow"),this.$qNoApply.resolve())},e}();t.EnableMultiWindowAndReloadAppActionHandler=a,angular.module("teamspace.enableMultiWindowAndReloadAppActionHandler",["teamspace.callingMultiWindowService","teamspace.constants","teamspace.layoutService"]).service("enableMultiWindowAndReloadAppActionHandler",a)}},[2285]);