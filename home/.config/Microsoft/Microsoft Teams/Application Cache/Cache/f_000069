webpackJsonp([21],{2219:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n(2220)},2220:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)},i=this&&this.__awaiter||function(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var s=n(2221),c=n(88),l=n(309),u=n(2222),p=n(2223),f=n(2225),d=n(2229),h=function(e){function t(t,n,r,a,i,o,s,c,l,u,p,f,d){var h=e.call(this,l)||this;return h.constants=t,h.utilityService=n,h.settingsService=r,h.authenticationService=a,h.sxConfig=i,h.localizationService=o,h.eventingService=s,h.appStateService=c,h.loggingService=u,h.logger=p,h.actionCallbacks=f,h.dataCallbacks=d,h.changeTheme=function(e){var t=window.LPC;t&&t.loadTheme(h.getTheme(e))},h.initializeOnAppLaunchAndReinit("First Initialize"),h}return r(t,e),Object.defineProperty(t.prototype,"isLivePersonaCardInitialized",{get:function(){return!(null==this.lpcPromise||null==window.LPC)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isLivePersonaCardEnabled",{get:function(){return!!this.settingsService.valueAsBoolean(this.constants.settings.names.enableLivePersonaCard)},enumerable:!0,configurable:!0}),t.prototype.mtmaTelemetryIdentifier=function(){return"LivePersonaCardService"},t.prototype.cleanupOnAppTeardown=function(e){this.logger.log("LivePersonaCardService onAppTeardown: reason = {0}",e),this.lpcPromise=null,window.LPC=null,this.unbsubscribeFromAppStateChanges&&(this.unbsubscribeFromAppStateChanges(),this.unbsubscribeFromAppStateChanges=null)},t.prototype.initializeOnAppLaunchAndReinit=function(e){var t=this;this.logger.log("LivePersonaCardService Initialize reason {0}",e),this.eventingService.unsafeOnWithTenantScope(this.constants.events.layout.themeChanged,function(e,n){t.isLivePersonaCardInitialized&&t.changeTheme(n)}),this.unbsubscribeFromAppStateChanges&&this.unbsubscribeFromAppStateChanges(),this.unbsubscribeFromAppStateChanges=this.eventingService.unsafeOnWithTenantScope(this.constants.events.appState.changed,function(e,n){t.onAppStateChanged(n)})},t.prototype.initializeLPC=function(){return i(this,void 0,void 0,function(){var e,t,n,r,i,c,l,u,p,f,d,h,g,v;return o(this,function(o){if(this.isLivePersonaCardInitialized)return[2,this.lpcPromise];if(e=this.loggingService.newScenario("LivePersonaCard_Initialize"),t=this.utilityService.generateUUID(),n=this.localizationService.getLocale(),r=this.settingsService.getVersion().clientVersion,i=this.settingsService.isInternalRing(),c=this.authenticationService.getUserTypeInTenant(),l=this.sxConfig.getCurrentSkypeMri(),u=c===teamspace.services.UserTypeInTenant.Guest,p=i&&!u?"df":"",!this.appStateService.isOnline)throw v="App is Offline",e.fail({message:v,clientCorrelationId:t,lpcRegion:p,userTypeInTenant:c}),new Error(v);f=this.getTeamsConfig(t,n,p),d=this.settingsService.getRing(),this.logger.info("Client Correlation ID for LivePersonaCard in Teams Main Window: clientCorrelationId="+t);try{return h=d&&d.id?d.id:void 0,g=r,this.lpcPromise=s.initializeLivePersonaCardAsync(a(a({},f),{actionCallbacks:this.actionCallbacks,dataCallbacks:this.dataCallbacks,getAuthToken:this.getAuthToken(t),logMessage:function(e,t,n){this.logger.debug("LogType="+e+", LogResultType="+t+", Message="+n)},theme:this.getTheme(this.settingsService.getActiveTheme()),hostAppRing:h,hostAppVersion:g,options:{hostAppRing:h,hostAppVersion:g,isLoggedInAsTeamsGuestUser:u},loggedInUserTeamsMri:l})),this.lpcPromise.then(function(){var n=window.LPC&&window.LPC.version||"";e.stop({message:"LivePersonaCard loaded",version:n,clientCorrelationId:t,lpcRegion:p,userTypeInTenant:c})}).catch(function(n){throw e.fail({message:"Could not load LivePersonaCard",clientCorrelationId:t,lpcRegion:p,userTypeInTenant:c}),n}),[2,this.lpcPromise]}catch(n){throw v="Could not load live persona card: "+n,e.fail({message:v,clientCorrelationId:t,lpcRegion:p,userTypeInTenant:c}),new Error(v)}return[2]})})},t.prototype.createLPC=function(e,t){var n=t.profile,r=t.behavior,i=t.ariaLabel,o=t.externalAppSessionCorrelationId,s=t.disableAccessibilityDefaults,c=t.tabIndex,u=t.clientScenario,p=t.isSharedChannel,f=t.hostTenantId,d=t.hostConversationId,h=t.isExchangeOnlyContact,g=t.contactId;{if(this.isLivePersonaCardInitialized){var v=l.determineLPCPersonaType(n.role,n.type),m=l.getCleanUpn(n.userPrincipalName),y={personaInfo:{identifiers:{PersonaType:v,AadObjectId:n.objectId,TeamsMri:n.mri,OlsPersonaId:g,HostAppPersonaId:l.serializeHostAppPersonaId({userId:n.mri,isSharedChannel:p,hostTenantId:f,hostConversationId:d,isExchangeOnlyContact:h}),Upn:m,Smtp:n.email},skypeId:n.skypeId},behavior:a({disableHover:!1,locationToOpen:"Card",cardPlacementMode:"AnchorSide"},r),ariaLabel:i,disableAccessibilityDefaults:!!s,tabIndex:c,externalAppSessionCorrelationId:o,clientScenario:u};this.attachHoverTargetAsync(e,y);var b=function(){window.requestIdleCallback&&window.requestIdleCallback(function(){window.LPC&&window.LPC.removedPersonaFromPage(e)})}.bind(this);return{destroy:function(){b()}}}this.logger.error("Not initialized")}},t.prototype.onAppStateChanged=function(e){var t=e.prevState,n=t===teamspace.services.ApplicationState.Offline||t===teamspace.services.ApplicationState.Disconnected||t===teamspace.services.ApplicationState.Disabled;this.appStateService.isOnline&&n&&!this.isLivePersonaCardInitialized&&(s.freeBootstrapperMemory(window),this.initializeLPC())},t.prototype.attachHoverTargetAsync=function(e,t){window.LPC.addedPersonaToPageV2(e,t)},t.prototype.getTheme=function(e){switch(e){case c.LpcTheme.Dark:case c.LpcTheme.DarkV2:return f.darkTheme;case c.LpcTheme.HighContrast:return f.highContrastTheme;case c.LpcTheme.Default:case c.LpcTheme.DefaultV2:default:return f.defaultTheme}},t.prototype.getTeamsConfig=function(e,t,n){var r=this.settingsService.valueFor(this.constants.settings.names.lpcComplianceEnvironment),a=this.authenticationService.isCurrentUserTFLOrMsaAccount();return{culture:t||window.navigator.language||"en-us",region:n,clientCorrelationId:e,clientType:"MicrosoftTeamsAngular",clientContextType:"Generic",complianceEnvironment:r,options:{isImmersiveProfileEnabled:!1,isLinkedInIntegrationEnabled:!1},isConsumer:a}},t.prototype.getAuthToken=function(e){var t=this;return function(n,r){return i(t,void 0,void 0,function(){var t,a,i,s,c,l;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),t=this.constants.settings.names,a=t.lokiTokenResourceUrl,i=t.enableSilentLokiAuthTokenRetrieval,s=this.settingsService.valueAsBoolean(i),[4,this.authenticationService.getAuthTokens([this.settingsService.valueFor(a)],[],s)];case 1:return(c=o.sent())?n(c,e):r("Error retrieving auth token",e),[3,3];case 2:return l=o.sent(),this.logger.error("Error acquiring access token for LOKI"),r("Error retrieving auth token",e),[3,3];case 3:return[2]}})})}},t}(teamspace.services.MTMABase);t.LivePersonaCardService=h,angular.module("teamspace.lpcService",["teamspace.loggingService","teamspace.authenticationService","teamspace.dialogService","teamspace.utilityService","teamspace.peopleService","teamspace.navigationService","teamspace.conversationsService","teamspace.localizationService","teamspace.eventingService","teamspace.messageService","teamspace.settingsService","teamspace.callingUserActionService","teamspace.presenceManagerService","teamspace.htmlSanitizer","teamspace.dateFormatService","teamspace.platformDetectService"]).factory("lpcService",["constants","callingPolicyStore","messagingPolicySettingsStore","utilityService","settingsService","loggingService","authenticationService","$rootScope","navigationService","conversationsService","localizationService","eventingService","messageService","peopleService","dialogService","callingUserActionService","presenceManagerService","htmlSanitizer","dateFormatService","presenceService","$translate","resources","timeagoCalcService","platformDetectService","profilePictureLoaderService","orchestrationService","analyticsService","callBlockingService","appStateService","sxConfig","flatContactListService",function(e,t,n,r,a,i,o,s,c,l,f,g,v,m,y,b,C,S,P,T,k,w,A,L,I,O,x,M,U,E,_){var F=i.newLogger("LivePersonaCardService"),G=new d.LpcTelemetryHelper(x,i,l),D=G.logPanelActionEvent.bind(G),R=o.getUserTypeInTenant(),H=u.LPCActionCallbackFactory(s,e,F,m,l,c,b,v,M,y,D),N=p.LPCDataCallbackFactory(F,l,C,m,r,S,P,a,e,T,k,w,A,L,f,I,M,t,n,R,E,o,_);return new h(e,r,a,o,E,f,g,U,O,i,F,H,N)}])},2221:function(e,t,n){!function(t,n){e.exports=n()}(window,function(){return function(e){function t(t){for(var n,r,i=t[0],o=t[1],s=0,l=[];s<i.length;s++)r=i[s],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&l.push(a[r][0]),a[r]=0;for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(e[n]=o[n]);for(c&&c(t);l.length;)l.shift()()}function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}var r={},a={1:0};n.e=function(e){var t=[],r=a[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise(function(t,n){r=a[e]=[t,n]});t.push(r[2]=i);var o,s=document.createElement("script");s.charset="utf-8",s.timeout=120,n.nc&&s.setAttribute("nonce",n.nc),s.src=function(e){return n.p+""+({0:"feed-bootstrapper",2:"topic-card-bootstrapper",3:"vendors~aria-webjs-sdk"}[e]||e)+"_"+{0:"c07844ee995b75b027c0",2:"b2583c09f988cbab4e8b",3:"7c361ca8b46eea452880"}[e]+".js"}(e),0!==s.src.indexOf(window.location.origin+"/")&&(s.crossOrigin="anonymous");var c=new Error;o=function(t){s.onerror=s.onload=null,clearTimeout(l);var n=a[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",c.name="ChunkLoadError",c.type=r,c.request=i,n[1](c)}a[e]=void 0}};var l=setTimeout(function(){o({type:"timeout",target:s})},12e4);s.onerror=s.onload=o,document.head.appendChild(s)}return Promise.all(t)},n.m=e,n.c=r,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://lpcres.delve.office.com/lpc/versionless/",n.oe=function(e){throw console.error(e),e};var i=window.webpackJsonpMidgardBootstrapper=window.webpackJsonpMidgardBootstrapper||[],o=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var c=o;return n(n.s=11)}([function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(e,t,n,r,a){this.name=e,this.message=t,this.rootCorrelationId=n,this.statusCode=r,this.numberOfRetries=a}},function(e,t,n){"use strict";var r;n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a}),function(e){e.getAuthToken="GetAuthTokenDuration",e.getAuthTokenFromStart="GetAuthTokenFromStartDuration",e.getLokiConfig="GetLokiConfigDuration",e.getLokiConfigFromStart="GetLokiConfigFromStartDuration",e.getLpcBundles="GetLpcBundlesDuration",e.getLpcBundlesFromStart="GetLpcBundlesFromStartDuration",e.startLpc="StartLpcDuration",e.startLpcFromStart="StartLpcFromStartDuration",e.getOfficeFeedBundles="GetOfficeFeedBundlesFromStartDuration"}(r||(r={}));var a=function(){function e(e){this.targetWindow=e,this.start=this.getCurrentTime(),this.timings={}}return e.prototype.measureFromStart=function(e){this.timings[e]=Math.round(this.getCurrentTime()-this.start)},e.prototype.startCustomTiming=function(e){try{this.targetWindow.performance.mark(e+"-start")}catch(e){}},e.prototype.endCustomTiming=function(e){try{this.targetWindow.performance.mark(e+"-end"),this.targetWindow.performance.measure(e,e+"-start",e+"-end");var t=this.targetWindow.performance.getEntriesByName(e)[0];this.timings[e]=Math.round(t.duration)}catch(e){}},e.prototype.getAllTimings=function(){var e=this;try{var t=this.targetWindow.performance.getEntriesByType("resource");t&&t.forEach(function(t){if(t&&t.name){var n=t.name.toLowerCase(),r=!1;-1!==n.indexOf("authtoken/loki")?(n="AuthRequestDuration",r=!0):-1!==n.indexOf("service.svc?action=getclientaccesstoken&ep=1&app=mail")?(n="AuthRequestDuration",r=!0):-1!==n.indexOf("/lpc/versionless/livepersonacard_")?(n="LpcBundleRequestDuration",r=!0):-1!==n.indexOf("/lpc/versionless/livepersonacardstrings")?(n="LpcStringsRequestDuration",r=!0):-1!==n.indexOf("/api/v1/configuration/")&&(n="InitConfigRequestDuration",r=!0),r&&(e.timings[n]=Math.round(t.duration))}})}catch(e){}return this.timings},e.prototype.getCurrentTime=function(){return this.targetWindow.performance&&"function"==typeof this.targetWindow.performance.now?performance.now():Date.now()},e}()},function(e,t,n){"use strict";function r(e){var t=e.targetWindow||window,n=l.get(t);return n||(n={bootstrapperConfig:c(c({},e),{targetWindow:t}),ariaLogger:new s(e),initializationPromise:void 0,forceRefreshInitializationPromise:!1,forceRefreshInitializationTimeout:void 0}),l.set(t,n),n}function a(e){var t=l.get(e);if(t){var n=t.bootstrapperConfig.targetWindow;n&&(delete n.LPC,delete n.LivePersonaCardHoverTarget,delete n.LivePersonaCardHoverTargetV2,delete n.LivePersonaCardStrings,delete n.LivePersonaCardStringsLpcMini,delete n.OfficeFeed,delete n.OfficeFeedStrings,delete n.MeetingInsightsV2,delete n.MidgardBootstrapper,delete n.PersonaInsightRing),delete t.bootstrapperConfig.targetWindow,delete t.ariaLogger,delete t.initializationPromise,delete t.bootstrapperConfig,clearTimeout(t.forceRefreshInitializationTimeout)}l.delete(e)}n.d(t,"b",function(){return r}),n.d(t,"a",function(){return a});var i=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((r=r.apply(e,t||[])).next())})},o=function(e,t){function n(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}var r,a,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},s=function(){function e(e){this.bootstrapperConfig=e,this.loggers=new Map}return e.prototype.logEventAsync=function(e,t){return i(this,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),[4,this.getLoggerAsync(t)];case 1:return n.sent().logEvent(e),[4,this.getLogManagerAsync()];case 2:return n.sent().flush(this.noOp),[3,4];case 3:return n.sent(),console.log("Live Persona Card ERROR: Failed to log an event to Aria"),[3,4];case 4:return[2]}})})},e.prototype.updateContextWithLokiDataAsync=function(e,t){return i(this,void 0,void 0,function(){var n;return o(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.getLoggerAsync(t)];case 1:return(n=r.sent()).setContext("LokiUrl",e.LokiUrl),n.setContext("tenantAadObjectId",e.TenantAadObjectId),n.setContext("userAadObjectId",e.UserAadObjectId),n.setContext("userPuid",e.UserPuid),[3,3];case 2:throw r.sent(),new Error("Live Persona Card ERROR: Failed to update Aria's context");case 3:return[2]}})})},e.prototype.getLoggerAsync=function(e){return i(this,void 0,void 0,function(){var t,n,r;return o(this,function(a){switch(a.label){case 0:return(t=this.loggers.get(e))?[3,3]:[4,this.getLogManagerAsync()];case 1:return n=a.sent(),[4,this.getCollectorUrlAsync()];case 2:r=a.sent(),(t=n.initialize(e,{collectorUri:r}))||(t=n.getLogger(e)),this.loggers.set(e,t),t.setContext("culture",this.bootstrapperConfig.culture),t.setContext("region",this.bootstrapperConfig.region),t.setContext("clientType",this.bootstrapperConfig.clientType),t.setContext("clientContextType",this.bootstrapperConfig.clientContextType),t.setContext("clientCorrelationId",this.bootstrapperConfig.clientCorrelationId),t.setContext("bootstrapperVersion","1.20200825.12.0"),t.setContext("complianceEnvironment",this.bootstrapperConfig.complianceEnvironment),a.label=3;case 3:return[2,t]}})})},e.prototype.getLogManagerAsync=function(){return i(this,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,n.e(3).then(n.t.bind(null,43,7))];case 1:return[2,e.sent().AWTLogManager]}})})},e.prototype.getCollectorUrlAsync=function(){return i(this,void 0,void 0,function(){var e;return o(this,function(t){switch(t.label){case 0:return[4,n.e(3).then(n.t.bind(null,43,7))];case 1:switch(e=t.sent(),this.bootstrapperConfig.complianceEnvironment){case"Blackforest":return[2,e.AWT_COLLECTOR_URL_GERMANY];case"GccHigh":return[2,e.AWT_COLLECTOR_URL_USGOV_DOJ];case"DoD":return[2,e.AWT_COLLECTOR_URL_USGOV_DOD];case"Gallatin":case"GccModerate":case"Prod":default:return[2,void 0]}return[2]}})})},e.prototype.noOp=function(){},e}(),c=function(){return(c=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},l=new Map},function(e,t,n){"use strict";function r(e,t,n){try{n.sessionStorage&&n.sessionStorage.setItem&&n.sessionStorage.setItem(e,t)}catch(e){}}function a(e,t,n){return new Promise(function(a,s){e?(r(o,e,n),a(e)):t(function(e,t){e?(r(o,e,n),a(e)):s(new i.a("GetAuthTokenError","Auth token is undefined",t))},function(e,t){var n=function(e){return/^AADSTS\d+?:/.test(e)}(e)?e:"";s(new i.a("GetAuthTokenError",n,t))})})}n.d(t,"a",function(){return a});var i=n(0),o="LokiAuthToken"},function(e,t,n){"use strict";function r(e){var t={};return Object.keys(e).forEach(function(n){t["Perf_"+n]=e[n].toString()}),t}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=3e5},function(e,t,n){"use strict";function r(e,t){var n=this,r=0,i=function(e,t){return o(n,void 0,void 0,function(){var n;return s(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,6]),[4,a(e,t)];case 1:return o.sent(),[3,6];case 2:return n=o.sent(),r<c?(r++,[4,i(e,t)]):[3,4];case 3:return o.sent(),[3,5];case 4:throw n.numberOfRetries=r,n;case 5:return[3,6];case 6:return[2]}})})};return i(e,t)}function a(e,t){return new Promise(function(n,r){var a=t.document.createElement("script");a.type="text/javascript",a.charset="utf-8",a.crossOrigin="anonymous",a.src=e,a.addEventListener("load",function(){n()}),a.addEventListener("error",function(){r(new i.a("LoadScriptError","Unexpected error while loading script on page."))}),t.document.body.appendChild(a)})}n.d(t,"a",function(){return r});var i=n(0),o=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((r=r.apply(e,t||[])).next())})},s=function(e,t){function n(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}var r,a,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},c=2},function(e,t,n){"use strict";function r(e){switch(e.complianceEnvironment){case"Blackforest":return i;case"GccHigh":return o;case"DoD":return s;case"Gallatin":return c;case"GccModerate":case"Prod":default:return a}}n.d(t,"a",function(){return r});var a="e5ad760145754ffc9704e67c800087f2-dc72ff20-3e8a-401a-b9a8-ec72e4dd3e22-7257",i="e5ad760145754ffc9704e67c800087f2-fe4f92a6-9453-4f06-a3f9-52484ba9c6a1-7193",o="e5ad760145754ffc9704e67c800087f2-5eda57b1-3b30-42c8-a461-bf3c6ee769d8-7057",s="e5ad760145754ffc9704e67c800087f2-e57f210b-942a-4f32-aaa3-2fd7b8d44a62-7359",c="e5ad760145754ffc9704e67c800087f2-e2685720-0f91-4c64-acd6-32359f3b1c29-6998"},function(e,t,n){"use strict";function r(e){return{ErrorType:e.name,ErrorMessage:e.message||"",RootCorrelationId:e.rootCorrelationId||"",IsClientOnline:navigator&&void 0!==typeof navigator.onLine?navigator.onLine:""}}n.d(t,"a",function(){return r})},function(e,t,n){"use strict";function r(e,t){var n=function(e){return"df"===e?c.Dogfood:"msit"===e?c.MSIT:void 0}(e);return n||(n=function(e){switch(e){case"Blackforest":return c.Blackforest;case"GccModerate":return c.GccModerate;case"GccHigh":return c.GccHigh;case"DoD":return c.DOD;case"Gallatin":return c.Gallatin;case"Prod":return c.TopLevel;case"Unknown":throw new Error("'Unknown' is not an expected environment type in Loki");default:return e}}(t)),n}function a(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(t.location.search),r=t.decodeURIComponent||window.decodeURIComponent;return null===n?"":r&&r(n[1].replace(/\+/g," "))||""}function i(e,t,n){return s(function(e,t){var n=t||e.culture,a=r(e.region,e.complianceEnvironment);return l.replace("{0}",a).replace("{1}",n)}(t,a(v,n)),e,d(d({},t),{clientFeature:"LivePersonaCard"}),n)}function o(e,t,n){return s(function(e,t){var n=t||e.culture,a=r(e.region,e.complianceEnvironment);return u.replace("{0}",a).replace("{1}",n)}(t,a(v,n)),e,d(d({},t),{clientFeature:"OfficeFeed"}),n)}function s(e,t,n,r){return new Promise(function(i,o){var s=new XMLHttpRequest;s.open("GET",e,!0),s.setRequestHeader("authToken",t),s.setRequestHeader("Accept","application/json");var c=f.replace(/[xy]/g,function(e){var t;if(window.crypto){var n=new Uint8Array(1);window.crypto.getRandomValues(n),t=n[0]}else t=Math.floor(16*Math.random());return("x"===e?t%16:t%4+8).toString(16)});s.setRequestHeader("X-RootCorrelationId",c),s.setRequestHeader("X-CorrelationId",c),s.setRequestHeader("X-ClientCorrelationId",n.clientCorrelationId),s.setRequestHeader("X-ClientType",n.clientType),s.setRequestHeader("X-ClientFeature",n.clientFeature),n.hostAppRing&&s.setRequestHeader("X-HostAppRing",n.hostAppRing),n.hostAppVersion&&s.setRequestHeader("X-HostAppVersion",n.hostAppVersion),r&&r.React&&r.React.version&&r.ReactDOM&&s.setRequestHeader("X-HostAppReactVersion",r.React.version);var l=a(m,r)||a(g,r);l&&(s.setRequestHeader(g,l),s.setRequestHeader(m,l));var u=a(y,r);u&&s.setRequestHeader(y,u),s.addEventListener("load",function(){if(200===s.status)try{var e=JSON.parse(s.response);e.RootCorrelationId=c,e.LokiVersion=s.getResponseHeader("x-serverversion")||"",i(e)}catch(e){o(new p.a("GetLokiConfigError","Failed to parse initialization config.",c))}else o(new p.a("GetLokiConfigError","Couldn't retrieve initialization config. Status code is "+s.status,c,s.status))}),s.addEventListener("error",function(){o(new p.a("GetLokiConfigError","Couldn't retrieve initialization config, request failed to complete.",c))}),s.addEventListener("timeout",function(){o(new p.a("GetLokiConfigError","Loki config request timed out after "+h+" ms.",c))}),s.timeout=h,s.send()})}n.d(t,"a",function(){return i}),n.d(t,"b",function(){return o});var c;!function(e){e.TopLevel="https://loki.delve.office.com",e.Blackforest="https://loki.delve.office.de",e.GccModerate="https://gcc.loki.delve.office.com",e.GccHigh="https://gcchigh.loki.office365.us",e.DOD="https://dod.loki.office365.us",e.Gallatin="https://loki.office365.cn",e.Dogfood="https://df.loki.delve.office.com",e.LegacyDogfood="https://sfdf.loki.delve.office.com",e.MSIT="https://msit.loki.delve.office.com",e.LegacyMSIT="https://sfmsit.loki.delve.office.com"}(c||(c={}));var l="{0}/api/v1/livepersonacard/configuration?cultureName={1}",u="{0}/api/v1/officefeed/configuration?cultureName={1}&returnResources=true",p=n(0),f="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx",d=function(){return(d=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},h=6e4,g="LivePersonaCardVersionOverride",v="LivePersonaCardCultureOverride",m="MidgardVersion",y="MidgardBranch"},function(e,t,n){"use strict";function r(e){return void 0===e||"string"!=typeof e||""===e||null===e}function a(e){return void 0===e||"function"!=typeof e}function i(e){var t="";if(e){var n=[];r(e.culture)&&n.push("culture"),r(e.clientType)&&n.push("clientType"),r(e.clientContextType)&&n.push("clientContextType"),r(e.clientCorrelationId)&&n.push("clientCorrelationId"),a(e.logMessage)&&n.push("logMessage"),a(e.getAuthToken)&&n.push("getAuthToken"),n.length>0&&(t="Invalid required parameter(s): "+n.join(", ")+". Check the values and types you're passing. "),e.region&&-1===s.indexOf(e.region.toLowerCase().trim())&&(t+="Invalid region value. Allowed values are: empty string for production environments, and "+s.join(", ")+" for pre-production environments. "),-1===c.indexOf(e.complianceEnvironment)&&(t+="Environment is missing or wrong. Allowed values are: "+c.join(", ")+". We currently don't support other Sovereign Clouds.")}else t="Config must be defined.";if(t)throw new o.a("ValidateBootstrapperConfigError",t)}n.d(t,"a",function(){return i});var o=n(0),s=["msit","df","ppe"],c=["Prod","Blackforest","GccModerate","GccHigh","DoD","Gallatin"]},function(e,t,n){"use strict";function r(e,t,n){return m(this,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:return(i=Object(v.b)(t)).lpcConfig?(r=i.lpcConfig,[3,3]):[3,1];case 1:return[4,a(e,t,n)];case 2:r=o.sent(),i.lpcConfig=r,o.label=3;case 3:return[2,r]}})})}function a(e,t,n){return m(this,void 0,void 0,function(){var r,i;return y(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,8]),[4,Object(g.a)(e,t,n)];case 1:return r=o.sent(),[3,8];case 2:return(i=o.sent()).statusCode&&401===i.statusCode?[4,Object(h.a)(void 0,t.getAuthToken,n)]:[3,4];case 3:e=o.sent(),o.label=4;case 4:return C<b?(C++,[4,a(e,t,n)]):[3,6];case 5:return r=o.sent(),[3,7];case 6:throw i.numberOfRetries=C,i;case 7:return[3,8];case 8:return[2,r]}})})}function i(e,t){var n=e.ResourceUrls||[];if(0===n.length){var r=e.Resources[k],a=e.Resources[P];"OwaPeopleHub"===e.Workload&&(a=e.Resources[T]),n=[r,a]}return Promise.all(n.map(function(e){return Object(S.a)(e,t)})).then(function(){return n})}function o(e,t){var n=t.targetWindow;return new Promise(function(r,a){setTimeout(function(){try{n.LPC||a(new w.a("StartLivePersonaCardError","targetWindow.LPC is undefined.")),n.LivePersonaCardStrings&&n.LivePersonaCardStrings.strings||n.LivePersonaCardStringsLpcMini&&n.LivePersonaCardStringsLpcMini.strings||a(new w.a("StartLivePersonaCardError","targetWindow.LivePersonaCardStrings is undefined."));var i=function(e,t){var n=t.targetWindow;return{refreshAuthToken:s(t),logToExternalApplication:t.logMessage,contextType:t.clientContextType,strings:n.LivePersonaCardStringsLpcMini&&n.LivePersonaCardStringsLpcMini.strings||n.LivePersonaCardStrings&&n.LivePersonaCardStrings.strings,source:t.clientType,consumerCorrelationId:t.clientCorrelationId,activeFlights:e.Flights,isDebug:!1,culture:t.culture,dataCallbacks:t.dataCallbacks,actionCallbacks:t.actionCallbacks,dataUpdateBroadcaster:t.dataUpdateBroadcaster,privateDataCallbacks:t.privateDataCallbacks,options:t.options?t.options:{hideDocumentFilter:!1},theme:t.theme,lokiUrl:e.LokiUrl,lokiVersion:e.LokiVersion,tenantAadObjectId:e.TenantAadObjectId,userAadObjectId:e.UserAadObjectId,userPuid:e.UserPuid,ecsConfigIds:e.EcsConfigIds,ecsETag:e.EcsEtag,loggedInUserUpn:e.Upn,loggedInUserTeamsMri:t.loggedInUserTeamsMri,complianceEnvironment:t.complianceEnvironment,userDisplayName:e.UserDisplayName}}(e,t);n.LPC.start(i),r()}catch(e){a(new w.a("StartLivePersonaCardError",e.name))}},0)})}function s(e){return function(t){e.getAuthToken(function(e,n){t(e,"",n,void 0)},function(e,n){t("",e,n,void 0)})}}function c(e){return U(this,void 0,void 0,function(){var t,n,a,s,c=this;return E(this,function(l){return t=Object(v.b)(e),n=function(){return Object(v.b)(e).ariaLogger},!t.forceRefreshInitializationPromise&&t.initializationPromise?[2,t.initializationPromise]:(a=t.bootstrapperConfig.targetWindow,s=new O.a(a),t.forceRefreshInitializationPromise=!1,t.initializationPromise=new Promise(function(l,u){return U(c,void 0,void 0,function(){var c,p,f,d,g,v;return E(this,function(m){switch(m.label){case 0:c=Object(A.a)(e),m.label=1;case 1:return m.trys.push([1,7,,8]),Object(x.a)(e),s.startCustomTiming(O.b.getAuthToken),[4,Object(h.a)(e.authToken,e.getAuthToken,a)];case 2:return p=m.sent(),s.endCustomTiming(O.b.getAuthToken),s.measureFromStart(O.b.getAuthTokenFromStart),s.startCustomTiming(O.b.getLokiConfig),[4,r(p,e,a)];case 3:return f=m.sent(),s.endCustomTiming(O.b.getLokiConfig),s.measureFromStart(O.b.getLokiConfigFromStart),s.startCustomTiming(O.b.getLpcBundles),[4,i(f,a)];case 4:return m.sent(),s.endCustomTiming(O.b.getLpcBundles),s.measureFromStart(O.b.getLpcBundlesFromStart),s.startCustomTiming(O.b.startLpc),[4,o(f,t.bootstrapperConfig)];case 5:return m.sent(),s.endCustomTiming(O.b.startLpc),s.measureFromStart(O.b.startLpcFromStart),[4,n().updateContextWithLokiDataAsync(f,c).catch(function(){console.log("Live Persona Card ERROR: Bootstrapper failed to initialize Aria, continuing without.")})];case 6:return m.sent(),(d=Object(I.a)(s.getAllTimings())).RootCorrelationId=f.RootCorrelationId,d.isConsumer=e.isConsumer,n().logEventAsync({name:"initializeLivePersonaCard_success",properties:d},c),l(),[3,8];case 7:return g=m.sent(),v=Object(I.a)(s.getAllTimings()),n().logEventAsync({name:"initializeLivePersonaCard_failure",properties:M(M(M({},Object(L.a)(g)),v),{isConsumer:e.isConsumer})},c),u("Failed to initialize Live Persona Card: "+g.name+" "+g.message),[3,8];case 8:return[2]}})})}),t.initializationPromise.catch(function(){t.forceRefreshInitializationTimeout=setTimeout(function(){t&&(t.forceRefreshInitializationPromise=!0)},d.a)}),[2,t.initializationPromise])})})}function l(e){Object(v.a)(e)}function u(e){return U(this,void 0,void 0,function(){var t;return E(this,function(n){switch(n.label){case 0:return t=Object(v.b)(e),[4,Object(h.a)(e.authToken,e.getAuthToken,t.bootstrapperConfig.targetWindow)];case 1:return[2,r(n.sent(),e,t.bootstrapperConfig.targetWindow)]}})})}function p(e){return U(this,void 0,void 0,function(){var t;return E(this,function(r){return t=Object(v.b)(e),[2,n.e(2).then(n.bind(null,45)).then(function(e){return(0,e.initializeTopicCardAsync)(t.bootstrapperConfig)})]})})}function f(e){return U(this,void 0,void 0,function(){return E(this,function(t){switch(t.label){case 0:return[4,n.e(0).then(n.bind(null,44))];case 1:return[2,(0,t.sent().initializeOfficeFeedAsync)(e)]}})})}n.r(t),n.d(t,"initializeLivePersonaCardAsync",function(){return c}),n.d(t,"freeBootstrapperMemory",function(){return l}),n.d(t,"fetchLokiConfigAsync",function(){return u}),n.d(t,"lazyInitializeTopicCardAsync",function(){return p}),n.d(t,"lazyInitializeOfficeFeedAsync",function(){return f});var d=n(5),h=n(3),g=n(9),v=n(2),m=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((r=r.apply(e,t||[])).next())})},y=function(e,t){function n(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}var r,a,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},b=2,C=0,S=n(6),P="livepersonacard_with-react",T="livepersonacard_without-react",k="livepersonacardstrings",w=n(0),A=n(7),L=n(8),I=n(4),O=n(1),x=n(10),M=function(){return(M=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},U=function(e,t,n,r){return new(n||(n=Promise))(function(a,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n(function(e){e(t)})).then(o,s)}c((r=r.apply(e,t||[])).next())})},E=function(e,t){function n(n){return function(o){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,a&&(i=2&n[0]?a.return:n[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,n[1])).done)return i;switch(a=0,i&&(n=[2&n[0],i.value]),n[0]){case 0:case 1:i=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,a=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){s=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){s.label=n[1];break}if(6===n[0]&&s.label<i[1]){s.label=i[1],i=n;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(n);break}i[2]&&s.ops.pop(),s.trys.pop();continue}n=t.call(e,s)}catch(e){n=[6,e],a=0}finally{r=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}var r,a,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o};try{var _=window.document.createElement("link"),F=Boolean("onmscontentzoom"in window.document);_.rel=F?"dns-prefetch":"preconnect",_.href="https://lpcres.delve.office.com/",window.document.head.appendChild(_)}catch(e){console.log("Live Persona Card ERROR: Bootstrapper failed to warm up the connection to Midgard CDN.",e)}}])})},2222:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var i=n(88),o=function(e,t,n){return function(r){var a={slug:r.peopleSlug||r.slug,groupName:r.groupName||r.teamName,middlePane:r.middlePane,threadId:r.threadId,messageId:void 0,ctx:r.ctx,navCtx:e.navContext.livePersonaCard,appId:null};return n.navigatePromise(t,e.states.appConversation,a)}},s=function(e,t){return function(n,i){return void 0===i&&(i=!1),r(void 0,void 0,void 0,function(){var r;return a(this,function(a){return(r=e.getChatConversationWith(n))?[2,t.placeCall({conversationId:r.id,withVideo:i,context:teamspace.services.CallTelemetryContext.LivePersonCard,checkUserMode:!0,isChannelMeeting:!1})]:[2,Promise.reject("Cannot find the chat")]})})}},c=function(e,t){return function(n,r){var a=e.getChatConversationWith(n);if(!a)return Promise.reject("Cannot find the chat");var i=SkypeX.Services.Utilities.newClientMessageId();return t.createMessage({conversationId:a.id,replyChainId:null,messageSubject:null,messageBody:r,messagePreview:r,fileAttachments:null,extensions:null,mentions:null,inputExtensionAttachments:null,embeddedLinks:null,isHtml:!1,importance:null,clientId:i,externalId:null,draftObjectId:null,inlineImages:null})}},l=function(e,t,n,o,s,c){return function(l,u){var p=l.persona;return r(void 0,void 0,void 0,function(){var r,l,f,d,h,g;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t.info("LPC::Starting chat"),r=n.getFreshnessInMs(),l=e.scenarios.people.lpcStartChat,[4,n.getAllPeopleProfile([p.TeamsMri],l,!1,!1,r)];case 1:return f=a.sent()[0],d=o.getPrivateChatUserMri(f,l),[4,s({groupName:f.displayName,peopleSlug:d,middlePane:e.messages.panes.conversations,ctx:e.navigation.context.chat})];case 2:return a.sent(),u(!0),c(i.LpcCallbackTelemetryType.lpcStartChat,p.TeamsMri),[3,4];case 3:return h=a.sent(),g="Failed to navigate to chat",t.error(g),u(!1,g),[3,4];case 4:return[2]}})})}},u=function(e,t,n,o,s,c){return function(o,l){return r(void 0,void 0,void 0,function(){var r,u,p,f,d;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),t.info("LPC::Navigating to user's org chart"),r=n.getFreshnessInMs(),u=e.scenarios.people.lpcOrgChart,[4,n.getAllPeopleProfile([o.TeamsMri],u,!1,!1,r)];case 1:return p=a.sent()[0],[4,s({groupName:p.displayName,slug:o.TeamsMri,middlePane:e.peopleTab.panes.organization,ctx:e.navigation.context.chat})];case 2:return a.sent(),l(!0),c(i.LpcCallbackTelemetryType.lpcOrgChart,o.TeamsMri),[3,4];case 3:return f=a.sent(),d="Failed to navigate to org chat",t.error(d),l(!1,d),[3,4];case 4:return[2]}})})}},p=function(e,t,n){return function(o,s){return r(void 0,void 0,void 0,function(){var r,c;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e.info("LPC::Starting audio call"),[4,t(o.TeamsMri)];case 1:return a.sent(),s(!0),n(i.LpcCallbackTelemetryType.lpcAudioCall,o.TeamsMri),[3,3];case 2:return r=a.sent(),c="Failed to start audio call with",e.error(c),s(!1,c),[3,3];case 3:return[2]}})})}},f=function(e,t,n){return function(o,s){return r(void 0,void 0,void 0,function(){var r,c;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e.info("LPC::Starting video call"),[4,t(o.TeamsMri,!0)];case 1:return a.sent(),s(!0),n(i.LpcCallbackTelemetryType.lpcVideoCall,o.TeamsMri),[3,3];case 2:return r=a.sent(),c="Failed to start video call with",e.error(c),s(!1,c),[3,3];case 3:return[2]}})})}},d=function(e,t,n){return function(o,s,c){return r(void 0,void 0,void 0,function(){var r,l;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e.info("LPC::Sending message to user, message length {0}",s&&s.length),[4,t(o.TeamsMri,s)];case 1:return a.sent(),c(!0),n(i.LpcCallbackTelemetryType.lpcQuickIM,o.TeamsMri),[3,3];case 2:return r=a.sent(),l="Failed to send message",e.error(l),c(!1,l),[3,3];case 3:return[2]}})})}},h=function(e,t,n,o){return function(s,c){return r(void 0,void 0,void 0,function(){var r,l,u;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),e.info("LPC::Blocking contact"),(r=t.getChatConversationWith(s.TeamsMri))?[4,t.acceptBlockSfCChat(r.id,!1,"LivePersonaCard")]:[3,2];case 1:return a.sent(),[3,4];case 2:return[4,n.addBlockedMri(s.TeamsMri,"LivePersonaCard")];case 3:a.sent(),a.label=4;case 4:return c(!0),o(i.LpcCallbackTelemetryType.lpcBlockContact,s.TeamsMri),[3,6];case 5:return l=a.sent(),u="Failed to block contact",e.error(u),c(!1,u),[3,6];case 6:return[2]}})})}},g=function(e,t,n,o){return function(s,c){return r(void 0,void 0,void 0,function(){var r,l,u;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,5,,6]),e.info("LPC::Unblocking contact"),(r=t.getChatConversationWith(s.TeamsMri))?[4,t.acceptBlockSfCChat(r.id,!0,"LivePersonaCard")]:[3,2];case 1:return a.sent(),[3,4];case 2:return[4,n.deleteBlockedMri(s.TeamsMri,"LivePersonaCard")];case 3:a.sent(),a.label=4;case 4:return c(!0),o(i.LpcCallbackTelemetryType.lpcUnblockContact,s.TeamsMri),[3,6];case 5:return l=a.sent(),u="Failed to unblock contact",e.error(u),c(!1,u),[3,6];case 6:return[2]}})})}},v=function(e,t,n,o,s){return function(c,l){return r(void 0,void 0,void 0,function(){var r,u,p,f;return a(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),e.info("LPC::Edit Me Profile"),[4,o.getMeMSAProfile(n.scenarios.people.lpcEditProfile,!1)];case 1:return r=a.sent(),u=n.appHeaderBar.buttonid.profileButton,t.open(n.dialogs.updateUserProfile,{isFre:!1,preActiveElementIds:[u],user:r,isMSAEditNameClick:!0}),l(!0),s(i.LpcCallbackTelemetryType.lpcEditMeProfile,c.TeamsMri),[3,3];case 2:return p=a.sent(),f="Failed to edit me user profile",e.error(f),l(!1,f),[3,3];case 3:return[2]}})})}};t.LPCActionCallbackFactory=function(e,t,n,r,a,i,m,y,b,C,S){var P=o(t,e,i),T=s(a,m),k=c(a,y);return{startChat:l(t,n,r,a,P,S),showOrgChart:u(t,n,r,0,P,S),sendQuickMessage:d(n,k,S),startVideoCall:f(n,T,S),startAudioCall:p(n,T,S),blockContact:h(n,a,b,S),unblockContact:g(n,a,b,S),editMeProfile:v(n,C,t,r,S)}}},2223:function(e,t,n){"use strict";function r(e){return e&&validator.isEmail(e)}function a(e,t,n){var r=this;return function(a,i,o){return c(r,void 0,void 0,function(){var r,i,s,c,u,p;return l(this,function(l){switch(l.label){case 0:r=t.service.newScenario(n.scenarios.people.lpcGetOrgChart),i=a.TeamsMri||a.Smtp||a.Upn,l.label=1;case 1:return l.trys.push([1,3,,4]),[4,e.getOrgChart(i)];case 2:return(s=l.sent())?(c=f.getDirectReportsAndManager(s.value),r.stop(),o(c,void 0)):(p="No orgChart returned",t.error(p),r.stop({reason:p}),o(void 0,p)),[3,4];case 3:return u=l.sent(),p="Exception in orgChart call",t.error("getOrgChart failed in LPC data callback"),r.fail({reason:p}),o(void 0,p),[3,4];case 4:return[2]}})})}}function i(e,t,n,r,a,i){var o=this;return function(s,u,d){return c(o,void 0,void 0,function(){var o,c,u,h,g,v,m,y,b,C,S,P,T,k,w,A,I;return l(this,function(l){switch(l.label){case 0:o=t.service.newScenario(a.scenarios.people.lpcGetHeaderInfo),c=s.TeamsMri||s.Smtp||s.Upn,l.label=1;case 1:return l.trys.push([1,8,,9]),u=p.deserializeHostAppPersonaId(s.HostAppPersonaId),h=u.isSharedChannel,g=u.hostTenantId,v=u.hostConversationId,m=u.isExchangeOnlyContact,y=void 0,h?[4,e.getAllPeopleProfileForConversation([c],v,!1,a.scenarios.people.lpcGetHeaderInfoSC,void 0,h,g)]:[3,3];case 2:return y=l.sent(),o.mark(a.scenarios.people.lpcGetHeaderInfoSC),[3,7];case 3:return m?[4,f.getPersonaProfileByContactId(s.OlsPersonaId,t,i,o,a.scenarios.people.lpcGetHeaderInfoEC)]:[3,5];case 4:return(y=l.sent())?[3,7]:[2,d(void 0,"No profile returned for exchange contact in LPC getHeaderInfoAndCardType callback")];case 5:return[4,e.getAllPeopleProfile([c],a.scenarios.people.lpcGetHeaderInfo,!Boolean(s.TeamsMri))];case 6:y=l.sent(),o.mark(a.scenarios.people.lpcGetHeaderInfo),l.label=7;case 7:return(b=y[0])?(C=b,S=n.getCurrentSkypeMri(),P=S===s.TeamsMri,T=p.determineCardTypeForTargetUser(C.role,C.type,P),k=r.valueAsBoolean(a.settings.names.showOnlySearchablePhonesAndEmailsInLPC),w=L(T,C,k),o.stop(),d(w,void 0)):(I="No profile returned",t.error("getAllPeopleProfile returned no profile in LPC GetHeaderInfoAndCardType callback"),o.fail({reason:I}),d(void 0,I)),[3,9];case 8:return A=l.sent(),I="Exception in profile call",t.error("getAllPeopleProfile failed in LPC GetHeaderInfoAndCardType callback"),o.fail({reason:I}),d(void 0,I),[3,9];case 9:return[2]}})})}}function o(e,t,n,r,a){var i=this;return function(o,s){return c(i,void 0,void 0,function(){var i,c,u,d,h,g,v,m,y,b,C,S,P,T,k;return l(this,function(l){switch(l.label){case 0:i=t.service.newScenario(r.scenarios.people.lpcGetPersonaInfo),c=o.TeamsMri||o.Smtp||o.Upn,l.label=1;case 1:return l.trys.push([1,8,,9]),u=p.deserializeHostAppPersonaId(o.HostAppPersonaId),d=u.isSharedChannel,h=u.hostTenantId,g=u.hostConversationId,v=u.isExchangeOnlyContact,m=void 0,d?[4,e.getAllPeopleProfileForConversation([c],g,!1,r.scenarios.people.lpcGetPersonaInfoSC,void 0,d,h)]:[3,3];case 2:return m=l.sent(),i.mark(r.scenarios.people.lpcGetPersonaInfoSC),[3,7];case 3:return v?[4,f.getPersonaProfileByContactId(o.OlsPersonaId,t,a,i,r.scenarios.people.lpcGetPersonaInfoEC)]:[3,5];case 4:return(m=l.sent())?[3,7]:[2,s(void 0,"No profile returned for exchange contact in LPC getPersonaInfo callback")];case 5:return[4,e.getAllPeopleProfile([c],r.scenarios.people.lpcGetPersonaInfo,!Boolean(o.TeamsMri))];case 6:m=l.sent(),i.mark(r.scenarios.people.lpcGetPersonaInfo),l.label=7;case 7:return(y=m[0])?(b=y,C=d&&!!b.xtapUser,S=n.valueAsBoolean(r.settings.names.showOnlySearchablePhonesAndEmailsInLPC),P={hostAppPersonaId:o.HostAppPersonaId,aadObjectId:b.objectId,email:f.getEmail(b,S),extraEmails:f.getEmails(b,S),upn:b.userPrincipalName,userType:p.determineLPCPersonaType(b.role,b.type),displayName:b.displayName,firstName:b.givenName,lastName:b.surname,skypeId:b.skypeId,teamsMri:o.TeamsMri||b.mri,jobTitle:b.jobTitle,department:C?b.companyName:b.department,officeLocation:b.userLocation,phoneNumbersAndUrls:f.getPhoneNumbers(b,S)},i.stop(),s(P,void 0)):(k="No profile returned",t.error("getAllPeopleProfile returned no profile in LPC GetPersonaInfo callback"),i.fail({reason:k}),s(void 0,k)),[3,9];case 8:return T=l.sent(),k="Exception in profile call",t.error("getAllPeopleProfile failed in LPC GetPersonaInfo callback"),i.fail({reason:k}),s(void 0,k),[3,9];case 9:return[2]}})})}}var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e}).apply(this,arguments)},c=this&&this.__awaiter||function(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},l=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0});var u=n(88),p=n(309),f=n(2224);t.unescapeHtmlEntities=function(e){if(!e)return e;var t=document.createElement("textarea");return t.innerHTML=e,t.value};var d=function(e,t,n,a,i){return function(o,u){return c(void 0,void 0,void 0,function(){var c,d,h,g,v,m,y,b,C,S,P,T,k;return l(this,function(l){switch(l.label){case 0:if(c=e.service.newScenario(n.scenarios.people.lpcGetImageUri),d=p.deserializeHostAppPersonaId(o.HostAppPersonaId),h=d.isSharedChannel,g=d.hostTenantId,v=d.hostConversationId,m=d.isExchangeOnlyContact,y={mri:o.TeamsMri,principalName:o.Upn||o.Smtp||o.TeamsMri,displayName:o.DisplayName||"",size:n.profilePictureSizes.medium},b=r(y.principalName),C=h&&!b,o.DisplayName&&!C)return[3,9];S=o.TeamsMri||o.Smtp||o.Upn,l.label=1;case 1:return l.trys.push([1,8,,9]),P=void 0,h?[4,a.getAllPeopleProfileForConversation([S],v,!0,n.scenarios.people.lpcGetImageUriSC,void 0,h,g)]:[3,3];case 2:return P=l.sent(),c.mark(n.scenarios.people.lpcGetImageUriSC),[3,7];case 3:return m?[4,f.getPersonaProfileByContactId(o.OlsPersonaId,e,i,c,n.scenarios.people.lpcGetImageUriEC)]:[3,5];case 4:return P=l.sent(),[3,7];case 5:return[4,a.getAllShortPeopleProfile([S],n.scenarios.people.lpcGetImageUri,!Boolean(o.TeamsMri))];case 6:P=l.sent(),c.mark(n.scenarios.people.lpcGetImageUri),l.label=7;case 7:return(T=P[0])&&(y=s(s({},y),{displayName:T.displayName}),C&&(y=s(s({},y),{principalName:T.userPrincipalName}))),[3,9];case 8:return k=l.sent(),e.error("Failed to fetch persona profile in getAndPrefetchPersonaImageUri callback"),[3,9];case 9:return h&&(y=s(s({},y),{isSharedChannel:h,hostTenantId:g,conversationId:v})),m&&(y=s(s({},y),{isExchangeOnlyContact:m})),t.loadImage(y,!1,!1,!1,h?n.scenarios.people.lpcGetImageUriSC:n.scenarios.people.lpcGetImageUri).then(function(e){var t=e&&e.imgUrl||"";c.stop(),u(t,{})}).catch(function(e){c.fail({reason:"Failed to fetch persona"}),u(void 0,void 0,e)}),[2]}})})}};t.getSkypeConsumerChatStatus=function(e,t,n){var r=t.findConversationWith(n);if(r&&r.isSfC())return r.InteropConversationStatus()===e.interopConversationStatus.blocked?u.PersonaPresence.blocked:u.PersonaPresence.none};var h=function(e,n,r,a,i,o){var s=t.getSkypeConsumerChatStatus(r,a,o);if(void 0!==s)return s;if(i.isBlockedContact(o))return u.PersonaPresence.blocked;var c=e.status,l=e.flwPresence;if(n.valueAsBoolean(r.settings.names.enableFlwPresence)){if(l===SkypeX.Services.UserFlwPresence.OffShift)return u.PersonaPresence.offline;if(l===SkypeX.Services.UserFlwPresence.OnShift)switch(c){case SkypeX.Services.UserStatus.Busy:case SkypeX.Services.UserStatus.OnThePhone:case SkypeX.Services.UserStatus.InAMeeting:return u.PersonaPresence.busy;default:return u.PersonaPresence.online}}switch(c){case SkypeX.Services.UserStatus.Online:return u.PersonaPresence.online;case SkypeX.Services.UserStatus.Offline:case SkypeX.Services.UserStatus.OutOfOffice:case SkypeX.Services.UserStatus.Unknown:return u.PersonaPresence.offline;case SkypeX.Services.UserStatus.Away:case SkypeX.Services.UserStatus.Idle:case SkypeX.Services.UserStatus.BeRightBack:case SkypeX.Services.UserStatus.AppearAway:return u.PersonaPresence.away;case SkypeX.Services.UserStatus.Busy:case SkypeX.Services.UserStatus.InAMeeting:case SkypeX.Services.UserStatus.OnThePhone:return u.PersonaPresence.busy;case SkypeX.Services.UserStatus.OutToLunch:case SkypeX.Services.UserStatus.Presenting:case SkypeX.Services.UserStatus.Focusing:return u.PersonaPresence.dnd;default:return u.PersonaPresence.offline}},g=function(e,t,n,r,a,i,o){if(!t||0===t.length)return e;var s=r.getLocalTimezone();if(n&&s!==n){var c=(new Date).toLocaleDateString(a.getLocale(),{timeZoneName:"short"}).split(" "),l=c.length>0?c[c.length-1]:null;l&&(t=i.instant(o.strings.person_card_on_shift_end_time_with_timezone,{shiftEndTime:t,timeZoneCode:l}))}return i.instant(o.strings.person_card_on_shift_status_label,{onShiftStatus:e,shiftEndTime:t})},v=function(e,t,n,r,a,i,o,s,c){var l=e.status,u=e.calendarData,p=e.lastSeenAt,f=e.flwPresence,d=e.extensions;if(t.valueAsBoolean(a.settings.names.enableFlwPresence)){if(f===SkypeX.Services.UserFlwPresence.OffShift)return n.GetTranslatedStatusText(SkypeX.Services.UserStatus.OffShift);if(f===SkypeX.Services.UserFlwPresence.OnShift){var h=void 0,v=void 0,m=SkypeX.Services.UnifiedPresenceExtensionsParser.getShiftsData(d);switch(m&&m.currentShift&&(h=c.getDate(new Date(m.currentShift.endTime),"shortTime"),v=m.currentShift.teamOlsonCode),l){case SkypeX.Services.UserStatus.Busy:case SkypeX.Services.UserStatus.OnThePhone:case SkypeX.Services.UserStatus.InAMeeting:case SkypeX.Services.UserStatus.Presenting:var y=r.instant(i.strings.status_label_person_card_with_primary_and_secondary_status,{primaryStatus:n.GetTranslatedStatusText(l),secondaryStatus:n.GetTranslatedStatusText(SkypeX.Services.UserStatus.OnShift)});return g(y,h,v,s,c,r,i);default:var b=n.GetTranslatedStatusText(SkypeX.Services.UserStatus.OnShift);return g(b,h,v,s,c,r,i)}}}var C=p&&(new Date).getTime()-p.getTime()<=a.timeInMiliseconds.year;if(u&&u.isOutOfOffice)switch(l){case SkypeX.Services.UserStatus.Online:case SkypeX.Services.UserStatus.Busy:case SkypeX.Services.UserStatus.OnThePhone:case SkypeX.Services.UserStatus.InAMeeting:case SkypeX.Services.UserStatus.OutToLunch:case SkypeX.Services.UserStatus.Presenting:case SkypeX.Services.UserStatus.Focusing:return r.instant(i.strings.status_label_person_card_with_primary_and_secondary_status,{primaryStatus:n.GetTranslatedStatusText(l),secondaryStatus:n.GetTranslatedStatusText(SkypeX.Services.UserStatus.OutOfOffice)});case SkypeX.Services.UserStatus.Away:case SkypeX.Services.UserStatus.BeRightBack:case SkypeX.Services.UserStatus.Idle:case SkypeX.Services.UserStatus.Offline:return C?o.transformIntoTimeago(p):n.GetTranslatedStatusText(SkypeX.Services.UserStatus.OutOfOffice);default:return n.GetTranslatedStatusText(SkypeX.Services.UserStatus.OutOfOffice)}else switch(l){case SkypeX.Services.UserStatus.Away:case SkypeX.Services.UserStatus.BeRightBack:case SkypeX.Services.UserStatus.Idle:case SkypeX.Services.UserStatus.Offline:return C?o.transformIntoTimeago(p):n.GetTranslatedStatusText(l);default:return n.GetTranslatedStatusText(l)}},m=function(e,t,n,r,a){var i="";return e.calendarData&&e.calendarData.outOfOfficeNote&&e.calendarData.outOfOfficeNote.message&&(i=r.stripHtml(a.sanitizeHtml(e.calendarData.outOfOfficeNote.message)).trim()),i},y=function(e,t,n,r,a,i){var o={message:"",publishTime:""};if(e.note){var s=e.note.message,c=e.note.publishTime;if(c&&c.trim()){var l=new Date(c);o.publishTime=i.getMessageDisplayableDateTime(l)}if(s){var u=r.stripHtml(a.sanitizeHtml(s)).trim(),p=m(e,0,0,r,a);u.length&&!p.length&&(o.message=u)}}return o.message&&o.publishTime?o:void 0},b=function(e,n,r,a){var i=[],o=function(a){_.each(a,function(a){if("span"===a.name&&a.attribs&&a.attribs.itemtype===n.semanticObjectSchemas.mention&&a.attribs["data-itemprops"]){var s=r.DomUtils.getText(a),c=e.decodeHtml(a.attribs["data-itemprops"]),l=f.removeZeroWidthSpace(c),u=JSON.parse(l).mri;i.push({text:t.unescapeHtmlEntities(s),hostAppPersonaId:u,mri:u})}else"text"===a.type?i.push({text:t.unescapeHtmlEntities(r.DomUtils.getText(a)),hostAppPersonaId:void 0}):"br"===a.name?i.push({text:" ",hostAppPersonaId:void 0}):a.children&&a.children.length>0&&o(a.children)})};return o(a),i},C=function(e,t,n,r,a,i){if(t.valueAsBoolean(n.settings.names.enableStatusNoteV2)&&e.note){var o={message:[],publishTime:""},s=e.note.message,c=e.note.publishTime;if(s){var l=a.sanitizeHtml(s).trim(),u=window.htmlparser2,p=u.parseDOM("<div>"+l+"</div>"),f=b(r,n,u,p);o.message=f}if(c&&c.trim()){var d=new Date(c);o.publishTime=i.getMessageDisplayableDateTime(d)}return o.message.length&&o.publishTime?o:void 0}},S=function(e,t,n,r,a,i,o,s,c,l,u,p,f,d){return function(g,b){var S=e.getPresence(g,b);return{presence:h(S,a,i,f,d,g),isOutOfOffice:S&&!!S.calendarData&&!!S.calendarData.isOutOfOffice,oofMessage:S&&m(S,0,0,t,n),presenceText:S&&v(S,a,o,s,i,c,l,u,p),statusNote:S&&y(S,0,0,t,n,r),statusNoteV2:S&&C(S,a,i,t,n,r)}}},P=function(e){return function(t){var n=e.findConversationWith(t);return n&&n.isInteropChat()?SkypeX.Services.PresenceSource.SFB:SkypeX.Services.PresenceSource.UPS}},T=function(e,t,n,r,a,i,o,s,c,l,u,f,d,h,g){return function(v,m){if(p.deserializeHostAppPersonaId(v.HostAppPersonaId).isExchangeOnlyContact)return m(null,void 0);var y=g.service.newScenario(o.scenarios.people.lpcGetRichPresence),b=P(e),C=S(t,n,r,a,i,o,s,c,l,u,f,d,e,h)(v.TeamsMri,b(v.TeamsMri));y.stop(),m(C,void 0)}},k=function(e,t,n,r,a,i,o,s){return function(u){return c(void 0,void 0,void 0,function(){var c,f,d,h,g,v,m,y,b,C,S,P,T,k,w,A,L,I,O,x,M,U,E,_;return l(this,function(l){switch(l.label){case 0:if(c=r.service.newScenario(a.scenarios.people.lpcGetHeaderActionsPolicy),f=!s.isCurrentUserTFLOrMsaAccount(),d={disableChat:!1,disableOrg:!0,disableCall:!1,disableVideo:!1,disableBlockUnblock:f},h=o.isBlockedContact(u.TeamsMri))return c.stop({reason:"Blocked Contact"}),[2,{disableChat:!0,disableOrg:!0,disableCall:!0,disableVideo:!0,disableBlockUnblock:f}];g=e.getSettingValue(SkypeX.Services.CallingPolicyStorageKey.allowPrivateCalling),d.disableCall=!g,d.disableVideo=!g,v=t.getSettingValue(SkypeX.Services.MessagingPolicySettingsStorageKey.allowUserChat),l.label=1;case 1:return l.trys.push([1,6,,7]),m=p.deserializeHostAppPersonaId(u.HostAppPersonaId),y=m.isSharedChannel,b=m.hostTenantId,C=m.hostConversationId,(S=m.isExchangeOnlyContact)?(c.stop({reason:"Out-of-tenant outlook Contact"}),[2,{disableChat:!0,disableOrg:!0,disableCall:!0,disableVideo:!0,disableBlockUnblock:!0}]):(P=void 0,y?[4,n.getAllPeopleProfileForConversation([u.TeamsMri],C,!1,a.scenarios.people.lpcGetHeaderActionsPolicySC,void 0,y,b)]:[3,3]);case 2:return P=l.sent(),c.mark(a.scenarios.people.lpcGetHeaderActionsPolicySC),[3,5];case 3:return[4,n.getAllPeopleProfile([u.TeamsMri],a.scenarios.people.lpcGetHeaderActionsPolicy,!u.TeamsMri)];case 4:P=l.sent(),c.mark(a.scenarios.people.lpcGetHeaderActionsPolicy),l.label=5;case 5:if(T=P[0]){if(k=T.featureSettings,w=T.type,A=T.userType,L=T.isAnonymousUser,I=T.mri,L)return c.stop({reason:"Anonymous User"}),[2,{disableChat:!0,disableOrg:!0,disableCall:!0,disableVideo:!0,disableBlockUnblock:!0}];if(O=SkypeX.Services.ChatServiceUtils.isPstnMri(I))return c.stop({reason:"PSTN User"}),[2,{disableChat:!0,disableOrg:!0,disableCall:!1,disableVideo:!0,disableBlockUnblock:!0}];x=k&&k.isPrivateChatEnabled,M=w&&w.toLowerCase()===a.userTypes.person.toLowerCase(),U=A&&A.toLowerCase()===a.userTypes.guest.toLowerCase(),E=i===teamspace.services.UserTypeInTenant.Guest,d.disableChat=!1===x||!v,d.disableOrg=!(M&&!U)||E,c.stop()}return[3,7];case 6:return _=l.sent(),c.fail({reason:"Error while fetching persona"}),r.error("Failed to fetch persona profile in LPC data callbacks"),[3,7];case 7:return[2,d]}})})}},w=function(e,t,n){var r=f.getEmail(t,n);return{cardType:e,headerInfo:{userHeaderInfo:{displayName:t.displayName,firstName:t.givenName,lastName:t.surname,title:t.jobTitle,location:t.userLocation,profilePictureUrl:t.imageUri,mobilePhone:t.mobile,phone:f.getPhoneNumber(t,n),userPrincipalName:t.userPrincipalName,email:r&&r.Address,imAddress:t.skypeId}}}},A=function(e,t){return{cardType:e,headerInfo:{unresolvedHeaderInfo:{email:t}}}},L=function(e,t,n){return"NotResolved"===e?A(e,t.email):w(e,t,n)};t.makeGetHeaderInfoAndCardTypeCallback=i,t.GetPresenceSourceFunction=P,t.GetRichPresenceFunction=S,t.LPCDataCallbackFactory=function(e,t,n,r,s,c,l,u,p,f,h,g,v,m,y,b,C,S,P,w,A,L,I){return{getAndPrefetchPersonaImageUri:d(e,b,p,r,I),getRichPresence:T(t,n,s,c,l,u,p,f,h,g,v,m,y,C,e),getHeaderActionsPolicyAsync:k(S,P,r,e,p,w,C,L),getPersonaInfo:o(r,e,u,p,I),getOrgChart:a(r,e,p),getHeaderInfoAndCardType:i(r,e,A,u,p,I)}}},2224:function(e,t,n){"use strict";function r(e,t){var n=[];return e.emailsInfo&&e.emailsInfo.forEach(function(e){!e.searchable&&t||n.push({Address:e.address})}),n}function a(e,t){if(t){var n=[];return e.phonesInfo&&e.phonesInfo.forEach(function(e){e.searchable&&n.push({PhoneNumber:e.number,Type:"Home",PhoneUrl:"tel:"+e.number})}),n}var r=[];return e.phones&&e.phones.length>0&&e.phones.forEach(function(e){return r.push({PhoneNumber:e.number,PhoneUrl:"tel:"+e.number,Type:e.type})}),e.telephoneNumber&&r.push({PhoneNumber:e.telephoneNumber,PhoneUrl:"tel:"+e.telephoneNumber,Type:"Business"}),r}var i=this&&this.__awaiter||function(e,t,n,r){function a(e){return e instanceof n?e:new n(function(t){t(e)})}return new(n||(n=Promise))(function(n,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){e.done?n(e.value):a(e.value).then(o,s)}c((r=r.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){function n(e){return function(t){return r([e,t])}}function r(n){if(a)throw new TypeError("Generator is already executing.");for(;c;)try{if(a=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return c.label++,{value:n[1],done:!1};case 5:c.label++,i=n[1],n=[0];continue;case 7:n=c.ops.pop(),c.trys.pop();continue;default:if(o=c.trys,!(o=o.length>0&&o[o.length-1])&&(6===n[0]||2===n[0])){c=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){c.label=n[1];break}if(6===n[0]&&c.label<o[1]){c.label=o[1],o=n;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(n);break}o[2]&&c.ops.pop(),c.trys.pop();continue}n=t.call(e,c)}catch(e){n=[6,e],i=0}finally{a=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var a,i,o,s,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s};Object.defineProperty(t,"__esModule",{value:!0}),t.getDirectReportsAndManager=function(e){return{Managers:e.filter(function(e){return 1===e.managerLevel}).map(function(e){return{DisplayName:e.displayName,Smtp:e.smtpAddresses[0],Department:e.department,JobTitle:e.jobTitle}}),Directs:e.filter(function(e){return!e.userClassification}).map(function(e){return{DisplayName:e.displayName,Smtp:e.smtpAddresses[0],Department:e.department,JobTitle:e.jobTitle}})}},t.getEmails=r,t.getEmail=function(e,t){if(!t)return e.email?{Address:e.email}:void 0;var n=r(e,t);return n.length>0?n[0]:void 0},t.getPhoneNumbers=a,t.getPhoneNumber=function(e,t){if(t){var n=a(e,t);if(n.length>0){var r=n[0];return{number:r.PhoneNumber,type:r.Type,url:r.PhoneUrl}}}else{if(e.telephoneNumber)return{number:e.telephoneNumber,type:"Business",url:"tel:"+e.telephoneNumber};if(e.phones&&e.phones.length>0){var i=e.phones[0];return{number:i.number,type:i.type,url:"tel:"+i.number}}}},t.removeZeroWidthSpace=function(e){var t=/[\u200B-\u200D\uFEFF]/g;return e.replace(t,"")},t.getPersonaProfileByContactId=function(e,t,n,r,a){return i(this,void 0,void 0,function(){var i,s,c;return o(this,function(o){switch(o.label){case 0:return e?[4,n.getCachedExchangeContactById(e)]:[3,2];case 1:return(s=o.sent())?i=[{displayName:n.getDisplayNameForUserContact(s),id:s.id,jobTitle:s.jobTitle,mri:s.mri,phones:s.phones,email:s.emails[0]||"",objectId:s.id}]:(c="No profile returned for exchange contact",t.error("getCachedExchangeContactById returned no profile in LPC {0}",a),r.fail({reason:c})),[3,3];case 2:c="Empty OlsPersonaId to look for Exchange contact profile",t.error("Empty OlsPersonaId to look for Exchange contact profile in LPC {0}",a),r.fail({reason:c}),o.label=3;case 3:return i&&r.mark(a),[2,i]}})})}},2225:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(2226);t.defaultTheme=r.defaultTheme;var a=n(2227);t.darkTheme=a.darkTheme;var i=n(2228);t.highContrastTheme=i.highContrastTheme},2226:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="rgba(37,36,36,0.75)",a={themePrimary:r,themeSecondary:r,neutralPrimary:"#252424",neutralSecondary:r,neutralLight:"#FAF9F8",neutralLighter:"#f3f2f1",neutralLighterAlt:"#ffffff",neutralPrimaryAlt:"#FAF9F8",neutralSecondaryAlt:"#2A2828",neutralTertiary:"#c8c6c4",neutralTertiaryAlt:"#FAF9F8",neutralQuaternary:"#f3f2f1",neutralQuaternaryAlt:"#ffffff",purple:"#6264a7",magenta:"#943670",magentaDark:"rgba(148,54,112,0.05)"};t.defaultTheme={palette:a}},2227:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fontColor="rgba(255,255,255,0.75)",t.white="#2d2c2c",t.darkThemePalette={themePrimary:t.fontColor,themeSecondary:t.fontColor,neutralPrimary:"#ffffff",neutralSecondary:t.fontColor,neutralLight:"#3b3a39",neutralLighter:"#201F1F",neutralLighterAlt:t.white,neutralPrimaryAlt:"#3B3A3A",neutralSecondaryAlt:t.fontColor,neutralTertiary:"#605e5c",neutralTertiaryAlt:"#3b3a39",neutralQuaternary:"#201F1F",neutralQuaternaryAlt:"#201F1F",white:t.white,purple:"#a6a7dc",magenta:"#ae3d84",magentaDark:"rgba(207,96,152,0.1)",black:"#ffffff"},t.darkTheme={palette:t.darkThemePalette}},2228:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="#000000",a="#ffffff",i={themePrimary:"#ffffff",themeSecondary:"#ffffff",neutralPrimary:a,neutralSecondary:"#ffffff",neutralLight:r,neutralLighter:a,neutralLighterAlt:a,neutralPrimaryAlt:r,neutralSecondaryAlt:"#ffffff",neutralTertiary:"#30f42c",neutralTertiaryAlt:r,neutralQuaternary:r,neutralQuaternaryAlt:a,white:r,black:a,purple:"#ffff00",magenta:a,magentaDark:r};t.highContrastTheme={palette:i}},2229:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=teamspace.components.PanelActionGesture,a=teamspace.components.PanelActionOutcome,i=teamspace.components.PanelActionScenario,o=teamspace.components.PanelActionScenarioType,s=teamspace.components.PanelModuleName,c=teamspace.components.PanelModuleType,l=teamspace.components.WorkLoad,u=teamspace.components.SubWorkLoad,p=n(88),f=function(){function e(e,t,n){this.analyticsService=e,this.loggingService=t,this.conversationsService=n}return e.prototype.logPanelActionEvent=function(e,t){var n,f,d,h,g,v,m=this,y=c.people,b=a.nav,C=a.nav,S=o.people,P=teamspace.PanelRegion.popover,T=l.chatContent,k=u.composeMsg;switch(e){case p.LpcCallbackTelemetryType.lpcAudioCall:f=r.click,d=i.navCalling,h=s.lpcAudioCall,n="lpcAudioCall";break;case p.LpcCallbackTelemetryType.lpcStartChat:f=r.click,d=i.navChat,h=s.lpcStartChat,n="lpcStartChat";break;case p.LpcCallbackTelemetryType.lpcOrgChart:f=r.click,d=i.orgChart,h=s.lpcOrgChart,n="lpcOrgChart";break;case p.LpcCallbackTelemetryType.lpcQuickIM:f=r.click,b=a.submit,C=a.submit,d=i.quickIM,h=s.lpcQuickIM,g=s.sendButton,v=c.compose,n="lpcQuickIM";break;case p.LpcCallbackTelemetryType.lpcVideoCall:f=r.click,d=i.navCalling,h=s.lpcVideoCall,n="lpcVideoCall";break;case p.LpcCallbackTelemetryType.lpcBlockContact:f=r.click,d=i.blockUser,h=s.lpcBlockContact,n="lpcBlockContact";break;case p.LpcCallbackTelemetryType.lpcUnblockContact:f=r.click,d=i.unblockUser,h=s.lpcUnblockContact,n="lpcUnblockContact";break;default:return}var w={action:{gesture:f,outcome:b,outcomeNew:C,scenario:d?teamspace.shared.AttributeHelper.tryGetEnum(d.toString(),i,this.loggingService):null,scenarioType:S?teamspace.shared.AttributeHelper.tryGetEnum(S.toString(),o,this.loggingService):null,workLoad:teamspace.shared.AttributeHelper.tryGetEnum(T.toString(),l,this.loggingService),subWorkLoad:teamspace.shared.AttributeHelper.tryGetEnum(k.toString(),u,this.loggingService)},module:{name:h?teamspace.shared.AttributeHelper.tryGetEnum(h.toString(),s,this.loggingService):null,nameNew:g?teamspace.shared.AttributeHelper.tryGetEnum(g.toString(),s,this.loggingService):null,type:y?teamspace.shared.AttributeHelper.tryGetEnum(y.toString(),c,this.loggingService):null,typeNew:v?teamspace.shared.AttributeHelper.tryGetEnum(v.toString(),c,this.loggingService):null,summary:n},targetThread:this.getTargetThreadType(t)};this.analyticsService.getAnalyticsPanelActionEventData(w,P).then(function(e){m.analyticsService.sendPanelAction(e)})},e.prototype.getTargetThreadType=function(e){if(!e)return null;var t=this.conversationsService.getConversation(e);return{type:t&&t.conversationType||"OneOnOneChat"}},e}();t.LpcTelemetryHelper=f},309:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.determineLPCPersonaType=function(e,t){switch(t){case"Federated":case"SkypeConsumer":return"External";case"person":return"Guest"===e?"NotResolved":"User";default:return"User"}},t.determineCardTypeForTargetUser=function(e,t,n){if(n)return"Me";switch(t){case"Federated":case"SkypeConsumer":return"External";case"person":return"Guest"===e?"NotResolved":"User";default:return"User"}},t.getCleanUpn=function(e){return!e||SkypeX.Services.ChatServiceUtils.isMri(e)?void 0:e},t.serializeHostAppPersonaId=function(e){return JSON.stringify(e)},t.deserializeHostAppPersonaId=function(e){if(!e)return{userId:void 0,isSharedChannel:!1,hostTenantId:void 0,hostConversationId:void 0,isExchangeOnlyContact:!1};var t=JSON.parse(e);return{userId:t.userId,isSharedChannel:!0===t.isSharedChannel,hostTenantId:t.hostTenantId,hostConversationId:t.hostConversationId,isExchangeOnlyContact:!0===t.isExchangeOnlyContact}}},88:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});!function(e){e[e.none=0]="none",e[e.offline=1]="offline",e[e.online=2]="online",e[e.away=3]="away",e[e.dnd=4]="dnd",e[e.blocked=5]="blocked",e[e.busy=6]="busy",e[e.oof=7]="oof"}(t.PersonaPresence||(t.PersonaPresence={}));!function(e){e.Default="default",e.HighContrast="contrast",e.Dark="dark",e.DefaultV2="defaultV2",e.DarkV2="darkV2"}(t.LpcTheme||(t.LpcTheme={}));!function(e){e[e.lpcAudioCall=0]="lpcAudioCall",e[e.lpcStartChat=1]="lpcStartChat",e[e.lpcEditMeProfile=2]="lpcEditMeProfile",e[e.lpcOrgChart=3]="lpcOrgChart",e[e.lpcQuickIM=4]="lpcQuickIM",e[e.lpcVideoCall=5]="lpcVideoCall",e[e.lpcBlockContact=6]="lpcBlockContact",e[e.lpcUnblockContact=7]="lpcUnblockContact",e[e.personImageCallback=8]="personImageCallback",e[e.richPresenceCallback=9]="richPresenceCallback"}(t.LpcCallbackTelemetryType||(t.LpcCallbackTelemetryType={}))}},[2219]);