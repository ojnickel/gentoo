(this.webpackJsonp=this.webpackJsonp||[]).push([[19],{DOJB:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return a}));var r=n("lMlv"),i=function(e){return Boolean(e&&e.startsWith(r.a.Pstn))},a=function(e){var t=e.slice(r.a.Pstn.length),n=t.indexOf("_");return-1!==n&&(t=t.slice(0,n)),t}},EQfm:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("+7/b"),i=n("svWY");function a(e,t){function n(e){if(!Object(i.isArray)(e)&&!Object(i.isObject)(e)||Object(i.isDate)(e))return e;var n={};Object(i.forOwn)(e,(function(e,r){n[r]=a(e,t)}));var s=n,o=t;s[o];return Object(r.m)(s,["symbol"==typeof o?o:o+""])}return Object(i.isArray)(e)?e.map(n):n(e)}},FK3d:function(e,t,n){"use strict";n.d(t,"a",(function(){return S}));var r=n("+7/b"),i=n("svWY"),a=n("jN5E"),s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chat"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isRead"}},{kind:"Field",name:{kind:"Name",value:"chatType"}},{kind:"Field",name:{kind:"Name",value:"members"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"givenName"}},{kind:"Field",name:{kind:"Name",value:"email"}}]}},{kind:"Field",name:{kind:"Name",value:"botMembers"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}}]}}]}}]},o={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"newChatIntentId"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"newChatIntentId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}]}]}}]},c=n("ra0y"),u=n("3J71"),l=n("ux1a"),d=n("VxlM"),m=n("POyb"),p=n("IoEE"),v=n("CdiN"),f=n("fDoL"),h=n("ifNO"),b=n("c2NR"),g="Chat Resolvers",y=function(e,t){var n=e.content,a=e.messageType,s=e.clientMessageId,o=e.files,c=e.deeplinks,u=e.importance,l=e.computed;void 0===t&&(t={});var d=void 0===l?{}:l,m=d.mentions,v=d.urlPreview,f=d.embeddedLinks,h=Object(i.map)(m,(function(e){var t=e.userId,n=Object(r.m)(e,["userId"]);return Object(r.a)(Object(r.a)({},n),{userId:t,id:t})})),g=Object(i.map)(o,(function(e){var t=e.chicletBreadcrumbs,n=Object(r.m)(e,["chicletBreadcrumbs"]);return Object(r.a)({previewUrl:"",previewWidth:null,previewHeight:null,chicletBreadcrumbs:t?{__typename:"ChicletBreadcrumbs",sourceChannelName:t.sourceChannelName||null,sourceTeamName:t.sourceTeamName||null}:null},n)})),y=Object(b.k)(v),O=Object(b.j)(f);return Object(r.a)({content:n,contentType:"text",messageType:a,clientMessageId:s,isImportant:u===p.b.MessageImportance.Important,status:p.b.MessageStatus.Delivered,mentions:h,files:g,deeplinks:Object(b.g)(c),urlPreview:y,embeddedLinks:O,emotions:null},t)},O="ChatResolvers",C="48:starred";function k(e){return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,e.getUser()];case 1:return[2,t.sent().profile.oid]}}))}))}var S={Query:{chats:function(e,t,n){var i=t.first,a=t.after,s=n.getCSAService,o=n.loggerFactory,c=n.user;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,u,d,m,p;return Object(r.i)(this,(function(r){switch(r.label){case 0:e=[],t=null,n=null,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,s()];case 2:return[4,r.sent().getChats(i,a)];case 3:return u=r.sent(),d=u.items,m=u.continuationToken,t=m,e=d.map((function(e){return Object(l.s)(e,o,c)})),n=!!t,[3,5];case 4:return p=r.sent(),o.newLogger(g).error("Unable to resolve chats: ",p),[2,Promise.reject(p)];case 5:return[2,{edges:e,pageInfo:{endCursor:t,hasNextPage:n}}]}}))}))},messages:function(e,t,n){var i=t.convId,a=t.cursor,s=t.count,o=n.getCSAService,c=n.loggerFactory;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n;return Object(r.i)(this,(function(r){switch(r.label){case 0:return Object(l.l)(i)?[2,{messages:[]}]:[3,1];case 1:return[4,o()];case 2:return[4,r.sent().getMessages(i,a,s||void 0)];case 3:return e=r.sent(),t=e.messages,n=e.messageToken,[2,{messages:t.map((function(e){return Object(l.C)(e,i,c)})).sort((function(e,t){var n=new Date(e.originalArrivalTime);return new Date(t.originalArrivalTime).valueOf()-n.valueOf()})),cursor:n,dataSource:"network"}]}}))}))},message:function(e,t,n){var i=t.convId,a=t.messageId,s=n.getCSAService,o=n.loggerFactory;return Object(r.f)(this,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,s()];case 1:return[4,t.sent().getMessage(i,a)];case 2:return e=t.sent(),[2,{message:Object(l.C)(e,i,o)}]}}))}))},chat:function(e,t,n){var i=t.convId,a=n.getCSAService,s=n.loggerFactory,o=n.user;return Object(r.f)(this,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,a()];case 1:return e=t.sent(),[2,Object(b.b)(i,e,s,o)]}}))}))},chatWithUser:function(e,t,n){var i=t.userId,a=t.createLieIfNotFound,o=n.getCSAService,c=n.discover,l=n.getPeopleService,m=n.loggerFactory,p=n.user,v=n.cache;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,f,y,O,C,k;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,c.skypeid()];case 1:return e=r.sent(),t=Object(d.a)(e,i),n=null,[4,o()];case 2:f=r.sent(),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,Object(b.b)(t,f,m,p)];case 4:return n=r.sent(),[3,6];case 5:if(y=r.sent(),!Object(h.i)(y,u.e.RequireStatus,u.d.RemoteOperationFailed,{requiredStatus:[u.j.OK,u.k.HTTP_2XX],status:u.j.NOT_FOUND}))throw y;return[3,6];case 6:return n||!a?[3,9]:(O=b.c,C=[[e,i]],[4,l()]);case 7:return[4,O.apply(void 0,C.concat([r.sent()]))];case 8:n=r.sent();try{v.writeQuery({query:s,variables:{convId:n.id},data:{chat:n}})}catch(e){throw e}k=m.newLogger(g),Object(b.a)(v,n,k),r.label=9;case 9:return[2,n]}}))}))},chatsWithUsers:function(e,t,n){var i=t.userIds,a=t.filters,o=t.partialMatch,c=t.topicName,u=t.createLieIfNotFound,d=n.cache,m=n.getCSAService,p=n.getPeopleService,v=n.loggerFactory,f=n.user;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,h,y,O;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e=[],[4,m()];case 1:return[4,r.sent().getChatsWithUsers(i,!!o)];case 2:return(t=r.sent())&&(e=Object(l.f)(t.map((function(e){return Object(l.q)(e,v,f)})),a||{}),c&&(e=e.filter((function(e){return e.title===c})))),0===e.length&&u?(h=b.c,y=[i],[4,p()]):[3,5];case 3:return[4,h.apply(void 0,y.concat([r.sent(),c]))];case 4:n=r.sent();try{d.writeQuery({query:s,variables:{convId:n.id},data:{chat:n}})}catch(e){throw e}O=v.newLogger(g),Object(b.a)(d,n,O),e.push(n),r.label=5;case 5:return[2,e]}}))}))},unreadCounts:function(e,t,n){var i=n.getCSAService;return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(e){switch(e.label){case 0:return[4,i()];case 1:return[4,e.sent().getBadges()];case 2:return[2,e.sent().map(l.E)[0]]}}))}))},badgeCounts:function(e,t,n){var i=n.getCSAService;return Object(r.f)(this,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,i()];case 1:return[4,t.sent().getBadgeCounts()];case 2:return e=t.sent().badgeCounts,[2,Object(l.o)(e[0])]}}))}))},chatsByTitle:function(e,t,n){var i=t.title,a=t.filters,s=n.getCSAService,o=n.loggerFactory,c=n.user;return Object(r.f)(this,void 0,void 0,(function(){var e;return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,s()];case 1:return[4,t.sent().getChatsByTitle(i)];case 2:return[2,(e=t.sent())?Object(l.f)(e.map((function(e){return Object(l.q)(e,o,c)})),a||{}):[]]}}))}))},membersConsumptionHorizon:function(e,t,n){var i=t.convId,a=n.getChatService,s=n.getCSAService,o=n.loggerFactory,c=n.coreSettings;return Object(r.f)(this,void 0,void 0,(function(){var e,t;return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,s()];case 1:return e=n.sent(),[4,a()];case 2:return t=n.sent(),[2,Object(b.n)(i,t,e,o,c)]}}))}))},messageAnnotations:function(e,t,n){var a=t.convId,s=t.messageId,o=t.reaction,c=t.cursor,u=n.getChatService;return Object(r.f)(this,void 0,Promise,(function(){var e;return Object(r.i)(this,(function(t){switch(t.label){case 0:return[4,u()];case 1:return[4,t.sent().getMessageAnnotations(a,s,o,c)];case 2:return e=t.sent(),[2,e&&{hasNext:e.hasNext,cursor:e.cursor,users:Object(i.map)(e.annotations,(function(e){return e.mri}))}]}}))}))},searchUsersByConversation:function(e,t,n){var i=t.convId,a=t.searchQuery,o=t.searchExactMatches,c=t.includeCurrentLoggedInUser,u=n.getCSAService,d=n.discover,m=n.loggerFactory,p=n.user,v=n.cache;return Object(r.f)(this,void 0,Promise,(function(){var e,t,n,f;return Object(r.i)(this,(function(r){switch(r.label){case 0:if(!i)throw new Error("ConvId null not supported");if(!Object(l.l)(i))return[3,1];try{t=v.readQuery({query:s,variables:{convId:i}}),e=null==t?void 0:t.chat}catch(e){throw new Error("Lie chat could not be found in cache, convId - "+i)}return[3,4];case 1:return[4,u()];case 2:return n=r.sent(),[4,Object(b.b)(i,n,m,p)];case 3:e=r.sent(),r.label=4;case 4:if(!e)throw new Error("Conversation could not be found, convId - "+i);return[4,d.skypeid()];case 5:return f=r.sent(),[2,Object(b.q)(e.members,f,a,o,c)]}}))}))},newChatIntentId:function(e,t,n){var r,i=t.convId,s=n.cache,c=n.loggerFactory;if(Object(l.m)(i))return Object(a.v4)();if(Object(l.l)(i))try{var u=s.readQuery({query:o,variables:{convId:l.b}});return null!==(r=null==u?void 0:u.newChatIntentId)&&void 0!==r?r:null}catch(e){throw e}return c.newLogger(g).warn("Shouldn't get newChatIntentId for chat which is not either new chat or lie chat"),null}},Mutation:{sendMessage:function(e,t,n){var a=t.convId,s=t.message,o=t.action,c=n.authenticationService,u=n.discover,d=n.getChatService,p=n.getPeopleService,f=n.getCSAService;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,h,g,O,C,k,S,j,T,I,M,N,w,D,P,F,A,U,L;return Object(r.i)(this,(function(E){switch(E.label){case 0:return[4,Promise.all([c.getUser(),u.skypeid()])];case 1:return e=E.sent(),t=e[0].profile.name,n=e[1],[4,d()];case 2:return h=E.sent(),Object(l.j)(a)?[4,h.getThread(a)]:[3,7];case 3:return k=E.sent(),[4,u.skypeid()];case 4:return S=E.sent(),T=m.a,I=[k.members],[4,p()];case 5:return[4,T.apply(void 0,I.concat([E.sent()]))];case 6:j=E.sent(),M=Object(i.find)(j,(function(e){return e.mri===S})),O=M&&M.sipProxyAddress,N=Object(i.find)(j,(function(e){return e.mri!==S})),C=N&&N.sipProxyAddress,g="receiverSfB",s=Object(r.a)(Object(r.a)({},s),{messageType:"Text"}),E.label=7;case 7:return(w=Object(b.o)(s))&&s&&(s=Object(r.a)(Object(r.a)({},s),{messageType:"Text"})),D=Object(b.e)(s,t,{fromSipUri:O,toSipUri:C,interopType:g,skipFanoutToBots:w}),s&&s.scheduledSendTime?[4,f()]:[3,10];case 8:return[4,E.sent().postScheduledMessage(a,s,s.scheduledSendTime,o)];case 9:return E.sent(),[2,Promise.resolve({convId:a,message:s,action:o})];case 10:switch(o){case v.SendMessageAction.Create:return[3,11];case v.SendMessageAction.Update:return[3,13]}return[3,15];case 11:return[4,h.postMessageToConversation(a,D)];case 12:return P=E.sent(),U=P.id,F=P.originalarrivaltime,[2,y(s,{id:U,originalArrivalTime:new Date(F).toISOString(),from:n,imDisplayName:n})];case 13:return[4,h.updateMessageInConversation(a,D)];case 14:return E.sent(),U=(A=s).id,L=A.originalArrivalTime,[2,y(s,{id:U,originalArrivalTime:L,editTime:(new Date).toISOString(),from:n,imDisplayName:n})];case 15:throw new RangeError("Invalid action type for sendMessage")}}))}))},createChat:function(e,t,n){var i=t.userIds,a=t.topicName;return Object(r.f)(this,void 0,void 0,(function(){var e,t,s,o,c,u,l,d,m,p,v,f,h,g,y;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e=n.coreSettings,t=n.getChatService,s=n.getCSAService,o=n.discover,c=n.loggerFactory,u=n.user,[4,o.skypeid()];case 1:return l=r.sent(),d=Object(b.d)(l,i),[4,t()];case 2:return m=r.sent(),[4,Object(b.f)(m,i,d,a||"")];case 3:return p=r.sent(),v=p.threadId,f=p.status,h=p.responseBody,[4,Object(b.m)(f,h,e,c)];case 4:return g=r.sent(),[4,s()];case 5:return y=r.sent(),[4,Object(b.b)(v,y,c,u)];case 6:return[2,{conversation:r.sent(),hasIBPolicyRejectedUsers:g}]}}))}))},addMembersToConversation:function(e,t,n){var a=t.convId,s=t.members,o=t.shareHistoryTime,c=n.coreSettings,u=n.getChatService,d=n.getPeopleService,p=n.loggerFactory;return Object(r.f)(this,void 0,Promise,(function(){var e,t,n,v,f;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[],e=!1,Object(l.l)(a)?[3,4]:(!Object(i.isNil)(o)&&o>0&&(864e5,o=Date.now()-864e5*o),[4,u()]);case 1:return[4,r.sent().addMembersToThread(a,s,Object(i.isNil)(o)?void 0:o)];case 2:return t=r.sent(),[4,Object(b.i)(t.status,t.body,c,p)];case 3:n=r.sent(),e=n&&n.length>0,Object(i.pullAllBy)(s,n,"id"),r.label=4;case 4:return v=m.a,f=[s],[4,d()];case 5:return[4,v.apply(void 0,f.concat([r.sent()]))];case 6:return[2,{users:r.sent(),hasIBPolicyRejectedUsers:e}]}}))}))},registerBadgeCounts:function(e,t,n){var i=n.getBadgeCountService,a=n.getChatService,s=n.getCSAService;return Object(r.f)(this,void 0,void 0,(function(){var e,t;return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,a()];case 1:return[4,n.sent().getMyProperties()];case 2:return e=n.sent(),[4,i()];case 3:return[4,n.sent().getBadgeCountRequestBody(e)];case 4:return t=n.sent(),[4,s()];case 5:return[4,n.sent().registerBadgeCounts(t)];case 6:return n.sent(),[2,!0]}}))}))},removeMemberFromConversation:function(e,t,n){var i=t.convId,a=t.userId,s=n.discover,o=n.getChatService,c=n.loggerFactory,u=n.scenarioFactory;return Object(r.f)(this,void 0,Promise,(function(){var e,t,n;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,o()];case 1:return e=r.sent(),[4,Object(b.p)(e,i,a,c)];case 2:return t=r.sent(),[4,Object(b.l)(i,a,t,u,s)];case 3:return n=r.sent(),[2,{userId:a,hasChatPermissionsPolicyRejectedUsers:n}]}}))}))},ackUrgentMessage:function(e,t,n){var i=t.convId,a=t.messageId,s=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(e){switch(e.label){case 0:return[4,s()];case 1:return[4,e.sent().addMessageEmotion(i,a,p.b.EmotionKey.acks)];case 2:return e.sent(),[2,!0]}}))}))},updateMessageEmotion:function(e,t,n){var i=t.convId,a=t.messageId,s=t.key,o=t.action,c=n.discover,l=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){var e,t;return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,c.skypeid()];case 1:return e=n.sent(),[4,l()];case 2:if(t=n.sent(),!s)return[2,o===p.b.EmotionAction.remove?{id:""}:{id:e}];switch(o){case p.b.EmotionAction.add:return[3,3];case p.b.EmotionAction.remove:return[3,5]}return[3,7];case 3:return[4,t.addMessageEmotion(i,a,s)];case 4:return n.sent(),[2,{id:e}];case 5:return[4,t.removeMessageEmotion(i,a,s)];case 6:return n.sent(),[2,{id:""}];case 7:throw Object(h.a)(O,u.d.NotImplemented,"updateMessageEmotion",{action:o})}}))}))},saveMessage:function(e,t,n){var i=t.convId,a=t.messageId,s=n.discover,o=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,c,d,m,v,f,b,g;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e=p.b.EmotionKey.star,[4,s.skypeid()];case 1:return t=r.sent(),[4,o()];case 2:return[4,(n=r.sent()).getConversationMessage(i,a)];case 3:if(c=r.sent(),Object(l.i)(e,t,c))throw Object(h.a)(O,u.d.AlreadyPresent,"saveMessage");return[4,n.addMessageEmotion(i,a,e)];case 4:r.sent(),r.label=5;case 5:return r.trys.push([5,7,,9]),d=Object(l.D)(c),m=c.messagetype,v=c.content,f=c.imdisplayname,b={messagetype:m,content:v,imdisplayname:f,properties:{starred:d}},[4,n.postMessageToConversation(C,b)];case 6:return r.sent(),[3,9];case 7:return g=r.sent(),[4,n.removeMessageEmotion(i,a,e)];case 8:throw r.sent(),g;case 9:return[2,{id:t}]}}))}))},unsaveMessage:function(e,t,n){var i=t.convId,a=t.messageId,s=n.getChatService,o=n.getCSAService,c=n.discover;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,d,m,v,f;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e=p.b.EmotionKey.star,[4,c.skypeid()];case 1:return t=r.sent(),[4,s()];case 2:return[4,(n=r.sent()).getConversationMessage(i,a)];case 3:if(d=r.sent(),!Object(l.i)(e,t,d))throw Object(h.a)(O,u.d.NotPresent,"unsaveMessage");return[4,n.removeMessageEmotion(i,a,e)];case 4:r.sent(),r.label=5;case 5:return r.trys.push([5,10,,12]),[4,o()];case 6:return[4,r.sent().getMessages(C)];case 7:return m=r.sent().messages,(v=Object(l.g)(a,i,m))?[4,n.markStarredMessageAsDeleted(v)]:[3,9];case 8:r.sent(),r.label=9;case 9:return[3,12];case 10:return f=r.sent(),[4,n.addMessageEmotion(i,a,e)];case 11:throw r.sent(),f;case 12:return[2,null]}}))}))},deleteMessage:function(e,t,n){var i=t.convId,a=t.messageId,s=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(e){switch(e.label){case 0:return[4,s()];case 1:return[4,e.sent().deleteMessage(i,a)];case 2:return e.sent(),[2,{id:a}]}}))}))},undeleteMessage:function(e,t,n){var i=t.convId,a=t.messageId,s=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(e){switch(e.label){case 0:return[4,s()];case 1:return[4,e.sent().undeleteMessage(i,a)];case 2:return e.sent(),[2,{id:a}]}}))}))},sendTypingIndicator:function(e,t,n){var i=t.convId,a=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,s;return Object(r.i)(this,(function(r){switch(r.label){case 0:return e={messagetype:"Control/Typing",contenttype:"Application/Message",content:""},[4,a()];case 1:return[4,r.sent().postMessageToConversation(i,e)];case 2:return t=r.sent(),n=t.id,s=t.originalarrivaltime,[2,{id:n,originalArrivalTime:new Date(s).toISOString(),content:e.content,contentType:e.contenttype,messageType:e.messagetype,isImportant:!1,clientMessageId:e.clientmessageid}]}}))}))},setConsumptionHorizon:function(e,t,n){var i=t.convId,a=t.message,s=a.originalArrivalTime,o=a.clientMessageId,c=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n;return Object(r.i)(this,(function(r){switch(r.label){case 0:e=Date.now(),t=new Date(s||"").valueOf()+";"+e+";"+o,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,c()];case 2:return[4,r.sent().setConversationConsumptionHorizon(i,t)];case 3:return r.sent(),[3,5];case 4:return n=r.sent(),[2,Promise.reject(n)];case 5:return[2,{id:i,timeStamp:new Date(e).toISOString(),originalArrivalTime:s,clientMessageId:o}]}}))}))},setConsumptionHorizonBookmark:function(e,t,n){var i=t.convId,a=t.message,s=a.originalArrivalTime,o=a.clientMessageId,c=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){var e,t,n,a,u;return Object(r.i)(this,(function(r){switch(r.label){case 0:e=Date.now(),t=new Date(s||""),n="0"===s?"0":""+(t.valueOf()-1),a=n+";"+e+";"+o,r.label=1;case 1:return r.trys.push([1,4,,5]),[4,c()];case 2:return[4,r.sent().setConversationConsumptionHorizon(i,a,!0)];case 3:return r.sent(),[3,5];case 4:return u=r.sent(),[2,Promise.reject(u)];case 5:return[2,{id:i,timeStamp:new Date(e).toISOString(),originalArrivalTime:"0"===n?"0":new Date(t.valueOf()-1).toISOString(),clientMessageId:o}]}}))}))},updateMessageLinks:function(e,t,n){var i=t.convId,a=t.messageId,s=t.links,o=n.getChatService;return Object(r.f)(this,void 0,void 0,(function(){return Object(r.i)(this,(function(e){switch(e.label){case 0:return[4,o()];case 1:return[4,e.sent().updateMessageLinks(i,a,{links:s})];case 2:return e.sent(),[2,!0]}}))}))}},Subscription:{chatServiceEvent:{subscribe:function(e,t,n){var i=t.conversationId,a=n.authenticationService,s=n.getChatService,o=n.getChatServiceEndpointProvider,d=n.getPeopleService,p=n.getStatefulLongPoll,v=n.loggerFactory,f=n.user;return Object(r.c)(this,arguments,(function(){var e,t,n,b,g,y,C,S,j,T,I,M,N,w=this;return Object(r.i)(this,(function(D){switch(D.label){case 0:return e=function(e){return Object(r.f)(w,void 0,void 0,(function(){var t,n;return Object(r.i)(this,(function(r){switch(r.label){case 0:return t=m.a,n=[e],[4,d()];case 1:return[2,t.apply(void 0,n.concat([r.sent()]))]}}))}))},[4,Object(r.e)(s())];case 1:return t=D.sent(),[4,Object(r.e)(o?o():Promise.resolve(void 0))];case 2:return n=D.sent(),[4,Object(r.e)(p?p():Promise.resolve(void 0))];case 3:if(b=D.sent(),!n||!b)throw Object(h.a)(O,u.d.NotPresent,"chatServiceEvent");return[4,Object(r.e)(k(a))];case 4:g=D.sent(),y=b.poll({chatService:t,chatServiceEndpointProvider:n,currentUserId:g,sendActiveTimeoutParam:!1}),D.label=5;case 5:D.trys.push([5,13,14,19]),C=Object(r.d)(Object(c.a)(y)),D.label=6;case 6:return[4,Object(r.e)(C.next())];case 7:return(S=D.sent()).done?[3,12]:(j=S.value,[4,Object(r.e)(Object(l.r)(j,e,v,f))]);case 8:if(!(T=D.sent()))return[3,11];if(i){if(("ThreadUpdate"===T.__typename||"ConversationUpdate"===T.__typename)&&T.conversation.id!==i)return[3,11];if(("NewMessage"===T.__typename||"MessageUpdate"===T.__typename||"ConsumptionHorizonUpdate"===T.__typename)&&T.convId!==i)return[3,11]}return[4,Object(r.e)({chatServiceEvent:T})];case 9:return[4,D.sent()];case 10:D.sent(),D.label=11;case 11:return[3,6];case 12:return[3,19];case 13:return I=D.sent(),M={error:I},[3,19];case 14:return D.trys.push([14,,17,18]),S&&!S.done&&(N=C.return)?[4,Object(r.e)(N.call(C))]:[3,16];case 15:D.sent(),D.label=16;case 16:return[3,18];case 17:if(M)throw M.error;return[7];case 18:return[7];case 19:return[2]}}))}))}},chatServicePostActiveEvent:{subscribe:function(e,t,n){var i=n.authenticationService,a=n.getChatServiceEndpointProvider,s=n.getChatService;return Object(r.c)(this,arguments,(function(){var e,t;return Object(r.i)(this,(function(n){switch(n.label){case 0:return[4,Object(r.e)(s())];case 1:return e=n.sent(),[4,Object(r.e)(a())];case 2:return t=n.sent(),[5,Object(r.p)(Object(r.b)(Object(r.d)(Object(f.a)(e,t,(function(){return k(i)})))))];case 3:return[4,r.e.apply(void 0,[n.sent()])];case 4:return n.sent(),[2]}}))}))}}}}},GQA1:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return s}));var r={saveUnknownUser:"unknown_user_profile_generated",unknownUserFromDB:"unknown_user_from_index_db"},i={botType:"BOT"},a={member:"Member",guest:"Guest",voiceApp:"ADVoiceApp",DistributionList:"Group",Bot:"Bot",person:"Person",federated:"Federated",skypeConsumer:"SkypeConsumer",tflUser:"TFLUser",tflOffNetwork:"TFLOffNetwork"},s={showWarningBannerMinimumThreshold:20,type:{team:"team",channel:"channel",person:"person",webhook:"webhook",bot:"BOT",addABot:"addABot",app:"app"},hintElement:"ts-hint"}},Jn2m:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));n("uZya");var r=n("DOJB"),i=n("z4q9"),a=n("GQA1");var s=function(e){var t=e.mri,n=e.objectId,r={__typename:"User",id:t||n,objectId:n,mri:t,displayName:e.displayName,givenName:e.givenName,surname:e.surname,type:e.type,jobTitle:e.jobTitle,userPrincipalName:e.userPrincipalName,email:e.email,tenantId:e.tenantId,sipProxyAddress:e.sipProxyAddress,mobile:e.mobile,telephoneNumber:e.telephoneNumber};return function(e,t){var n=e.department;n&&(t.department=n)}(e,r),l(e,r),u(e,r),o(e,r),c(e,r),m(r),r},o=function(e,t){if(function(e){var t=e;return void 0!==t.isFederated||void 0!==t.isAnonymousB2bUser}(e)){var n=e.isFederated,r=e.fetchErrorCode,i=e.isAnonymousB2bUser;t.isFederated=n,t.fetchErrorCode=r,t.isAnonymousB2bUser=i}},c=function(e,t){e.featureSettings&&(t.featureSettings=e.featureSettings),e.isBlocked&&(t.isBlocked=e.isBlocked),e.cid&&(t.cid=e.cid),e.phonesInfo&&(t.phonesInfo=e.phonesInfo),e.emailsInfo&&(t.emailsInfo=e.emailsInfo),e.xtapUser&&(t.xtapUser=e.xtapUser),e.companyName&&(t.companyName=e.companyName),t.isShortProfile=e.isShortProfile},u=function(e,t){(function(e){return void 0!==e.userType}(e)||function(e){var t=e;return t.type?t.type===a.b.botType:Object(i.j)(e.mri)}(e))&&(t.userType=e.userType,t.description=e.description,t.isUnified=e.isUnified,t.securityEnabled=e.securityEnabled,t.featureSettings=e.featureSettings,t.imageUri=e.imageUri,t.userLocation=e.userLocation)},l=function(e,t){var n=e.phones;n&&(t.phones=n.map((function(e){return d(e)})))},d=function(e){return{number:e.number,type:e.type}},m=function(e){var t=e.mri;if(Object(r.b)(t)&&!e.displayName){var n=Object(r.a)(t);e.displayName=n,e.givenName=n}else e.displayName||(e.displayName="Unknown User");return e}},"KY7/":function(e,t,n){"use strict";n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return m}));var r,i,a=n("+7/b"),s=n("V4fY"),o=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.DL,s.b.ModernGroup,s.b.PersonalContact,s.b.UserDefinedGroup,s.b.Pstn,s.b.CallQandAA,s.b.Room,s.b.TeamTags,s.b.GroupChats,s.b.Xtap],c=(s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.DL,s.b.ModernGroup,s.b.PersonalContact,s.b.UserDefinedGroup,s.b.Pstn,(r={})[s.c.callForwardGroupSelection]=[],r[s.c.allTrue]=o,r[s.c.searchSuggestions]=o,r[s.c.addToMeetingForSharedChannel]=o,r[s.c.searchResults]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.ModernGroup,s.b.PersonalContact,s.b.UserDefinedGroup,s.b.Pstn,s.b.CallQandAA],r[s.c.addToTeam]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.Pstn],r[s.c.newChat]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.ModernGroup,s.b.UserDefinedGroup,s.b.TeamTags,s.b.Room],r[s.c.transfer]=[s.b.AADTenant,s.b.Guest,s.b.DisabledUser,s.b.DL,s.b.ModernGroup,s.b.PersonalContact,s.b.UserDefinedGroup,s.b.Pstn,s.b.CallQandAA],r[s.c.addToCall]=[s.b.AADTenant,s.b.Guest,s.b.Bot,s.b.DisabledUser,s.b.UserDefinedGroup,s.b.Pstn],r[s.c.addToChat]=[s.b.AADTenant,s.b.DL,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.DisabledUser,s.b.TeamTags],r[s.c.searchPeopleFilter]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.Pstn,s.b.TeamTags,s.b.PersonalContact],r[s.c.callRouting]=[s.b.AADTenant,s.b.Guest,s.b.Bot,s.b.DisabledUser,s.b.DL,s.b.PersonalContact,s.b.UserDefinedGroup,s.b.Pstn,s.b.CallQandAA],r[s.c.delegationSelection]=[s.b.AADTenant],r[s.c.presenceSettings]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.PersonalContact,s.b.Pstn],r[s.c.addToMeeting]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.DL,s.b.ModernGroup,s.b.PersonalContact,s.b.UserDefinedGroup,s.b.Pstn],r[s.c.meetingSchedule]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.DL,s.b.ModernGroup,s.b.PersonalContact,s.b.Pstn],r[s.c.addToSpeedDialOrContacts]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.DisabledUser,s.b.PersonalContact,s.b.Pstn,s.b.CallQandAA],r[s.c.atMention]=[s.b.AADTenant,s.b.Guest,s.b.Bot,s.b.Pstn],r[s.c.orgChart]=[s.b.AADTenant,s.b.Guest,s.b.Pstn],r[s.c.priorityContactsSelection]=[s.b.AADTenant,s.b.Federated,s.b.FederatedConsumer,s.b.Pstn],r[s.c.taggedContactsSelection]=[s.b.AADTenant,s.b.Guest,s.b.DL,s.b.PersonalContact],r[s.c.shareToTeams]=[s.b.AADTenant,s.b.Guest,s.b.Federated,s.b.FederatedConsumer,s.b.DisabledUser,s.b.PersonalContact,s.b.UserDefinedGroup],r[s.c.escalateMessage]=[s.b.AADTenant],r[s.c.allFalse]=[],r[s.c.custom]=[],r),u=n("svWY"),l=function(e,t){return Object(u.flatten)(e.filter((function(e){var n=e[0];e[1];return n===t})).map((function(e){e[0];return e[1]})))},d=((i={})[s.d.Substrate]=[s.b.AADTenant,s.b.Guest,s.b.GroupChats,s.b.DL],i[s.d.AAD]=[s.b.Guest],i[s.d.IndexedDb]=[s.b.Federated,s.b.FederatedConsumer,s.b.Bot,s.b.Pstn],i[s.d.MiddleTier]=[],i[s.d.TopNCache]=[],i),m=function(){function e(e,t){this.includeFeatures=e,this.name=t,this.includeAADTenant=!1,this.includeGuest=!1,this.includeFederated=!1,this.includeFederatedConsumer=!1,this.includeBot=!1,this.includeDisabledUser=!1,this.includeDL=!1,this.includeModernGroup=!1,this.includePersonalContact=!1,this.includeUserDefinedGroup=!1,this.includePstn=!1,this.includeCallQandAA=!1,this.includeRoom=!1,this.includeTeamTags=!1,this.includeGroupChats=!1,this.includeXtap=!1,this.includeAADTenant=Object(u.includes)(e,s.b.AADTenant),this.includeGuest=Object(u.includes)(e,s.b.Guest),this.includeFederated=Object(u.includes)(e,s.b.Federated),this.includeFederatedConsumer=Object(u.includes)(e,s.b.FederatedConsumer),this.includeBot=Object(u.includes)(e,s.b.Bot),this.includeDisabledUser=Object(u.includes)(e,s.b.DisabledUser),this.includeDL=Object(u.includes)(e,s.b.DL),this.includeModernGroup=Object(u.includes)(e,s.b.ModernGroup),this.includePersonalContact=Object(u.includes)(e,s.b.PersonalContact),this.includeUserDefinedGroup=Object(u.includes)(e,s.b.UserDefinedGroup),this.includePstn=Object(u.includes)(e,s.b.Pstn),this.includeCallQandAA=Object(u.includes)(e,s.b.CallQandAA),this.includeRoom=Object(u.includes)(e,s.b.Room),this.includeTeamTags=Object(u.includes)(e,s.b.TeamTags),this.includeGroupChats=Object(u.includes)(e,s.b.GroupChats),this.includeXtap=Object(u.includes)(e,s.b.Xtap)}return e.fromName=function(t,n){if(void 0===n&&(n=[]),!(t in c))throw new TypeError("Invalid `name` attribute passed. Please make sure it exists in PEOPLE_FILTER_NAME_CONFIG.");var r=l(n,!0),i=l(n,!1);return new e(u.without.apply(null,Object(a.o)([Object(u.concat)(c[t],r)],i)),t)},e.createFrom=function(t,n,r){return new e(n||t.includeFeatures,r||t.name)},e.includesAll=function(e,t){return Object(u.every)(t,(function(t){return Object(u.includes)(e.includeFeatures,t)}))},e.includesAny=function(e,t){return Object(u.some)(t,(function(t){return Object(u.includes)(e.includeFeatures,t)}))},e}()},POyb:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("+7/b"),i=n("svWY"),a=n("Jn2m");function s(e,t){return Object(r.f)(this,void 0,Promise,(function(){var n,s,o,c;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n=Object(i.uniqBy)(e,(function(e){return e.id})),s=Object(i.chunk)(n.map((function(e){return e.id})),t.MAX_PEOPLE_MRI_LIMIT),[4,Promise.all(s.map((function(e){return t.getPeopleProfilesByMris(e)})))];case 1:return o=r.sent(),c=[],o.forEach((function(e){c=c.concat(Array.from(e.values(),a.a))})),[2,c]}}))}))}},Rwu9:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ConsumptionHorizonBookmark"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}}]}}]}},TdW2:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n("+7/b"),i=n("vIjS"),a={kind:"Document",definitions:Object(r.o)([{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chatList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"first"}},type:{kind:"NamedType",name:{kind:"Name",value:"Int"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"after"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filter"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chats"},arguments:[{kind:"Argument",name:{kind:"Name",value:"first"},value:{kind:"Variable",name:{kind:"Name",value:"first"}}},{kind:"Argument",name:{kind:"Name",value:"after"},value:{kind:"Variable",name:{kind:"Name",value:"after"}}},{kind:"Argument",name:{kind:"Name",value:"filter"},value:{kind:"Variable",name:{kind:"Name",value:"filter"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"edges"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"node"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"chatFields"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"pageInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"endCursor"}},{kind:"Field",name:{kind:"Name",value:"hasNextPage"}}]}}]}}]}}],i.b.definitions)}},UYsd:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"lastMessageFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Message"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"content"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"imDisplayName"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}},{kind:"Field",name:{kind:"Name",value:"from"}},{kind:"Field",name:{kind:"Name",value:"messageType"}},{kind:"Field",name:{kind:"Name",value:"files"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}}]}},{kind:"Field",name:{kind:"Name",value:"cards"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contentType"}},{kind:"Field",name:{kind:"Name",value:"cardClientId"}}]}}]}}]}},V4fY:function(e,t,n){"use strict";var r,i,a;n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return a})),function(e){e.addToCall="addToCall",e.addToChat="addToChat",e.addToMeeting="addToMeeting",e.addToMeetingForSharedChannel="addToMeetingForSharedChannel",e.addToSpeedDialOrContacts="addToSpeedDialOrContacts",e.addToTeam="addToTeam",e.atMention="atMention",e.callForwardGroupSelection="callForwardGroupSelection",e.callRouting="callToRouting",e.delegationSelection="delegationSelection",e.meetingSchedule="meetingSchedule",e.newChat="newChat",e.orgChart="orgChart",e.presenceSettings="presenceSettings",e.priorityContactsSelection="priorityContactsSelection",e.searchResults="searchResults",e.searchPeopleFilter="searchPeopleFilter",e.searchSuggestions="searchSuggestions",e.shareToTeams="shareToTeams",e.taggedContactsSelection="taggedContactSelection",e.transfer="transfer",e.escalateMessage="escalateMessage",e.allFalse="allFalse",e.allTrue="allTrue",e.custom="custom"}(r||(r={})),function(e){e.AADTenant="AADTenant",e.Bot="Bot",e.CallQandAA="CallQandAA",e.DisabledUser="DisabledUser",e.DL="DL",e.Federated="Federated",e.FederatedConsumer="FederatedConsumer",e.Guest="Guest",e.ModernGroup="ModernGroup",e.PersonalContact="PersonalContact",e.Pstn="Pstn",e.Room="Room",e.UserDefinedGroup="UserDefinedGroup",e.TeamTags="TeamTags",e.PstnNonE164="PstnNonE164",e.LetterMapNumbers="LetterMapNumbers",e.GroupChats="GroupChats",e.Xtap="Xtap"}(i||(i={})),function(e){e.AAD="AAD",e.IndexedDb="IndexedDB",e.MiddleTier="MT",e.Substrate="3S",e.TopNCache="TopNCache"}(a||(a={}))},VxlM:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s}));var r=n("cCWX"),i=(n("lMlv"),function(e){return e.slice(e.includes("_")?41:8)}),a=function(e,t){var n=[i(e),i(t)].sort();return"19:"+n[0]+"_"+n[1]+"@unq.gbl.spaces"};function s(){var e=Object(r.a)(2);return(""+e[0]+e[1]).substr(0,19)}},VyoL:function(e,t,n){"use strict";n.d(t,"J",(function(){return u})),n.d(t,"a",(function(){return l})),n.d(t,"n",(function(){return d})),n.d(t,"q",(function(){return m})),n.d(t,"k",(function(){return p})),n.d(t,"m",(function(){return f})),n.d(t,"v",(function(){return h})),n.d(t,"G",(function(){return y})),n.d(t,"o",(function(){return O})),n.d(t,"l",(function(){return S})),n.d(t,"h",(function(){return j})),n.d(t,"j",(function(){return T})),n.d(t,"B",(function(){return I})),n.d(t,"g",(function(){return M})),n.d(t,"F",(function(){return N})),n.d(t,"y",(function(){return w})),n.d(t,"A",(function(){return P})),n.d(t,"d",(function(){return F})),n.d(t,"x",(function(){return A})),n.d(t,"z",(function(){return U})),n.d(t,"I",(function(){return L})),n.d(t,"C",(function(){return B})),n.d(t,"D",(function(){return x})),n.d(t,"c",(function(){return _})),n.d(t,"K",(function(){return H})),n.d(t,"t",(function(){return G})),n.d(t,"w",(function(){return Q})),n.d(t,"u",(function(){return J})),n.d(t,"p",(function(){return Y})),n.d(t,"E",(function(){return $})),n.d(t,"s",(function(){return Z})),n.d(t,"H",(function(){return ee})),n.d(t,"f",(function(){return te})),n.d(t,"b",(function(){return ne})),n.d(t,"e",(function(){return re})),n.d(t,"i",(function(){return ie})),n.d(t,"r",(function(){return ae}));var r=n("g5XK"),i=n("svWY"),a=n("zQSw"),s=n("z4q9"),o=n("e4hD"),c=n("YZyc"),u=function(e){var t=b(e);return C(e)?t:t||k(e)},l=function(e){return e.threadProperties&&e.threadProperties[o.hb.CreatedAt]?e.threadProperties[o.hb.CreatedAt]:null},d=function(e){if(!e)throw new Error("Invalid conversation passed to isDeleted()");if(!e.threadProperties)return!1;var t=e.threadProperties.isDeleted||e.threadProperties[o.hb.IsDeleted];return!!t&&("boolean"==typeof t?t:"function"==typeof t.toLowerCase&&"true"===t.toLowerCase())},m=function(e){return!(!e.properties||!e.properties[o.i.Followed])&&"true"===e.properties[o.i.Followed].toLowerCase()},p=function(e){return!(!e.properties||!e.properties[o.i.Collapsed])&&"true"===e.properties[o.i.Collapsed].toLowerCase()},v=function(e){return-1===e.detailsVersion?-1===e.threadVersion:0===e.threadVersion},f=function(e){return v(e)||j(e)&&!L(e)};function h(e){return e.includes(o.t)||e===o.H}var b=function(e){return Object(s.s)(e.id)&&h(e.id)},g=function(e){return e.threadProperties&&!!e.threadProperties[o.hb.ParentSpaces]},y=function(e){return e.threadProperties&&e.threadProperties[o.hb.ThreadType]===o.jb.Team&&!g(e)};var O=function(e){if(e.properties){if(e.properties[o.i.Favorite])return"true"===e.properties[o.i.Favorite].toLowerCase();if((t=e).threadProperties&&t.threadProperties[o.hb.ThreadType]===o.jb.Team)return!0}var t;return!1};function C(e){return e.id.endsWith(o.O)}var k=function(e){return C(e)},S=function(e,t){return!(C(e)&&!function(e){var t=e.get(a.a.Messaging).msgEnableSfbCloudFromBVD,n=e.get(a.a.UserResources),r=n.isSfbCloud,i=n.isSipEnabled,s=n.isSfbCloudInBVD,o=n.isSipEnabledInBVD;return!!(t?o&&s:i&&r)}(t))};var j=function(e,t){return void 0===t&&(t=!1),T(e.type,t)},T=function(e,t){return void 0===t&&(t=!1),e===o.j.Chat||e===o.j.PhoneChat||e===o.j.OneOnOne||!t&&D(e)},I=function(e){return e.id===r.eb.NotificationConversationId},M=function(e){return e.type===o.j.Team||e.type===o.j.Topic},N=function(e){return function(e){if(!e||!M(e))return;var t=e.threadProperties[o.hb.SpaceTypes],n=t?parseInt(t,10):0;return e.threadProperties[o.hb.SubstrateGroupId]?c.k.Shared:(n&c.D.Private)===c.D.Private?c.k.Private:c.k.Standard}(e)===c.k.Shared},w=function(e){return D(e.type)},D=function(e){return e===o.j.Meeting},P=function(e,t){return e.from.substring(e.from.indexOf("/")+1)===(-1===t.indexOf(o.U)?o.U+t:t)},F=function(e,t){if(!e.threadProperties)return 0;var n=t.get(a.a.Sync).enableRetentionHorizonV2Property||N(e)?e.threadProperties.retentionHorizonV2:0;return n&&isFinite(Number(n))?Number(n):0},A=function(e){return!!e.mruEvictedTime&&e.mruEvictedTime>0},U=function(e,t,n){var r=F(t,n);return!isNaN(Number(e))&&!isNaN(r)&&Number(e)<r},L=function(e,t){return!Object(s.s)(e.id)||!v(e)&&!d(e)&&(Object(i.isArray)(e.members)&&t?Object(i.some)(e.members,(function(e){return e&&e.id===t})):!(e.threadProperties&&M(e)&&!e.threadProperties[o.hb.LastLeaveAt]&&!e.threadProperties[o.hb.LastJoinAt])&&!(e.threadProperties&&e.threadProperties[o.hb.LastLeaveAt]&&(!e.threadProperties[o.hb.LastJoinAt]||e.threadProperties[o.hb.LastJoinAt]<e.threadProperties[o.hb.LastLeaveAt])))};function E(e){return R(e.properties&&e.properties[o.i.ConsumptionHorizonBookmark]||o.ob)}function R(e){var t=function(e){var t=3,n=e.split(";");return n&&n.length===t&&n[0]&&!isNaN(Number(n[0]))&&n[1]&&!isNaN(Number(n[1]))&&n[2]&&!Object(i.isNil)(Number(n[2]))?n:o.ob.split(";")}(e),n=t[0],r=t[1],a=t[2],s=Number(r)||0;return{originalArrivalTime:Number(n)||0,timeStamp:s,clientMessageId:a}}var B=function(e){var t=function(e){return R(e.properties&&e.properties[o.i.ConsumptionHorizon]||o.ob)}(e),n=E(e);return!Object(i.isNil)(e.lastMessageTimeUtc)&&e.lastMessageTimeUtc<=t.originalArrivalTime&&0===n.originalArrivalTime};var x=function(e,t){var n="";e.lastMessage&&(Object(s.q)(e.lastMessage)?n=function(e){var t="";if(Object(s.q)(e)&&e.content){var n=e.content.match(/<initiator>(.*?)<\/initiator>/i);n&&n[1]&&(t=n[1].trim())}return t}(e.lastMessage)||"":e.lastMessage.from&&(n=Object(i.last)(e.lastMessage.from.split("/"))||""));var r=E(e);return B(e)||-1!==n.indexOf(t)&&0===r.originalArrivalTime},_=function(e,t,n){var r,a=!e.members||!!e.members&&Object(i.some)(e.members,(function(e){return!e}));if(n&&!a){var s=function(e,t){return Object(i.reduce)(e.members,(function(e,n){var r=n.id;return r&&r!==t&&e.push(r),e}),[])}(e,t);r=b(e)&&1===s.length?n[s[0]]:n[e.id]}return r},H=function(e){if(!e)throw new Error("Invalid conversation passed to topicName");if(e.threadProperties){if(j(e)){var t=e.threadProperties.topic;return t&&-1!==t.indexOf(":")&&(t=void 0),t}var n=e.threadProperties.topic,r=e.threadProperties[o.hb.TopicThreadTopic];if(n&&n.trim())return n;if(r&&r.trim())return r}return""},G=function(e,t){return void 0===t&&(t=!1),j(e,!0)&&!z(e,t)},z=function(e,t){void 0===t&&(t=!1);var n=e.members&&e.members.length<=2;return j(e,!0)&&n&&(b(e)||K(e)||!t&&V(e)||q(e))},q=function(e){return e.members&&e.members.length<=2&&W(e)&&(e.type===o.j.PhoneChat||e.threadProperties&&e.threadProperties[o.hb.ThreadType]===o.jb.PhoneChat)},W=function(e){return Object(i.some)(e.members,(function(e){return!!e.id&&e.id.startsWith(o.z.Pstn)}))},V=function(e){return j(e,!0)&&e.members&&2===e.members.length&&!Object(i.isNil)(e.threadProperties)&&parseInt(e.threadProperties[o.hb.CreatedAt],10)<o.I},K=function(e){return!!e.id&&e.id.indexOf(o.kb)>-1},Q=function(e){return e.threadProperties&&e.threadProperties[o.hb.ThreadType]===o.jb.Team&&g(e)},J=function(e){return function(e){return k(e)}(e)||function(e){return X(e)}(e)||function(e){return $(e&&e.id)}(e)},X=function(e){return Object(i.endsWith)(e.id,o.p)||Object(i.endsWith)(e.id,o.o)||Object(i.startsWith)(e.id,o.B)},Y=function(e){return X(e)||se(e)},$=function(e){return!!e&&(Object(i.endsWith)(e,o.P)||Object(i.startsWith)(e,o.Q))},Z=function(e){var t=Object(i.endsWith)(e,o.p)||Object(i.endsWith)(e,o.o)||Object(i.startsWith)(e,o.B),n=e.endsWith(o.O),r=$(e);return t||n||r},ee=function(e){var t=function(e,t,n){if(void 0===n&&(n=!1),Object(s.s)(e.id)&&!v(e)){if(e.memberProperties&&n)return e.memberProperties[o.w.ExpirationTime];if(e.members&&t){var r=Object(i.find)(e.members,(function(e){return e&&e.id===t}));return r&&r.memberExpirationTime}}}(e),n=t&&t<Date.now();return L(e)&&!n},te=function(e){if(e.threadProperties&&e.threadProperties[o.hb.Topics]){var t=e.threadProperties[o.hb.Topics];return"["===t.substr(0,1)?JSON.parse(t):t.split("|").map((function(e){return{id:e,name:"Unknown"}}))}return[]},ne=function(e){var t=te(e),n=function(e){if(e.threadProperties){if(e.threadProperties[o.hb.XTeamName])return e.threadProperties[o.hb.XTeamName];if(e.type===o.j.Team&&e.threadProperties.topic)return e.threadProperties.topic}}(e);return t.map((function(t){var r={};return r[o.hb.CreatedAt]=parseInt(t.createdat,10),r[o.hb.Picture]=t.picture,r[o.hb.XTeamName]=n,r.topic=t.name,r[o.hb.LastLeaveAt]=1,r[o.hb.ThreadType]=o.jb.Topic,r[o.hb.SpaceId]=e.id,{threadProperties:r,id:t.id,members:[],messages:"",properties:{},version:0,type:o.j.Topic,threadVersion:0,detailsVersion:-1,oldConsumptionHorizonKeys:[],teamId:e.id,lastMessageTimeUtc:0,isPending:void 0,memberProperties:{},mruEvictedTime:0,rosterVersion:0,rosterSummary:void 0,botMembers:[],lastSeenSkipRosterState:void 0,lastMessage:void 0,localClientId:"",isUserMember:!1,source:e.source}}))},re=function(e){var t=e.threadProperties&&e.threadProperties[o.hb.SpaceId];return(y(e)?e.id:g(e)?function(e){if(e.parentId)return e.parentId;if(g(e))try{var t=JSON.parse(e.threadProperties[o.hb.ParentSpaces]).linkedSpaceInfoItems[0].spaceThreadId;if(!Object(i.isEmpty)(t))return e.parentId=t,t}catch(e){return}}(e):t)||e.teamId},ie=function(e){return!(!e.properties||!e.properties[o.i.Alerts])&&"true"!==e.properties[o.i.Alerts].toLowerCase()},ae=function(e){return e.threadProperties&&e.threadProperties[o.hb.GapDetectionEnabled]},se=function(e){var t=ce(e);return t&&!X(e)&&z(e)&&Object(i.some)(e.members,(function(e){return e.tenantId&&e.tenantId!==t}))||oe(e.id)||oe(e.localClientId||"")},oe=function(e){return Object(i.startsWith)(e,o.C)},ce=function(e){return e.threadProperties&&e.threadProperties[o.hb.TenantId]}},XRes:function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return c}));var r,i,a=n("IoEE");!function(e){e[e.Standard=0]="Standard",e[e.Important=2]="Important",e[e.Urgent=3]="Urgent"}(r||(r={})),function(e){e.Standard="",e.Important="high",e.Urgent="urgent"}(i||(i={}));var s=function(e){return c(e)===a.b.MessageImportance.Important},o=function(e){return i[e]||i.Standard},c=function(e){switch(e){case i.Important:case r.Important:return a.b.MessageImportance.Important;case i.Urgent:case r.Urgent:return a.b.MessageImportance.Urgent;case i.Standard:case r.Standard:default:return a.b.MessageImportance.Standard}}},c2NR:function(e,t,n){"use strict";n.d(t,"b",(function(){return S})),n.d(t,"h",(function(){return j})),n.d(t,"n",(function(){return T})),n.d(t,"e",(function(){return I})),n.d(t,"j",(function(){return M})),n.d(t,"q",(function(){return N})),n.d(t,"k",(function(){return w})),n.d(t,"g",(function(){return D})),n.d(t,"d",(function(){return P})),n.d(t,"c",(function(){return F})),n.d(t,"f",(function(){return A})),n.d(t,"o",(function(){return U})),n.d(t,"p",(function(){return E})),n.d(t,"l",(function(){return R})),n.d(t,"i",(function(){return B})),n.d(t,"m",(function(){return x})),n.d(t,"a",(function(){return _}));var r=n("+7/b"),i=n("svWY"),a=n("jN5E"),s=n("zQSw"),o=n("3J71"),c=n("ux1a"),u=n("POyb"),l=n("XRes"),d=n("hs8O"),m=n("EQfm"),p=n("SdXO");function v(e,t){return JSON.stringify(Object(r.o)(Object(d.a)(e),function(e){return e=Object(m.a)(e,"__typename"),Object(i.map)(Object(i.compact)(e),(function(e){return{"@type":p.a.hyperLink,title:e.title,description:e.description,fileShareUrlMeta:e.fileShareUrlMeta,url:e.fileShareUrlMeta&&e.fileShareUrlMeta.shareUrl}}))}(t)))}var f,h=n("IoEE"),b=n("e4hD"),g=n("W1yN"),y=n("gXkv"),O=207,C=206,k=40318;!function(e){e[e.ChatWithRestrictedUserNotAllowed=40323]="ChatWithRestrictedUserNotAllowed",e[e.ChatWithLimitedUserNotAllowed=40324]="ChatWithLimitedUserNotAllowed",e[e.GroupChatNotAllowed=40325]="GroupChatNotAllowed",e[e.AddUserToChatNotAllowed=40326]="AddUserToChatNotAllowed",e[e.AddRestrictedUserInvalidOwnerNotAllowed=40327]="AddRestrictedUserInvalidOwnerNotAllowed",e[e.AddRestrictedUserNoOwnerNotAllowed=40328]="AddRestrictedUserNoOwnerNotAllowed",e[e.RemoveChatOwnerNotAllowed=40329]="RemoveChatOwnerNotAllowed",e[e.RemoveUserFromChatNotAllowed=40330]="RemoveUserFromChatNotAllowed",e[e.LeaveChatNotAllowed=40331]="LeaveChatNotAllowed",e[e.ChatWithExternalNotAllowed=40332]="ChatWithExternalNotAllowed",e[e.AddRestrictedUserExternalNotAllowed=40333]="AddRestrictedUserExternalNotAllowed",e[e.RemoveFullUserNotAllowed=40334]="RemoveFullUserNotAllowed",e[e.AddRestrictedUserFederatedChatNotAllowed=40335]="AddRestrictedUserFederatedChatNotAllowed",e[e.RemoveUserFromFederatedChatNotAllowed=40336]="RemoveUserFromFederatedChatNotAllowed"}(f||(f={}));var S=function(e,t,n,i){return Object(r.f)(void 0,void 0,Promise,(function(){var a;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,t.getChat(e)];case 1:return a=r.sent(),[2,Object(c.q)(a,n,i)]}}))}))},j=function(e,t){return Object(r.f)(void 0,void 0,Promise,(function(){var n,i,a;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n=[],e.forEach((function(e){return e.members&&e.members.forEach((function(e){n.push(e)}))})),[4,Object(u.a)(n,t)];case 1:return i=r.sent(),a={},i.forEach((function(e){a[e.id]=e})),[2,a]}}))}))},T=function(e,t,n,i,a){return Object(r.f)(void 0,void 0,Promise,(function(){var o,u,l,d,m,p,v,f,h;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,n.getChat(e)];case 1:if(o=r.sent(),u=o&&o.members,l=o&&o.isOneOnOne,d=i.newLogger("Chat Resolvers"),m=a.get(s.a.Messaging).maxRosterSizeInGroupChatChatServiceLimit,p=null!=m?m:Number.MAX_VALUE,!(l||u&&u.length<=p))return[3,6];r.label=2;case 2:return r.trys.push([2,4,,5]),[4,t.getMembersConsumptionHorizon(e)];case 3:return v=r.sent(),[3,5];case 4:return f=r.sent(),d.error("fail to fetch consumption horizon data from server because: "+f),[3,5];case 5:return[3,7];case 6:d.log("chat "+e+" is not supported for read receipt."),r.label=7;case 7:return h=v&&v.consumptionhorizons,[2,Object(c.v)(h)]}}))}))},I=function(e,t,n){void 0===n&&(n={fromSipUri:void 0,toSipUri:void 0,interopType:void 0,skipFanoutToBots:void 0});var i=e.content,a=e.importance,s=e.subject,o=e.files,u=e.computed,d=void 0===u?{}:u,m=e.id,p=e.messageType,f=e.clientMessageId,h=d,b=h.urlPreview,g=h.mentions,y=h.cards,O=h.embeddedLinks;return{id:m,messagetype:p,contenttype:"text",content:i,imdisplayname:t,clientmessageid:f,amsreferences:d.amsReferences,fromSipUri:n&&n.fromSipUri||void 0,toSipUri:n&&n.toSipUri||void 0,properties:Object(r.a)({importance:Object(l.b)(a),subject:s,cards:Object(c.y)(y),links:v(b?[b]:[],O||[]),mentions:Object(c.A)(g),files:Object(c.z)(o),policyViolation:e.policyViolation,interopType:n&&n.interopType},void 0!==(null==n?void 0:n.skipFanoutToBots)&&{skipfanouttobots:n.skipFanoutToBots})}},M=function(e){return e?e.map((function(e){var t=e.fileShareUrlMeta?Object(r.a)(Object(r.a)({},e.fileShareUrlMeta),{__typename:"FileShareUrlMeta"}):null;return Object(r.a)(Object(r.a)({},e),{__typename:"EmbeddedLink",fileShareUrlMeta:t})})):null},N=function(e,t,n,r,a){if(n){var s=n.indexOf("@"),o=-1!==s,c=n.substring(s).replace(""," ").replace(/^@/,"");if(e.length<=2&&!o)return[];if(c){var u=Object(i.escapeRegExp)(c),l=!o&&r?new RegExp("(?:^|\\W)"+u+"(?:$|\\W)","i"):new RegExp("((?:^|\\b|\\.)"+u+")","i");e=Object(i.filter)(e,(function(e){return!Object(i.isNil)(e)&&!Object(i.isNil)(e.displayName)&&l.test(e.displayName)||!Object(i.isNil)(e.email)&&l.test(e.email)}))}}a||(e=Object(i.filter)(e,(function(e){return e.id!==t})));return e=Object(i.take)(e,5)},w=function(e){return e?Object(r.a)(Object(r.a)({},e),{thumbnailMeta:e.thumbnailMeta?Object(r.a)(Object(r.a)({},e.thumbnailMeta),{__typename:"ImageMeta"}):null,__typename:"UrlPreview"}):null},D=function(e){return e?e.map((function(e){return{id:e.id,title:e.title,channelId:e.channelId,siteUrl:e.siteUrl,serverRelativeUrl:e.serverRelativeUrl,objectUrl:e.objectUrl,state:e.state,__typename:"DeepLink"}})):null},P=function(e,t){return t&&Object(i.remove)(t,(function(t){return t===e})),t&&Object(r.o)([{id:e,role:"Admin"}],t.map((function(e){return{id:e,role:"Admin"}})))},F=function(e,t,n){return void 0===n&&(n=null),Object(r.f)(void 0,void 0,Promise,(function(){var i,s,o,l,d,m,p;return Object(r.i)(this,(function(r){switch(r.label){case 0:return i=[],e.forEach((function(e){return i.push({id:e})})),s=2,[4,Object(u.a)(i,t)];case 1:return o=r.sent(),l=""+b.z.SkypeSpacesThread+c.a+Object(a.v4)(),d=new Date,m=d.toISOString(),p=d.getTime().toString(),[2,{__typename:"Conversation",id:l,title:n,members:o,consumptionHorizon:Object(c.d)(l,m),lastMessage:Object(c.e)(p,m),botMembers:null,isDisabled:!1,isOneOnOne:e.length===s,isRead:!1,chatType:h.b.ChatType.Chat,type:h.b.ChatType.Chat}]}}))}))},A=function(e,t,n,i){return void 0===i&&(i=""),Object(r.f)(void 0,void 0,Promise,(function(){var a;return Object(r.i)(this,(function(s){return a=t&&1===t.length?{uniquerosterthread:!0,fixedRoster:!0}:{},[2,e.createThread(n,i,Object(r.a)({threadType:"chat",chatFilesIndexId:2},a))]}))}))},U=function(e){var t;return"BotMessageBack"===(null==e?void 0:e.messageType)&&(t=!0),t},L=function(e,t,n){return Object(r.f)(void 0,void 0,Promise,(function(){var i,a;return Object(r.i)(this,(function(r){switch(r.label){case 0:i=e.serverResponse,r.label=1;case 1:return r.trys.push([1,3,,4]),a=t,[4,null==i?void 0:i.body.json()];case 2:return a.errResponseBody=r.sent(),t.errResponseMessage=JSON.parse(t.errResponseBody.message),t.status=null==i?void 0:i.status,[3,4];case 3:return r.sent(),n.newLogger("Chat Resolvers").error("Unable to parse server response into json"),[3,4];case 4:return[2]}}))}))},E=function(e,t,n,i){return Object(r.f)(void 0,void 0,Promise,(function(){var a,s;return Object(r.i)(this,(function(r){switch(r.label){case 0:a={},r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e.removeMemberFromThread(t,n)];case 2:return r.sent(),[3,5];case 3:return s=r.sent(),[4,L(s,a,i)];case 4:return r.sent(),[3,5];case 5:return[2,a]}}))}))},R=function(e,t,n,i,a){return Object(r.f)(void 0,void 0,Promise,(function(){var s,c,u,l,d;return Object(r.i)(this,(function(r){switch(r.label){case 0:return n.status===o.j.FORBIDDEN&&209===(null===(u=n.errResponseBody)||void 0===u?void 0:u.errorCode)&&(null===(l=n.errResponseMessage)||void 0===l?void 0:l.errorSubCode)in f?[4,a.skypeid()]:[3,2];case 1:return s=r.sent(),c=s===t?g.b.LeaveChatFailure:g.b.RemoveMemberFailure,i.newScenario(c).fail({"Thread.Id":e,errors:JSON.stringify({failureCount:1}),errorCode:JSON.stringify(null===(d=n.errResponseMessage)||void 0===d?void 0:d.errorSubCode),statusCode:n.status}),[2,!0];case 2:return[2,!1]}}))}))},B=function(e,t,n,i){return Object(r.f)(void 0,void 0,Promise,(function(){var a,o,c,u;return Object(r.i)(this,(function(r){switch(r.label){case 0:if(a=[],o=i.newLogger("Chat Resolvers"),!n.get(s.a.Messaging).enableInformationBarrierInMW||e!==O)return[2,a];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,t.json()];case 2:return(c=r.sent())&&c.multipleStatus&&c.multipleStatus.forEach((function(e){e&&e.statusCode===C&&e.statusSubCode===k&&a.push({id:e.id})})),[2,a];case 3:return u=r.sent(),o.error("fail to check for IB rejected users: "+u),[2,a];case 4:return[2]}}))}))},x=function(e,t,n,i){return Object(r.f)(void 0,void 0,Promise,(function(){var a;return Object(r.i)(this,(function(r){switch(r.label){case 0:return[4,B(e,t,n,i)];case 1:return[2,(a=r.sent())&&a.length>0]}}))}))},_=function(e,t,n){var r=Object(c.p)(t.id,t.title,t.members,t.lastMessage,t.consumptionHorizon);Object(y.c)(e,r,n)}},cCWX:function(e,t,n){"use strict";(function(e){function r(t){void 0===t&&(t=1);var n=new Uint32Array(t),r=e;if(r.msCrypto)r.msCrypto.getRandomValues(n);else if(r.crypto)r.crypto.getRandomValues(n);else for(var i=t;i--;){n[i]=Math.floor(4294967296*Math.random())}return Array.from(n)}n.d(t,"a",(function(){return r}))}).call(this,n("uKge"))},fDoL:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n("+7/b"),i=n("f4tu"),a=n("pybt"),s=n("8FIh"),o=n("cvjv"),c=n("PCsB"),u=n("3J71"),l=n("ifNO"),d=12e4,m=12e4,p=new i.f(1e4);function v(e,t,n){return Object(r.c)(this,arguments,(function(){var s;return Object(r.i)(this,(function(o){switch(o.label){case 0:return o.trys.push([0,8,,10]),[4,Object(r.e)(n())];case 1:return s=o.sent(),[4,Object(r.e)(f({chatService:e,chatServiceEndpointProvider:t,userId:s,delay:new i.d(2e3,2,d)}))];case 2:return[4,r.e.apply(void 0,[o.sent()])];case 3:return[4,o.sent()];case 4:return o.sent(),[4,Object(r.e)(Object(a.a)(m))];case 5:return o.sent(),[4,Object(r.e)("")];case 6:return[4,o.sent()];case 7:return o.sent(),[3,10];case 8:return o.sent(),[4,Object(r.e)(Object(a.a)(p.next()))];case 9:return o.sent(),[3,10];case 10:return[3,0];case 11:return[2]}}))}))}var f=Object(s.a)((function(e){var t=e.chatServiceEndpointProvider,n=e.userId;return Object(o.a)(t.postActiveEndpoint(n),3e4)}),(function(e,t){var n=t.delay;return Object(r.f)(void 0,void 0,void 0,(function(){return Object(r.i)(this,(function(t){if(e.context===u.e.RequireStatus&&Object(c.a)(Object(l.e)(e,"status",0))||e.context===u.e.Timed||e instanceof TypeError)throw e;return[2,Object(a.a)(n.next())]}))}))}))},gXkv:function(e,t,n){"use strict";n.d(t,"a",(function(){return d})),n.d(t,"d",(function(){return m})),n.d(t,"e",(function(){return p})),n.d(t,"b",(function(){return v})),n.d(t,"f",(function(){return f})),n.d(t,"c",(function(){return h})),n.d(t,"g",(function(){return b}));var r=n("+7/b"),i=n("TdW2"),a=n("vIjS"),s={kind:"Document",definitions:Object(r.o)([{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"chat"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"convId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"chat"},arguments:[{kind:"Argument",name:{kind:"Name",value:"convId"},value:{kind:"Variable",name:{kind:"Name",value:"convId"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"chatFields"}}]}}]}}],a.b.definitions)},o=n("jN5E"),c=n("e4hD"),u=n("ux1a"),l={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"draftChatIdChanged"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"draftChatIdChanged"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"oldChatId"}},{kind:"Field",name:{kind:"Name",value:"newChatId"}}]}}]}}]},d=[c.jb.Chat,c.jb.Meeting,c.jb.OneOnOne,c.jb.PhoneChat,c.jb.SfbInteropChat];function m(e,t,n){return!!y(g(e,n),t)}function p(e,t,n){return Object(r.f)(this,void 0,Promise,(function(){var i,a,o,c;return Object(r.i)(this,(function(r){switch(r.label){case 0:if(!(i=g(e,n))||!i.chats.edges)return[2];if(y(i,t))return[2];a=null,r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.query({query:s,variables:{convId:t}})];case 2:return o=r.sent().data,a=o,[3,4];case 3:return c=r.sent(),n.warn("[ensureChatExistsInCache]: error reading from appolo cache "+c.message),[3,4];case 4:return a&&a.chat?(v(e,a.chat,n),[2]):[2]}}))}))}function v(e,t,n,a){var s,o=g(e,n);if((null===(s=null==o?void 0:o.chats)||void 0===s?void 0:s.edges)&&t)if(y(o,t.id))n.warn("Chat exists in chatlist cache",t.id);else{var c=a?o.chats.edges.filter((function(e){var t;return(null===(t=null==e?void 0:e.node)||void 0===t?void 0:t.id)!==u.b})):o.chats.edges,l={node:Object(r.a)({chatSubType:null,isLastMessageFromMe:null,isDisabled:null,isMuted:null},t),__typename:"ChatsEdge"},d=Object(r.a)(Object(r.a)({},o),{chats:Object(r.a)(Object(r.a)({},o.chats),{edges:Object(r.o)([l],c)})});try{e.writeQuery({query:i.a,data:d})}catch(e){n.warn("[addChatToChatList]: error in writeQuery appolo cache "+e.message)}}}function f(e,t,n){var a,s=g(e,n);if(null===(a=null==s?void 0:s.chats)||void 0===a?void 0:a.edges){var o=s.chats.edges.filter((function(e){var n;return(null===(n=null==e?void 0:e.node)||void 0===n?void 0:n.id)!==t}));try{e.writeQuery({query:i.a,data:Object(r.a)(Object(r.a)({},s),{chats:Object(r.a)(Object(r.a)({},s.chats),{edges:o})})})}catch(e){n.warn("[removeChatFromChatList]: error in writeQuery appolo cache "+e.message)}}}function h(e,t,n){v(e,t,n,!0),Object(u.l)(null==t?void 0:t.id)&&O(e,u.b,t.id,n)}function b(e,t,n,r){f(e,t,r),O(e,t||"",n||"",r)}function g(e,t){try{return e.readQuery({query:i.a})}catch(e){return t.warn("[readChatsFromCache]: error in reading from appolo cache "+e.message),null}}function y(e,t){if(e&&e.chats.edges)return e.chats.edges.find((function(e){return e&&e.node&&e.node.id===t}))}function O(e,t,n,r){try{var i=Object(o.v4)();e.writeQuery({query:l,data:{draftChatIdChanged:{__typename:"DraftChatIdChangedInfo",id:i,newChatId:n,oldChatId:t}}})}catch(e){r.warn("[writeDraftChatIdChanged]: Error while writing draft chat id changed info query to cache "+e.message)}}},hs8O:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return s}));var r=n("svWY"),i=n("SdXO");n("EQfm");function a(e){return{url:e.url,title:e.title,description:e.description,previewEnabled:!0,thumbnail:e.thumbnail,thumbnailMeta:e.thumbnail_meta}}function s(e){return Object(r.map)(Object(r.compact)(e),(function(e,t){return{"@type":i.a.hyperLink,itemid:t.toString(),url:e.url,previewenabled:e.previewEnabled,preview:{previewurl:e.thumbnail,previewmeta:e.thumbnailMeta,title:e.title,description:e.description}}}))}},lMlv:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.User="8:orgid:",e.Pstn="4:",e.Bot="28:"}(r||(r={}))},"o+Te":function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("ozJ0"),i=n("9oEN"),a=function(){function e(){}return e.prototype.initialize=function(e){this.logger=e,this.logger.debug("Event Logging-Service initialized")},e.getInstance=function(){return this.instance},e.prototype.event=function(e,t){Object(i.b)(r.a.Tracking,e,t)},e.prototype.customEvent=function(e,t,n){Object(i.b)(e,t,n)},e.instance=new e,e}();function s(e,t){a.getInstance().event(e,t)}},ra0y:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r,i=n("+7/b");!function(e){e[e.Value=0]="Value",e[e.Error=1]="Error"}(r||(r={}));var a=n("W1yN"),s=n("svWY"),o=function(){function e(e,t,n,r,i){if(void 0===e&&(e=100),this.newScenario=t,this.logger=r,this.getDroppedEventMetadataFn=i,e<0)throw new TypeError("BufferLimit has to be > 0");this._isComplete=!1,this._values=[],this._promiseResolutionFunctions=[],this._bufferLimit=e,this._overflowScenario=null,this._droppedEvents=0,this._operationName=n,this._droppedEventMetadataToCount=new Map}return e.prototype.next=function(e){this._push({type:r.Value,value:e})},e.prototype.error=function(e){this._push({type:r.Error,error:e})},e.prototype.complete=function(){for(this._isComplete=!0;this._promiseResolutionFunctions.length>0;)this._promiseResolutionFunctions.shift().resolve({done:!0})},e.prototype.nextPromise=function(){var e=this;if(this._overflowScenario&&this._values.length<this._bufferLimit){var t="AsyncIterableObserver buffer is no longer full for operation "+this._operationName+". Dropped "+this._droppedEvents+" events.";if(this.getDroppedEventMetadataFn){var n=Object(s.maxBy)(Array.from(this._droppedEventMetadataToCount.keys()),(function(t){return e._droppedEventMetadataToCount.get(t)}));t=t+" Max dropped event metadata: "+n+".",this._overflowScenario.appendEventData({context:JSON.stringify(Array.from(this._droppedEventMetadataToCount.entries())),reason:n})}this.logger&&this.logger.warn(t),this._overflowScenario.stop({size:this._droppedEvents}),this._overflowScenario=null,this._droppedEvents=0,this._droppedEventMetadataToCount=new Map}if(this._values.length>0){var i=this._values.shift(),a=i.type,o=i.value,c=i.error;return a===r.Error?Promise.reject(c):Promise.resolve({done:!1,value:o})}return this._isComplete?Promise.resolve({done:!0}):new Promise((function(t,n){e._promiseResolutionFunctions.push({resolve:t,reject:n})}))},e.prototype._push=function(e){if(this._promiseResolutionFunctions.length>0){var t=this._promiseResolutionFunctions.shift(),n=t.resolve,i=t.reject;e.type===r.Error?i(e.error):n({done:!1,value:e.value})}else{if(this._values.length>this._bufferLimit-1){if(this._droppedEvents+=1,this.getDroppedEventMetadataFn&&e.value){var s=this.getDroppedEventMetadataFn(e.value),o=this._droppedEventMetadataToCount.get(s);this._droppedEventMetadataToCount.set(s,o?o+1:1)}throw!this._overflowScenario&&this.newScenario&&(this._overflowScenario=this.newScenario(a.b.OnAsyncIterableObserverOverflow),this._overflowScenario.appendEventData({operationName:this._operationName})),new Error("AsyncIterableObserver buffer is full, all future events will be dropped")}this._values.push(e)}},e}();function c(e,t,n,r,a,s){return Object(i.c)(this,arguments,(function(){var c,u,l;return Object(i.i)(this,(function(d){switch(d.label){case 0:c=new o(t,n,r,a,s),u=e.subscribe(c),d.label=1;case 1:return d.trys.push([1,,8,9]),[4,Object(i.e)(c.nextPromise())];case 2:l=d.sent(),d.label=3;case 3:return!l||l.done?[3,7]:[4,Object(i.e)(l.value)];case 4:return[4,d.sent()];case 5:return d.sent(),[4,Object(i.e)(c.nextPromise())];case 6:return l=d.sent(),[3,3];case 7:return[3,9];case 8:return u.unsubscribe(),[7];case 9:return[2]}}))}))}},uZya:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n("+7/b"),i=n("V4fY"),a=n("zQSw"),s=n("GQA1"),o=n("o+Te"),c=n("F/li"),u=n("svWY"),l=n("KY7/"),d=c.e*c.f*16,m=2*c.a*c.c*c.e*c.f,p="50:sms:",v="50:smsunverified:",f=function(){function e(){}return e.isUnknownUser=function(e){return"unknown_email_address@invalid.teams.ms"===e.email||"unknown@af4716f4-406e-409b-acc1-b8bf9efe83fa.com"===e.email},e.getRequestCount=function(e){return e&&e.requestCount||e.$$requestCount||0},e.sanitizeUserProfileObject=function(e){if(!e)throw new Error("Invalid user profile object passed");var t=Object(r.a)({isSelf:void 0,managerLevel:void 0},e);t.isSelf,t.managerLevel,t.userClassification;return Object(r.m)(t,["isSelf","managerLevel","userClassification"])},e.getCacheExpiryCallbackForUser=function(e,t){return void 0===t&&(t=null),function(n){if(n.isAnonymousUser)return 0;var r=n.skypeTeamsInfo&&n.skypeTeamsInfo.isSkypeTeamsUser;return e.get(a.a.People).enableNonTeamsUserShortCacheExpiry&&!r?d:t||m}},e.sendTelemetryForIndexDBUnknownUser=function(e,t){(e=Object(u.map)(e,(function(e){return e.includes("temp_fed:")?"UnresolvedFederationUserMriLogText":e})))&&e.length>0&&Object(o.a)(s.c.unknownUserFromDB,{errors:JSON.stringify([{unknownUserMris:e,callerInfo:t}])})},e.isEnoughProfileInfoInCache=function(t,n){return t&&!e.isUnknownUser(t)&&(!n||n&&!Object(u.isUndefined)(t.isShortProfile)&&!t.isShortProfile)},e.addDescription=function(e,t){if(void 0===t&&(t=!1),!e.description&&!this.isBot(e)){var n=e.userPrincipalName.substr(0,e.userPrincipalName.indexOf("@")).toUpperCase();e.description=e.jobTitle?"("+n+") "+e.jobTitle:e.userType===s.d.guest||t?e.email||e.userPrincipalName:n}},e.addUserDisplaynamePostFix=function(t,n,r){var i=n.get(a.a.People).enableUnverifiedTag,s=i&&t.isAnonymousUser;return t.displayName=e.removeMismatchedPostFix(i,t.displayName,r),s?this.addUnverifiedIndicator(t,r):this.addGuestIndicator(t,r)},e.addUnverifiedIndicator=function(e,t){var n=t.stringTranslate("peoplePicker","unverified_user_postfix"),r=e.guestlessDisplayName&&e.guestlessDisplayName.indexOf(n);r&&r>=0?e.guestlessDisplayName=e.guestlessDisplayName.substring(0,r-1):(!e.displayName.includes(n)&&e.displayName!==t.stringTranslate("peoplePicker","default_unverified_displayname")&&(e.displayName=e.displayName+" "+n),e.givenName&&(e.guestGivenName=e.givenName+" "+n),e.surname&&(e.guestSurname=e.surname+" "+n))},e.addGuestIndicator=function(e,t){var n=t.stringTranslate("peoplePicker","guest_user_postfix"),r=e.guestlessDisplayName.indexOf(n);r>-1?e.guestlessDisplayName=e.guestlessDisplayName.substring(0,r).trimRight():(e.displayName=e.displayName+" "+n,e.givenName&&(e.guestGivenName=e.givenName+" "+n),e.surname&&(e.guestSurname=e.surname+" "+n))},e.getUserDisplaynamePostFix=function(t,n,r,i,s){if(!n)return null;var o=s.stringTranslate("peoplePicker","default_guest_displayname"),c=s.stringTranslate("peoplePicker","guest_user_postfix"),u=s.stringTranslate("peoplePicker","default_unverified_displayname"),l=s.stringTranslate("peoplePicker","unverified_user_postfix"),d=s.stringTranslate("peoplePicker","external_user_postfix");if(t.startsWith("8:teamsvisitor:")){var m=i.get(a.a.People).enableUnverifiedTag;n=e.removeMismatchedPostFix(m,n,s),m?n.includes(l)||n===u||(n+=" "+l):n.includes(c)||n===o||(n+=" "+c)}else r&&(n.includes(d)||(n+=" "+d));return n},e.removeMismatchedPostFix=function(e,t,n){var r=e?"guest_user_postfix":"unverified_user_postfix",i=n.stringTranslate("peoplePicker",r),a=t.indexOf(i);return a>-1?t.substring(0,a).trimRight():t},e.addUserTypeInfo=function(e){e.type&&"ADUser"===e.type||"User"===e.objectType?(e.type=s.a.type.person,e.$$subType="ADUser"):e.type&&(e.$$subType=e.type)},e.applyFeatureFlagSettings=function(e,t){var n=e.includeFeatures;switch(e.name){case i.c.addToMeeting:case i.c.meetingSchedule:var r=t.get(a.a.Federated),s=r.enableBotsInScheduledMeetings;r.enableFederatedUsersInMeetings||(n=Object(u.difference)(n,[i.b.Federated])),s&&(n=Object(u.difference)(n,[i.b.Bot]));break;case i.c.addToChat:t.get(a.a.Federated).enableFederatedUsersInAddToChat||(n=Object(u.difference)(n,[i.b.Federated])),t.get(a.a.DistributionLists).enableDLsInAddToChat||(n=Object(u.difference)(n,[i.b.DL]));break;case i.c.addToTeam:t.get(a.a.Federated).enableFederatedUsersInAddToTeam||(n=Object(u.difference)(n,[i.b.Federated]));break;case i.c.addToSpeedDialOrContacts:t.get(a.a.Federated).enableFederatedUsersInAddToSpeedDialOrContacts||(n=Object(u.difference)(n,[i.b.Federated]))}return l.a.createFrom(e,n)},e.filterSearchResults=function(t,n,r){var i=n;return(t=e.applyFeatureFlagSettings(t,r)).includeFederated||(i=i.filter((function(t){return!e.isFederatedUser(t)}))),t.includeGuest||(i=i.filter((function(t){return!e.isGuestUser(t)}))),t.includeBot||(i=i.filter((function(t){return!e.isBot(t)}))),t.includeDL||(i=i.filter((function(t){return!e.isDistributionList(t)}))),t.includePstn||(i=i.filter((function(t){return!e.isPSTNUser(t)}))),t.includeAADTenant||(i=i.filter((function(t){return!e.isInTenantUser(t)}))),t.includeCallQandAA||(i=i.filter((function(t){return!e.isCallQorAAUser(t)}))),i},e.getTflOffNetworkUserDefaultDisplayName=function(e){return e&&e.substring(e.lastIndexOf(":")+1)},e.isFederatedUser=function(e){return!!e.isFederated},e.isGuestUser=function(e){return e.type===s.d.guest||e.userType===s.d.guest},e.isTFLUser=function(e){return e.type===s.d.tflUser},e.isInTenantUser=function(t){return!(t.type!==s.a.type.person&&"ADUser"!==t.type||e.isGuestUser(t)||t.isFederated)},e.isBot=function(e){var t;return(null===(t=e.type)||void 0===t?void 0:t.toUpperCase())===s.b.botType},e.isDistributionList=function(e){return e.type===s.d.DistributionList&&e.objectType===s.d.DistributionList},e.isPSTNUser=function(e){return e.mri&&0===e.mri.indexOf("4:")},e.isSfcUser=function(e){return e.type===s.d.skypeConsumer},e.isCallQorAAUser=function(e){return e.type===s.d.voiceApp},e.isTFLOffNetworkUser=function(e){return 0===(null==e?void 0:e.indexOf("8:tfloffnetwork:"))},e.isTFLSmsUnVerifiedMri=function(e){return 0===(null==e?void 0:e.indexOf(v))},e.isTFLSmsVerifiedMri=function(e){return 0===(null==e?void 0:e.indexOf(p))},e.isTFLSmsMri=function(e){return 0===(null==e?void 0:e.indexOf(p))||0===(null==e?void 0:e.indexOf(v))},e.isDisplayNameUnknownUser=function(e){return e&&"Unknown User"===e},e.isConversationItem=function(e){var t;return 0===(null===(t=e.id)||void 0===t?void 0:t.indexOf("19:"))},e.isTag=function(e){return"Tag"===e.type},e}()},uo7e:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"consumptionHorizonFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ConsumptionHorizon"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"originalArrivalTime"}},{kind:"Field",name:{kind:"Name",value:"timeStamp"}},{kind:"Field",name:{kind:"Name",value:"clientMessageId"}}]}}]}},ux1a:function(e,t,n){"use strict";n.d(t,"a",(function(){return U})),n.d(t,"b",(function(){return L})),n.d(t,"z",(function(){return Q})),n.d(t,"y",(function(){return J})),n.d(t,"B",(function(){return ae})),n.d(t,"w",(function(){return oe})),n.d(t,"e",(function(){return ue})),n.d(t,"d",(function(){return le})),n.d(t,"p",(function(){return de})),n.d(t,"C",(function(){return me})),n.d(t,"h",(function(){return pe})),n.d(t,"u",(function(){return ge})),n.d(t,"v",(function(){return Me})),n.d(t,"x",(function(){return Ne})),n.d(t,"q",(function(){return we})),n.d(t,"s",(function(){return De})),n.d(t,"t",(function(){return Pe})),n.d(t,"o",(function(){return Fe})),n.d(t,"E",(function(){return Ae})),n.d(t,"A",(function(){return Ue})),n.d(t,"D",(function(){return We})),n.d(t,"g",(function(){return Ve})),n.d(t,"i",(function(){return Qe})),n.d(t,"r",(function(){return et})),n.d(t,"j",(function(){return tt})),n.d(t,"n",(function(){return nt})),n.d(t,"k",(function(){return rt})),n.d(t,"f",(function(){return it})),n.d(t,"l",(function(){return at})),n.d(t,"m",(function(){return st})),n.d(t,"c",(function(){return ot}));var r=n("+7/b"),i=n("s7wg"),a=n("IoEE"),s=n("z4q9"),o=n("e4hD"),c=n("YZyc"),u=n("VyoL"),l=n("g5XK"),d=n("FaER"),m=n("vJjW"),p=n("DiTa"),v=n("ifNO"),f=n("3J71"),h=n("svWY"),b="default",g=function(e){return"incoming"===e?a.b.CallDirection.Incoming:"outgoing"===e?a.b.CallDirection.Outgoing:a.b.CallDirection.Unknown},y=function(e){switch(e){case"missed":return a.b.CallLogCallState.Missed;case"accepted":return a.b.CallLogCallState.Accepted;case"declined":return a.b.CallLogCallState.Declined;case"acceptedElsewhere":return a.b.CallLogCallState.AcceptedElsewhere;default:return a.b.CallLogCallState.Unknown}},O=function(e){return"twoParty"===e?a.b.CallLogCallType.TwoParty:"multiParty"===e?a.b.CallLogCallType.MultiParty:a.b.CallLogCallType.Unknown},C=function(e){switch(e){case"default":return a.b.CallLogSessionType.Default;case"screenSharing":case"ScreenSharing":return a.b.CallLogSessionType.ScreenSharing;case"emergencyGroupCall":return a.b.CallLogSessionType.EmergencyGroupCall;default:return a.b.CallLogSessionType.Unknown}},k=function(e){return e?Object(r.a)({type:b},e):void 0},S=function(e){return{type:e.type,onBehalfOf:e.onBehalfOf&&Object(r.a)({type:b},e.onBehalfOf),details:e.details&&Object(r.a)({type:b},e.details)}},j={__typename:"CallLogParticipant",displayName:"Uknown",id:"28:unknown",type:b},T=function(e,t,n,r,i){var a,s,c,u,l=(new Date).toISOString();if(i===o.y.CallTranscript){if(!(d=function(e,t){if(t)try{var n=JSON.parse(unescape(t.replace(/\u200b|\\/g,"")));return{callId:n.callId,userParticipantId:n.originatorParticipantId,transcriptMsg:{scopeId:n.scopeId}}}catch(t){return e.error("failed to parse transcription content.",t),null}}(e,n)))return;a=d.callId,s=d.userParticipantId,c=d.transcriptMsg}else if(i===o.y.CallRecording){var d;if(!(d=function(e,t){var n,r,i;if(e){var a=(new DOMParser).parseFromString(e,"text/xml");return{callId:null===(n=a.querySelector("Id[type=callId]"))||void 0===n?void 0:n.getAttribute("value"),userParticipantId:null===(r=a.querySelector("Id[type=OriginatorParticipantId]"))||void 0===r?void 0:r.getAttribute("value"),recordingMsg:{conversationId:o.f,messageId:t||"",initiatorId:(null===(i=a.querySelector("RecordingInitiatorId"))||void 0===i?void 0:i.getAttribute("value"))||"",content:e}}}}(n,r)))return;a=d.callId,s=d.userParticipantId,u=d.recordingMsg}else a=t.callId,s=null==t?void 0:t.userParticipantId,l=t.startTime;return{callId:a,userParticipantId:s,transcript:c,recordings:u&&[u],startTime:l}},I=function(e,t,n,i,a,s){if(!(void 0===n?!t:n!==o.f)){var c=s.newLogger("CallHistoryHelper");try{var u=t?JSON.parse(t):{},l=u.applicationContent,d=u.callDirection,m=u.callState,p=u.callType,v=u.connectTime,f=u.endTime,h=u.messageId,b=u.originatorParticipant,I=u.participantList,M=u.sessionType,N=u.sharedCorrelationId,w=u.targetParticipant,D=u.threadId,P=u.spamProperties,F=T(c,u,a,e,i);if(!F)return;var A=k(b);return A||(A=j,c.warn("Could not parse valid participant from "+t)),Object(r.a)({applicationContent:l&&S(l),callDirection:g(d),callState:y(m),callType:O(p),connectTime:v,endTime:f,messageId:h,originatorParticipant:A,participantList:I?I.map(k):[],targetParticipant:w&&k(w),threadId:D,sessionType:C(M),sharedCorrelationId:null!=N?N:"",spamRiskLevel:P?P.riskLevel:null},F)}catch(e){c.warn("UnhandledException in message transformation: "+e)}}},M=n("XRes"),N=n("Jn2m"),w=n("VxlM"),D="http://schema.skype.com/StarredMessage",P=d.a,F=new Map([["sms",a.b.EscalationModality.SMS],["email",a.b.EscalationModality.Email],["call",a.b.EscalationModality.Call],["teamscall",a.b.EscalationModality.TeamsCall],["etnp",a.b.EscalationModality.ETNP]]),A=new Set(["RichText/Media_CallRecording","RichText/Media_CallTranscript","Event/Call"]),U="preview-",L="newchat",E="deeplink",R=function(e){return e&&e.emotions?e.emotions.map((function(e){return{key:e.key,users:e.users.map((function(e){var t=e.mri,n=e.time,r=e.value;return{id:P(t),time:n,value:r}}))}})):null},B=function(e){if(!e||!e.emotions)return null;var t=e.emotions;return Object.keys(t).map((function(e){return{key:e,count:t[e]}}))},x=function(e){return e&&e.escalations?JSON.parse(e.escalations).map((function(e){var t=e.key,n=e.users;return{key:F.get(t),users:n.map((function(e){var t=e.mri,n=e.time,r=e.value;return{mri:P(t),time:n,value:r}}))}})):null},_=function(e,t){return e&&e.mentions?z(e.mentions,t):null},H=function(e,t){return e&&e.onbehalfof?z(e.onbehalfof,t):null},G=function(e,t){if(!t||!t.atp)return null;var n=t.atp;try{return"string"==typeof n?JSON.parse(n):n}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in toAtpSharepointData: "+t),null}},z=function(e,t){var n="string"==typeof e?JSON.parse(e):e;return n?n.map((function(e){var n=e.itemid,r=e.mri,i=e.displayName,a=e.mentionType;return{id:t+"_"+n,userId:r,itemId:n,displayName:i,mentionType:a}})):null},q=function(e){if(!e||!e.files)return null;try{var t=JSON.parse(null==e?void 0:e.files);return(t=t.filter((function(e){return e.type===E}))).map((function(e){var t=e.id,n=e.title,r=e.fileInfo,i=e.channelId;return{id:t,title:n,state:e.state,serverRelativeUrl:r.serverRelativeUrl,channelId:i,siteUrl:r.siteUrl,objectUrl:r.fileUrl}}))}catch(e){return null}},W=function(e){if(!e||!e.files)return null;try{var t=JSON.parse(e.files);return t=t.filter((function(e){return e.type!==E})),Object(h.map)(t,(function(e){return V(e)}))}catch(e){return null}},V=function(e){var t=["http","https"],n=e.filePreview,i=e.chicletBreadcrumbs,s=e.fileInfo,o=e.anchorFileId,c=e.progressComplete,u=e.isUploadError,l=e.fileChicletState,d=s.shareUrl,p=s.shareId,v=s.itemId,f=n||{},h=null==l?void 0:l.serviceName,b=K(e,2),g=b.id,y=b.baseUrl,O=b.objectUrl,C=b.type,k=b.title,S=b.state,j="active"!==S&&"hidden"!==S;return Object(r.a)({id:g,itemId:v,chicletBreadcrumbs:i,baseUrl:Object(m.g)(y,t),objectUrl:Object(m.g)(O,t),shareId:p,shareUrl:d,type:C,title:k,fileId:g,isReferencedFile:j,anchorFileId:o,progressComplete:c&&parseInt(c,10)||null,serviceName:h&&a.b.FileViewServiceName[h],state:S&&a.b.FileChicletState[S],hasUploadFailed:u},f)},K=function(e,t){var n,r,i=e.version,a=e.id,s=e.baseUrl,o=e.objectUrl,c=e.type,u=e.title,l=e.state;if(i!==t&&(a=e.itemid,u=e.fileName,c=e.fileType,o=(n=e.fileInfo).fileUrl,s=n.siteUrl,l=null===(r=e.fileChicletState)||void 0===r?void 0:r.state),"string"!=typeof a)throw Object(v.a)("ChatHelpers",f.d.Undefined,"toFiles",{id:a,version:i,type:c},"File id is missing");return{id:a,baseUrl:s,objectUrl:o,type:c,title:u,state:l}},Q=function(e){return JSON.stringify(Object(h.map)(e,(function(e){var t=e.id,n=e.itemId,r=e.baseUrl,i=e.type,a=e.title,s=e.objectUrl,o=e.previewUrl,c=e.shareUrl,u=e.shareId,l=e.state,d=e.chicletBreadcrumbs,m=e.serviceName,p=e.previewHeight,v=e.previewWidth,f=e.progressComplete;return{itemid:t,fileName:a,fileType:i,fileInfo:{itemId:n,fileUrl:s,siteUrl:r,serverRelativeUrl:"",shareUrl:c,shareId:u},fileChicletState:{serviceName:m,state:l},"@type":"http://schema.skype.com/File",version:2,id:t,baseUrl:r,objectUrl:s,type:i,title:a,state:l,chicletBreadcrumbs:d,providerData:{code:null,type:0},botFileProperties:{},isUploadError:e.hasUploadFailed,progressComplete:f,filePreview:{previewUrl:o,previewHeight:p,previewWidth:v}}})))},J=function(e){return e&&JSON.stringify(Object(h.map)(e,(function(e){var t=e.content,n=Object(r.m)(e,["content"]);return Object(r.a)(Object(r.a)({},n),{content:JSON.parse(t)})})))},X=function(e,t){if(!e||!e.links)return{urlPreview:null,embeddedLinks:null};try{var n=["http","https"],r=JSON.parse(e.links),i=[],a=[];return r.forEach((function(e){Y(e,i,n),$(e,a,n)})),{urlPreview:a.length>0?a[0]:null,embeddedLinks:i}}catch(e){return t.newLogger("Chat Helper").log("UnhandledException in message transformation: "+e),{urlPreview:null,embeddedLinks:null}}},Y=function(e,t,n){var r=e.url,i=e.fileShareUrlMeta,a=e.title,s=e.description,o=Object(m.g)(r,n);i&&t.push({objectUrl:o,title:a,description:s,fileShareUrlMeta:i})},$=function(e,t,n){var r=e.url,i=e.preview,a=e.previewenabled,s=i||{},o=s.previewurl,c=s.previewmeta,u=s.title,l=s.description,d=Object(m.g)(r,n);t.push({url:d,thumbnail:Object(m.g)(o,n),title:u,description:l,previewEnabled:a,thumbnailMeta:c?{width:c.width,height:c.height}:null})},Z=function(e,t){if(!t||!t.cards)return null;try{return JSON.parse(t.cards).map((function(e){var t=e.appIcon,n=e.appId,r=e.appName,i=e.cardClientId,a=e.content,s=e.contentType,o=e.locale;return{appIcon:t,appId:n,appName:r,cardClientId:i,content:JSON.stringify(a),contentType:s,locale:o}}))}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in toCards: "+t),null}},ee=function(e,t,n,r){var i=r&&r.policyViolation,a=r&&r.genericStreamMetadata;if(!i&&!a)return null;var s={};if("string"==typeof i)try{i=JSON.parse(i)}catch(n){e.newLogger("Chat Helper").log("Exception in parsing PolicyViolation in message: "+t+". Error: "+n)}i&&(s.policyViolation=i);var o=a&&a.policyTip;if("string"==typeof a)try{o=JSON.parse(a).policyTip}catch(n){e.newLogger("Chat Helper").log("Exception in parsing policy tip in message: "+t+". Error: "+n)}return o&&(s.dlpData={id:t,content:n,policyTip:o}),s},te=function(e,t){if(!t||!t.meeting)return null;try{var n=JSON.parse(t.meeting);return{organizerId:n.organizerId,tenantId:n.tenantId,itemId:n.itemid,meetingTitle:n.meetingtitle,scheduledMeetingInfo:n.scheduledmeetinginfo}}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in toMeeting: "+t),null}},ne=function(e,t,n,r){var i=t||n;if(i)return i;if(r&&A.has(e)){var a=r.match(/<id type="callId"[^>]*?\svalue="([^"]+?)"/i);return a&&a[1]||null}return null},re=function(e,t,n){return n&&n.body&&n.sourceContentHash===Object(p.a)(t||"").toString()&&n.sourceLanguageCode?{status:n.toggled?a.b.TranslationStatusV2.Done:a.b.TranslationStatusV2.ShowOriginalMessage,content:n.body,sourceLangCode:n.sourceLanguageCode,targetLangCode:n.targetLanguageCode,version:e,sourceContentHash:n.sourceContentHash}:{status:void 0,content:void 0,sourceLangCode:void 0,targetLangCode:void 0,version:void 0,sourceContentHash:void 0}},ie=function(e,t){return"-1"===e?t:e},ae=function(e,t,n){var i;if(e.id){var s=se(e,t),o=e.id,c=e.clientmessageid,u=e.messagetype,l=e.properties,d=e.callId,m=e.skypeguid,p=e.content,v=e.conversationid;return Object(r.a)(Object(r.a)({},s),{__typename:"Message",interopDeliveryState:l&&l.deliveryState&&l.deliveryState.state,smsDeliveryReports:l&&l.smsDeliveryReports?l.smsDeliveryReports:null,announcement:ve(l),escalations:x(l),notification:ct(t,l),status:n||a.b.MessageStatus.Delivered,meeting:te(t,l),onBehalfOf:H(l,o),callId:ne(u,d,m||l&&l.skypeguid,p),callLog:l&&I(ie(o,c),l["call-log"],v,u,p,t),replyPermission:null!==(i=null==l?void 0:l.replyPermission)&&void 0!==i?i:null,atpSharepointData:G(t,l)})}},se=function(e,t){var n=e.id,i=e.content,a=e.originalarrivaltime,s=e.from,o=e.messagetype,c=e.annotationsSummary,u=e.userHasStarred,l=e.properties,d=e.clientmessageid,m=e.version,p=e.imdisplayname,v=e.translation;return Object(r.a)(Object(r.a)({id:ie(n,d),content:i,originalArrivalTime:a,from:P(s),messageType:he(t,o,l),isImportant:Object(M.c)(l&&l.importance),importance:Object(M.a)(l&&l.importance),emotionsSummary:B(c),emotions:R(l),mentions:_(l,n),cards:Z(t,l),files:W(l),deeplinks:q(l)},X(l,t)),{deleteTime:l&&l.deletetime,editTime:l&&l.edittime,version:m,userHasSaved:u,imDisplayName:p,clientMessageId:d,translationV2:re(m,i,v),dlpContext:ee(t,n,i,l)})},oe=function(e){var t=e.content,n=e.id,r=e.messageType,i=e.originalArrivalTime,a=e.type,s=e.version;return{__typename:"Message",content:t,id:n,messageType:r,originalArrivalTime:new Date(i).toISOString(),type:a,version:s}},ce=function(e,t){var n=ae(e,t,Je(e.state));if(!n)throw Object(v.a)("ChatHelpers",f.d.Undefined,"toNewMessageSchema",{resource:e},"Bad shaped NewMessage");var r=null;if(e&&e.conversationLink){var i=Object(s.h)(e);r=i===n.id?null:i}return{convId:e.conversationid||Object(s.e)(e),replyChainId:r,threadType:e.threadtype,threadTopic:e.threadtopic,message:n}};function ue(e,t){return{__typename:"Message",content:"",messageType:"Text",id:e,originalArrivalTime:t,imDisplayName:null,from:null,deleteTime:null,files:null,cards:null,embeddedLinks:null,callId:null,replyPermission:null,onBehalfOf:null,atpSharepointData:null,deeplinks:null,version:null,importance:null,interopDeliveryState:null,smsDeliveryReports:null,emotions:null,emotionsSummary:null,escalations:null,mentions:null,status:null,diagnosticInfo:null,clientMessageId:e,urlPreview:null,dlpContext:null,editTime:null,deletionInfo:null,translation:null,userHasSaved:null,translationV2:null}}function le(e,t){return{__typename:"ConsumptionHorizon",id:e,originalArrivalTime:t,timeStamp:t,clientMessageId:Object(w.b)()}}function de(e,t,n,r,i){void 0===t&&(t=""),void 0===n&&(n=[]);var s=new Date,o=s.toISOString(),c=s.getTime().toString();return{__typename:"Conversation",id:e,title:t,members:n,activeCallsCount:null,canBeDiscarded:null,canBeFavorited:null,canBeHidden:null,botMembers:null,canBeLeft:null,canBeMuted:null,canBePinned:null,canBotBeBlocked:null,canManageApps:null,canPopOut:null,canTagContact:null,chatSubType:null,isDisabled:!1,isOneOnOne:!1,isRead:!0,datatid:null,displayName:null,hasActions:null,hasActiveCalls:null,hasFailedMessages:null,isBotBlocked:null,isBotUser:null,isContactTagged:null,isFederated:!1,isHidden:null,isHighImportance:null,isLastMessageFromMe:null,isLastMessageText:null,isMeeting:!1,isMuted:null,isNewChat:!0,isSfB:!1,isUrgentImportance:null,chatType:a.b.ChatType.Chat,type:a.b.ChatType.Chat,lastMessage:r||ue(c,o),meetingInformation:null,userConsumptionHorizon:null,consumptionHorizonBookmark:null,consumptionHorizon:i||le(e,o),lastMessageTime:null,longTitle:null,messagePreview:null,messagePreviewAria:null,otherMemberMris:null,pictureGroup:null,pictureUpn:null,pinnedIndex:null,plGroupKey:null,presenceSource:null,showAtMention:null,showMarkers:null,tooltipTitle:null}}var me=function(e,t,n){var i=e.annotationsSummary,s=e.id,o=e.from,c=e.messageType,u=e.properties,l=e.version,d=Object(r.m)(e,["annotationsSummary","id","from","messageType","properties","version"]);if(!s)return null;try{return Object(r.a)(Object(r.a)(Object(r.a)({__typename:"Message",id:s,from:o,messageType:he(n,c,u),version:Object(h.isNumber)(l)?l.toString():void 0,isImportant:Object(M.c)(u&&u.importance),importance:Object(M.a)(u&&u.importance),interopDeliveryState:u&&u.deliveryState&&u.deliveryState.state,smsDeliveryReports:(null==u?void 0:u.smsDeliveryReports)||null,emotions:R(u),emotionsSummary:B(i),announcement:ve(u),escalations:x(u),mentions:_(u,s),onBehalfOf:H(u,s),cards:Z(n,u),files:W(u),deeplinks:q(u)},X(u,n)),{deleteTime:u&&u.deletetime,editTime:u&&u.edittime,status:a.b.MessageStatus.Delivered,dlpContext:ee(n,s,d.content,u),meeting:te(n,u),callId:u&&u.skypeguid,translationV2:void 0,callLog:u&&I(s,u["call-log"],t,c,d.content,n)}),d)}catch(e){return n.newLogger("Chat Helper").log("UnhandledException in message transformation: "+e),Object(r.a)({id:s,from:o,messageType:he(n,c,u),isImportant:null,emotions:null,mentions:null,files:null,announcement:null,urlPreview:null,deleteTime:null,status:null},d)}},pe=function(e){var t=e.originalArrivalTime,n=e.timeStamp,r=e.clientMessageId;return{originalArrivalTime:new Date(t).toISOString(),timeStamp:new Date(n).toISOString(),clientMessageId:r}},ve=function(e){var t={title:"",originalImageUrl:null,croppedImageUrl:null,colorTheme:null};if(!e)return t;var n="string"==typeof e.cards?JSON.parse(e.cards):e.cards;if(!n||0===n.length)return t;var r=n.find((function(e){return"application/vnd.microsoft.teams.messaging-announcementBanner"===e.contentType}));if(!r)return t;var i=fe(r);return{title:e.title?e.title:"",originalImageUrl:i.originalImageUrl,croppedImageUrl:i.croppedImageUrl,colorTheme:i.colorTheme}},fe=function(e){var t=Object(h.get)(e,"content.imageData.origImage.src",null),n=Object(h.get)(e,"content.imageData.croppedImage.src",null),r=Object(h.get)(e,"content.imageData.colorTheme",null)||Object(h.get)(e,"content.colorTheme",null);return{originalImageUrl:t=void 0===t?null:t,croppedImageUrl:n=void 0===n?null:n,colorTheme:r=void 0===r?null:r}},he=function(e,t,n){return t===o.y.HTML&&be(e,n)?o.y.Collaborate:t},be=function(e,t){var n=Z(e,t);if(!n)return!1;var r=Object(h.find)(n,(function(e){return"application/vnd.microsoft.card.fluid"===e.contentType}));return!!r&&!!JSON.parse(r.content).componentUrl},ge=function(e,t){if(Object(h.isEmpty)(t))return null;var n=t.split(";"),i=n[0],a=n[1],s=n[2];return Object(r.a)({id:e},pe({originalArrivalTime:parseInt(i,10),timeStamp:parseInt(a,10),clientMessageId:s}))},ye=function(e,t,n){var r=t&&t[o.i.SmartReplies];return r&&"string"==typeof r?Oe(e,r,n):null},Oe=function(e,t,n){try{var r=JSON.parse(t);return Ce(e,r)}catch(e){return n.newLogger("Chat Helper").log("Exception in parsing quick reply augmentation. Error: "+e),null}},Ce=function(e,t){var n,r,i=ke(t);if(!i||!i.suggestedActions.actions||!i.id)return null;var a=i.suggestedActions.actions.filter((function(e){var t,n;return e.type===o.X&&(null===(t=e.channelData)||void 0===t?void 0:t.id)&&(null===(n=e.channelData)||void 0===n?void 0:n.utcTime)&&e.value})).map((function(e){return{channelDataId:e.channelData.id,timestamp:e.channelData.utcTime,value:e.value}}));if(!a||0===a.length)return null;var s=null===(r=null===(n=i.suggestedActions.actions[0])||void 0===n?void 0:n.channelData)||void 0===r?void 0:r.targetMessageId;return s||i.replyToId?{convId:e,timestamp:a[0].timestamp,replyMessageId:s||i.replyToId,suggestions:a,whisperId:i.id}:null},ke=function(e){var t=e&&e.suggestedActivities&&e.suggestedActivities.filter((function(e){var t,n,r;return(null==e?void 0:e.type)===o.W&&(null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.id)===o.Y&&(null==e?void 0:e.timestamp)&&(null===(r=null===(n=null==e?void 0:e.suggestedActions)||void 0===n?void 0:n.actions)||void 0===r?void 0:r.some((function(e){return e.type===o.X})))}));return t&&0!==t.length?t.reduce((function(e,t){return new Date(e.timestamp).getTime()>new Date(t.timestamp).getTime()?e:t})):null},Se=function(e,t,n){try{var i=je(t),a=null==i?void 0:i.map((function(t){return{activityReplyToId:t.replyToId,activityTimestamp:t.timestamp,convId:e,suggestedReplies:t.suggestedActions.actions.filter((function(e){var t,n;return(null===(t=null==e?void 0:e.channelData)||void 0===t?void 0:t.id)&&(null===(n=null==e?void 0:e.channelData)||void 0===n?void 0:n.utcTime)})).map((function(e){var n,i,a={targetMessageId:(null===(n=null==e?void 0:e.channelData)||void 0===n?void 0:n.targetMessageId)||t.replyToId,type:(null===(i=null==e?void 0:e.channelData)||void 0===i?void 0:i.type)||"reply"};return{suggestionChannelData:Object(r.a)(Object(r.a)({},null==e?void 0:e.channelData),a),value:e.value,whisperId:t.id}}))}}));return a&&0!==a.length?{suggestedRepliesCollections:a}:null}catch(e){return n.newLogger("Chat Helper").error("formatQuickReplyAugmentationFromObject: Exception in parsing quick reply augmentation. Error: "+e),null}},je=function(e){var t=e&&e.suggestedActivities&&e.suggestedActivities.filter((function(e){var t,n,r;return(null==e?void 0:e.type)===o.W&&(null===(t=null==e?void 0:e.from)||void 0===t?void 0:t.id)===o.Y&&(null==e?void 0:e.timestamp)&&(null===(r=null===(n=null==e?void 0:e.suggestedActions)||void 0===n?void 0:n.actions)||void 0===r?void 0:r.some((function(e){return e.type===o.X||e.type===o.k})))}));return t&&0!==t.length?t:null},Te=function(e,t,n){var r=t&&t[o.i.SmartReplies];return r&&"string"==typeof r?function(e,t,n){try{var r=JSON.parse(t);return Se(e,r,n)}catch(e){return n.newLogger("Chat Helper").error("formatQuickReplyAugmentationFromString: Exception in parsing quick reply augmentation. Error: "+e),null}}(e,r,n):null},Ie=function(e){switch(e){case c.y.None:return a.b.MeetingType.Unknown;case c.y.Adhoc:return a.b.MeetingType.Adhoc;case c.y.Scheduled:return a.b.MeetingType.Scheduled;case c.y.Recurring:return a.b.MeetingType.Recurring;case c.y.Broadcast:return a.b.MeetingType.Broadcast;case c.y.MeetNow:return a.b.MeetingType.MeetNow}},Me=function(e){return e&&e.map((function(e){return{id:e.id,originalArrivalTime:e.consumptionhorizon,messageVisibilityTime:e.messageVisibilityTime}}))||null};var Ne=function(e,t,n,i){try{var a=e.members;return function(e,t,n,i){var a=e.id,s=e.lastMessage,c=e.properties,l=e.threadProperties,d=ge(a,c[o.i.ConsumptionHorizonBookmark]);return Object(r.a)(Object(r.a)({},e),{id:a,chatSubType:Ee(l.threadType),chatType:Be(l.threadType),consumptionHorizon:ge(a,c[o.i.ConsumptionHorizon]),consumptionHorizonBookmark:d,smartReplySuggestions:ye(a,c,n),quickReplyAugmentation:Te(a,c,n),creator:l[o.hb.Creator],isUserMember:qe(t,i),isDisabled:ze(l.isDisabled),isLastMessageFromMe:l.isLastMessageFromMe,isMuted:Object(u.i)(e),isOneOnOne:Ge(l[o.hb.P2PChatUniqueRosterThread]),isRead:l.isRead,lastMessage:s&&ae(s,n),meetingInformation:Ke(a,l[o.hb.Meeting]),members:t,tenantId:l[o.hb.TenantId],title:l.topic,type:null,userConsumptionHorizon:d,interopConversationStatus:_e(c[o.i.InteropConversationStatus])})}(e,a&&a.length?a.map((function(e){return e.id in t?t[e.id]:function(e){return Object(N.a)(Object(r.a)(Object(r.a)({},e),{mri:e.id,objectId:"",type:"",userPrincipalName:"",isMuted:e.isReader}))}(e)})):[],n,i)}catch(t){return n.newLogger("Chat Helper").log("UnhandledException in toConversationSchemaFromSkypeConversationLocal transformation: "+t),Object(r.a)(Object(r.a)({},e),{id:e.id,isUserMember:!1,members:[],type:null})}},we=function(e,t,n){var i=e.id,s=e.members,o=e.consumptionHorizon,c=e.userConsumptionHorizon,u=e.lastMessage,l=e.creator,d=e.meetingInformation,m=e.isDisabled,p=e.isMuted,v=e.isLastMessageFromMe,f=e.isRead,b=e.isOneOnOne,g=e.chatType,y=(e.createdAt,e.interopConversationStatus),O=e.quickReplyAugmentation,C=Object(r.m)(e,["id","members","consumptionHorizon","userConsumptionHorizon","lastMessage","creator","meetingInformation","isDisabled","isMuted","isLastMessageFromMe","isRead","isOneOnOne","chatType","createdAt","interopConversationStatus","quickReplyAugmentation"]);try{var k=Object(h.map)(s,N.a),S=d&&{id:i,subject:d.subject,startTime:d.startTime,scenario:d.scenario,endTime:d.endTime,iCalUid:d.iCalUid,meetingType:d.meetingType?Ie(d.meetingType):a.b.MeetingType.Unknown};return Object(r.a)(Object(r.a)({__typename:"Conversation"},C),{id:i,consumptionHorizon:o&&Object(r.a)({__typename:"ConsumptionHorizon",id:i},pe(o)),consumptionHorizonBookmark:c&&Object(r.a)({__typename:"ConsumptionHorizonBookmark",id:i},pe(c)),userConsumptionHorizon:c&&Object(r.a)({__typename:"ConsumptionHorizonBookmark",id:i},pe(c)),lastMessage:u&&me(u,i,t),members:k,creator:l,meetingInformation:S,isDisabled:!!m,isMuted:p,isUserMember:qe(k,n),isLastMessageFromMe:!!v,isRead:f,isOneOnOne:!!b,chatType:Be(g),interopConversationStatus:_e(y),smartReplySuggestions:O&&Ce(i,O),quickReplyAugmentation:O&&Se(i,O,t)})}catch(e){return t.newLogger("Chat Helper").log("UnhandledException in conversation object transformation: "+e),Object(r.a)(Object(r.a)({},C),{id:i,isUserMember:!1,consumptionHorizon:null,consumptionHorizonBookmark:null,userConsumptionHorizon:null,lastMessage:null,members:[],creator:null,meetingInformation:null,chatType:null})}},De=function(e,t,n){return{node:we(e,t,n),cursor:e.createdAt||e.id}},Pe=function(e,t,n,r){return{node:Ne(e,t,n,r),cursor:e.id}},Fe=function(e){return{activities:e.activities,callLogs:e.callLogs,chats:e.chats,total:e.total}},Ae=function(e){var t=e.notificationCount,n=e.chatCount;return{notificationCount:t,chatCount:n.teamsChats+n.sfbGatewayChats+n.federatedChats}};function Ue(e){return JSON.stringify(Object(h.map)(e,(function(e){var t=e.mentionType,n=e.displayName;return{"@type":"http://schema.skype.com/Mention",itemid:e.itemId,mri:e.userId,mentionType:t,displayName:n}})))}var Le,Ee=function(e){if(e)return"space"===e||"topic"===e?c.l.Channel:"meeting"===e?c.l.Meeting:c.l.None},Re=new Map([["chat",a.b.ChatType.Chat],["phonechat",a.b.ChatType.PhoneChat],["meeting",a.b.ChatType.Meeting],["sfbinteropchat",a.b.ChatType.SfBInteropChat]]),Be=function(e){var t=null;return null==e||void 0===(t=Re.get(e))&&(t=null),t},xe=new Map([["AcceptPending",a.b.InteropConversationStatus.AcceptPending],["Accepted",a.b.InteropConversationStatus.Accepted],["Blocked",a.b.InteropConversationStatus.Blocked],["Quarantined",a.b.InteropConversationStatus.Quarantined]]),_e=function(e){return e&&xe.get(e)||null},He=new Map([["ChatEnabled",a.b.MeetingChatPolicy.ChatEnabled],["ChatDisabled",a.b.MeetingChatPolicy.ChatDisabled],["InMeeting",a.b.MeetingChatPolicy.InMeeting]]),Ge=function(e){switch(typeof e){case"string":e="true"===e.toLowerCase();case"boolean":return e;default:return!1}},ze=function(e){return Object(h.isString)(e)?"true"===e.toLowerCase():e||!1},qe=function(e,t){return!(!(null==t?void 0:t.id)||!e)&&e.some((function(e){return e.id===t.id}))},We=function(e){var t=e.id,n=e.conversationid,r=e.imdisplayname,i=e.from,a=e.composetime;return t&&{"@type":D,mri:P(i),imdisplayname:r,messageId:t,parentMessageId:t,threadId:n,isUnresolvedEmailUser:!1,originalComposeTime:a}},Ve=function(e,t,n){var r=n.find((function(n){try{var r=JSON.parse((n.properties||{}).starred),i=r&&r["@type"]===D&&r.threadId===t?r.messageId:void 0;return e===i}catch(e){return!1}}));return r&&r.id},Ke=function(e,t){if(t){var n=JSON.parse(t);if(Object.keys(t).length)return Object(r.a)(Object(r.a)({id:e},n),{meetingType:n.meetingType?Ie(c.y[n.meetingType]):a.b.MeetingType.Unknown})}},Qe=function(e,t,n){var r=R(n.properties);return!!r&&r.some((function(n){return n.key===e&&!!n.users&&n.users.some((function(e){return e.id===t}))}))},Je=function(e){var t;switch(e){case l.gb.Error:t=a.b.MessageStatus.Error;break;case l.gb.Sending:t=a.b.MessageStatus.Sending;break;default:t=a.b.MessageStatus.Delivered}return t},Xe=function(e,t,n){return Object(r.f)(void 0,void 0,Promise,(function(){var i,a,o,c,u,l;return Object(r.i)(this,(function(d){switch(d.label){case 0:return i=e.id||"",a=e.properties,o=Object(s.b)(e.members,a,[]).members,c=Ke(i,a&&a.meeting),o?[4,t(o)]:[3,2];case 1:return l=d.sent(),[3,3];case 2:l=[],d.label=3;case 3:return u=l,[2,{__typename:"ThreadUpdate",conversation:Object(r.a)(Object(r.a)({id:i,title:a&&a.topic,isOneOnOne:a&&Ge(a.uniquerosterthread),isUserMember:qe(u,n),members:u},c&&{meetingInformation:Object(r.a)({},c)}),{chatType:a&&Be(a.threadType)})}]}}))}))},Ye=function(e){return e&&e.historyHiddenTime||null},$e=function(e){return!!e&&!!e[o.i.Alerts]&&"true"!==e[o.i.Alerts].trim().toLowerCase()},Ze=function(e){return e&&(e.isDisabled||e.messagingdisabled)},et=function(e,t,n,i){var a=e.resourceType,s=e.resource;return Object(r.f)(void 0,void 0,Promise,(function(){var e,c,u;return Object(r.i)(this,(function(l){switch(l.label){case 0:switch(l.trys.push([0,9,,10]),a){case"NewMessage":case"MessageUpdate":return[3,1];case"ThreadUpdate":return[3,2];case"ConversationUpdate":return[3,4];case"ResolveConversationLie":return[3,5];case"DiscardConversation":return[3,6]}return[3,7];case 1:return e=function(e,t,n){var i;if(e&&e.messagetype===o.h.MemberConsumptionHorizonUpdate){var a=e.conversationid||Object(d.a)(e.conversationLink),s=JSON.parse(e.content);return{__typename:"ConsumptionHorizonUpdate",convId:a,memberConsumptionHorizon:{id:s.user,originalArrivalTime:s.consumptionhorizon,messageVisibilityTime:s.messageVisibilityTime}}}return e&&e.properties&&e.properties.activity?{__typename:"NotificationUpdate",convId:e.properties.activity.sourceThreadId||"",messageId:e.properties.activity.sourceMessageId||""}:"MessageUpdate"===n?Object(r.a)(Object(r.a)({__typename:n},ce(e,t)),{threadType:null===(i=e.properties)||void 0===i?void 0:i.threadType}):Object(r.a)({__typename:n},ce(e,t))}(s,n,a),[3,8];case 2:return[4,Xe(s,t,i)];case 3:return e=l.sent(),[3,8];case 4:return e=function(e,t){var n,r=e.properties,i=e.threadProperties,a=e.lastMessage,s=r&&r.consumptionhorizon||null,o=r&&(r.userConsumptionHorizon||r.consumptionHorizonBookmark)||null,c=e.id||"",u=ge(c,o);return{__typename:"ConversationUpdate",conversation:{id:c,isUserMember:!1,isDisabled:ze(Ze(i)),meetingChatPolicy:(n=null==i?void 0:i.meetingChatPolicy,n&&He.get(n)||null),title:i&&i.topic,consumptionHorizon:ge(c,s),consumptionHorizonBookmark:u,userConsumptionHorizon:u,smartReplySuggestions:ye(c,r,t),quickReplyAugmentation:Te(c,r,t),chatType:i&&Be(i.threadType),chatSubType:i&&Ee(i.threadType),lastMessage:ae(a,t),members:[],interopConversationStatus:r&&_e(r.interopconversationstatus)||null,isRetentionHorizonSet:e.isRetentionHorizonSet,isMuted:$e(r),chatHistoryHiddenTime:Ye(r)}}}(s,n),[3,8];case 5:return e={__typename:a,lieConvId:(c=s).id,realConvId:c.realConvId},[3,8];case 6:return e={__typename:a,convId:(c=s).id},[3,8];case 7:return[3,8];case 8:return[3,10];case 9:return u=l.sent(),n.newLogger("ChatHelpers").warn("Error processing chat service event: "+u),[3,10];case 10:return[2,e]}}))}))};!function(e){e.SfBGatewayChat="@sfb.unq.gbl.spaces",e.OnPremFederatedGatewayChat="@sfbonprem.unq.gbl.spaces",e.FederatedGatewayChat="@fed.unq.gbl.spaces"}(Le||(Le={}));var tt=function(e){return nt(e)||rt(e)||Object(u.E)(e)},nt=function(e){return!!e&&e.endsWith(Le.SfBGatewayChat)},rt=function(e){return!!e&&(e.includes(":fed:preview")||e.endsWith(Le.FederatedGatewayChat)||e.endsWith(Le.OnPremFederatedGatewayChat))},it=function(e,t){return Object(h.filter)(e,Object(h.omit)(t,"__typename"))},at=function(e){return!!e&&-1!==e.indexOf(U)},st=function(e){return e===L},ot=function(e,t,n,r,s,o,c){if(e)return n?i.n.Meeting:r?s?i.n.Botchat:function(e){return!!e&&e===a.b.ChatType.PhoneChat}(t)?i.n.SMSOneOnOneChat:Object(u.E)(e)?i.n.SfcInteropChat:nt(e)?i.n.SfbInteropChat:o?i.n.NativeFederatedChat:c?i.n.FederatedChat:i.n.OneOnOneChat:i.n.GroupChat},ct=function(e,t){if(!t||!t.notification)return null;try{var n=t.notification;return{alertInMeeting:n.alertInMeeting,externalResourceUrl:n.externalResourceUrl}}catch(t){return e.newLogger("Chat Helper").log("UnhandledException in chat message notification transformation: "+t),null}}},vIjS:function(e,t,n){"use strict";n.d(t,"b",(function(){return o}));var r=n("+7/b"),i=n("UYsd"),a=n("uo7e"),s=n("Rwu9"),o={kind:"Document",definitions:Object(r.o)([{kind:"FragmentDefinition",name:{kind:"Name",value:"chatFields"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Conversation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"title"}},{kind:"Field",name:{kind:"Name",value:"isOneOnOne"}},{kind:"Field",name:{kind:"Name",value:"isDisabled"}},{kind:"Field",name:{kind:"Name",value:"isMuted"}},{kind:"Field",name:{kind:"Name",value:"isLastMessageFromMe"}},{kind:"Field",name:{kind:"Name",value:"chatSubType"}},{kind:"Field",name:{kind:"Name",value:"lastMessage"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteTime"}},{kind:"FragmentSpread",name:{kind:"Name",value:"lastMessageFields"}}]}},{kind:"Field",name:{kind:"Name",value:"members"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"userFieldsForChat"}}]}},{kind:"Field",name:{kind:"Name",value:"meetingInformation"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"meetingInformationFieldsShort"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonFields"}}]}},{kind:"Field",name:{kind:"Name",value:"consumptionHorizonBookmark"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"userConsumptionHorizon"},selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"consumptionHorizonBookmarkFields"}}]}},{kind:"Field",name:{kind:"Name",value:"isSfB"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isHighImportance"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isUrgentImportance"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"activeCallsCount"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"datatid"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"displayName"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"hasActiveCalls"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"hasFailedMessages"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"otherMemberMris"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isNewChat"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isBotBlocked"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isBotUser"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isFederated"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isHidden"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isContactTagged"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"pictureUpn"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"pinnedIndex"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"showAtMention"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"showMarkers"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"tooltipTitle"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"longTitle"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"pictureGroup"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"userId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}}]}},{kind:"Field",name:{kind:"Name",value:"lastMessageTime"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"messagePreview"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"messagePreviewAria"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isLastMessageText"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"isMeeting"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"plGroupKey"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"presenceSource"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"hasActions"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBeDiscarded"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBotBeBlocked"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBePinned"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBeMuted"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBeLeft"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBeHidden"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canBeFavorited"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canTagContact"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canPopOut"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"canManageApps"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]}]}}],i.a.definitions,[{kind:"FragmentDefinition",name:{kind:"Name",value:"userFieldsForChat"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"User"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"mri"}},{kind:"Field",name:{kind:"Name",value:"objectId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"givenName"}},{kind:"Field",name:{kind:"Name",value:"surname"}},{kind:"Field",name:{kind:"Name",value:"email"}}]}}],[{kind:"FragmentDefinition",name:{kind:"Name",value:"meetingInformationFieldsShort"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeetingInformation"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"meetingType"}}]}}],a.a.definitions,s.a.definitions)}},zqWZ:function(e,t,n){"use strict";n.r(t),n.d(t,"resolvers",(function(){return s.a})),n.d(t,"IContext",(function(){})),n.d(t,"chatLegacyResolvers",(function(){return Z})),n.d(t,"IMessagesFromManagerResponseObject",(function(){})),n.d(t,"chatWorkerResolvers",(function(){return ae})),n.d(t,"addChatToChatList",(function(){return se.b})),n.d(t,"addDraftChatToChatList",(function(){return se.c})),n.d(t,"removeChatFromChatList",(function(){return se.f})),n.d(t,"removeDraftChatFromChatList",(function(){return se.g})),n.d(t,"chatExistsInCache",(function(){return se.d})),n.d(t,"ensureChatExistsInCache",(function(){return se.e})),n.d(t,"WhitelistedThreadTypes",(function(){return se.a})),n.d(t,"chatListQuery",(function(){return oe.a})),n.d(t,"IChatList",(function(){return oe.chatListQuery})),n.d(t,"IChatListVariables",(function(){return oe.chatListQueryVariables})),n.d(t,"chatFieldsFragment",(function(){return ce.chatFieldsFragment}));var r={};n.r(r),n.d(r,"DataSource",(function(){return U}));var i,a,s=n("FK3d"),o=n("+7/b"),c=n("z4q9"),u=n("g5XK"),l=n("ra0y"),d=n("3J71"),m=n("svWY"),p=n("e4hD");!function(e){e[e.Sync=1]="Sync",e[e.LongPoll=2]="LongPoll",e[e.SfB=3]="SfB",e[e.SyncRelated=4]="SyncRelated",e[e.Local=5]="Local",e[e.CSAReplyChain=6]="CSAReplyChain",e[e.DeltaSync=7]="DeltaSync"}(i||(i={})),function(e){e[e.Sending=0]="Sending",e[e.Delivered=1]="Delivered",e[e.Received=2]="Received",e[e.Error=3]="Error",e[e.Deleted=4]="Deleted"}(a||(a={}));var v,f,h=["AddConversations","AddRegularChannel","AddSpecialChannel","AddSharedChannel","AddTeam","ConversationStoreStartupFromMain","ConversationStoreStartupFromWorker","ConversationListSync","GetConversation","GetConversationLie","LongPollUpdateConversations","MembersInvited","NewConversation","PatchConversation","ReceivedFromWorker","RelatedMessagesSync","ResolveLie","ThreadUpdate"],b=["Translation","DLP","Delete","PostNewClientLie","PostEditClientLie","PostReactionClientLie","ResolveEditClientLie","PostNewClientLie","ResolveNewClientLie"],g=n("VyoL"),y=function(){function e(t){this.id=t.id,this.conversationId=t.conversationId,this.parentMessageId=t.parentMessageId,this.clientMessageId=t.clientMessageId,this.sequenceId=t.sequenceId||0,this.version=t.version,this.type=t.type||"",this.contentType=t.contentType||"",this.activityType=t.activityType||"",this.messageType=t.messageType,this.clientArrivalTime=t.clientArrivalTime,this.originalArrivalTime=t.originalArrivalTime,this.imDisplayName=t.imDisplayName,this.creator=t.creator,this.skypeGuid=t.skypeGuid,this.properties=t.properties||{},this.source=t.source,this._content=t.content,this._isSanitized=t.isSanitized,this.translation=t.translation,this.annotationsSummary=t.annotationsSummary,this.state=t.state,this.callId=t.callId,this.threadType=t.threadType||"",this.dlpData=t.dlpData,this.searchKey=e.createSearchKey(t.conversationId,t.id),this.dedupeKey=t.dedupeKey||this.creator+"_"+(this.clientMessageId||this.id),this.originalNonLieMessage=t.originalNonLieMessage}return e.createSearchKey=function(e,t){return e+"_"+t},e.FromChatServiceMessage=function(t,n,r,i){void 0===r&&(r=!1),void 0===i&&(i=a.Delivered);var s=Object(o.a)(Object(o.a)({},t),{conversationId:e.getConversationId(t),parentMessageId:e.getParentMessageId(t),clientMessageId:t.clientmessageid||"",sequenceId:t.sequenceId||0,imDisplayName:t.imdisplayname||"",creator:Object(m.last)(Object(m.split)(t.from,"/"))||"",messageType:t.messagetype,contentType:t.contenttype||"",activityType:t.activitytype||"",skypeGuid:t.skypeguid,originalArrivalTime:e.getOriginalArrivaTimeUtc(t.originalarrivaltime),source:n,clientArrivalTime:Date.now(),dedupeKey:"",searchKey:e.createSearchKey(e.getConversationId(t),t.id),state:i,isSanitized:r,threadType:t.threadtype});return new e(s)},e.shouldUseExistingMessage=function(e,t){return(!e.isClientLie||!t.isClientLie||e.state!==a.Sending||t.state!==a.Error)&&(!(e.sequenceId<t.sequenceId)&&e.version>=t.version)},e.FromCSAMessage=function(t){var n=Object(o.a)(Object(o.a)({},t),{conversationId:t.containerId,originalArrivalTime:e.getOriginalArrivaTimeUtc(t.originalArrivalTime),parentMessageId:t.parentMessageId||t.id,sequenceId:t.sequenceId||0,source:i.CSAReplyChain,creator:t.from,version:t.version.toString(),clientArrivalTime:Date.now(),dedupeKey:"",searchKey:e.createSearchKey(t.containerId,t.id),isSanitized:!1,state:a.Delivered});return new e(n)},e.isClientLieId=function(t){return t===e.ClientLieId||Object(m.startsWith)(t,e.ClientLiePrefix)},e.getParentMessageId=function(t){var n=Object(m.flow)((function(e){return Object(m.split)(e,"/")}),(function(e){return Object(m.last)(e)}),(function(e){return Object(m.split)(e,"=")}),(function(e){return Object(m.nth)(e,1)}))(t.conversationLink);return n=n||t.id,e.isClientLieId(n)?e.ClientLieId:n},e.getConversationId=function(e){return Object(m.flow)((function(e){return Object(m.split)(e,"/")}),(function(e){return Object(m.last)(e)}),(function(e){return Object(m.split)(e,";")}),(function(e){return Object(m.first)(e)}))(e.conversationLink)||""},e.getOriginalArrivaTimeUtc=function(e){return e?new Date(e).getTime():-1},Object.defineProperty(e.prototype,"key",{get:function(){return this.dedupeKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSanitized",{get:function(){return this._isSanitized},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"content",{get:function(){return this._content},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBotMessage",{get:function(){return!!this.creator&&this.creator.startsWith(p.z.BotPrefix)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isConnectorMessage",{get:function(){return!!this.creator&&this.creator.startsWith(p.s)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onBehalfOf",{get:function(){return this.properties&&""+(this.properties[p.x.OnBehalfOf]||"")},enumerable:!1,configurable:!0}),e.prototype.sanitizeContent=function(e){if(this.shouldSkipSanitization())this._isSanitized=!0;else{var t=this.content;this.messageType!==p.y.HTML||this.isGatewayChatMessage||(t="<div>"+t+"</div>"),t=(t=e.sanitizeHtml(t)).replace(/}}/g,"}<span>}</span>"),this._content=t,this._isSanitized=!0}},Object.defineProperty(e.prototype,"isEdited",{get:function(){return!!this.properties[p.x.EditTime]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"editedTime",{get:function(){return this.isEdited?Number(this.properties[p.x.EditTime]):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDeleted",{get:function(){return!!this.properties[p.x.DeleteTime]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deletedTime",{get:function(){return this.isDeleted?Number(this.properties[p.x.DeleteTime]):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClientLie",{get:function(){return this.id===e.ClientLieId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEditClientLie",{get:function(){return!!this.originalNonLieMessage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isLie",{get:function(){return this.isClientLie||this.isEditClientLie},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isGatewayChatMessage",{get:function(){return Object(g.s)(this.conversationId)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSystemMessage",{get:function(){return Object(m.includes)(p.cb,this.messageType)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isRootMessage",{get:function(){return this.id===this.parentMessageId},enumerable:!1,configurable:!0}),e.prototype.isSentByUser=function(e){return this.creator===e},e.prototype.toDBSchema=function(){return{id:this.id,callId:this.callId,dedupeKey:this.dedupeKey,conversationId:this.conversationId,parentMessageId:this.parentMessageId,clientMessageId:this.clientMessageId,sequenceId:this.sequenceId,version:this.version,searchKey:this.searchKey,type:this.type,contentType:this.contentType,activityType:this.activityType,messageType:this.messageType,threadType:this.threadType,clientArrivalTime:this.clientArrivalTime,originalArrivalTime:this.originalArrivalTime,imDisplayName:this.imDisplayName,creator:this.creator,content:this.content,source:this.source,properties:this.properties,skypeGuid:this.skypeGuid,translation:this.translation,isSanitized:this.isSanitized,originalNonLieMessage:this.originalNonLieMessage,annotationsSummary:this.annotationsSummary,state:this.state,dlpData:this.dlpData}},e.prototype.toLegacySchema=function(){var e=this.source===i.DeltaSync?i.Sync:this.source,t=this.toChatServiceSchema(),n=t.message,r=t.isPlainTextConvertedToHtml;return Object(o.a)(Object(o.a)({},Object(m.omit)(n,["conversationid"])),{clientArrivalTime:new Date(this.clientArrivalTime).toISOString(),source:e,isSanitized:this.isSanitized,isPlainTextConvertedToHtml:r})},e.prototype.toIntermediateSchemaForServerConversion=function(e){var t=this.toChatServiceSchema().message;return{id:t.id,content:t.content,originalarrivaltime:t.originalarrivaltime,imdisplayname:t.imdisplayname,from:t.from,messagetype:t.messagetype,properties:t.properties,skypeguid:t.skypeguid,clientmessageid:t.clientmessageid,translation:t.translation,version:t.version,annotationsSummary:t.annotationsSummary,conversationLink:t.conversationLink,conversationid:t.conversationid,threadtype:t.threadtype,dlpData:t.dlpData,userHasStarred:Object(c.n)(this.properties,e),callId:this.skypeGuid}},e.prototype.revertEditLieToOriginalMessage=function(){return!!this.originalNonLieMessage&&(this._content=this.originalNonLieMessage.content,this.translation=this.originalNonLieMessage.translation,this.dlpData=this.originalNonLieMessage.dlpData,this.properties[p.x.EditTime]=this.originalNonLieMessage.editTimeProperty,this.state=a.Delivered,!0)},e.prototype.resolveEditLieContent=function(){return this.originalNonLieMessage=void 0,this.state=a.Delivered,!0},e.prototype.copyExistingEditClientLie=function(e){this.originalNonLieMessage=e.originalNonLieMessage,this._content=e.content,this.translation=e.translation,this.dlpData=e.dlpData,this.state=e.state,this.properties[p.x.EditTime]=e.properties[p.x.EditTime]},e.prototype.isUpdatedMessage=function(){return Number(this.version)>Number(this.id)},e.prototype.shouldSkipSanitization=function(){return Object(m.isEmpty)(this.content)||this.isSanitized||this.isSystemMessage||this.messageType===p.y.Text||this.messageType===p.y.Call||this.messageType===p.y.CallRecording},e.prototype.toChatServiceSchema=function(){var t=this.content,n=this.messageType,r=!1;this.isSanitized&&n===p.y.Text&&(t="<div>"+Object(m.escape)(t)+"</div>",n=p.y.HTML,r=!0);var i=e.isClientLieId(this.parentMessageId)?""+e.ClientLiePrefix+this.clientMessageId:this.parentMessageId,a="conversation/"+this.conversationId+";messageid="+i;return{message:{content:t,messagetype:n,contenttype:this.contentType,activitytype:this.activityType,clientmessageid:this.clientMessageId,sequenceId:this.sequenceId,imdisplayname:this.imDisplayName,properties:this.properties,state:this.state,id:this.id,callId:this.callId,type:this.type,composetime:new Date(this.originalArrivalTime).toISOString(),originalarrivaltime:new Date(this.originalArrivalTime).toISOString(),from:"worker/"+this.creator,conversationLink:a,version:this.version,skypeguid:this.skypeGuid,translation:this.translation,annotationsSummary:this.annotationsSummary,threadtype:this.threadType,conversationid:this.conversationId,dlpData:this.dlpData},isPlainTextConvertedToHtml:r}},e.ClientLieId="-1",e.ClientLiePrefix="clientId_",e}(),O=function(){function e(t){var n=this;if(this.latestDeliveryTime=0,this.messageMap={},this.messageSearchKeys=[],Object(m.isEmpty)(t))throw new Error("Empty Object - cannot create a replychain");if(e.isDBSchema(t))this.replyChainId=t.replyChainId,this.conversationId=t.conversationId,this.latestDeliveryTime=t.latestDeliveryTime,this.messageSearchKeys=t.messageSearchKeys,this.lastUpdatedBy=t.lastUpdatedBy,Object(m.forEach)(t.messageMap,(function(e,t){n.messageMap[t]=new y(e)}));else{var r=t.messages;if(Object(m.isEmpty)(r))throw new Error("Must pass at least one message to build a reply chain");this.replyChainId=r[0].parentMessageId,this.conversationId=r[0].conversationId,r=Object(m.sortBy)(r,(function(e){return e.originalArrivalTime})),this.messageMap=Object(m.keyBy)(r,(function(e){return e.key})),this.lastUpdatedBy=t.source,this.updateSearchKeysAndLatestDeliveryTime()}}return e.isDBSchema=function(e){return"replyChainId"in e&&"conversationId"in e},e.fromSkypeMessages=function(t,n){if(Object(m.isEmpty)(t))throw new Error("SkypeReplyChainCDL - fromSkypeMessages: Need at least one message to create a SkypeReplyChain");return Object(m.flow)((function(e){return Object(m.map)(e,(function(e){return y.FromChatServiceMessage(e,n,!1,e.state)}))}),(function(e){return Object(m.groupBy)(e,(function(e){return e.parentMessageId}))}),(function(t){return Object(m.map)(t,(function(t){return new e({messages:t,source:n})}))}))(t)},e.fromCSAReplyChain=function(t){if(Object(m.isEmpty)(t))throw new Error("SkypeReplyChainCDL - fromCSAReplyChain: CSA replychain is empty");var n=i.CSAReplyChain,r=Object(m.flow)((function(e){return Object(m.map)(e,(function(e){return y.FromCSAMessage(e)}))}),(function(e){return Object(m.groupBy)(e,(function(e){return e.parentMessageId}))}),(function(t){return Object(m.map)(t,(function(t){return new e({messages:t,source:n})}))}))(t.messages);return Object(m.first)(r)},e.getClientLieDBKey=function(e){return[e,y.ClientLieId]},e.getClientLieKey=function(t){return e.getClientLieDBKey(t).toString()},e.isRootPresent=function(e){return Object(m.some)(e.messageMap,(function(t){return t.id===e.replyChainId}))},Object.defineProperty(e.prototype,"id",{get:function(){return this.replyChainId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this.dbKey.toString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dbKey",{get:function(){return[this.conversationId,this.replyChainId]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isClientLieReplyChain",{get:function(){return this.id===y.ClientLieId},enumerable:!1,configurable:!0}),e.prototype.sanitizeContent=function(e){Object(m.forEach)(this.messageMap,(function(t){return t.sanitizeContent(e)}))},Object.defineProperty(e.prototype,"messages",{get:function(){return Object(m.values)(this.messageMap)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isSanitized",{get:function(){return Object(m.every)(this.messages,(function(e){return e.isSanitized}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"earliestMessage",{get:function(){return this.hasMessages()?Object(m.minBy)(this.messages,(function(e){return e.originalArrivalTime})):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"latestMessage",{get:function(){return this.hasMessages()?Object(m.maxBy)(this.messages,(function(e){return e.originalArrivalTime})):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parentMessage",{get:function(){return this.hasMessages()?Object(m.find)(this.messages,(function(e){return e.id===e.parentMessageId})):void 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"messageCount",{get:function(){return Object(m.size)(this.messageMap)},enumerable:!1,configurable:!0}),e.prototype.hasMessage=function(e){return e in this.messageMap},e.prototype.hasMessages=function(){return this.messageCount>0},e.prototype.getMessage=function(e){return this.messageMap[e]},e.prototype.merge=function(e,t){var n=this,r=[];return Object(m.forEach)(e.messageMap,(function(e,i){var a=n.messageMap[i],s=a?n.mergeMessages(a,e,t):e;s!==a&&(r.push(s.id),n.messageMap[i]=s)})),this.updateSearchKeysAndLatestDeliveryTime(),this.lastUpdatedBy=e.lastUpdatedBy,{replyChain:this,updatedMessageIds:r}},e.prototype.deleteMessages=function(e){var t=this,n=0;return Object(m.forEach)(Object(m.keys)(this.messageMap),(function(r){e(t.messageMap[r])&&(delete t.messageMap[r],n++)})),n>0&&this.updateSearchKeysAndLatestDeliveryTime(),n},e.prototype.toDBSchema=function(){var e={};return Object(m.forEach)(this.messageMap,(function(t,n){e[n]=t.toDBSchema()})),{conversationId:this.conversationId,replyChainId:this.replyChainId,latestDeliveryTime:this.latestDeliveryTime,messageMap:e,messageSearchKeys:this.messageSearchKeys,lastUpdatedBy:this.lastUpdatedBy}},e.prototype.toLegacySchema=function(){var e=Object(m.map)(this.messages,(function(e){return e.toLegacySchema()}));return{conversationId:this.conversationId,replyChainId:this.replyChainId,latestDeliveryTime:this.latestDeliveryTime,messages:e}},e.prototype.tryResolveClientLie=function(e){if(!this.isClientLieReplyChain||!e.isRootMessage||!this.hasMessage(e.key))return!1;var t=Object(m.sortBy)(this.messages,(function(e){return e.originalArrivalTime})),n=Object(m.findIndex)(t,(function(t){return t.key===e.key}));return Object(m.forEach)(t,(function(t,r){Object(m.set)(t,"originalArrivalTime",e.originalArrivalTime+r-n)})),this.deleteMessages((function(t){return t.key===e.key})),!0},e.prototype.revertEditClientLie=function(e){var t=this.getMessage(e.key);return!(!t||!t.isEditClientLie)&&t.revertEditLieToOriginalMessage()},e.prototype.resolveEditClientLie=function(e){var t=this.getMessage(e.key);return!(!t||!t.isEditClientLie)&&t.resolveEditLieContent()},e.prototype.updateSearchKeysAndLatestDeliveryTime=function(){this.messageSearchKeys=Object(m.map)(this.messageMap,(function(e){return e.searchKey}));var e=this.latestMessage,t=this.getLatestNonDeletedMessage();this.latestDeliveryTime=t?t.originalArrivalTime:e?e.originalArrivalTime:0},e.prototype.getLatestNonDeletedMessage=function(){return this.hasMessages()?Object(m.maxBy)(Object(m.filter)(this.messageMap,(function(e){return!e.isDeleted})),(function(e){return e.originalArrivalTime})):void 0},e.prototype.mergeMessages=function(e,t,n){return y.shouldUseExistingMessage(e,t)?t.source===i.Local?this.mergeClientPropertiesFromLocal(e,t,n):e:n&&this.isReasonLie(n)||t.isLie||e.isLie?this.mergeLies(e,t):this.mergeClientMessageProperties(e,t,n)},e.prototype.isReasonLie=function(e){return"PostEditClientLie"===e||"PostReactionClientLie"===e||"ResolveEditClientLie"===e||"PostNewClientLie"===e},e.prototype.mergeClientMessageProperties=function(e,t,n){return t.source===i.Local?this.mergeClientPropertiesFromLocal(e,t,n):this.mergeClientPropertiesFromServer(e,t)},e.prototype.mergeClientPropertiesFromLocal=function(e,t,n){switch(n){case"Translation":t.translation&&(e.translation=t.translation);break;case"DLP":e.dlpData=t.dlpData}return e},e.prototype.mergeClientPropertiesFromServer=function(e,t){return t.isDeleted||e.isDeleted||t.isEdited&&t.editedTime!==e.editedTime||(t.translation=e.translation,t.dlpData=e.dlpData),t},e.prototype.mergeLies=function(e,t){return t.isEditClientLie?e.isEditClientLie?t.originalNonLieMessage=e.originalNonLieMessage:t.originalNonLieMessage={content:e.content,translation:e.translation,dlpData:e.dlpData,editTimeProperty:e.properties[p.x.EditTime]}:e.isEditClientLie&&t.copyExistingEditClientLie(e),t.source===i.Local?t:this.mergeClientPropertiesFromServer(e,t)},e}();!function(e){e.LoadAll="LOAD_ALL",e.LoadNone="LOAD_NONE",e.Custom="CUSTOM"}(v||(v={})),function(e){e.CleanupInactive="CLEANUP_INACTIVE"}(f||(f={}));var C,k=n("zQSw"),S=864e13;!function(e){e.latestDeliveryTimeByConversationId="latestDeliveryTimeByConversationId",e.byMessageSearchKeys="byMessageSearchKeys"}(C||(C={}));var j="conversations",T=(v.LoadAll,"syncstates"),I=(v.LoadAll,n("Mo3Q")),M=n("ifNO");var N,w=function(){function e(e){var t=this;this._subscriptionObservers=[],this.storeObservables={},e.forEach((function(e){t.storeObservables[e.name]={subscriptionObservers:[],observable:new I((function(n){t.storeObservables[e.name].subscriptionObservers.push(n),t.replayEventsForNewSubscriber(e.name,n)})),isDone:!1,lastError:void 0,nextStatesSeen:[],dependentOn:e.dependentOn}})),this._observable=new I((function(e){t._subscriptionObservers.push(e)}))}return e.prototype.subscribe=function(e,t,n,r){return this.checkStoreName(e),this.storeObservables[e].observable.subscribe({next:t,error:n,complete:r})},e.prototype.changeState=function(e,t,n){this.checkStoreName(e);var r=this.storeObservables[e].subscriptionObservers;if(r&&r.length&&r.forEach((function(e){e.next(t)})),this.storeObservables[e].nextStatesSeen.push(t),t===n)this.complete(e);else{var i=!0;Object(m.forEach)(this.storeObservables,(function(e){var n=Object(m.last)(e.nextStatesSeen);(void 0===n||n<t)&&(i=!1)})),i&&Object(m.forEach)(this._subscriptionObservers,(function(e){return e.next(t)}))}},e.prototype.getDependentStore=function(e){return this.storeObservables[e]&&this.storeObservables[e].dependentOn},Object.defineProperty(e.prototype,"observable",{get:function(){return this._observable},enumerable:!1,configurable:!0}),e.prototype.error=function(e,t){if((r=t)&&void 0!==r.target&&void 0!==r.target.error){var n=t.target.error;t=Object(M.a)("transaction",d.d.WriteToStoreFailed,n&&n.message||"",void 0,Object(M.b)(n))}var r;this.checkStoreName(e);var i=this.storeObservables[e].subscriptionObservers;i&&i.length&&i.forEach((function(e){e.error(t)})),this.storeObservables[e].lastError=t,this.storeObservables[e].isDone=!0,Object(m.forEach)(this._subscriptionObservers,(function(e){return e.error(t)}))},e.convertObservableToPromise=function(e,t){return new Promise((function(n,r){e.subscribe({next:function(e){e===t&&n()},error:function(e){r(e)},complete:function(){n()}})}))},e.prototype.replayEventsForNewSubscriber=function(e,t){Object(m.forEach)(this.storeObservables[e].nextStatesSeen,(function(e){t.next(e)})),this.storeObservables[e].lastError&&t.error(this.storeObservables[e].lastError),this.storeObservables[e].isDone&&t.complete()},e.prototype.complete=function(e){this.storeObservables[e].isDone=!0;var t=this.storeObservables[e].subscriptionObservers;t&&t.length&&t.forEach((function(e){e.complete()}));var n=!0;for(var r in this.storeObservables)this.storeObservables[r]&&(n=n&&this.storeObservables[r].isDone&&!this.storeObservables[r].lastError);n&&Object(m.forEach)(this._subscriptionObservers,(function(e){return e.complete()}))},e.prototype.checkStoreName=function(e){if(!e||!this.storeObservables[e])throw TypeError("Store name not found in transactions. Name: "+e)},e}();!function(e){e.MemoryCommitted="MEMORY_COMMITTED",e.DiskCommitted="DISK_COMMITTED"}(N||(N={}));var D,P,F,A,U,L=n("W1yN");!function(e){e[e.inMemory=0]="inMemory",e[e.indexedDB=1]="indexedDB",e[e.Network=2]="Network"}(D||(D={})),function(e){e[e.hiddenChatHistoryFilter=0]="hiddenChatHistoryFilter"}(P||(P={})),function(e){e[e.InsideSyncWindow=0]="InsideSyncWindow",e[e.OutsideSyncWindow=1]="OutsideSyncWindow"}(F||(F={})),function(e){e[e.MessageId=1]="MessageId",e[e.ReplyChainId=2]="ReplyChainId",e[e.TimeRange=3]="TimeRange",e[e.ClientLies=4]="ClientLies"}(A||(A={})),function(e){e.inMemory="inMemory",e.indexedDB="indexedDB",e.network="network"}(U||(U={}));var E,R=n("ux1a");!function(e){e.MainRenderer="MainRenderer",e.Experience="Experience"}(E||(E={}));var B=function(e,t,n){return Object(o.f)(void 0,void 0,Promise,(function(){var r,i,a,s,c,u,l,p,v,f,h,b,g;return Object(o.i)(this,(function(y){switch(y.label){case 0:r=e.correlationId,i=e.deeplinkMessageId,a=n.managers.replyChainManager,s=n.workerBootstrapServices,c=s.newScenario,u=s.logger,(l=n.loggingContext).correlationId=r,(p=c(L.b.ReplyChainManagerGetReplyChains)).appendEventData({origin:t,correlationId:r,"Thread.Id":e.conversationId,"Message.Id":i||void 0,message:i?"requested_deeplink":"no_deeplink"}),y.label=1;case 1:return y.trys.push([1,3,,4]),[4,a.getReplyChains(e,p,l)];case 2:return v=y.sent(),f=v.replyChains,h=Object(o.m)(v,["replyChains"]),b=Object(m.flatMap)(f,(function(e){return e.messages})),p.stop(),[2,Object(o.a)({messages:b},h)];case 3:return g=y.sent(),u.error("getMessagesFromManager failed:  "+(g&&g.message),l,d.d.FailedToGet),p.fail({errors:g&&g.message}),[2,Promise.reject(g)];case 4:return[2]}}))}))},x=function(e,t,n){return Object(o.f)(void 0,void 0,Promise,(function(){var r,i,a,s,c,u,l,p,v,f,h;return Object(o.i)(this,(function(b){switch(b.label){case 0:r=n.managers.replyChainManager,i=n.workerBootstrapServices,a=i.newScenario,s=i.logger,c=n.loggingContext,(u=a(L.b.ReplyChainManagerGetReplyChainsByKeys)).appendEventData({correlationId:e.correlationId,origin:t}),c.correlationId=e.correlationId,b.label=1;case 1:return b.trys.push([1,3,,4]),[4,r.getReplyChainsByKeys(e,u,c)];case 2:return l=b.sent(),p=l.replyChains,v=Object(o.m)(l,["replyChains"]),f=Object(m.flatMap)(p,(function(e){return e.messages})),u.stop(),[2,Object(o.a)({messages:f},v)];case 3:return h=b.sent(),s.error("getMessagesByKeysFromManager failed:  "+(h&&h.message),c,d.d.FailedToGet),u.fail({errors:h&&h.message}),[2,Promise.reject(h)];case 4:return[2]}}))}))},_=function(e){if(!Object(m.isNil)(e))throw Object(M.a)("ChatWorkerResolvers",d.d.FailedToFetch,"messages",void 0,"Sync failed with "+e)},H=function(e){switch(e){case D.inMemory:return r.DataSource.inMemory;case D.indexedDB:return r.DataSource.indexedDB;case D.Network:return r.DataSource.network;default:return null}},G=function(e,t){var n=function(e,t){return Object(m.map)(Object(m.orderBy)(e,(function(e){return e.originalArrivalTime}),"desc"),(function(e){return e.messageType===p.y.ShowHiddenChatHistory?Object(R.w)(e):Object(R.B)(e.toIntermediateSchemaForServerConversion(t.currentUserMri),t.loggerFactory)}))}(e.messages,t),r=n[n.length-1];return{messages:n,cursor:r&&r.originalArrivalTime?new Date(r.originalArrivalTime).getTime().toString():"1",dataSource:H(e.telemetryData.dataSource),areMessagesAvailable:e.messages.length>0,isConvSynced:!e.isLatestDataPending}},z=function(e){return{dataSource:H(e.dataSource),isDBPrefetchRunning:e.isDBPrefetchRunning}},q=function(e){return i[e.replyChain.lastUpdatedBy]+"-"+e.emitReason};n("f7fw");var W=function(e){var t=Object(o.a)(Object(o.a)({},e.threadProperties),e.properties);return Object(o.a)(Object(o.a)({},e),{properties:t})};var V=1e3,K=function(e,t){var n=e.managers,r=e.longPollEventPublisher,i=e.cancellationListener,a=e.workerBootstrapServices,s=e.loggingContext;return new I((function(e){var o=n.conversationManager.subscribe((function(t){e.next({event:t,source:"ConversationManager"})}),(function(e){return Y(e)&&$(t,e.id)})),u=r.subscribe((function(t){e.next({event:t,source:"LongPollEventPublisher"})}),(function(e){return $(t,Object(c.C)(e))&&X("Experience",e)})),l=function(e,t,n){return e.subscribeToFilteredUpdates((function(e){var n=e.replyChain.messages.filter((function(t){return Object(m.includes)(e.updatedMessageIds,t.id)}));t.next({event:n,source:"ReplyChainManager"})}),(function(e){return $(n,e.conversationId)}))}(n.replyChainManager,e,t);i.subscribe((function(){a.logger.log("Unsubscribing chatServiceEvent for "+t,s),o.unsubscribe(),u.unsubscribe(),l.unsubscribe(),e.complete()}))}))},Q=function(e,t,n,r,i,a){return Object(o.f)(void 0,void 0,Promise,(function(){var s,c;return Object(o.i)(this,(function(o){switch(o.label){case 0:switch(s=[],e.source){case"LongPollEventPublisher":u=e.event,s=[u];break;case"ConversationManager":s=function(e,t,n){return t.log("Emitting chatServiceEvents from ConversationManager "+e.id+" version "+e.version,n),[{resource:e,resourceType:p.m.ConversationUpdate},{resource:W(e),resourceType:p.m.ThreadUpdate}]}(e.event,i,a);break;case"ReplyChainManager":s=function(e,t,n,r){return e.map((function(e){var i=e.isUpdatedMessage()?p.m.MessageUpdate:p.m.NewMessage;return t.log("Emitting chatServiceEvent from RCManager "+i+" "+e.conversationId+", id "+e.id+", version "+e.version,n),{resource:e.toIntermediateSchemaForServerConversion(r.id),resourceType:i}}))}(e.event,i,a,r)}return c=m.compact,[4,Promise.all(s.map((function(e){return Object(R.r)(e,t,n,r)})))];case 1:return[2,c.apply(void 0,[o.sent()])]}var u}))}))},J={Legacy:[p.m.NewMessage,p.m.MessageUpdate,p.m.CustomUserProperties,"ResyncRequired"],Experience:[p.m.NewMessage,p.m.MessageUpdate]},X=function(e,t){if(-1===J[e].indexOf(t.resourceType))return!1;if(t.resourceType===p.m.NewMessage||t.resourceType===p.m.MessageUpdate){var n=t.resource;return!!n.messagetype&&(-1!==n.messagetype.indexOf("Control/")||n.messagetype===p.h.MemberConsumptionHorizonUpdate)}return!0},Y=function(e){return e.source===u.b.StartupSyncClean||e.source===u.b.StartupSyncUpdate||e.source===u.b.ThreadDetailsSync||e.source===u.b.LongPoll};function $(e,t){return!e||t===e}var Z={Query:{conversations:function(e,t,n){var r=n.managers,i=n.loggingContext;return Object(o.f)(this,void 0,void 0,(function(){return Object(o.i)(this,(function(e){switch(e.label){case 0:return[4,r.conversationManager.getConversations(void 0,i)];case 1:return[2,e.sent()]}}))}))},legacyConversationsWithAllProperties:function(e,t,n){var r=n.managers,i=n.loggingContext;return Z.Query.conversations&&Z.Query.conversations({},{},{managers:r,loggingContext:i})},legacyMessages:function(e,t,n){var r=t.convId,i=t.count,a=t.cursor,s=t.deeplinkMessageId,u=t.correlationId,l=t.includeLatestData;return Object(o.f)(this,void 0,void 0,(function(){var e,t;return Object(o.i)(this,(function(o){switch(o.label){case 0:e={conversationId:r,count:i,token:a,deeplinkMessageId:s,correlationId:u,includeLatestData:l},o.label=1;case 1:return o.trys.push([1,,3,4]),[4,B(e,E.MainRenderer,n)];case 2:return t=o.sent(),[2,{legacyMessages:Object(m.map)(t.messages,(function(e){return e.toLegacySchema()})),cursor:t.token,deeplinkReplyChainId:t.deeplinkReplyChainId,isLatestDataPending:t.isLatestDataPending,errorCode:t.errorCode,errorDescription:t.errorDescription,telemetryData:z(t.telemetryData)}];case 3:return Object(c.o)(r)||n.onActiveSubject.onNext({ids:[r]}),[7];case 4:return[2]}}))}))},legacyMessagesWithAllProperties:function(e,t,n){return Z.Query.legacyMessages&&Z.Query.legacyMessages(e,t,n)},legacyMessagesByKeys:function(e,t,n){var r=t.convId,i=t.keys,a=t.keyType,s=t.correlationId,c=t.includeLatestData;return Object(o.f)(this,void 0,void 0,(function(){var e;return Object(o.i)(this,(function(t){switch(t.label){case 0:return[4,x({conversationId:r,keys:i,keyType:a,correlationId:s,includeLatestData:c},E.MainRenderer,n)];case 1:return e=t.sent(),[2,{legacyMessages:Object(m.map)(e.messages,(function(e){return e.toLegacySchema()})),telemetryData:z(e.telemetryData),isLatestDataPending:e.isLatestDataPending,errorCode:e.errorCode,errorDescription:e.errorDescription}]}}))}))},legacyMessagesByKeysWithAllProperties:function(e,t,n){return Z.Query.legacyMessagesByKeys&&Z.Query.legacyMessagesByKeys(e,t,n)}},Mutation:{putConversations:function(e,t,n){var r=t.conversations,i=t.reason,a=n.managers,s=n.workerBootstrapServices,c=n.loggingContext;return Object(o.f)(this,void 0,Promise,(function(){var e,t,n;return Object(o.i)(this,(function(o){switch(o.label){case 0:if(!r||!r.length)return[2,ee("PutConversations - conversations param not provided",c,s.logger)];e=Object(m.forEach)(r,(function(e){e.source=u.b.ResolverPutConversation})),o.label=1;case 1:return o.trys.push([1,3,,4]),l=i,t=h.includes(l)?l:void 0,void 0===i?s.logger.warn("Did not receive conversation update reason",c):void 0===t&&s.logger.warn("Invalid conversation update reason provided: "+i,c),[4,a.conversationManager.putConversations(e,u.b.ResolverPutConversation,c,t)];case 2:return o.sent(),[2,!0];case 3:return[2,ee("PutConversations - errored out while putting conversations in the manager "+((n=o.sent())&&n.message),c,s.logger)];case 4:return[2]}var l}))}))},putLegacyMessages:function(e,t,n){var r=t.messages,i=t.correlationId,a=t.reason,s=n.managers,c=n.workerBootstrapServices,l=n.loggingContext;return Object(o.f)(this,void 0,void 0,(function(){var e,t,n;return Object(o.i)(this,(function(o){switch(o.label){case 0:e=c.newScenario(L.b.PutLegacyMessagesResolver),i&&e.appendEventData({correlationId:i}),t=O.fromSkypeMessages(r,u.hb.Local),o.label=1;case 1:return o.trys.push([1,5,,6]),"Delete"!==a?[3,2]:(s.replyChainManager.handleMessagesDeletedInCurrentSession(t),[3,4]);case 2:return[4,s.replyChainManager.handleSyncedReplyChains(t,l,e,void 0,(d=a,b.includes(d)?d:void 0))];case 3:o.sent(),o.label=4;case 4:return e.stop(),[2,!0];case 5:return n=o.sent(),e.fail({message:n&&n.message}),[2,ee("PutLegacyMessages - errored out while putting messages in the manager "+(n&&n.message),l,c.logger)];case 6:return[2]}var d}))}))},resolveEditClientLie:function(e,t,n){var r=t.message,i=t.shouldResolve,a=t.correlationId,s=n.managers,c=n.workerBootstrapServices,l=n.loggingContext;return Object(o.f)(this,void 0,void 0,(function(){var e,t,n,d;return Object(o.i)(this,(function(o){switch(o.label){case 0:e=O.fromSkypeMessages([r],u.hb.Local)[0],t=c.newScenario(L.b.ResolveEditClientLieResolver),a&&t.appendEventData({correlationId:a}),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,s.replyChainManager.resolveOrRevertEditClientLie(e,i,t,l)];case 2:return n=o.sent(),t.stop(),[2,n];case 3:return d=o.sent(),t.fail({message:d&&d.message}),[2,ee("resolveEditClientLie - errored out while trying to resolve client lie in the manager: "+(d&&d.message),l,c.logger)];case 4:return[2]}}))}))},removeConversations:function(e,t,n){var r=t.conversationIds,i=n.managers,a=n.workerBootstrapServices,s=n.loggingContext;return Object(o.f)(this,void 0,Promise,(function(){var e,t,n;return Object(o.i)(this,(function(c){switch(c.label){case 0:if(!r||!r.length)return[2,ee("removeConversations - conversationIds param not provided",s,a.logger)];c.label=1;case 1:return c.trys.push([1,3,,4]),e=i,t=Object(m.map)(r,(function(t){return function(e,t,n){return Object(o.f)(this,void 0,Promise,(function(){var r,i;return Object(o.i)(this,(function(a){if(!e)throw new TypeError("SyncUtilities - missing conversationId to delete");return r=new w([{name:j,dependentOn:T},{name:T}]),i=w.convertObservableToPromise(r.observable,N.MemoryCommitted),n.syncStateManager.deleteConversationSyncState(e,!1,r,t),n.conversationManager.removeConversations([e],r,t),[2,i]}))}))}(t,s,{conversationManager:e.conversationManager,syncStateManager:e.syncStateManager})})),[4,Promise.all(t)];case 2:return c.sent(),[2,!0];case 3:return[2,ee("RemoveConversations - errored out while removing conversations: "+((n=c.sent())&&n.message),s,a.logger)];case 4:return[2]}}))}))}},Subscription:{conversationUpdateEvent:{subscribe:function(e,t,n){var r=n.managers,i=n.workerBootstrapServices;return Object(o.c)(this,arguments,(function(){var e,t,n,a,s,c,u,d;return Object(o.i)(this,(function(m){switch(m.label){case 0:e=new I((function(e){r.conversationManager.subscribe((function(t){e.next(t)}))})),m.label=1;case 1:m.trys.push([1,8,9,14]),t=Object(o.d)(Object(l.a)(e,V,i.newScenario,"conversationUpdateEvent",i.logger)),m.label=2;case 2:return[4,Object(o.e)(t.next())];case 3:return(n=m.sent()).done?[3,7]:(a=n.value,s={conversationUpdateEvent:a},[4,Object(o.e)(s)]);case 4:return[4,m.sent()];case 5:m.sent(),m.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return c=m.sent(),u={error:c},[3,14];case 9:return m.trys.push([9,,12,13]),n&&!n.done&&(d=t.return)?[4,Object(o.e)(d.call(t))]:[3,11];case 10:m.sent(),m.label=11;case 11:return[3,13];case 12:if(u)throw u.error;return[7];case 13:return[7];case 14:return[2]}}))}))}},legacyReplyChainUpdateEvent:{subscribe:function(e,t,n){var r=n.managers,i=n.workerBootstrapServices;return Object(o.c)(this,arguments,(function(){var e,t,n,a,s,c,u,d;return Object(o.i)(this,(function(m){switch(m.label){case 0:e=new I((function(e){r.replyChainManager.subscribeToFilteredUpdates((function(t){e.next(t)}))})),m.label=1;case 1:m.trys.push([1,8,9,14]),t=Object(o.d)(Object(l.a)(e,V,i.newScenario,"legacyReplyChainUpdateEvent",i.logger,q)),m.label=2;case 2:return[4,Object(o.e)(t.next())];case 3:return(n=m.sent()).done?[3,7]:(a=n.value,s={legacyReplyChainUpdateEvent:{replyChain:a.replyChain.toLegacySchema(),updatedMessageIds:a.updatedMessageIds}},[4,Object(o.e)(s)]);case 4:return[4,m.sent()];case 5:m.sent(),m.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return c=m.sent(),u={error:c},[3,14];case 9:return m.trys.push([9,,12,13]),n&&!n.done&&(d=t.return)?[4,Object(o.e)(d.call(t))]:[3,11];case 10:m.sent(),m.label=11;case 11:return[3,13];case 12:if(u)throw u.error;return[7];case 13:return[7];case 14:return[2]}}))}))}},legacyChatServiceEvent:{subscribe:function(e,t,n){var r=n.longPollEventPublisher,i=n.workerBootstrapServices;return Object(o.c)(this,arguments,(function(){var e,t,n,a,s,c,u,d,m;return Object(o.i)(this,(function(p){switch(p.label){case 0:e=new I((function(e){r.subscribe((function(t){return e.next(t)}),(function(e){return X("Legacy",e)}))})),t=Object(l.a)(e,V,i.newScenario,"legacyChatServiceEvent",i.logger),p.label=1;case 1:p.trys.push([1,8,9,14]),n=Object(o.d)(t),p.label=2;case 2:return[4,Object(o.e)(n.next())];case 3:return(a=p.sent()).done?[3,7]:(s=a.value,c=Object(o.a)(Object(o.a)({},s),{resource:JSON.stringify(s.resource)}),[4,Object(o.e)({legacyChatServiceEvent:c})]);case 4:return[4,p.sent()];case 5:p.sent(),p.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return u=p.sent(),d={error:u},[3,14];case 9:return p.trys.push([9,,12,13]),a&&!a.done&&(m=n.return)?[4,Object(o.e)(m.call(n))]:[3,11];case 10:p.sent(),p.label=11;case 11:return[3,13];case 12:if(d)throw d.error;return[7];case 13:return[7];case 14:return[2]}}))}))}},legacySenderMRIEvent:{subscribe:function(e,t,n){var r=n.managers,i=n.workerBootstrapServices;return Object(o.c)(this,arguments,(function(){var e,t,n,a,s,c,u,d;return Object(o.i)(this,(function(m){switch(m.label){case 0:e=new I((function(e){r.peopleProfileManager.subscribeToSenderMRIEvent((function(t){e.next(t)}))})),m.label=1;case 1:m.trys.push([1,8,9,14]),t=Object(o.d)(Object(l.a)(e,V,i.newScenario,"legacySenderMRIEvent",i.logger)),m.label=2;case 2:return[4,Object(o.e)(t.next())];case 3:return(n=m.sent()).done?[3,7]:(a=n.value,s={legacySenderMRIEvent:a},[4,Object(o.e)(s)]);case 4:return[4,m.sent()];case 5:m.sent(),m.label=6;case 6:return[3,2];case 7:return[3,14];case 8:return c=m.sent(),u={error:c},[3,14];case 9:return m.trys.push([9,,12,13]),n&&!n.done&&(d=t.return)?[4,Object(o.e)(d.call(t))]:[3,11];case 10:m.sent(),m.label=11;case 11:return[3,13];case 12:if(u)throw u.error;return[7];case 13:return[7];case 14:return[2]}}))}))}}}};function ee(e,t,n){return t.component="ChatLegacyResolvers",n.error(e,t,d.d.InvalidInput),Promise.reject(e)}var te=n("c2NR");function ne(e,t,n,r,i){return Object(o.f)(this,void 0,Promise,(function(){var a,s;return Object(o.i)(this,(function(o){switch(o.label){case 0:return[4,t.getConversation(e)];case 1:return(a=o.sent())?[4,Object(te.h)([a],r)]:[2,{id:e,members:[]}];case 2:return s=o.sent(),[2,Object(R.x)(a,s,n,i)]}}))}))}function re(e,t,n,r,i,a){var s,c;return Object(o.f)(this,void 0,Promise,(function(){var u,l,d,p,v,f,h,b;return Object(o.i)(this,(function(o){switch(o.label){case 0:return u={edges:[],__typename:"ChatsConnection",pageInfo:{__typename:"PageInfo",startCursor:void 0,endCursor:"",hasNextPage:!1}},[4,e.getConversations((function(e){return Object(g.h)(e)&&!Object(m.isNil)(e.lastMessage)}))];case 1:return(l=o.sent())&&l.length?(d=Object(m.orderBy)(l,(function(e){var t;return null===(t=e.lastMessage)||void 0===t?void 0:t.originalarrivaltime}),"desc"),p=d.length,v=function(e,t){var n=0;t&&e.every((function(e,r){return!(e.lastMessage&&e.lastMessage.originalarrivaltime<t)||(n=r,!1)}));return n}(d,a),f=d.splice(v,i),[4,Object(te.h)(f,n)]):[2,u];case 2:return h=o.sent(),[2,{edges:b=f.map((function(e){return Object(R.t)(e,h,t,r)})),__typename:"ChatsConnection",pageInfo:{__typename:"PageInfo",startCursor:f&&f.length&&(null===(s=f[0].lastMessage)||void 0===s?void 0:s.originalarrivaltime)||"",endCursor:null===(c=f[f.length-1].lastMessage)||void 0===c?void 0:c.originalarrivaltime,hasNextPage:v+b.length<p}}]}}))}))}var ie=n("POyb"),ae={Query:{messages:function(e,t,n){var r=t.convId,i=t.cursor,a=t.replyChainId,s=t.count;return Object(o.f)(this,void 0,void 0,(function(){var e,t,c,u,l,m,p;return Object(o.i)(this,(function(v){switch(v.label){case 0:return e=n.loggingContext,t=n.coreSettings,c=function(e){var t=e.requestWindowId?":"+e.requestWindowId:"";return""+e.requestRendererId+t+":"+e.requestId}(e),a?(u={conversationId:r,keys:[a],keyType:A.ReplyChainId,includeLatestData:!0,correlationId:c},[4,x(u,E.Experience,n)]):[3,2];case 1:return l=v.sent(),_(l.errorCode),[2,G(l,n)];case 2:return m={conversationId:r,token:i,count:s||t.get(k.a.Sync).chatReplyChainsToFetch||20,includeLatestData:!1,correlationId:c,replyChainFilterToBeApplied:P.hiddenChatHistoryFilter},[4,B(m,E.Experience,n)];case 3:return p=v.sent(),_(p.errorCode),p.isLatestDataPending&&function(e,t,n,r){Object(o.f)(void 0,void 0,Promise,(function(){var i,a,s,c,u;return Object(o.i)(this,(function(o){switch(o.label){case 0:i=t||"0",a=S.toString(),r.workerBootstrapServices.logger.log("Fetching latest data for conv "+e+", startTime "+i+", correlationId "+n,r.loggingContext),s={conversationId:e,keys:[i,a],keyType:A.TimeRange,includeLatestData:!0,correlationId:n},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,x(s,E.Experience,r)];case 2:return c=o.sent(),_(c.errorCode),[3,4];case 3:return u=o.sent(),r.workerBootstrapServices.logger.error("Latest data fetch failed: "+(u&&u.message),r.loggingContext,u&&d.d[u.code]&&u.code||d.d.Unknown),[2];case 4:return[2]}}))}))}(r,p.token,c,n),[2,G(p,n)]}}))}))},chat:function(e,t,n){var r=t.convId,i=n.managers,a=n.loggerFactory,s=n.peopleService,c=n.currentUserMri;return Object(o.f)(this,void 0,void 0,(function(){return Object(o.i)(this,(function(e){switch(e.label){case 0:return[4,ne(r,i.conversationManager,a,s,{id:c})];case 1:return[2,e.sent()]}}))}))},chats:function(e,t,n){var r=t.first,i=t.after,a=n.managers,s=n.loggerFactory,c=n.currentUserMri,u=n.peopleService;return Object(o.f)(this,void 0,void 0,(function(){return Object(o.i)(this,(function(e){switch(e.label){case 0:return 20,[4,re(a.conversationManager,s,u,{id:c},r||20,i)];case 1:return[2,e.sent()]}}))}))},searchUsersByConversation:function(e,t,n){var r=t.convId,i=t.searchQuery,a=t.searchExactMatches,s=t.includeCurrentLoggedInUser,c=n.managers,u=n.loggerFactory,l=n.peopleService,d=n.currentUserMri;return Object(o.f)(this,void 0,Promise,(function(){var e;return Object(o.i)(this,(function(t){switch(t.label){case 0:if(!r)throw new Error("ConvId null not supported");return[4,ne(r,c.conversationManager,u,l,{id:d})];case 1:if(!(e=t.sent()))throw new Error("Conversation could not be found, convId - "+r);return[2,Object(te.q)(e.members,d,i,a,s)]}}))}))}},Subscription:{chatServiceEvent:{subscribe:function(e,t,n){var r=t.conversationId;return Object(o.c)(this,arguments,(function(){var e,t,i,a,s,c,u,d,m,p,v,f,h,b,g,y,O,C=this;return Object(o.i)(this,(function(k){switch(k.label){case 0:e=n.workerBootstrapServices,t=n.peopleService,i=n.loggerFactory,a=n.currentUserMri,s=n.loggingContext,e.logger.log("Subscribing chatServiceEvent for "+(r||"chat list"),s),c=function(e){return Object(o.f)(C,void 0,void 0,(function(){return Object(o.i)(this,(function(n){return[2,Object(ie.a)(e,t)]}))}))},u=K(n,r),k.label=1;case 1:k.trys.push([1,11,12,17]),d=Object(o.d)(Object(l.a)(u,V,e.newScenario,"chatServiceEvent",e.logger)),k.label=2;case 2:return[4,Object(o.e)(d.next())];case 3:return(m=k.sent()).done?[3,10]:(p=m.value,[4,Object(o.e)(Q(p,c,i,{id:a},e.logger,s))]);case 4:v=k.sent(),f=0,h=v,k.label=5;case 5:return f<h.length?(b=h[f],[4,Object(o.e)({chatServiceEvent:b})]):[3,9];case 6:return[4,k.sent()];case 7:k.sent(),k.label=8;case 8:return f++,[3,5];case 9:return[3,2];case 10:return[3,17];case 11:return g=k.sent(),y={error:g},[3,17];case 12:return k.trys.push([12,,15,16]),m&&!m.done&&(O=d.return)?[4,Object(o.e)(O.call(d))]:[3,14];case 13:k.sent(),k.label=14;case 14:return[3,16];case 15:if(y)throw y.error;return[7];case 16:return[7];case 17:return[2]}}))}))}}}},se=n("gXkv"),oe=n("TdW2"),ce=n("vIjS")}}]);