webpackJsonp([39],{2531:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s(2532)},2532:function(e,t,s){"use strict";var i=this&&this.__extends||function(){var e=function(t,s){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])})(t,s)};return function(t,s){function i(){this.constructor=t}e(t,s),t.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();Object.defineProperty(t,"__esModule",{value:!0});var a=s(2533),n=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.etag="",t.teamId="",t.title="",t.plGroupKey="",t.icon="",t.pictureGroup=[],t.isItalicized=!1,t}i(t,e)}(function(){return function(){}}()),function(){function e(e,t,s,i,a,n,r,o,c,l,h,p,m,d,u,g,v,f,y,I,S){this.$q=e,this.$scope=t,this.$translate=s,this.resources=i,this.peopleService=a,this.conversationsService=n,this.constants=r,this.chatTitlesService=o,this.calendarService=c,this.callingService=l,this.appsService=h,this.channelService=p,this.callTitleService=m,this.eventingService=d,this.tabService=u,this.filesUtilityService=g,this.utilityService=f,this.settingsService=y,this.identityService=I,this.messageFetchService=S,this.defaultIconUrl="svg/icons-recents.html",this.defaultDocumentIconUrl="svg/icons-document.html",this.strTemplate="svg/icons-{type}.html",this.itemAdditionalDetailsPromiseArray=[],this.isLoaded=!1,this.logger=v.newLogger("historyDropdown"),this.chatPrefix=s.instant(i.strings.history_menu_chat_with_menuitem_text)}return e.$inject=["$q","$scope","$translate","resources","peopleService","conversationsService","constants","chatTitlesService","calendarService","callingService","appsService","channelService","callTitleService","eventingService","tabService","filesUtilityService","loggingService","utilityService","settingsService","identityService","messageFetchService"],e.prototype.$onInit=function(){this.historyStack=[],this.populateHistoryStack()},e.prototype.$onDestroy=function(){this.historyStack=void 0},e.prototype.populateHistoryStack=function(){var e=this;return(this.navigationStack||[]).forEach(function(t){var s={stateName:t.stateName,params:t.params,etag:"",title:"",teamId:"",plGroupKey:"",icon:"",pictureGroup:[],isItalicized:!1};e.itemAdditionalDetailsPromiseArray.push(e.enhanceItemDetails(s)),e.historyStack.push(s)}),this.utilityService.whenAllAllowFailures(this.itemAdditionalDetailsPromiseArray).then(function(){e.isLoaded=!0}).catch(function(){return e.logger.error("Error while populating history menu item details"),e.$q.reject()})},e.prototype.shouldShowTeamsIcon=function(e){return(e.stateName===this.constants.states.appConversation||e.stateName===this.constants.states.appAppsAppChannelSection)&&e.params.ctx===this.constants.navigation.context.channel&&!!e.params.threadId},e.prototype.shouldShowChatIcon=function(e){return(e.stateName===this.constants.states.appConversation||e.stateName===this.constants.states.appAppsAppChatSection)&&e.params.ctx===this.constants.navigation.context.chat&&e.params.slug!==this.constants.p2p.newChatId},e.prototype.shouldShowCalendarIcon=function(e){return e.stateName===this.constants.states.appCalendar||e.stateName===this.constants.states.appCalendarV2},e.prototype.shouldShowFileIcon=function(e){return e.stateName===this.constants.states.appDocumentViewer&&e.params.fileId},e.prototype.shouldShowCallIcon=function(e){return e.stateName===this.constants.states.appCallList},e.prototype.enhanceItemWithTabDetails=function(e,t,s){var i=this;return this.tabService.getTab(e.params.threadId,e.params.middlePane).then(function(e){t=s,s=decodeURIComponent(e.displayName)}).catch(function(){return i.logger.error("Error while fetching tab information for {0}",e.params.threadId),i.$q.reject()}).finally(function(){i.enhanceItemWithFullMenuTitle(e,t,s)})},e.prototype.enhanceItemWithCalendarDetails=function(e,t,s,i){var a=this;return this.calendarService.getEventUsingEventProvider(e.params.meetingId,teamspace.services.CalendarEventProviderType.userEventUsingEventId,"app page title",null,!1,t).then(function(e){s=e.subject}).catch(function(){return a.logger.error("Error while fetching tab information for {0}",e.params.meetingId),a.$q.reject()}).finally(function(){s||(s=a.$translate.instant(a.resources.strings.meeting_browser_title)),a.enhanceItemWithFullMenuTitle(e,s,i),e.icon="svg/icons-calendar.html"})},e.prototype.enhanceItemWithUserInfo=function(e){var t,s=this,i="",a=teamspace.services.SfBInteropUtilsService.isNativeFederationMri(e.params.slug)?teamspace.services.SfBInteropUtilsService.getOriginalId(e.params.slug):e.params.slug;return this.peopleService.getPeopleProfile(a,"pageTitle").then(function(a){if(a&&a.displayName&&(t=a.displayName,e.params.middlePane&&e.params.middlePane!==s.constants.activity.panes.conversations)){var n=s.tabService.getTabById(e.params.middlePane);n&&n.displayName&&(i=n.displayName)}s.enhanceItemWithFullMenuTitle(e,t,i)}).catch(function(){e.title=s.chatPrefix+" "+s.$translate.instant(s.resources.strings.unknown_user),s.logger.error("Error while fetching user profile information for history item.")})},e.prototype.enhanceItemWithChatDetails=function(e,t){var s,i=this,a="";return this.chatTitlesService.buildChatTitles(t).then(function(n){if(n&&(e.pictureGroup=n.pictureMembers,e.plGroupKey=i.peopleService.getPlGroupKeyFromPictureGroup(e.pictureGroup),n.title&&(s=n.title,e.params.middlePane&&e.params.middlePane!==i.constants.activity.panes.conversations))){var r=i.tabService.getTabById(e.params.middlePane);r&&r.displayName&&(a=r.displayName)}return e.params.messageId?i.enhanceItemWithMessagePreview(e,s,t,e.params.messageId):i.enhanceItemWithFullMenuTitle(e,s,a)}).catch(function(){e.title=i.chatPrefix+" "+i.$translate.instant(i.resources.strings.unknown_user),i.logger.error("Error while fetching chat title information for {0}",t)})},e.prototype.enhanceItemWithMessagePreview=function(e,t,s,i,a,n){var r,o=this;return this.messageFetchService.getMessage(s,i,!1,a).then(function(e){if(e&&e.trimmedMessageContent){var t={withEllipsis:!0},s=e&&o.utilityService.truncate(e.trimmedMessageContent,40,t);n?r=s:n=s}}).catch(function(){o.logger.error("Error while fetching message preview for conversionId "+s+" messageId "+i+" replyChainId "+a)}).finally(function(){o.enhanceItemWithFullMenuTitle(e,t,n,r)})},e.prototype.enhanceItemDetails=function(e){var t,s,i,a,n=this,r={name:e.stateName},o=e.params,c=teamspace.services.navigationGetStateContextFrom(r,o,this.constants);if(c===this.constants.navigation.context.channel&&o.threadId){if((y=this.findTeamChannelDetails(e,o.threadId))&&y.channel&&y.team){if(i=y.team.displayName,a=y.channel.displayName,o.middlePane&&o.middlePane===this.constants.activity.panes.conversations&&o.messageId&&o.replyChainId)return this.enhanceItemWithMessagePreview(e,i,o.threadId,o.messageId,o.replyChainId,a);if(o.middlePane&&o.middlePane.contains("tab"))return this.enhanceItemWithTabDetails(e,i,a);o.middlePane&&o.middlePane!==this.constants.activity.panes.conversations&&(i=a,a=decodeURIComponent(o.middlePane))}}else if(c===this.constants.navigation.context.chat){if(o.slug)if(o.slug===this.constants.p2p.newChatId)e.icon="svg/icons-compose.html",i=this.$translate.instant(this.resources.strings.new_chat_button);else{if(SkypeX.Services.ChatServiceUtils.isMri(o.slug))return this.enhanceItemWithUserInfo(e);var l=this.conversationsService.getCorrespondingConversation(e.params.slug),h=l&&this.chatTitlesService.getChatConversationTitles(l.id);if(h&&(e.pictureGroup=h.pictureMembers,e.plGroupKey=this.peopleService.getPlGroupKeyFromPictureGroup(e.pictureGroup),h.title)){if(i=h.title,e.params.messageId)return this.enhanceItemWithMessagePreview(e,i,l.id,e.params.messageId);if(e.params.middlePane&&e.params.middlePane!==this.constants.activity.panes.conversations){var p=this.tabService.getTabById(e.params.middlePane);p&&p.displayName&&(a=p.displayName)}}if(l&&!i)return this.enhanceItemWithChatDetails(e,l.id)}}else if(r.name===this.constants.states.appCalendar||r.name===this.constants.states.appCalendarV2){if(e.icon="svg/icons-calendar.html",o.meetingId){var m="true"===o.isBroadcast;return a=this.$translate.instant(this.resources.strings.meeting_browser_title),this.enhanceItemWithCalendarDetails(e,m,i,a)}var d=this.settingsService.valueAsBoolean(this.constants.settings.names.enableFreemiumCalendar)&&this.identityService.isFreemiumTenant();i=this.$translate.instant(d?this.resources.strings.aria_app_bar_meetings:this.resources.strings.meeting_browser_title),e.icon="svg/icons-calendar.html"}else if(r.name===this.constants.states.appAppsAppContext)e.icon=this.defaultIconUrl,o&&"OneToOne"===o.conversationType?i=o.itemName:o&&"Group"===o.conversationType&&(i=o.groupName,a=o.itemName);else if(r.name===this.constants.states.preJoinCalling)e.icon="svg/icons-call.html",o.title&&o.title.length>0?(i=o.title,a=this.$translate.instant(this.resources.strings.page_title_header_in_meeting)):i=this.$translate.instant(this.resources.strings.page_title_header_in_meeting);else if(r.name===this.constants.states.appCalling){if(o.teamsCallId){var u=this.callingService.getCallByTeamsCallId(o.teamsCallId);i=this.callTitleService.getMeetupTitleForCall(u),a=this.$translate.instant(this.resources.strings.page_title_header_in_meeting)}else i=this.$translate.instant(this.resources.strings.page_title_header_in_meeting);e.icon="svg/icons-call.html"}else if(r.name===this.constants.states.appYourSpaces)i=this.$translate.instant(this.resources.strings.page_title_header_files),e.icon=this.defaultDocumentIconUrl;else if(r.name===this.constants.states.appDocumentViewer||r.name===this.constants.states.appAppsAppFileSection){var g=o;i=this.filesUtilityService.getFileNameFromObjectURL(g.objectUrl),e.icon=this.utilityService.getSVGBase(g.fileType,this.strTemplate)}else if(r.name===this.constants.states.appExternalDocumentViewer){var v=o;i=this.$translate.instant(this.resources.strings.page_title_file_viewer_type_format).replace("{fileType}",v.fileType.toUpperCase()),e.icon=this.defaultDocumentIconUrl}else if(r.name===this.constants.states.appCallList)i=this.$translate.instant(this.resources.strings.aria_app_bar_calling),e.icon="svg/icons-call.html";else if(r.name===this.constants.states.appApps)i=this.$translate.instant(this.resources.strings.page_title_header_app_store),e.icon="svg/icons-apps.html";else if(r.name===this.constants.states.appManageTenant)i=this.$translate.instant(this.resources.strings.page_title_header_manage_org);else if(r.name===this.constants.states.appAppsAppSection)this.appsService.getInstalledAppForUser(o.appId).then(function(t){t&&t.appDefinition&&t.appDefinition.name&&(i=t.appDefinition.name,n.enhanceItemWithFullMenuTitle(e,i,a),e.icon="svg/icons-apps.html")});else if(r.name===this.constants.states.appAppsAppSearchPage)if(i=o.q,e.icon="svg/icons-search.html",null===(t=o.searchStateInfo)||void 0===t?void 0:t.localizedStringId){var f=this.$translate.instant(o.searchStateInfo.localizedStringId);a=f!==o.searchStateInfo.localizedStringId?f:void 0}else switch((f=(null===(s=o.searchStateInfo)||void 0===s?void 0:s.currentTab)||"").toLowerCase()){case this.constants.search.tabs.all:a=this.$translate.instant(this.resources.strings.search_tab_all);break;case this.constants.search.tabs.files:a=this.$translate.instant(this.resources.strings.search_tab_files);break;case this.constants.search.tabs.people:a=this.$translate.instant(this.resources.strings.search_tab_people);break;case this.constants.search.tabs.messages:a=this.$translate.instant(this.resources.strings.search_tab_messages)}else if(r.name===this.constants.states.appDiscover)i=this.$translate.instant(this.resources.strings.history_menu_discover_teams_title),e.icon=this.defaultIconUrl;else if(r.name===this.constants.states.appTeamsManagement)i=this.$translate.instant(this.resources.strings.td_manage_teams_dashboard_title),e.icon=this.defaultIconUrl;else if(r.name===this.constants.states.appTeamDashboard&&o.threadId)(y=this.findTeamChannelDetails(e,o.threadId))&&y.team&&(i=y.team.displayName,a=this.$translate.instant(this.resources.strings.team_dashboard_view_dashboard),e.icon="svg/icons-settings.html");else if(r.name===this.constants.states.appChannelDashboard&&o.threadId){var y=this.findTeamChannelDetails(e,o.threadId);y&&y.channel&&(i=y.channel.displayName,a=this.$translate.instant(this.resources.strings.channel_dashboard_view),e.icon="svg/icons-settings.html")}return this.enhanceItemWithFullMenuTitle(e,i,a,void 0),this.$q.resolve()},e.prototype.enhanceItemWithFullMenuTitle=function(e,t,s,i){var a="";if(t&&(a+=t,s&&(a+=" > "+s,i&&(a+=" > "+i))),!a){if(e.params.ctx===this.constants.navigation.context.chat)a=this.chatPrefix+" "+this.$translate.instant(this.resources.strings.unknown_user);else{var n=this.getErrorLoggingData(e.params);this.logger.error("Error on stateName "+e.stateName+" with parameters: "+JSON.stringify(n)),a=this.$translate.instant(this.resources.strings.history_menu_default_text)}e.icon=this.defaultIconUrl,e.isItalicized=!0}e.title=a},e.prototype.getErrorLoggingData=function(e){var t=["context","ctx","messageId","middlePane","navCtx"],s={};return Object.keys(e).forEach(function(i){s[i]=!!e[i]&&(!t.includes(i)||e[i])}),s},e.prototype.findTeamChannelDetails=function(e,t){var s=this.channelService.getParentTeamAndChannelByChannelId(e.params.threadId);return s&&s.channel&&s.team&&(e.teamId=s.team.siteInfo.groupId,e.etag=s.team.pictureETag),s},e.prototype.handleHistoryItemClick=function(e,t){var s=this.historyStack.length-1;this.hide();var i=s-t;this.eventingService.$emit(this.constants.events.appHeaderBar.navigationIndexChanged,i)},e.prototype.hide=function(){this.$scope.$parent.$hide(),this.historyStack=void 0},e.prototype.handleKeyEvent=function(e,t){e.keyCode===this.constants.keyCodes.enter?(event.stopImmediatePropagation(),this.handleHistoryItemClick(e,t)):e.keyCode===this.constants.keyCodes.escape&&this.hide()},e.componentName="history-dropdown",e}());t.HistoryDropdownController=n,angular.module("teamspace.historyDropdown",["teamspace.channelService","teamspace.tabService","teamspace.conversationsService","teamspace.chatTitlesService","teamspace.eventingService","teamspace.filesUtilityService","teamspace.loggingService","teamspace.utilityService","teamspace.peopleService","teamspace.calendarService","teamspace.callingService","teamspace.appsService"]).component("historyDropdown",{bindings:{navigationStack:"=",navigationIndex:"="},template:a,controller:n,controllerAs:"hdc"})},2533:function(e,t){e.exports='<div class="history-dropdown" ng-if="hdc.isLoaded" analytics-panel-view="{ panel: {type: {{::$root.trackConstants.panelType.historyMenu}} }, dataBag:{count: hdc.historyStack.length }}">\n  <ul acc-role="menu dialog" class="dropdown-menu">\n    <li acc-role="menu-item focus-default has-sub-menu" class="popover-parent" ng-keydown="hdc.handleKeyEvent($event, $index)" ng-repeat="item in hdc.historyStack | orderBy:\'$index\':true">\n      <button aria-label="{{::item.title}}" class="ts-sym history-item app-font-base-regular" ng-class="{\'history-menu-selected\': $index == (hdc.historyStack.length - 1 - hdc.navigationIndex) }" ng-click="hdc.handleHistoryItemClick($event, $index)">\n        <div class="item-picture">\n          \x3c!-- team profile picture --\x3e\n          <profile-picture ng-if="hdc.shouldShowTeamsIcon(item)" css-class="team-icon" display-name="::item.teamName" team-id="item.teamId" etag="item.etag" retain-in-cache="true" source="history-dropdown">\n          </profile-picture>\n\n          \x3c!-- chat profile picture --\x3e\n          <profile-picture ng-if="hdc.shouldShowChatIcon(item)" css-class="user-picture" group-id="item.plGroupKey" group-users="item.pictureGroup" retain-in-cache="true" associated-chat-id="::item.params.slug" source="history-dropdown"></profile-picture>\n\n          \x3c!-- show other icons which are not teams, chat or calendar --\x3e\n          <ng-include class="team-icon" ng-if="!hdc.shouldShowChatIcon(item) && !hdc.shouldShowTeamsIcon(item)" src="item.icon"></ng-include>\n\n        </div>\n        <div class="history-item-name single-line-truncation" ng-class="{\'history-item-name-italic\': item.isItalicized }" title="{{::item.title}}">\n            {{::item.title}}\n        </div>\n      </button>\n    </li>\n  </ul>\n</div>'}},[2531]);